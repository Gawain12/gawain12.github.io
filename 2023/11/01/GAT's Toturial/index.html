

<!DOCTYPE html>
<html lang="zh-CN" data-default-color-scheme=auto>



<head>
  <meta charset="UTF-8">

  <link rel="apple-touch-icon" sizes="76x76" href="/img/fluid.png">
  <link rel="icon" href="/img/fluid.png">
  

  <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=5.0, shrink-to-fit=no">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  
  <meta name="theme-color" content="#2f4154">
  <meta name="author" content="Gawain">
  <meta name="keywords" content="Share">
  
    <meta name="description" content="GATÊïôÁ®ãÊú¨ÊñáÊù•Ëá™ÂØπ‰ΩúËÄÖgordicaleksaÁöÑnotebook‰ª£Á†Åpytorch-GATÁöÑÁøªËØë„ÄÇÊÑüË∞¢‰ΩúËÄÖÊú¨ÊñáÁöÑÊÉ≥Ê≥ïÊòØËÆ©ÈùûÁ†îÁ©∂‰∫∫Âëò‰πüËÉΩÊõ¥ËΩªÊùæÂú∞ÁêÜËß£ÂõæÊ≥®ÊÑèÂäõÁΩëÁªúÔºà‰ª•ÂèäÈÄöÁî®ÁöÑGNNÔºâÔºÅ Âú®Êú¨Êñá‰∏≠ÔºåÊÇ®Â∞ÜËé∑Âæó‰ª•‰∏ãÈóÆÈ¢òÁöÑÁ≠îÊ°àÔºö ‚úÖ GAT Âà∞Â∫ïÊòØ‰ªÄ‰πàÔºü‚úÖ Â¶Ç‰ΩïÂä†ËΩΩÂíåÂèØËßÜÂåñCoraÂºïÊñáÁΩëÁªúÔºü‚úÖ Êàë‰ª¨Â¶Ç‰ΩïËÆ≠ÁªÉGATÔºàCoraÂàÜÁ±ªÁ§∫‰æãÔºâÔºü‚úÖ Â¶Ç‰ΩïÂèØËßÜÂåñ‰∏çÂêåGATÁöÑÂ±ûÊÄßÔºü ÂÆåÊàêÊú¨ËØæÁ®ãÂêéÔºåÊÇ®Â∞ÜÂØπÂõæÁ•ûÁªèÁΩëÁªúÊúâÊõ¥Â•ΩÁöÑÁêÜ">
<meta property="og:type" content="article">
<meta property="og:title" content="GATÊïôÁ®ã">
<meta property="og:url" content="https://gawain12.github.io/2023/11/01/GAT's%20Toturial/index.html">
<meta property="og:site_name" content="Gawain&#39;s notes">
<meta property="og:description" content="GATÊïôÁ®ãÊú¨ÊñáÊù•Ëá™ÂØπ‰ΩúËÄÖgordicaleksaÁöÑnotebook‰ª£Á†Åpytorch-GATÁöÑÁøªËØë„ÄÇÊÑüË∞¢‰ΩúËÄÖÊú¨ÊñáÁöÑÊÉ≥Ê≥ïÊòØËÆ©ÈùûÁ†îÁ©∂‰∫∫Âëò‰πüËÉΩÊõ¥ËΩªÊùæÂú∞ÁêÜËß£ÂõæÊ≥®ÊÑèÂäõÁΩëÁªúÔºà‰ª•ÂèäÈÄöÁî®ÁöÑGNNÔºâÔºÅ Âú®Êú¨Êñá‰∏≠ÔºåÊÇ®Â∞ÜËé∑Âæó‰ª•‰∏ãÈóÆÈ¢òÁöÑÁ≠îÊ°àÔºö ‚úÖ GAT Âà∞Â∫ïÊòØ‰ªÄ‰πàÔºü‚úÖ Â¶Ç‰ΩïÂä†ËΩΩÂíåÂèØËßÜÂåñCoraÂºïÊñáÁΩëÁªúÔºü‚úÖ Êàë‰ª¨Â¶Ç‰ΩïËÆ≠ÁªÉGATÔºàCoraÂàÜÁ±ªÁ§∫‰æãÔºâÔºü‚úÖ Â¶Ç‰ΩïÂèØËßÜÂåñ‰∏çÂêåGATÁöÑÂ±ûÊÄßÔºü ÂÆåÊàêÊú¨ËØæÁ®ãÂêéÔºåÊÇ®Â∞ÜÂØπÂõæÁ•ûÁªèÁΩëÁªúÊúâÊõ¥Â•ΩÁöÑÁêÜ">
<meta property="og:locale" content="zh_CN">
<meta property="og:image" content="https://i-blog.csdnimg.cn/blog_migrate/45d6723d19b7b712df7a148478dd9256.png">
<meta property="og:image" content="https://ptpimg.me/92t60u.png">
<meta property="og:image" content="https://ptpimg.me/s94oh0.png">
<meta property="og:image" content="https://ptpimg.me/yt72e1.png">
<meta property="og:image" content="https://ptpimg.me/mv5zat.png">
<meta property="og:image" content="https://ptpimg.me/855sl2.png">
<meta property="og:image" content="https://ptpimg.me/kk5k1q.png">
<meta property="og:image" content="https://ptpimg.me/02bw9r.png">
<meta property="og:image" content="https://ptpimg.me/8c77s3.png">
<meta property="og:image" content="https://ptpimg.me/6pt7d4.png">
<meta property="og:image" content="https://ptpimg.me/6q14cf.png">
<meta property="og:image" content="https://ptpimg.me/vdku0v.png">
<meta property="article:published_time" content="2023-10-31T17:29:04.000Z">
<meta property="article:modified_time" content="2024-07-30T11:58:29.243Z">
<meta property="article:author" content="Gawain">
<meta property="article:tag" content="Share">
<meta name="twitter:card" content="summary_large_image">
<meta name="twitter:image" content="https://i-blog.csdnimg.cn/blog_migrate/45d6723d19b7b712df7a148478dd9256.png">
  
  
  
  <title>GATÊïôÁ®ã - Gawain&#39;s notes</title>

  <link  rel="stylesheet" href="https://lib.baomitu.com/twitter-bootstrap/4.6.1/css/bootstrap.min.css" />



  <link  rel="stylesheet" href="https://lib.baomitu.com/github-markdown-css/4.0.0/github-markdown.min.css" />

  <link  rel="stylesheet" href="https://lib.baomitu.com/hint.css/2.7.0/hint.min.css" />

  <link  rel="stylesheet" href="https://lib.baomitu.com/fancybox/3.5.7/jquery.fancybox.min.css" />



<!-- ‰∏ªÈ¢ò‰æùËµñÁöÑÂõæÊ†áÂ∫ìÔºå‰∏çË¶ÅËá™Ë°å‰øÆÊîπ -->
<!-- Do not modify the link that theme dependent icons -->

<link rel="stylesheet" href="//at.alicdn.com/t/c/font_1749284_5i9bdhy70f8.css">



<link rel="stylesheet" href="//at.alicdn.com/t/c/font_1736178_k526ubmyhba.css">


<link  rel="stylesheet" href="/css/main.css" />


  <link id="highlight-css" rel="stylesheet" href="/css/highlight.css" />
  
    <link id="highlight-css-dark" rel="stylesheet" href="/css/highlight-dark.css" />
  




  <script id="fluid-configs">
    var Fluid = window.Fluid || {};
    Fluid.ctx = Object.assign({}, Fluid.ctx)
    var CONFIG = {"hostname":"gawain12.github.io","root":"/","version":"1.9.8","typing":{"enable":true,"typeSpeed":70,"cursorChar":"_","loop":false,"scope":[]},"anchorjs":{"enable":true,"element":"h1,h2,h3,h4,h5,h6","placement":"left","visible":"hover","icon":""},"progressbar":{"enable":true,"height_px":3,"color":"#29d","options":{"showSpinner":false,"trickleSpeed":100}},"code_language":{"enable":true,"default":"TEXT"},"copy_btn":true,"image_caption":{"enable":true},"image_zoom":{"enable":true,"img_url_replace":["",""]},"toc":{"enable":true,"placement":"right","headingSelector":"h1,h2,h3,h4,h5,h6","collapseDepth":0},"lazyload":{"enable":true,"loading_img":"/img/loading.gif","onlypost":false,"offset_factor":2},"web_analytics":{"enable":false,"follow_dnt":true,"baidu":null,"google":{"measurement_id":null},"tencent":{"sid":null,"cid":null},"leancloud":{"app_id":"FeJdeqy6cDDAySGfsLP8g1bl-MdYXbMMI","app_key":"Hj6SxzGjyvHq8tHLJTqtcyHZ","server_url":"https://fejdeqy6.api.lncldglobal.com","path":"window.location.pathname","ignore_local":false},"umami":{"src":null,"website_id":null,"domains":null,"start_time":"2024-01-01T00:00:00.000Z","token":null,"api_server":null}},"search_path":"/local-search.xml","include_content_in_search":true};

    if (CONFIG.web_analytics.follow_dnt) {
      var dntVal = navigator.doNotTrack || window.doNotTrack || navigator.msDoNotTrack;
      Fluid.ctx.dnt = dntVal && (dntVal.startsWith('1') || dntVal.startsWith('yes') || dntVal.startsWith('on'));
    }
  </script>
  <script  src="/js/utils.js" ></script>
  <script  src="/js/color-schema.js" ></script>
  


  
<meta name="generator" content="Hexo 7.3.0"></head>


<body>
  

  <header>
    

<div class="header-inner" style="height: 70vh;">
  <nav id="navbar" class="navbar fixed-top  navbar-expand-lg navbar-dark scrolling-navbar">
  <div class="container">
    <a class="navbar-brand" href="/">
      <strong>Gawain&#39;s Blog</strong>
    </a>

    <button id="navbar-toggler-btn" class="navbar-toggler" type="button" data-toggle="collapse"
            data-target="#navbarSupportedContent"
            aria-controls="navbarSupportedContent" aria-expanded="false" aria-label="Toggle navigation">
      <div class="animated-icon"><span></span><span></span><span></span></div>
    </button>

    <!-- Collapsible content -->
    <div class="collapse navbar-collapse" id="navbarSupportedContent">
      <ul class="navbar-nav ml-auto text-center">
        
          
          
          
          
            <li class="nav-item">
              <a class="nav-link" href="/" target="_self">
                <i class="iconfont icon-home-fill"></i>
                <span>È¶ñÈ°µ</span>
              </a>
            </li>
          
        
          
          
          
          
            <li class="nav-item">
              <a class="nav-link" href="/archives/" target="_self">
                <i class="iconfont icon-archive-fill"></i>
                <span>ÂΩíÊ°£</span>
              </a>
            </li>
          
        
          
          
          
          
            <li class="nav-item dropdown">
              <a class="nav-link dropdown-toggle" target="_self" href="javascript:;" role="button"
                 data-toggle="dropdown" aria-haspopup="true" aria-expanded="false">
                <i class="iconfont icon-category-fill"></i>
                <span>‰π¶ÂΩ±Èü≥ËÆ∞ÂΩï</span>
              </a>
              <div class="dropdown-menu" aria-labelledby="navbarDropdown">
                
                  
                  
                  
                  <a class="dropdown-item" href="/books/" target="_self">
                    <i class="icofont-abc"></i>
                    <span>üìñÊñáÂ≠¶</span>
                  </a>
                
                  
                  
                  
                  <a class="dropdown-item" href="/movies/" target="_self">
                    <i class="icofont-love"></i>
                    <span>üé¨ÁîµÂΩ±</span>
                  </a>
                
                  
                  
                  
                  <a class="dropdown-item" href="/songs/" target="_self">
                    <i class="icofont-notebook"></i>
                    <span>üéµÈü≥‰πê</span>
                  </a>
                
              </div>
            </li>
          
        
          
          
          
          
            <li class="nav-item">
              <a class="nav-link" href="/tags/" target="_self">
                <i class="iconfont icon-tags-fill"></i>
                <span>Ê†áÁ≠æ</span>
              </a>
            </li>
          
        
          
          
          
          
            <li class="nav-item">
              <a class="nav-link" href="/remark/" target="_self">
                
                <span>ÁïôË®ÄÊùø</span>
              </a>
            </li>
          
        
          
          
          
          
            <li class="nav-item">
              <a class="nav-link" href="/about/" target="_self">
                <i class="iconfont icon-user-fill"></i>
                <span>ÂÖ≥‰∫é</span>
              </a>
            </li>
          
        
        
          <li class="nav-item" id="search-btn">
            <a class="nav-link" target="_self" href="javascript:;" data-toggle="modal" data-target="#modalSearch" aria-label="Search">
              <i class="iconfont icon-search"></i>
            </a>
          </li>
          
        
        
          <li class="nav-item" id="color-toggle-btn">
            <a class="nav-link" target="_self" href="javascript:;" aria-label="Color Toggle">
              <i class="iconfont icon-dark" id="color-toggle-icon"></i>
            </a>
          </li>
        
      </ul>
    </div>
  </div>
</nav>

  

<div id="banner" class="banner" parallax=true
     style="background: url('/img/default.png') no-repeat center center; background-size: cover;">
  <div class="full-bg-img">
    <div class="mask flex-center" style="background-color: rgba(0, 0, 0, 0.3)">
      <div class="banner-text text-center fade-in-up">
        <div class="h2">
          
            <span id="subtitle" data-typed-text="GATÊïôÁ®ã"></span>
          
        </div>

        
          
  <div class="mt-3">
    
    
      <span class="post-meta">
        <i class="iconfont icon-date-fill" aria-hidden="true"></i>
        <time datetime="2023-11-01 01:29" pubdate>
          2023Âπ¥11Êúà1Êó• ÂáåÊô®
        </time>
      </span>
    
  </div>

  <div class="mt-1">
    
      <span class="post-meta mr-2">
        <i class="iconfont icon-chart"></i>
        
          13k Â≠ó
        
      </span>
    

    
      <span class="post-meta mr-2">
        <i class="iconfont icon-clock-fill"></i>
        
        
        
          112 ÂàÜÈíü
        
      </span>
    

    
    
  </div>


        
      </div>

      
    </div>
  </div>
</div>

</div>

  </header>

  <main>
    
      

<div class="container-fluid nopadding-x">
  <div class="row nomargin-x">
    <div class="side-col d-none d-lg-block col-lg-2">
      

    </div>

    <div class="col-lg-8 nopadding-x-md">
      <div class="container nopadding-x-md" id="board-ctn">
        <div id="board">
          <article class="post-content mx-auto">
            <h1 id="seo-header">GATÊïôÁ®ã</h1>
            
              <p id="updated-time" class="note note-info" style="">
                
                  
                    Êú¨ÊñáÊúÄÂêéÊõ¥Êñ∞‰∫é 2024Âπ¥7Êúà30Êó• Êôö‰∏ä
                  
                
              </p>
            
            
              <div class="markdown-body">
                
                <h1 id="GATÊïôÁ®ã"><a href="#GATÊïôÁ®ã" class="headerlink" title="GATÊïôÁ®ã"></a>GATÊïôÁ®ã</h1><h3 id="Êú¨ÊñáÊù•Ëá™ÂØπ‰ΩúËÄÖgordicaleksaÁöÑnotebook‰ª£Á†Åpytorch-GATÁöÑÁøªËØë„ÄÇÊÑüË∞¢‰ΩúËÄÖ"><a href="#Êú¨ÊñáÊù•Ëá™ÂØπ‰ΩúËÄÖgordicaleksaÁöÑnotebook‰ª£Á†Åpytorch-GATÁöÑÁøªËØë„ÄÇÊÑüË∞¢‰ΩúËÄÖ" class="headerlink" title="Êú¨ÊñáÊù•Ëá™ÂØπ‰ΩúËÄÖgordicaleksaÁöÑnotebook‰ª£Á†Åpytorch-GATÁöÑÁøªËØë„ÄÇÊÑüË∞¢‰ΩúËÄÖ"></a><strong>Êú¨ÊñáÊù•Ëá™ÂØπ‰ΩúËÄÖgordicaleksaÁöÑnotebook‰ª£Á†Å<a target="_blank" rel="noopener" href="https://github.com/gordicaleksa/pytorch-GAT">pytorch-GAT</a>ÁöÑÁøªËØë„ÄÇÊÑüË∞¢‰ΩúËÄÖ</strong></h3><p>Êú¨ÊñáÁöÑÊÉ≥Ê≥ïÊòØËÆ©ÈùûÁ†îÁ©∂‰∫∫Âëò‰πüËÉΩÊõ¥ËΩªÊùæÂú∞ÁêÜËß£ÂõæÊ≥®ÊÑèÂäõÁΩëÁªúÔºà‰ª•ÂèäÈÄöÁî®ÁöÑGNNÔºâÔºÅ</p>
<p>Âú®Êú¨Êñá‰∏≠ÔºåÊÇ®Â∞ÜËé∑Âæó‰ª•‰∏ãÈóÆÈ¢òÁöÑÁ≠îÊ°àÔºö</p>
<p>‚úÖ GAT Âà∞Â∫ïÊòØ‰ªÄ‰πàÔºü<br/><br>‚úÖ Â¶Ç‰ΩïÂä†ËΩΩÂíåÂèØËßÜÂåñCoraÂºïÊñáÁΩëÁªúÔºü<br/><br>‚úÖ Êàë‰ª¨Â¶Ç‰ΩïËÆ≠ÁªÉGATÔºàCoraÂàÜÁ±ªÁ§∫‰æãÔºâÔºü<br/><br>‚úÖ Â¶Ç‰ΩïÂèØËßÜÂåñ‰∏çÂêåGATÁöÑÂ±ûÊÄßÔºü<br/></p>
<p>ÂÆåÊàêÊú¨ËØæÁ®ãÂêéÔºåÊÇ®Â∞ÜÂØπÂõæÁ•ûÁªèÁΩëÁªúÊúâÊõ¥Â•ΩÁöÑÁêÜËß£ÔºÅ</p>
<p><em>Ê≥®ÊÑèÔºöÂú®Êú¨Á¨îËÆ∞Êú¨‰∏≠ÔºåÊàë‰ª¨Â∞ÜÈáçÁÇπÂÖ≥Ê≥® CoraÔºà‰º†ÂØºÊ≥ïÁ§∫‰æãÔºâÔºåÂ¶ÇÊûúÈúÄË¶ÅÂèØ‰ª•Êü•ÁúãÂÖ∂‰ªñÁ¨îËÆ∞Êú¨‰∏≠ÁöÑPPI - ËõãÁôΩË¥®Áõ∏‰∫í‰ΩúÁî®Êï∞ÊçÆÈõÜÔºàÂΩíÁ∫≥Ê≥ïÔºâ„ÄÇ</em></p>
<p>ÂæàÂ•ΩÔºåËÆ©Êàë‰ª¨ÂºÄÂßãÂêßÔºÅ</p>
<hr>
<h2 id="ÂõæÊ≥®ÊÑèÂäõÁΩëÁªúÂà∞Â∫ïÊòØ‰ªÄ‰πàÔºü"><a href="#ÂõæÊ≥®ÊÑèÂäõÁΩëÁªúÂà∞Â∫ïÊòØ‰ªÄ‰πàÔºü" class="headerlink" title="ÂõæÊ≥®ÊÑèÂäõÁΩëÁªúÂà∞Â∫ïÊòØ‰ªÄ‰πàÔºü"></a>ÂõæÊ≥®ÊÑèÂäõÁΩëÁªúÂà∞Â∫ïÊòØ‰ªÄ‰πàÔºü</h2><p>ÂõæÊ≥®ÊÑèÂäõÁΩëÁªúÔºàGraph Attention NetworkÔºâÔºåÁÆÄÁß∞ GATÔºåÊòØ‰∏ÄÁßçÂõæÁ•ûÁªèÁΩëÁªúÔºàGNNÔºâÔºåÊó©Âú® 2017 Âπ¥Â∞±Âú®‰∏ÄÁØáÂêç‰∏∫<a target="_blank" rel="noopener" href="https://arxiv.org/abs/1710.10903">„ÄäGraph Attention Networks„Äã</a>Veliƒçkoviƒá et al.ÁöÑËÆ∫Êñá‰∏≠ÂèëË°®„ÄÇ</p>
<p>‰∫ãÂÆûËØÅÊòéÔºåÂ∞ÜÊ≥®ÊÑèÂäõÁöÑÊÉ≥Ê≥ï‰∏éÁé∞ÊúâÁöÑÂõæÂç∑ÁßØÁΩëÁªúÔºàGCNÔºâÁõ∏ÁªìÂêàÊòØ‰∏Ä‰∏™ÂæàÂ•ΩÁöÑ‰∏æÊé™ÔºåGATÊòØGNNÊñáÁåÆ‰∏≠Ë¢´ÂºïÁî®Ê¨°Êï∞Á¨¨‰∫åÂ§öÁöÑËÆ∫ÊñáÔºàÊà™Ëá≥Êí∞ÂÜôÊú¨ÊñáÊó∂Ôºâ„ÄÇ</p>
<p>Âõ†‰∏∫<code>GCN + attention = GAT</code>‰∏∫‰∫ÜÁêÜËß£GATÔºå‰Ω†Âü∫Êú¨‰∏äÈúÄË¶ÅÁêÜËß£GCN„ÄÇ</p>
<p>Êï¥‰∏™ÊÉ≥Ê≥ïÊù•Ëá™ CNN„ÄÇÂç∑ÁßØÁ•ûÁªèÁΩëÁªúÂèëÂ±ïÈùûÂ∏∏Â•ΩÔºåËß£ÂÜ≥‰∫ÜÂêÑÁßçËÆ°ÁÆóÊú∫ËßÜËßâ‰ªªÂä°ÔºåÂπ∂Âú®Ê∑±Â∫¶Â≠¶‰π†È¢ÜÂüüÂºïËµ∑‰∫ÜÂ∑®Â§ßÁöÑËΩ∞Âä®ÔºåÂõ†Ê≠§‰∏Ä‰∫õ‰∫∫ÂÜ≥ÂÆöÂ∞ÜËøô‰∏™ÊÉ≥Ê≥ïËΩ¨ÁßªÂà∞Âõæ‰∏ä„ÄÇ</p>
<p>Âü∫Êú¨ÈóÆÈ¢òÊòØÔºåËôΩÁÑ∂ÂõæÂÉè‰Ωç‰∫éËßÑÂàôÁΩëÊ†º‰∏äÔºàÊÇ®‰πüÂèØ‰ª•Â∞ÜÂÖ∂ËßÜ‰∏∫ÂõæÂΩ¢ÔºâÔºå‰ΩÜÂõ†Ê≠§ÂÖ∑ÊúâÁ≤æÁ°ÆÁöÑÈ°∫Â∫èÊ¶ÇÂøµÔºà‰æãÂ¶ÇÊàëÁöÑÂ∑¶‰∏äËßíÈÇªÂ±ÖÔºàÈÄöÂ∏∏Áß∞‰∏∫CV‰∏ñÁïåÈáåÁöÑÂÉèÁ¥†Ôºâ))ÔºåÂõæ‰∏çÂÖ∑Â§áËøôÁßçËâØÂ•ΩÁöÑÁâπÊÄßÔºåÂπ∂‰∏îÈÇªÂ±ÖÁöÑÊï∞Èáè‰ª•ÂèäÈÇªÂ±ÖÁöÑÈ°∫Â∫èÈÉΩÂèØËÉΩ‰ºöÊúâÊâÄ‰∏çÂêå„ÄÇ</p>
<p>ÈÇ£‰πàÂ¶Ç‰Ωï‰∏∫ÂõæÂÆö‰πâÂÜÖÊ†∏Âë¢ÔºüÂÜÖÊ†∏Â§ßÂ∞è‰∏çËÉΩÊòØËøôÊ†∑3x3ÔºåÂõ†‰∏∫ÊúâÊó∂‰∏Ä‰∏™ËäÇÁÇπÊúâ2‰∏™ÈÇªÂ±ÖÔºåÊúâÊó∂ÊòØ 233240Ôºà<em>ÊäìÁãÇ</em>Ôºâ„ÄÇ</p>
<p>Âá∫Áé∞‰∫Ü 2 ‰∏™‰∏ªË¶ÅÊÉ≥Ê≥ïÔºö</p>
<ul>
<li>Ë∞±ÊñπÊ≥ïÔºàÂÆÉ‰ª¨ÈÉΩ‰ª•ÊüêÁßçÊñπÂºèÂà©Áî®ÂõæÊãâÊôÆÊãâÊñØÁâπÂæÅÂü∫ÔºàÊàëÂú®ËøôÈáåÂÆåÂÖ®ÂøΩÁï•ÂÆÉ‰ª¨ÔºâÔºâ</li>
<li>Á©∫Èó¥ÊñπÊ≥ï</li>
</ul>
<p>Â∞ΩÁÆ°Á©∫Èó¥ÊñπÊ≥ïÂèØËÉΩÈöêÁ∫¶ÂèóÂà∞Ë∞±ÊñπÊ≥ïÁöÑÂêØÂèëÔºå‰ΩÜÁõ¥Êé•‰ªéÁ©∫Èó¥ËßíÂ∫¶ÊÄùËÄÉÂÆÉ‰ª¨Ë¶ÅÂ•ΩÂæóÂ§ö„ÄÇÂ•ΩÁöÑÔºåÂ∞±ËøôÊ†∑Âêß„ÄÇ</p>
<hr>
<p><strong>Á©∫Èó¥ÔºàÊ∂àÊÅØ‰º†ÈÄíÔºâÊñπÊ≥ïÁöÑÈ´òÁ∫ßËß£ÈáäÔºö</strong></p>
<p>ÊâÄ‰ª•‰Ω†ÂèØ‰ª•‰ΩøÁî®Êù•Ëá™ÈÇªÂ±ÖÁöÑÁâπÂæÅÂêëÈáè„ÄÇÊÇ®ÊâßË°å‰ª•‰∏ãÊìç‰ΩúÔºö</p>
<ol>
<li>‰Ω†‰ª•ÊüêÁßçÊñπÂºèÂèòÊç¢ÂÆÉ‰ª¨Ôºà‰πüËÆ∏ÊòØÁ∫øÊÄßÊäïÂΩ±Ôºâ</li>
<li>‰Ω†‰ª•ÊüêÁßçÊñπÂºèËÅöÂêàÂÆÉ‰ª¨Ôºà‰πüËÆ∏Áî®Ê≥®ÊÑèÂäõÁ≥ªÊï∞Êù•Ë°°ÈáèÂÆÉ‰ª¨ÔºåÁûßÔºåÊàë‰ª¨ÂæóÂà∞‰∫Ü GATÔºà‰Ω†ÁúãÊàëÂú®ÈÇ£ÈáåÂÅö‰∫Ü‰ªÄ‰πàÔºâÔºâ</li>
<li>ÊÇ®ÂèØ‰ª•ÈÄöËøáÂ∞ÜÂΩìÂâçËäÇÁÇπÔºàÂèòÊç¢ÂêéÁöÑÔºâÁâπÂæÅÂêëÈáè‰∏éËÅöÂêàÈÇªÂ±ÖË°®Á§∫Áõ∏ÁªìÂêàÊù•Êõ¥Êñ∞ÂΩìÂâçËäÇÁÇπÁöÑÁâπÂæÅÂêëÈáèÔºà‰ª•ÊüêÁßçÊñπÂºèÔºâ„ÄÇ<br>Â∑Æ‰∏çÂ§öÂ∞±ÊòØËøôÊ†∑Ôºå‰Ω†ÂèØ‰ª•Â∞ÜËÆ∏Â§ö‰∏çÂêåÁöÑ GNN ÊîæÂÖ•Ëøô‰∏™Ê°ÜÊû∂‰∏≠„ÄÇ</li>
</ol>
<p>GAT Á§∫ÊÑèÂõæÂ¶Ç‰∏ãÔºà‰∏çÂêåÈ¢úËâ≤ÁöÑËæπ‰ª£Ë°®‰∏çÂêåÁöÑÊ≥®ÊÑèÂäõÂ§¥ÔºâÔºö<br><img src="https://i-blog.csdnimg.cn/blog_migrate/45d6723d19b7b712df7a148478dd9256.png" srcset="/img/loading.gif" lazyload alt="transformer architecture" align="center" style="width: 500px;"/> <br/></p>
<p><strong>ÊúâË∂£ÁöÑ‰∫ãÂÆû:</strong> <em>transformers</em> ÂèØ‰ª•Ë¢´ËÆ§‰∏∫ÊòØGATÁöÑ‰∏Ä‰∏™Áâπ‰æã‚ÄîÂΩìËæìÂÖ•ÂõæÊòØ<strong>ÂÖ®ËøûÊé•</strong>Êó∂„ÄÇÊü•Áúã<a target="_blank" rel="noopener" href="https://thegradient.pub/transformers-are-graph-neural-networks/">Ê≠§ÂçöÂÆ¢</a>‰∫ÜËß£Êõ¥Â§öËØ¶ÁªÜ‰ø°ÊÅØ„ÄÇ</p>
<hr>
<p>ËøôÂ∞±ÊòØÊÇ®Áé∞Âú®ÈúÄË¶Å‰∫ÜËß£ÁöÑ‰∏ÄÂàáÔºÅ</p>
<p>Â¶ÇÊûúÊÇ®ÈúÄË¶ÅËøõ‰∏ÄÊ≠•Â∏ÆÂä©ÁêÜËß£ÊâÄÊúâÁªÜËäÇÔºåÊàë‰ª¨ÂàõÂª∫‰∫Ü <a target="_blank" rel="noopener" href="https://www.youtube.com/watch?v=uFLeKkXWq2c">in-depth overview of the GAT paper:</a>ËøôÁØáGAT ËÆ∫ÊñáÁöÑÊ∑±ÂÖ•Ê¶ÇËø∞Ôºö</p>
<p>ÈáçË¶ÅÊèêÁ§∫ÔºöÊ≠§Á¨îËÆ∞Êú¨‰∏≠ÁöÑ‰ª£Á†ÅÊòØËøô‰∏™repo‰∏≠ÂèØ‰ª•‰ΩøÁî®ÁöÑ‰ª£Á†ÅÁöÑÂ≠êÈõÜ„ÄÇÊàëÂ∞ÜÂú®ËøôÈáåÈáçÁÇπÂÖ≥Ê≥®Âçï‰∏™GATÂÆûÁé∞ÔºàÊ¶ÇÂøµ‰∏äÊúÄÈöæÁêÜËß£ÁöÑÂÆûÁé∞Ôºå‰ΩÜÂêåÊó∂‰πüÊòØÊúÄÊúâÊïàÁöÑÂÆûÁé∞Ôºâ„ÄÇËØ∑Ê≥®ÊÑèÔºåÊàëÂÆûÈôÖ‰∏äÂú®repo‰∏≠Êúâ3‰∏™GATÂÆûÁé∞„ÄÇ</p>
<p>ÊäõÂºÄËøô‰∫õÔºåËÆ©Êàë‰ª¨ÂºÄÂßãÊ∑±ÂÖ•Á†îÁ©∂ÂêßÔºÅËÆ©Êàë‰ª¨‰ªé‰∏éÊï∞ÊçÆÂä†ËΩΩÂíåÂèØËßÜÂåñÁõ∏ÂÖ≥ÁöÑÂØºÂÖ•ÂºÄÂßã„ÄÇ</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><code class="hljs python"><span class="hljs-comment"># I always like to structure my imports into Python&#x27;s native libs,</span><br><span class="hljs-comment"># stuff I installed via conda/pip and local file imports (but we don&#x27;t have those here)</span><br><br><span class="hljs-keyword">import</span> pickle<br><br><span class="hljs-comment"># ÂèØËßÜÂåñÁõ∏ÂÖ≥ÂØºÂÖ•</span><br><span class="hljs-keyword">import</span> matplotlib.pyplot <span class="hljs-keyword">as</span> plt<br><span class="hljs-keyword">import</span> networkx <span class="hljs-keyword">as</span> nx<br><span class="hljs-keyword">import</span> igraph <span class="hljs-keyword">as</span> ig<br>plt.rcParams[<span class="hljs-string">&#x27;font.sans-serif&#x27;</span>] = [<span class="hljs-string">&#x27;SimHei&#x27;</span>]<br><span class="hljs-comment"># ‰∏ªË¶ÅÁöÑËÆ°ÁÆó‰æùËµñ</span><br><span class="hljs-keyword">import</span> scipy.sparse <span class="hljs-keyword">as</span> sp<br><span class="hljs-keyword">import</span> numpy <span class="hljs-keyword">as</span> np<br><br><span class="hljs-comment"># Ê∑±Â∫¶Â≠¶‰π†Áõ∏ÂÖ≥</span><br><span class="hljs-keyword">import</span> torch<br></code></pre></td></tr></table></figure>


<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br></pre></td><td class="code"><pre><code class="hljs python"><span class="hljs-keyword">import</span> os<br><span class="hljs-keyword">import</span> enum<br><br><span class="hljs-comment"># ÊîØÊåÅÁöÑÊï∞ÊçÆÈõÜ - ‰ªÖÂú®Ê≠§Á¨îËÆ∞Êú¨‰∏≠‰ΩøÁî® Cora</span><br><span class="hljs-keyword">class</span> <span class="hljs-title class_">DatasetType</span>(enum.Enum):<br>    CORA = <span class="hljs-number">0</span><br><br>    <br><span class="hljs-comment"># Networkx Âπ∂‰∏çÊòØ‰∏ì‰∏∫ÁªòÂõæËÄåÂà∂‰ΩúÁöÑÔºå‰ΩÜÊàëËøõË°å‰∫Ü‰∏Ä‰∫õÂÆûÈ™å</span><br><span class="hljs-keyword">class</span> <span class="hljs-title class_">GraphVisualizationTool</span>(enum.Enum):<br>    NETWORKX = <span class="hljs-number">0</span>,<br>    IGRAPH = <span class="hljs-number">1</span><br><br><br><span class="hljs-comment"># Êàë‰ª¨Â∞Ü‰ªéÊ≠§ÁõÆÂΩï‰∏≠ÂØºÂá∫ÂíåËØªÂèñÊï∞ÊçÆ</span><br>DATA_DIR_PATH = os.path.join(os.getcwd(), <span class="hljs-string">&#x27;data&#x27;</span>)<br>CORA_PATH = os.path.join(DATA_DIR_PATH, <span class="hljs-string">&#x27;cora&#x27;</span>)  <span class="hljs-comment"># ËøôÊòØÂ∑≤ÁªèÊ£ÄÂÖ•ÁöÑÔºåÊó†ÈúÄÂàõÂª∫ÁõÆÂΩï</span><br><br><span class="hljs-comment">#</span><br><span class="hljs-comment"># Cora ÁâπÂÆöÂ∏∏Èáè</span><br><span class="hljs-comment">#</span><br><br><span class="hljs-comment"># Thomas Kipf Á≠â‰∫∫Âú® GCN ËÆ∫Êñá‰∏≠È¶ñÊ¨°‰ΩøÁî®‰∫ÜÊ≠§ÊãÜÂàÜÔºåÂêéÊù• Petar Veliƒçkoviƒá Á≠â‰∫∫Âú® GAT ËÆ∫Êñá‰∏≠‰πü‰ΩøÁî®‰∫ÜÂÆÉ</span><br>CORA_TRAIN_RANGE = [<span class="hljs-number">0</span>, <span class="hljs-number">140</span>]  <span class="hljs-comment"># Êàë‰ª¨Â∞ÜÂâç 140 ‰∏™ËäÇÁÇπÁî®‰ΩúËÆ≠ÁªÉËäÇÁÇπ</span><br>CORA_VAL_RANGE = [<span class="hljs-number">140</span>, <span class="hljs-number">140</span>+<span class="hljs-number">500</span>]<br>CORA_TEST_RANGE = [<span class="hljs-number">1708</span>, <span class="hljs-number">1708</span>+<span class="hljs-number">1000</span>]<br>CORA_NUM_INPUT_FEATURES = <span class="hljs-number">1433</span><br>CORA_NUM_CLASSES = <span class="hljs-number">7</span><br><br><span class="hljs-comment"># Êó†ËÆ∫‰ΩïÊó∂Êàë‰ª¨ÈúÄË¶ÅÂèØËßÜÂåñÊù•Ëá™‰∏çÂêåÁ±ªÂà´ÁöÑÁÇπÊó∂Ôºàt-SNE„ÄÅCORA ÂèØËßÜÂåñÔºâ</span><br>cora_label_to_color_map = &#123;<span class="hljs-number">0</span>: <span class="hljs-string">&quot;red&quot;</span>, <span class="hljs-number">1</span>: <span class="hljs-string">&quot;blue&quot;</span>, <span class="hljs-number">2</span>: <span class="hljs-string">&quot;green&quot;</span>, <span class="hljs-number">3</span>: <span class="hljs-string">&quot;orange&quot;</span>, <span class="hljs-number">4</span>: <span class="hljs-string">&quot;yellow&quot;</span>, <span class="hljs-number">5</span>: <span class="hljs-string">&quot;pink&quot;</span>, <span class="hljs-number">6</span>: <span class="hljs-string">&quot;gray&quot;</span>&#125;<br><br></code></pre></td></tr></table></figure>

<p>ËøôÊ†∑Êàë‰ª¨Â∞±Ëß£ÈîÅ‰∫Ü1Á∫ßÔºàÊï∞ÊçÆüìúÔºâ„ÄÇÊàë‰ª¨ÁªßÁª≠ÔºÅ</p>
<h1 id="Á¨¨-1-ÈÉ®ÂàÜÔºö‰∫ÜËß£ÊÇ®ÁöÑÊï∞ÊçÆÔºà‰∏éÊï∞ÊçÆÂêàËÄå‰∏∫‰∏Äüìú‚ù§Ô∏èÔºâ"><a href="#Á¨¨-1-ÈÉ®ÂàÜÔºö‰∫ÜËß£ÊÇ®ÁöÑÊï∞ÊçÆÔºà‰∏éÊï∞ÊçÆÂêàËÄå‰∏∫‰∏Äüìú‚ù§Ô∏èÔºâ" class="headerlink" title="Á¨¨ 1 ÈÉ®ÂàÜÔºö‰∫ÜËß£ÊÇ®ÁöÑÊï∞ÊçÆÔºà‰∏éÊï∞ÊçÆÂêàËÄå‰∏∫‰∏Äüìú‚ù§Ô∏èÔºâ"></a>Á¨¨ 1 ÈÉ®ÂàÜÔºö‰∫ÜËß£ÊÇ®ÁöÑÊï∞ÊçÆÔºà‰∏éÊï∞ÊçÆÂêàËÄå‰∏∫‰∏Äüìú‚ù§Ô∏èÔºâ</h1><p>ÊàëÂ∞Ü‰ΩøÁî® Cora ÂºïÊñáÁΩëÁªú‰Ωú‰∏∫Êú¨Á¨îËÆ∞Êú¨‰∏≠ÁöÑËøêË°åÁ§∫‰æã„ÄÇ</p>
<p>ËØ¥Âà∞ËøôÈáåÔºå‰Ω†ÂèØËÉΩ‰ºöÊÉ≥Ôºå‰º†ÂØºÂ≠¶‰π†ÂíåÂΩíÁ∫≥Â≠¶‰π†Êúâ‰ªÄ‰πàÂå∫Âà´ÔºüÂ¶ÇÊûúÊÇ®‰∏çÁÜüÊÇâ GNNÔºåËøôÂèØËÉΩÁúãËµ∑Êù•ÊòØ‰∏Ä‰∏™Â•áÊÄ™ÁöÑÊ¶ÇÂøµ„ÄÇ‰ΩÜÂÆûÈôÖ‰∏äÂæàÁÆÄÂçï„ÄÇ</p>
<p><strong>‰º†ÂØºÊ≥ï</strong> - ‰Ω†Êúâ‰∏Ä‰∏™ÂõæÔºàÂ¶Ç CoraÔºâÔºå‰Ω†Â∞Ü‰∏Ä‰∫õËäÇÁÇπÔºàËÄå‰∏çÊòØÂõæÔºâÂàÜÊàêËÆ≠ÁªÉ&#x2F;È™åËØÅ&#x2F;ÊµãËØïËÆ≠ÁªÉÈõÜ„ÄÇÂú®ËÆ≠ÁªÉÊó∂ÔºåÊÇ®Â∞Ü‰ªÖ‰ΩøÁî®ËÆ≠ÁªÉËäÇÁÇπ‰∏≠ÁöÑÊ†áÁ≠æ„ÄÇ‰ΩÜ„ÄÇÂú®ÂâçÂêë‰º†Êí≠ÊúüÈó¥ÔºåÊ†πÊçÆÁ©∫Èó¥ GNN Â∑•‰ΩúÊñπÂºèÁöÑÊú¨Ë¥®ÔºåÊÇ®Â∞ÜËÅöÂêàÊù•Ëá™ÈÇªÂ±ÖÁöÑÁâπÂæÅÂêëÈáèÔºåÂÖ∂‰∏≠‰∏Ä‰∫õÂèØËÉΩÂ±û‰∫éÈ™åËØÅÁîöËá≥ÊµãËØïÈõÜÔºÅË¶ÅÁÇπÊòØ - ÊÇ®Ê≤°Êúâ‰ΩøÁî®ÂÆÉ‰ª¨ÁöÑÊ†áÁ≠æ‰ø°ÊÅØÔºåËÄåÊòØ‰ΩøÁî®‰∫ÜÁªìÊûÑ‰ø°ÊÅØÂèäÂÖ∂ÁâπÂæÅ„ÄÇ</p>
<p><strong>ÂΩíÁ∫≥Ê≥ï</strong> - Â¶ÇÊûúÊÇ®ÊúâËÆ°ÁÆóÊú∫ËßÜËßâÊàñ NLPÂü∫Á°ÄÔºåÊÇ®ÂèØËÉΩ‰ºöÊõ¥ÁÜüÊÇâËøô‰∏ÄÊ¶ÇÂøµ„ÄÇÊÇ®Êúâ‰∏ÄÁªÑËÆ≠ÁªÉÂõæ„ÄÅ‰∏ÄÁªÑÂçïÁã¨ÁöÑÈ™åËØÅÂõæÔºåÂΩìÁÑ∂ËøòÊúâ‰∏ÄÁªÑÂçïÁã¨ÁöÑÊµãËØïÂõæ„ÄÇ‰æãÂ¶ÇÔºåÂú®ÂõæÂàÜÁ±ª‰ªªÂä°‰∏≠ÔºåËÆ≠ÁªÉÊï∞ÊçÆÂèØ‰ª•ÂåÖÂê´Â∏¶Ê†áÁ≠æÁöÑÂõæÔºåÊµãËØïÊï∞ÊçÆÂèØ‰ª•ÂåÖÂê´‰∏çÂ∏¶Ê†áÁ≠æÁöÑÂõæ„ÄÇÊ®°ÂûãÂè™ËÉΩÂà©Áî®ËÆ≠ÁªÉÊï∞ÊçÆ‰∏≠ÁöÑÂõæÊù•Â≠¶‰π†ÂõæÂàÜÁ±ªÊ®°Âûã„ÄÇ</p>
<p>Ëß£ÈáäËøô‰∫õÂÆåÂêéÔºåËÆ©Êàë‰ª¨ËøõÂÖ•‰ª£Á†ÅÂπ∂Âä†ËΩΩÂíåÂèØËßÜÂåñ Cora„ÄÇ</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><code class="hljs python"><span class="hljs-comment"># È¶ñÂÖàÔºåËÆ©Êàë‰ª¨ÂÆö‰πâËøô‰∫õÁÆÄÂçïÁöÑÂäüËÉΩÁî®‰∫éÂä†ËΩΩ/‰øùÂ≠òpickleÊñá‰ª∂ - ‰∏∫‰∫ÜCoraÊàë‰ª¨ÈúÄË¶ÅÂÆÉ‰ª¨</span><br><br><span class="hljs-comment"># ÊâÄÊúâCoraÊï∞ÊçÆÈÉΩÂ≠òÂÇ®‰∏∫pickleÊñá‰ª∂</span><br><span class="hljs-keyword">def</span> <span class="hljs-title function_">pickle_read</span>(<span class="hljs-params">path</span>):<br>    <span class="hljs-keyword">with</span> <span class="hljs-built_in">open</span>(path, <span class="hljs-string">&#x27;rb&#x27;</span>) <span class="hljs-keyword">as</span> file:<br>        data = pickle.load(file)<br><br>    <span class="hljs-keyword">return</span> data<br><br><span class="hljs-keyword">def</span> <span class="hljs-title function_">pickle_save</span>(<span class="hljs-params">path, data</span>):<br>    <span class="hljs-keyword">with</span> <span class="hljs-built_in">open</span>(path, <span class="hljs-string">&#x27;wb&#x27;</span>) <span class="hljs-keyword">as</span> file:<br>        pickle.dump(data, file, protocol=pickle.HIGHEST_PROTOCOL)<br></code></pre></td></tr></table></figure>

<p>Áé∞Âú®ËÆ©Êàë‰ª¨ÁúãÁúãÂ¶Ç‰ΩïÂä†ËΩΩ CoraÔºÅ</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br></pre></td><td class="code"><pre><code class="hljs python"><span class="hljs-comment"># Êàë‰ª¨Á®çÂêé‰ºö‰º†ÂÖ•ËÆ≠ÁªÉÈÖçÁΩÆÂ≠óÂÖ∏</span><br><span class="hljs-keyword">def</span> <span class="hljs-title function_">load_graph_data</span>(<span class="hljs-params">training_config, device</span>):<br>    dataset_name = training_config[<span class="hljs-string">&#x27;dataset_name&#x27;</span>].lower()<br>    should_visualize = training_config[<span class="hljs-string">&#x27;should_visualize&#x27;</span>]<br><br>    <span class="hljs-keyword">if</span> dataset_name == DatasetType.CORA.name.lower():<br><br>        <span class="hljs-comment"># ÂΩ¢Áä∂ = (N, FIN)ÔºåÂÖ∂‰∏≠ N ÊòØËäÇÁÇπÊï∞ÔºåFIN ÊòØËæìÂÖ•ÁâπÂæÅÊï∞</span><br>        node_features_csr = pickle_read(os.path.join(CORA_PATH, <span class="hljs-string">&#x27;node_features.csr&#x27;</span>))<br>        <span class="hljs-comment"># ÂΩ¢Áä∂ = (N, 1)</span><br>        node_labels_npy = pickle_read(os.path.join(CORA_PATH, <span class="hljs-string">&#x27;node_labels.npy&#x27;</span>))<br>        <span class="hljs-comment"># ÂΩ¢Áä∂ = (N, Áõ∏ÈÇªËäÇÁÇπÊï∞) &lt;- ËøôÊòØ‰∏Ä‰∏™Â≠óÂÖ∏Ôºå‰∏çÊòØÁü©ÈòµÔºÅ</span><br>        adjacency_list_dict = pickle_read(os.path.join(CORA_PATH, <span class="hljs-string">&#x27;adjacency_list.dict&#x27;</span>))<br><br>        <span class="hljs-comment"># Ê†áÂáÜÂåñÁâπÂæÅÔºàÊúâÂä©‰∫éËÆ≠ÁªÉÔºâ</span><br>        node_features_csr = normalize_features_sparse(node_features_csr)<br>        num_of_nodes = <span class="hljs-built_in">len</span>(node_labels_npy)<br><br>        <span class="hljs-comment"># ÂΩ¢Áä∂ = (2, E)ÔºåÂÖ∂‰∏≠ E ÊòØËæπÊï∞Ôºå2 ÊòØÊ∫êËäÇÁÇπÂíåÁõÆÊ†áËäÇÁÇπ„ÄÇÂü∫Êú¨‰∏äËæπÁºòÁ¥¢Âºï</span><br>        <span class="hljs-comment"># ÂåÖÂê´Ê†ºÂºè‰∏∫ S-&gt;T ÁöÑÂÖÉÁªÑÔºå‰æãÂ¶Ç 0-&gt;3 Ë°®Á§∫ÂÖ∑Êúâ ID 0 ÁöÑËäÇÁÇπÊåáÂêëÂÖ∑Êúâ ID 3 ÁöÑËäÇÁÇπ„ÄÇ</span><br>        topology = build_edge_index(adjacency_list_dict, num_of_nodes, add_self_edges=<span class="hljs-literal">True</span>)<br><br>        <span class="hljs-comment"># Ê≥®ÊÑèÔºötopology Âè™ÊòØÂëΩÂêçÂõæÁªìÊûÑÊï∞ÊçÆÁöÑËä±Âì®ÊñπÂºè</span><br>        <span class="hljs-comment"># ÔºàÈô§ËæπÁºòÁ¥¢Âºï‰πãÂ§ñÔºåÂÆÉÂèØ‰ª•ÊòØÈÇªÊé•Áü©ÈòµÁöÑÂΩ¢ÂºèÔºâ</span><br><br>        <span class="hljs-keyword">if</span> should_visualize:  <span class="hljs-comment"># ÁΩëÁªúÂàÜÊûêÂíåÂõæÁªòÂà∂</span><br>            plot_in_out_degree_distributions(topology, num_of_nodes, dataset_name)  <span class="hljs-comment"># Êàë‰ª¨Â∞ÜÂú®Á¨¨‰∫åÈÉ®ÂàÜÂÆö‰πâËøô‰∫õ</span><br>            visualize_graph(topology, node_labels_npy, dataset_name)<br><br>        <span class="hljs-comment"># ËΩ¨Êç¢‰∏∫Á®†ÂØÜ PyTorch Âº†Èáè</span><br><br>        <span class="hljs-comment"># ÈúÄË¶ÅÊòØ long int Á±ªÂûãÔºåÂõ†‰∏∫‰ª•ÂêéÂÉè PyTorch ÁöÑ index_select ËøôÊ†∑ÁöÑÂáΩÊï∞ÊúüÊúõÂÆÉ</span><br>        topology = torch.tensor(topology, dtype=torch.long, device=device)<br>        node_labels = torch.tensor(node_labels_npy, dtype=torch.long, device=device)  <span class="hljs-comment"># ‰∫§ÂèâÁÜµÊúüÊúõ‰∏Ä‰∏™ long int</span><br>        node_features = torch.tensor(node_features_csr.todense(), device=device)<br><br>        <span class="hljs-comment"># Â∏ÆÂä©Êàë‰ª¨ÊèêÂèñÂ±û‰∫éËÆ≠ÁªÉ/È™åËØÅÂíåÊµãËØïÊãÜÂàÜÁöÑËäÇÁÇπÁöÑÁ¥¢Âºï</span><br>        train_indices = torch.arange(CORA_TRAIN_RANGE[<span class="hljs-number">0</span>], CORA_TRAIN_RANGE[<span class="hljs-number">1</span>], dtype=torch.long, device=device)<br>        val_indices = torch.arange(CORA_VAL_RANGE[<span class="hljs-number">0</span>], CORA_VAL_RANGE[<span class="hljs-number">1</span>], dtype=torch.long, device=device)<br>        test_indices = torch.arange(CORA_TEST_RANGE[<span class="hljs-number">0</span>], CORA_TEST_RANGE[<span class="hljs-number">1</span>], dtype=torch.long, device=device)<br><br>        <span class="hljs-keyword">return</span> node_features, node_labels, topology, train_indices, val_indices, test_indices<br>    <span class="hljs-keyword">else</span>:<br>        <span class="hljs-keyword">raise</span> Exception(<span class="hljs-string">f&#x27;<span class="hljs-subst">&#123;dataset_name&#125;</span> not yet supported.&#x27;</span>)<br><br></code></pre></td></tr></table></figure>

<p>ÂæàÂ•ΩÔºåÊàëËøò‰ΩøÁî®‰∫ÜÂè¶Â§ñ 2 ‰∏™Â∞öÊú™ÂÆö‰πâÁöÑÂáΩÊï∞„ÄÇÈ¶ñÂÖàËÆ©Êàë‰ª¨ÁúãÁúãÂ¶Ç‰ΩïÂú® Cora ‰∏äËøõË°åÁâπÂæÅÊ†áÂáÜÂåñÔºö</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br></pre></td><td class="code"><pre><code class="hljs python"><span class="hljs-keyword">def</span> <span class="hljs-title function_">normalize_features_sparse</span>(<span class="hljs-params">node_features_sparse</span>):<br>    <span class="hljs-keyword">assert</span> sp.issparse(node_features_sparse), <span class="hljs-string">f&#x27;Expected a sparse matrix, got <span class="hljs-subst">&#123;node_features_sparse&#125;</span>.&#x27;</span><br><br>    <span class="hljs-comment"># ËÄå‰∏çÊòØÂÉè normalize_features_dense() ‰∏≠ÈÇ£Ê†∑ËøõË°åÈô§Ê≥ïÔºåÊàë‰ª¨ÂØπÁâπÂæÅÁöÑÈÄÜÂíåËøõË°å‰πòÊ≥ï„ÄÇ</span><br>    <span class="hljs-comment"># Áé∞‰ª£Á°¨‰ª∂ÔºàGPU„ÄÅTPU„ÄÅASICÔºâÈíàÂØπÂø´ÈÄüÁü©Èòµ‰πòÊ≥ïËøõË°å‰∫Ü‰ºòÂåñÔºÅ ^^ (* &gt;&gt; /)</span><br>    <span class="hljs-comment"># ÂΩ¢Áä∂ = (N, FIN) -&gt; (N, 1)ÔºåÂÖ∂‰∏≠ N Ë°®Á§∫ËäÇÁÇπÊï∞ÔºåFIN Ë°®Á§∫ËæìÂÖ•ÁâπÂæÅÊï∞</span><br>    node_features_sum = np.array(node_features_sparse.<span class="hljs-built_in">sum</span>(-<span class="hljs-number">1</span>))  <span class="hljs-comment"># ÂØπÊØè‰∏™ËäÇÁÇπÁâπÂæÅÂêëÈáèÊ±ÇÂíåÁâπÂæÅ</span><br><br>    <span class="hljs-comment"># ÂàõÂª∫‰∏Ä‰∏™ÈÄÜÁü©ÈòµÔºàËÆ∞‰Ωè * by 1/x ‰ºò‰∫éÔºàÊõ¥Âø´Ôºâ/ by xÔºâ</span><br>    <span class="hljs-comment"># ÂΩ¢Áä∂ = (N, 1) -&gt; (N)</span><br>    node_features_inv_sum = np.power(node_features_sum, -<span class="hljs-number">1</span>).squeeze()<br><br>    <span class="hljs-comment"># ÂÜçÊ¨°Êüê‰∫õÂíåÂ∞Ü‰∏∫ 0ÔºåÂõ†Ê≠§ 1/0 Â∞Ü‰∏∫Êàë‰ª¨Êèê‰æõ infÔºåÂõ†Ê≠§Êàë‰ª¨Â∞ÜÂÆÉ‰ª¨ÊõøÊç¢‰∏∫ 1ÔºåÂÆÉÊòØ mul ÁöÑ‰∏≠ÊÄßÂÖÉÁ¥†</span><br>    node_features_inv_sum[np.isinf(node_features_inv_sum)] = <span class="hljs-number">1.</span><br><br>    <span class="hljs-comment"># ÂàõÂª∫‰∏Ä‰∏™ÂØπËßíÁü©ÈòµÔºåÂÖ∂ÂØπËßíÁ∫ø‰∏äÁöÑÂÄºÊù•Ëá™ node_features_inv_sum</span><br>    diagonal_inv_features_sum_matrix = sp.diags(node_features_inv_sum)<br><br>    <span class="hljs-comment"># Êàë‰ª¨ËøîÂõûÂΩí‰∏ÄÂåñÁöÑÁâπÂæÅ„ÄÇ</span><br>    <span class="hljs-keyword">return</span> diagonal_inv_features_sum_matrix.dot(node_features_sparse)<br><br></code></pre></td></tr></table></figure>

<p>ÂÆÉÂü∫Êú¨‰∏ä‰ΩøCora ÁöÑ‰∫åÂÖÉËäÇÁÇπÁâπÂæÅÂêëÈáèÊÄªÂíå‰∏∫1„ÄÇ‰æãÂ¶ÇÔºåÂ¶ÇÊûúÊàë‰ª¨Êúâ[1, 0, 1, 0, 1]ÔºàCoraÁöÑÁâπÂæÅÂêëÈáèÊõ¥ÈïøÔºåÊàë‰ª¨ÂæàÂø´Â∞±‰ºöÁúãÂà∞Ôºå‰ΩÜÊàë‰ª¨ÊöÇÊó∂ÈááÁî®‚Äã‚ÄãËøô‰∏™ÔºâÔºåÂÆÉÂ∞ÜË¢´ËΩ¨Êç¢‰∏∫[0.33, 0, 0.33, 0, 0.33]. Â∞±ÈÇ£‰πàÁÆÄÂçï„ÄÇÁêÜËß£ÂÆûÈôÖÁöÑÂÆûÁé∞ÊÄªÊòØÊØîËæÉÂõ∞ÈöæÔºå‰ΩÜ‰ªéÊ¶ÇÂøµ‰∏äËÆ≤ÔºåËøôÊòØÂ∞èËèú‰∏ÄÁ¢ü„ÄÇ</p>
<p>ËÆ©Êàë‰ª¨Âª∫Á´ãËæπÁ¥¢ÂºïÔºö</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br></pre></td><td class="code"><pre><code class="hljs python"><span class="hljs-keyword">def</span> <span class="hljs-title function_">build_edge_index</span>(<span class="hljs-params">adjacency_list_dict, num_of_nodes, add_self_edges=<span class="hljs-literal">True</span></span>):<br>    source_nodes_ids, target_nodes_ids = [], []<br>    seen_edges = <span class="hljs-built_in">set</span>()<br><br>    <span class="hljs-keyword">for</span> src_node, neighboring_nodes <span class="hljs-keyword">in</span> adjacency_list_dict.items():<br>        <span class="hljs-keyword">for</span> trg_node <span class="hljs-keyword">in</span> neighboring_nodes:<br>            <span class="hljs-comment"># if this edge hasn&#x27;t been seen so far we add it to the edge index (coalescing - removing duplicates)</span><br>            <span class="hljs-keyword">if</span> (src_node, trg_node) <span class="hljs-keyword">not</span> <span class="hljs-keyword">in</span> seen_edges:  <span class="hljs-comment"># it&#x27;d be easy to explicitly remove self-edges (Cora has none..)</span><br>                source_nodes_ids.append(src_node)<br>                target_nodes_ids.append(trg_node)<br><br>                seen_edges.add((src_node, trg_node))<br><br>    <span class="hljs-keyword">if</span> add_self_edges:<br>        source_nodes_ids.extend(np.arange(num_of_nodes))<br>        target_nodes_ids.extend(np.arange(num_of_nodes))<br><br>    <span class="hljs-comment"># shape = (2, E), where E is the number of edges in the graph</span><br>    edge_index = np.row_stack((source_nodes_ids, target_nodes_ids))<br><br>    <span class="hljs-keyword">return</span> edge_index<br></code></pre></td></tr></table></figure>

<p>Ëøô‰∏™Â∫îËØ•Áõ∏ÂΩìÁÆÄÂçï - Êàë‰ª¨Âè™ÊòØ‰ª•ËøôÁßçÊ†ºÂºèÁ¥ØÁßØËæπÔºö<br>[[0, 1], [2, 2], ‚Ä¶] ÂÖ∂‰∏≠ [s, t] ÂÖÉÁªÑÂü∫Êú¨‰∏äÂÆö‰πâ‰∫ÜËäÇÁÇπsÔºàÊ∫êÔºâÊåáÂêëÁöÑËæπÂà∞ËäÇÁÇπtÔºàÁõÆÊ†áÔºâ„ÄÇ</p>
<p>ÂÖ∂‰ªñÊµÅË°åÁöÑÊ†ºÂºèÔºàÂú®Ê∫êÁ†ÅÂè¶Â§ñ‰∏™ÂÆûÁé∞‰∏≠‰ΩøÁî®ÔºâÊòØÈÇªÊé•Áü©Èòµ- ‰ΩÜÂÆÉ‰ª¨Âç†Áî®Êõ¥Â§öÁöÑÂÜÖÂ≠òÔºàÂáÜÁ°ÆÂú∞ËØ¥ÔºåO(N^2)Ôºå‰∏éËæπÁºòÁ¥¢ÂºïÁªìÊûÑÁöÑ O(E) ËøõË°åÊØîËæÉÔºâ„ÄÇ</p>
<p>ÂæàÂ•ΩÔºåÊúÄÂêéËÆ©Êàë‰ª¨Â∞ùËØïÂä†ËΩΩÂÆÉ„ÄÇÊàë‰ª¨ËøòÂ∫îËØ•ÂàÜÊûêÂΩ¢Áä∂‚Äî‚ÄîËøôÊÄªÊòØ‰∏Ä‰∏™Â•Ω‰∏ªÊÑè„ÄÇ</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br></pre></td><td class="code"><pre><code class="hljs python"><span class="hljs-comment"># Let&#x27;s just define dummy visualization functions for now - just to stop Python interpreter from complaining!</span><br><br><span class="hljs-keyword">def</span> <span class="hljs-title function_">plot_in_out_degree_distributions</span>():<br>    <span class="hljs-keyword">pass</span><br><br><span class="hljs-keyword">def</span> <span class="hljs-title function_">visualize_graph</span>():<br>    <span class="hljs-keyword">pass</span><br><br>device = torch.device(<span class="hljs-string">&quot;cuda&quot;</span> <span class="hljs-keyword">if</span> torch.cuda.is_available() <span class="hljs-keyword">else</span> <span class="hljs-string">&quot;cpu&quot;</span>)  <span class="hljs-comment"># checking whether you have a GPU</span><br><br>config = &#123;<br>    <span class="hljs-string">&#x27;dataset_name&#x27;</span>: DatasetType.CORA.name,<br>    <span class="hljs-string">&#x27;should_visualize&#x27;</span>: <span class="hljs-literal">False</span><br>&#125;<br><br>node_features, node_labels, edge_index, train_indices, val_indices, test_indices = load_graph_data(config, device)<br><br><span class="hljs-built_in">print</span>(node_features.shape, node_features.dtype)<br><span class="hljs-built_in">print</span>(node_labels.shape, node_labels.dtype)<br><span class="hljs-built_in">print</span>(edge_index.shape, edge_index.dtype)<br><span class="hljs-built_in">print</span>(train_indices.shape, train_indices.dtype)<br><span class="hljs-built_in">print</span>(val_indices.shape, val_indices.dtype)<br><span class="hljs-built_in">print</span>(test_indices.shape, test_indices.dtype)<br></code></pre></td></tr></table></figure>

<pre><code class="hljs">torch.Size([2708, 1433]) torch.float32
torch.Size([2708]) torch.int64
torch.Size([2, 13264]) torch.int64
torch.Size([140]) torch.int64
torch.Size([500]) torch.int64
torch.Size([1000]) torch.int64


/var/folders/f0/812mfv7x63vbytjs3yf4gxtc0000gn/T/ipykernel_16269/2448994618.py:6: DeprecationWarning: Please use `csr_matrix` from the `scipy.sparse` namespace, the `scipy.sparse.csr` namespace is deprecated.
  data = pickle.load(file)
</code></pre>
<p>Â•ΩÁöÑÔºÅÂàÜÊûêÂΩ¢Áä∂Êàë‰ª¨ÂèØ‰ª•ÁúãÂà∞‰ª•‰∏ãÂÜÖÂÆπÔºö</p>
<ol>
<li>CoraÊúâ2708‰∏™ËäÇÁÇπ</li>
<li>ÊØè‰∏™ËäÇÁÇπÊúâ 1433 ‰∏™ÁâπÂæÅÔºàÊü•Áúãdata_loading.py‰∫ÜËß£Êõ¥Â§öËØ¶ÁªÜ‰ø°ÊÅØÔºâ</li>
<li>Êàë‰ª¨Êúâ 13264 Êù°ËæπÔºÅÔºàÂåÖÊã¨Ëá™Ë∫´ËæπÔºâ</li>
<li>Êàë‰ª¨Êúâ140‰∏™ËÆ≠ÁªÉËäÇÁÇπ</li>
<li>Êàë‰ª¨Êúâ 500 ‰∏™È™åËØÅËäÇÁÇπ</li>
<li>Êàë‰ª¨Êúâ1000‰∏™ÊµãËØïËäÇÁÇπ<br>Ê≠§Â§ñÔºåÂá†‰πéÊâÄÊúâÊï∞ÊçÆÈÉΩÊòØ int 64 Á±ªÂûã„ÄÇ‰∏∫‰ªÄ‰πàÔºüËøôÊòØ PyTorch Âº∫Âä†ÁªôÊàë‰ª¨ÁöÑ‰∏Ä‰∏™ÈôêÂà∂„ÄÇÊçüÂ§±ÂáΩÊï∞nn.CrossEntropyLossÂíåindex_selectÂáΩÊï∞ÈúÄË¶Å torch.long ÔºàÂç≥ 64 ‰ΩçÊï¥Êï∞Ôºâ-ÊâÄ‰ª•ËøôÊ†∑„ÄÇ</li>
</ol>
<ul>
<li><code>node_labels</code>ÊòØ int64 Âõ†‰∏∫<code>nn.CrossEntropyLoss</code></li>
<li>ÂÖ∂‰ªñÂèòÈáèÊòØ int64 Âõ†‰∏∫<code>index_select</code><br>Âú®‚ÄúÊóÅÊ≥®‚Äù‰∏≠ÔºåÈöèÁùÄÊÇ®ÁöÑËøõÂ±ïÊµãËØïÊÇ®ÁöÑ‰ª£Á†ÅÊÄªÊòØ‰∏Ä‰∏™Â•Ω‰∏ªÊÑè„ÄÇ</li>
</ul>
<p>Êï∞ÊçÆÂä†ËΩΩ‰∏éÊ≠§Á¨îËÆ∞Êú¨ÁöÑÂÖ∂‰ΩôÈÉ®ÂàÜÂÆåÂÖ®Ê≠£‰∫§ÔºåÂõ†Ê≠§Êàë‰ª¨ÂèØ‰ª•Áã¨Á´ãÊµãËØïÂÆÉÔºåÂπ∂Á°Æ‰øùÂΩ¢Áä∂ÂíåÊï∞ÊçÆÁ±ªÂûãÊúâÊÑè‰πâ„ÄÇÊàëÂú®ÂºÄÂèëÂÉèËøôÊ†∑ÁöÑÈ°πÁõÆÔºà‰ª•Âèä‰∏ÄËà¨ÊÉÖÂÜµ‰∏ãÔºâÊó∂‰ΩøÁî®Ëøô‰∏ÄÁ≠ñÁï•„ÄÇ</p>
<p>Êàë‰ªéÊï∞ÊçÆÂºÄÂßãÔºåÊ∑ªÂä†Âä†ËΩΩÂäüËÉΩÔºåÊ∑ªÂä†‰∏Ä‰∫õÂèØËßÜÂåñÔºåÁÑ∂ÂêéÊàëÈÄöÂ∏∏ÊâçÂºÄÂßãÂºÄÂèëÊ∑±Â∫¶Â≠¶‰π†Ê®°ÂûãÊú¨Ë∫´„ÄÇ</p>
<p>ÂèØËßÜÂåñÊòØ‰∏Ä‰∏™Â∑®Â§ßÁöÑÂ•ΩÂ§ÑÔºåÊâÄ‰ª•ËÆ©Êàë‰ª¨ÂºÄÂèëÂÆÉ‰ª¨„ÄÇ</p>
<h1 id="ÂèØËßÜÂåñÊï∞ÊçÆüîÆüëì"><a href="#ÂèØËßÜÂåñÊï∞ÊçÆüîÆüëì" class="headerlink" title="ÂèØËßÜÂåñÊï∞ÊçÆüîÆüëì"></a>ÂèØËßÜÂåñÊï∞ÊçÆüîÆüëì</h1><p>ËÆ©Êàë‰ª¨È¶ñÂÖà‰∫ÜËß£ Cora ‰∏≠ËäÇÁÇπÁöÑÂ∫¶ÂàÜÂ∏É - Âç≥ËäÇÁÇπÊúâÂ§öÂ∞ëÊù°ËæìÂÖ•&#x2F;ËæìÂá∫ËæπÔºåËøôÊòØÂõæËøûÈÄöÊÄßÁöÑÊüêÁßçÂ∫¶Èáè„ÄÇ</p>
<p>ËøêË°å‰ª•‰∏ã‰ª£Á†ÅÔºö</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br></pre></td><td class="code"><pre><code class="hljs python"><span class="hljs-keyword">def</span> <span class="hljs-title function_">plot_in_out_degree_distributions</span>(<span class="hljs-params">edge_index, num_of_nodes, dataset_name</span>):<br>    <span class="hljs-string">&quot;&quot;&quot;</span><br><span class="hljs-string">        Ê≥®ÊÑèÔºö‰ΩøÁî® igraph/networkx Á≠âÂ∑•ÂÖ∑ÂèØ‰ª•ËΩªÊùæËøõË°åÂêÑÁßçÂº∫Â§ßÁöÑÁΩëÁªúÂàÜÊûê„ÄÇ</span><br><span class="hljs-string">        ÊàëÈÄâÊã©Âú®Ê≠§Â§ÑÊòæÂºèËÆ°ÁÆó‰ªÖËäÇÁÇπÂ∫¶ÈáèÁªüËÆ°Ôºå‰ΩÜÂ¶ÇÊûúÈúÄË¶ÅÔºåÊÇ®ÂèØ‰ª•Ê∑±ÂÖ•Á†îÁ©∂Âπ∂ËÆ°ÁÆóÂõæÁõ¥ÂæÑ„ÄÅ‰∏âËßíÂΩ¢Êï∞Èáè‰ª•ÂèäËÆ∏Â§öÂÖ∂‰ªñÁΩëÁªúÂàÜÊûêÈ¢ÜÂüüÁöÑÊ¶ÇÂøµ„ÄÇ</span><br><span class="hljs-string"></span><br><span class="hljs-string">    &quot;&quot;&quot;</span><br>    <span class="hljs-keyword">if</span> <span class="hljs-built_in">isinstance</span>(edge_index, torch.Tensor):<br>        edge_index = edge_index.cpu().numpy()<br>        <br>    <span class="hljs-keyword">assert</span> <span class="hljs-built_in">isinstance</span>(edge_index, np.ndarray), <span class="hljs-string">f&#x27;Expected NumPy array got <span class="hljs-subst">&#123;<span class="hljs-built_in">type</span>(edge_index)&#125;</span>.&#x27;</span><br><br>    <span class="hljs-comment"># Â≠òÂÇ®ÊØè‰∏™ËäÇÁÇπÁöÑËæìÂÖ•ÂíåËæìÂá∫Â∫¶ÔºàÂØπ‰∫éÊó†ÂêëÂõæÂ¶Ç CoraÔºåÂÆÉ‰ª¨ÊòØÁõ∏ÂêåÁöÑÔºâ</span><br>    in_degrees = np.zeros(num_of_nodes, dtype=<span class="hljs-built_in">int</span>)<br>    out_degrees = np.zeros(num_of_nodes, dtype=<span class="hljs-built_in">int</span>)<br><br>    <span class="hljs-comment"># ËæπÁ¥¢ÂºïÂΩ¢Áä∂ = (2, E)ÔºåÁ¨¨‰∏ÄË°åÂåÖÂê´Ê∫êËäÇÁÇπÔºåÁ¨¨‰∫åË°åÂåÖÂê´ÁõÆÊ†á/Ê±áËäÇÁÇπ</span><br>    <span class="hljs-comment"># ÊúØËØ≠ËØ¥ÊòéÔºöÊ∫êËäÇÁÇπÊåáÂêëÁõÆÊ†á/Ê±áËäÇÁÇπ</span><br>    num_of_edges = edge_index.shape[<span class="hljs-number">1</span>]<br>    <span class="hljs-keyword">for</span> cnt <span class="hljs-keyword">in</span> <span class="hljs-built_in">range</span>(num_of_edges):<br>        source_node_id = edge_index[<span class="hljs-number">0</span>, cnt]<br>        target_node_id = edge_index[<span class="hljs-number">1</span>, cnt]<br><br>        out_degrees[source_node_id] += <span class="hljs-number">1</span>  <span class="hljs-comment"># Ê∫êËäÇÁÇπÊåáÂêëÂÖ∂‰ªñËäÇÁÇπ -&gt; Â¢ûÂä†ÂÖ∂Âá∫Â∫¶</span><br>        in_degrees[target_node_id] += <span class="hljs-number">1</span>  <span class="hljs-comment"># Á±ª‰ººÂú∞</span><br><br>    hist = np.zeros(np.<span class="hljs-built_in">max</span>(out_degrees) + <span class="hljs-number">1</span>)<br>    <span class="hljs-keyword">for</span> out_degree <span class="hljs-keyword">in</span> out_degrees:<br>        hist[out_degree] += <span class="hljs-number">1</span><br><br>    fig = plt.figure(figsize=(<span class="hljs-number">12</span>,<span class="hljs-number">8</span>), dpi=<span class="hljs-number">100</span>)  <span class="hljs-comment"># Âê¶ÂàôÂú® Jupyter Notebook ‰∏≠ÂõæË°®‰ºöÂæàÂ∞è</span><br>    fig.subplots_adjust(hspace=<span class="hljs-number">0.6</span>)<br><br>    plt.subplot(<span class="hljs-number">311</span>)<br>    plt.plot(in_degrees, color=<span class="hljs-string">&#x27;red&#x27;</span>)<br>    plt.xlabel(<span class="hljs-string">&#x27;node id&#x27;</span>); plt.ylabel(<span class="hljs-string">&#x27;in-degree count&#x27;</span>); plt.title(<span class="hljs-string">&#x27;‰∏çÂêåËäÇÁÇπ id ÁöÑËæìÂÖ•Â∫¶&#x27;</span>)<br><br>    plt.subplot(<span class="hljs-number">312</span>)<br>    plt.plot(out_degrees, color=<span class="hljs-string">&#x27;green&#x27;</span>)<br>    plt.xlabel(<span class="hljs-string">&#x27;node id&#x27;</span>); plt.ylabel(<span class="hljs-string">&#x27;out-degree count&#x27;</span>); plt.title(<span class="hljs-string">&#x27;‰∏çÂêåËäÇÁÇπ id ÁöÑËæìÂá∫Â∫¶&#x27;</span>)<br><br>    plt.subplot(<span class="hljs-number">313</span>)<br>    plt.plot(hist, color=<span class="hljs-string">&#x27;blue&#x27;</span>)<br>    plt.xlabel(<span class="hljs-string">&#x27;node degree&#x27;</span>)<br>    plt.ylabel(<span class="hljs-string">&#x27;ÁªôÂÆöÂá∫Â∫¶ÁöÑËäÇÁÇπÊï∞Èáè&#x27;</span>) <br>    plt.title(<span class="hljs-string">f&#x27;<span class="hljs-subst">&#123;dataset_name&#125;</span> Êï∞ÊçÆÈõÜÁöÑËäÇÁÇπÂá∫Â∫¶ÂàÜÂ∏É&#x27;</span>)<br>    plt.xticks(np.arange(<span class="hljs-number">0</span>, <span class="hljs-built_in">len</span>(hist), <span class="hljs-number">5.0</span>))<br><br>    plt.grid(<span class="hljs-literal">True</span>)<br>    plt.show()<br><br></code></pre></td></tr></table></figure>

<p>Â§™Ê£í‰∫ÜÔºåÁé∞Âú®ËÆ©Êàë‰ª¨ÂèØËßÜÂåñ Cora ÁöÑÂ∫¶ÂàÜÂ∏ÉÔºÅ</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><code class="hljs python">num_of_nodes = <span class="hljs-built_in">len</span>(node_labels)<br>plot_in_out_degree_distributions(edge_index, num_of_nodes, config[<span class="hljs-string">&#x27;dataset_name&#x27;</span>])<br></code></pre></td></tr></table></figure>


<p><img src="https://ptpimg.me/92t60u.png" srcset="/img/loading.gif" lazyload alt="ËØ∑Ê∑ªÂä†ÂõæÁâáÊèèËø∞"></p>
<p>ÊÇ®ÂèØ‰ª•Á´ãÂç≥Ê≥®ÊÑèÂà∞‰ª•‰∏ãÂá†‰ª∂‰∫ãÔºö</p>
<ul>
<li>Ââç2‰∏™ÂõæÊòØÁõ∏ÂêåÁöÑÔºåÂõ†‰∏∫Êàë‰ª¨Â∞Ü Cora ËßÜ‰∏∫Êó†ÂêëÂõæÔºàÂç≥‰ΩøÂÆÉËá™ÁÑ∂Â∫îËØ•Âª∫Ê®°‰∏∫ÊúâÂêëÂõæÔºâ</li>
<li>Êüê‰∫õËäÇÁÇπÂÖ∑ÊúâÂ§ßÈáèËæπÔºà‰∏≠Èó¥ÁöÑÂ≥∞ÂÄºÔºâÔºå‰ΩÜÂ§ßÂ§öÊï∞ËäÇÁÇπÁöÑËæπË¶ÅÂ∞ëÂæóÂ§ö</li>
<li>Á¨¨‰∏âÂº†Âõæ‰ª•Áõ¥ÊñπÂõæÁöÑÂΩ¢ÂºèÂæàÂ•ΩÂú∞ÂèØËßÜÂåñ‰∫ÜËøô‰∏ÄÁÇπ - Â§ßÂ§öÊï∞ËäÇÁÇπÂè™Êúâ2-5Êù°ËæπÔºàÂõ†Ê≠§Â≥∞ÂÄº‰Ωç‰∫éÊúÄÂ∑¶‰æßÔºâ<br>Â•ΩÂêßÔºåÊàë‰ª¨ÂºÄÂßãÂØπ Cora Êúâ‰∫Ü‰∏Ä‰∫õÊúâ‰ª∑ÂÄºÁöÑËßÅËß£ÔºåËÆ©Êàë‰ª¨ÁªßÁª≠Ëøõ‰∏ÄÊ≠•Ôºå‰ªéÂ≠óÈù¢‰∏äÊÉ≥Ë±°&#x2F;ÁúãÂà∞ Cora„ÄÇ</li>
</ul>
<p>‰∏ãÈù¢ÁöÑÂçïÂÖÉÊ†ºÂ∞ÜÁªòÂà∂ CoraÔºåËøêË°åÂÆÉ„ÄÇ</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br></pre></td><td class="code"><pre><code class="hljs python"><span class="hljs-string">&quot;&quot;&quot;</span><br><span class="hljs-string">ËØ∑ÂèÇÈòÖÊ≠§ÂçöÂÆ¢‰ª•‰∫ÜËß£ÂèØÁî®ÁöÑÂõæÂΩ¢ÂèØËßÜÂåñÂ∑•ÂÖ∑Ôºö</span><br><span class="hljs-string">  https://towardsdatascience.com/large-graph-visualization-tools-and-approaches-2b8758a1cd59</span><br><span class="hljs-string"></span><br><span class="hljs-string">Âü∫Êú¨‰∏äÔºåÂèñÂÜ≥‰∫éÊÇ®ÁöÑÂõæÂΩ¢Â§ßÂ∞èÔºåÂèØËÉΩ‰ºöÊúâ‰∏Ä‰∫õÊØî igraph Êõ¥Â•ΩÁöÑÁªòÂõæÂ∑•ÂÖ∑„ÄÇ</span><br><span class="hljs-string"></span><br><span class="hljs-string">Ê≥®ÊÑèÔºö‰∏çÂπ∏ÁöÑÊòØÔºåÊàë‰∏çÂæó‰∏çÂ∞ÜÊ≠§ÂáΩÊï∞ÊâÅÂπ≥ÂåñÔºåÂõ†‰∏∫ igraph Âú® Jupyter Notebook ‰∏≠ÈÅáÂà∞‰∫Ü‰∏Ä‰∫õÈóÆÈ¢òÔºå</span><br><span class="hljs-string">Êàë‰ª¨Âè™‰ºöÂú®ËøôÈáåË∞ÉÁî®ÂÆÉÔºåÊâÄ‰ª•Ê≤°ÂÖ≥Á≥ªÔºÅ</span><br><span class="hljs-string"></span><br><span class="hljs-string">&quot;&quot;&quot;</span><br><br>dataset_name = config[<span class="hljs-string">&#x27;dataset_name&#x27;</span>]<br>visualization_tool=GraphVisualizationTool.IGRAPH<br><br><span class="hljs-keyword">if</span> <span class="hljs-built_in">isinstance</span>(edge_index, torch.Tensor):<br>    edge_index_np = edge_index.cpu().numpy()<br><br><span class="hljs-keyword">if</span> <span class="hljs-built_in">isinstance</span>(node_labels, torch.Tensor):<br>    node_labels_np = node_labels.cpu().numpy()<br><br>num_of_nodes = <span class="hljs-built_in">len</span>(node_labels_np)<br>edge_index_tuples = <span class="hljs-built_in">list</span>(<span class="hljs-built_in">zip</span>(edge_index_np[<span class="hljs-number">0</span>, :], edge_index_np[<span class="hljs-number">1</span>, :]))  <span class="hljs-comment"># igraph Ë¶ÅÊ±ÇËøôÁßçÊ†ºÂºè</span><br><br><span class="hljs-comment"># ÊûÑÂª∫ igraph Âõæ</span><br>ig_graph = ig.Graph()<br>ig_graph.add_vertices(num_of_nodes)<br>ig_graph.add_edges(edge_index_tuples)<br><br><span class="hljs-comment"># ÂáÜÂ§áÂèØËßÜÂåñËÆæÁΩÆÂ≠óÂÖ∏</span><br>visual_style = &#123;<br>    <span class="hljs-string">&quot;bbox&quot;</span>: (<span class="hljs-number">700</span>, <span class="hljs-number">700</span>),<br>    <span class="hljs-string">&quot;margin&quot;</span>: <span class="hljs-number">5</span>,<br>&#125;<br><br><span class="hljs-comment"># ÊàëÈÄâÊã©ËæπÁöÑÂéöÂ∫¶‰∏éÈÄöËøáÊàë‰ª¨Âõæ‰∏≠Êüê‰∏™ËæπÁöÑÊúÄÁü≠Ë∑ØÂæÑÔºàÊµãÂú∞Á∫øÔºâÁöÑÊï∞ÈáèÊàêÊØî‰æãÔºàedge_betweenness ÂáΩÊï∞Ôºå‰∏Ä‰∏™ÁÆÄÂçïÁöÑ ad hoc ÂêØÂèëÂºèÔºâ</span><br><br><span class="hljs-comment"># line1ÔºöÊàë‰ΩøÁî®Êó•ÂøóÔºåÂê¶Âàô‰∏Ä‰∫õËæπ‰ºöÂ§™ÂéöÔºåËÄåÂÖ∂‰ªñËæπÊ†πÊú¨‰∏çÊòéÊòæ</span><br><span class="hljs-comment"># edge_betweenness ËøîÂõû &lt; 1 ÂØπ‰∫éÊüê‰∫õËæπÔºåËøôÂ∞±ÊòØ‰∏∫‰ªÄ‰πàÊàë‰ΩøÁî® clip ‰Ωú‰∏∫ log ÂØπ‰∫éÈÇ£‰∫õËæπÊù•ËØ¥ÊòØË¥üÁöÑ</span><br><span class="hljs-comment"># line2ÔºöÂΩí‰∏ÄÂåñÔºå‰ΩøÊúÄÂéöÁöÑËæπ‰∏∫ 1ÔºåÂê¶ÂàôËæπÂú®ÂõæË°®‰∏äÁúãËµ∑Êù•Â§™Âéö</span><br><span class="hljs-comment"># line3ÔºöËøôÈáåÁöÑÊÉ≥Ê≥ïÊòØËÆ©ÊúÄÂº∫ÁöÑËæπÁºò‰øùÊåÅÊØîÂÖ∂‰ªñËæπÁºòÊõ¥Âº∫Ôºå6 ÂàöÂàöÂ•ΩÔºå‰∏çË¶ÅÁ∫†Áªì‰∫éÊ≠§</span><br><br>edge_weights_raw = np.clip(np.log(np.asarray(ig_graph.edge_betweenness())+<span class="hljs-number">1e-16</span>), a_min=<span class="hljs-number">0</span>, a_max=<span class="hljs-literal">None</span>)<br>edge_weights_raw_normalized = edge_weights_raw / np.<span class="hljs-built_in">max</span>(edge_weights_raw)<br>edge_weights = [w**<span class="hljs-number">6</span> <span class="hljs-keyword">for</span> w <span class="hljs-keyword">in</span> edge_weights_raw_normalized]<br>visual_style[<span class="hljs-string">&quot;edge_width&quot;</span>] = edge_weights<br><br><span class="hljs-comment"># È°∂ÁÇπÂ§ßÂ∞èÁöÑÁÆÄÂçïÂêØÂèëÂºè„ÄÇÂ§ßÂ∞è ~ (Â∫¶/4)ÔºàÊàëÂ∞ùËØï‰∫Ü log Âíå sqrt ‰πüÂèñÂæó‰∫ÜÂæàÂ•ΩÁöÑÊïàÊûúÔºâ</span><br>visual_style[<span class="hljs-string">&quot;vertex_size&quot;</span>] = [deg / <span class="hljs-number">4</span> <span class="hljs-keyword">for</span> deg <span class="hljs-keyword">in</span> ig_graph.degree()]<br><br><span class="hljs-comment"># Cora ÁâπÊúâÁöÑÈÉ®ÂàÜÔºåÂõ†‰∏∫ Cora Êúâ 7 ‰∏™Ê†áÁ≠æ</span><br><span class="hljs-keyword">if</span> dataset_name.lower() == DatasetType.CORA.name.lower():<br>    visual_style[<span class="hljs-string">&quot;vertex_color&quot;</span>] = [cora_label_to_color_map[label] <span class="hljs-keyword">for</span> label <span class="hljs-keyword">in</span> node_labels_np]<br><span class="hljs-keyword">else</span>:<br>    <span class="hljs-built_in">print</span>(<span class="hljs-string">&#x27;ËØ∑ÈöèÊÑè‰∏∫ÊÇ®ÁöÑÁâπÂÆöÊï∞ÊçÆÈõÜÊ∑ªÂä†Ëá™ÂÆö‰πâÈÖçËâ≤ÊñπÊ°à„ÄÇ‰ΩøÁî® igraph ÈªòËÆ§ÈÖçËâ≤„ÄÇ&#x27;</span>)<br><br><span class="hljs-comment"># ËÆæÁΩÆÂ∏ÉÂ±Ä - ÂõæË°®Âú® 2D ÂõæË°®‰∏äÂëàÁé∞ÁöÑÊñπÂºè„ÄÇÂõæÂΩ¢ÁªòÂà∂Êú¨Ë∫´ÊòØ‰∏Ä‰∏™Â≠êÈ¢ÜÂüüÔºÅ</span><br><span class="hljs-comment"># Êàë‰ΩøÁî®‚ÄúKamada Kawai‚ÄùÂäõÂØºÂêëÊñπÊ≥ïÔºåËøôÁªÑÊñπÊ≥ïÂü∫‰∫éÁâ©ÁêÜÁ≥ªÁªüÊ®°Êãü„ÄÇ</span><br><span class="hljs-comment"># Ôºàlayout_drl ‰πü‰∏∫ Cora Êèê‰æõ‰∫Ü‰∏çÈîôÁöÑÁªìÊûúÔºâ</span><br>visual_style[<span class="hljs-string">&quot;layout&quot;</span>] = ig_graph.layout_kamada_kawai()<br><br><span class="hljs-built_in">print</span>(<span class="hljs-string">&#x27;Ê≠£Âú®ÁªòÂà∂ÁªìÊûú...ÔºàÂèØËÉΩÈúÄË¶ÅÂá†ÁßíÈíüÔºâ„ÄÇ&#x27;</span>)<br>ig.plot(ig_graph, **visual_style)<br><br><span class="hljs-comment"># Ëøô‰∏™ÁΩëÁ´ôÊúâ‰∏Ä‰∫õÂæàÊ£íÁöÑÂèØËßÜÂåñÊïàÊûúÔºåËØ∑Êü•ÁúãÔºö</span><br><span class="hljs-comment"># http://networkrepository.com/graphvis.php?d=./data/gsm50/labeled/cora.edges</span><br><br></code></pre></td></tr></table></figure>

<pre><code class="hljs">Ê≠£Âú®ÁªòÂà∂ÁªìÊûú...ÔºàÂèØËÉΩÈúÄË¶ÅÂá†ÁßíÈíüÔºâ„ÄÇ
</code></pre>
<p><img src="https://ptpimg.me/s94oh0.png" srcset="/img/loading.gif" lazyload alt="ËØ∑Ê∑ªÂä†ÂõæÁâáÊèèËø∞"></p>
<p>Â∞ùËØï‰ΩøÁî®visual_style[‚Äúbbox‚Äù]ËÆæÁΩÆÂà∞(3000, 3000)ÂíåÂú®vertex_sizeÁî® &#x2F; 2ËøêË°åÔºå‰Ω†‰ºöÂæóÂà∞‰∏Ä‰∏™Â∑®Â∑®Â∑®Â§ßËÄåÊÉä‰∫∫ÁöÑÁªòÂõæÔºàCÂ§ÑÁêÜ igraph ÂêéÈù¢ÁöÑÁªòÂõæÔºåÊâÄ‰ª•ÂÆÉËá≥Â∞ëÂú®ÊàëÁöÑÊú∫Âô®‰∏äÁõ∏ÂΩìÂø´ - ÂΩì‰Ω†ÊªöÂä®ÂÆÉÊó∂Êúâ‰∏Ä‰∫õËΩªÂæÆÁöÑÊªûÂêéÔºâ„ÄÇ</p>
<p>Â•ΩÁöÑÔºåÊàë‰ª¨Â∑≤ÁªèÂÆåÊàê‰∫ÜÂèØËßÜÂåñÂπ∂ÁêÜËß£‰∫ÜÊàë‰ª¨ÁöÑÊï∞ÊçÆ„ÄÇËøôÊòØ‰∏Ä‰∏™Â∑®Â§ßÁöÑÈáåÁ®ãÁ¢ëÔºåÊâÄ‰ª•ËØ∑ÊãçÊãçËá™Â∑±ÁöÑËÇ©ËÜÄ„ÄÇüèÜüéÇüéµ</p>
<p>Êàë‰ª¨Â∑≤ÁªèËß£ÈîÅ‰∫Ü 2 Á∫ßÔºàGATÊ®°Âûãü¶ÑÔºâ„ÄÇüòç</p>
<p>Áé∞Âú®ÔºåËÆ©Êàë‰ª¨‰∫ÜËß£Ëøô‰∏™Ê®°ÂûãÔºÅ</p>
<h1 id="Á¨¨-2-ÈÉ®ÂàÜÔºö‰∫ÜËß£-GAT-ÁöÑÂÜÖÈÉ®Ëøê‰ΩúÊñπÂºè"><a href="#Á¨¨-2-ÈÉ®ÂàÜÔºö‰∫ÜËß£-GAT-ÁöÑÂÜÖÈÉ®Ëøê‰ΩúÊñπÂºè" class="headerlink" title="Á¨¨ 2 ÈÉ®ÂàÜÔºö‰∫ÜËß£ GAT ÁöÑÂÜÖÈÉ®Ëøê‰ΩúÊñπÂºè"></a>Á¨¨ 2 ÈÉ®ÂàÜÔºö‰∫ÜËß£ GAT ÁöÑÂÜÖÈÉ®Ëøê‰ΩúÊñπÂºè</h1><p>GATÈ¶ñÂÖàÔºåËÆ©Êàë‰ª¨ÂàõÂª∫‰∏Ä‰∏™È´òÁ∫ßÁ±ªÔºåÊàë‰ª¨Â∞ÜÂú®ÂÖ∂‰∏≠‰ªéGatLayerÂØπË±°ÊûÑÂª∫„ÄÇ</p>
<p>ÂÆÉÂü∫Êú¨‰∏äÂè™ÊòØÂ∞ÜÂ±ÇÂ†ÜÂè†Âà∞ nn.Sequential ÂØπË±°‰∏≠ÔºåÊ≠§Â§ñÔºåÁî±‰∫é nn.Sequential ÈúÄË¶ÅÂçï‰∏™ËæìÂÖ•ÔºàÂπ∂‰∏îÂÆÉÊúâ‰∏Ä‰∏™ËæìÂá∫ÔºâÔºåÊàëÂè™ÊòØÂ∞ÜÊï∞ÊçÆÔºàÁâπÂæÅ„ÄÅËæπÁºòÁ¥¢ÂºïÔºâÊâìÂåÖÂà∞‰∏Ä‰∏™ÂÖÉÁªÑ‰∏≠ - Á∫ØËØ≠Ê≥ïÁ≥ñ„ÄÇ</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br></pre></td><td class="code"><pre><code class="hljs python"><span class="hljs-keyword">import</span> torch.nn <span class="hljs-keyword">as</span> nn<br><span class="hljs-keyword">from</span> torch.optim <span class="hljs-keyword">import</span> Adam<br><br><br><span class="hljs-keyword">class</span> <span class="hljs-title class_">GAT</span>(torch.nn.Module):<br>    <span class="hljs-string">&quot;&quot;&quot;</span><br><span class="hljs-string">    ÊúÄÊúâË∂£ÂíåÊúÄÈöæÁöÑÂÆûÁé∞ÊòØÂÆûÁé∞ÔºÉ3„ÄÇ</span><br><span class="hljs-string">    Imp1Âíåimp2Âú®ÁªÜËäÇ‰∏äÊúâÊâÄ‰∏çÂêåÔºå‰ΩÜÂü∫Êú¨‰∏äÊòØÁõ∏ÂêåÁöÑ‰∏úË•ø„ÄÇ</span><br><span class="hljs-string"></span><br><span class="hljs-string">    Âõ†Ê≠§ÔºåÊàëÂ∞ÜÂú®Êú¨Á¨îËÆ∞Êú¨‰∏≠‰∏ìÊ≥®‰∫éimpÔºÉ3„ÄÇ</span><br><span class="hljs-string"></span><br><span class="hljs-string">    &quot;&quot;&quot;</span><br><br>    <span class="hljs-keyword">def</span> <span class="hljs-title function_">__init__</span>(<span class="hljs-params">self, num_of_layers, num_heads_per_layer, num_features_per_layer, add_skip_connection=<span class="hljs-literal">True</span>, bias=<span class="hljs-literal">True</span>,</span><br><span class="hljs-params">                 dropout=<span class="hljs-number">0.6</span>, log_attention_weights=<span class="hljs-literal">False</span></span>):<br>        <span class="hljs-built_in">super</span>().__init__()<br>        <span class="hljs-keyword">assert</span> num_of_layers == <span class="hljs-built_in">len</span>(num_heads_per_layer) == <span class="hljs-built_in">len</span>(num_features_per_layer) - <span class="hljs-number">1</span>, <span class="hljs-string">f&#x27;ËæìÂÖ•ÊúâÊïàÁöÑÊû∂ÊûÑÂèÇÊï∞„ÄÇ&#x27;</span><br><br>        num_heads_per_layer = [<span class="hljs-number">1</span>] + num_heads_per_layer  <span class="hljs-comment"># ÊäÄÂ∑ß-ËøôÊ†∑ÊàëÂèØ‰ª•ÂæàÂ•ΩÂú∞ÂàõÂª∫‰∏ãÈù¢ÁöÑGATÂ±Ç</span><br><br>        gat_layers = []  <span class="hljs-comment"># Êî∂ÈõÜGATÂ±Ç</span><br>        <span class="hljs-keyword">for</span> i <span class="hljs-keyword">in</span> <span class="hljs-built_in">range</span>(num_of_layers):<br>            layer = GATLayer(<br>                num_in_features=num_features_per_layer[i] * num_heads_per_layer[i],  <span class="hljs-comment"># ËøûÊé•ÁöÑÁªìÊûú</span><br>                num_out_features=num_features_per_layer[i+<span class="hljs-number">1</span>],<br>                num_of_heads=num_heads_per_layer[i+<span class="hljs-number">1</span>],<br>                concat=<span class="hljs-literal">True</span> <span class="hljs-keyword">if</span> i &lt; num_of_layers - <span class="hljs-number">1</span> <span class="hljs-keyword">else</span> <span class="hljs-literal">False</span>,  <span class="hljs-comment"># ÊúÄÂêé‰∏Ä‰∏™GATÂ±ÇÊâßË°åÂπ≥ÂùáÂÄºÔºåÂÖ∂‰ªñÂ±ÇÊâßË°åËøûÊé•</span><br>                activation=nn.ELU() <span class="hljs-keyword">if</span> i &lt; num_of_layers - <span class="hljs-number">1</span> <span class="hljs-keyword">else</span> <span class="hljs-literal">None</span>,  <span class="hljs-comment"># ÊúÄÂêé‰∏ÄÂ±ÇÂè™ËæìÂá∫ÂéüÂßãÂàÜÊï∞</span><br>                dropout_prob=dropout,<br>                add_skip_connection=add_skip_connection,<br>                bias=bias,<br>                log_attention_weights=log_attention_weights<br>            )<br>            gat_layers.append(layer)<br><br>        <span class="hljs-variable language_">self</span>.gat_net = nn.Sequential(<br>            *gat_layers,<br>        )<br><br>    <span class="hljs-comment"># Êï∞ÊçÆÂè™ÊòØ‰∏Ä‰∏™Ôºàin_nodes_featuresÔºåedge_indexÔºâÂÖÉÁªÑÔºåÊàëÂøÖÈ°ªËøôÊ†∑ÂÅöÊòØÂõ†‰∏∫nn.SequentialÔºö</span><br>    <span class="hljs-comment"># https://discuss.pytorch.org/t/forward-takes-2-positional-arguments-but-3-were-given-for-nn-sqeuential-with-linear-layers/65698</span><br>    <span class="hljs-keyword">def</span> <span class="hljs-title function_">forward</span>(<span class="hljs-params">self, data</span>):<br>        <span class="hljs-keyword">return</span> <span class="hljs-variable language_">self</span>.gat_net(data)<br><br></code></pre></td></tr></table></figure>

<p>Áé∞Âú®ÔºåÊúâË∂£ÁöÑÈÉ®ÂàÜËÆ©Êàë‰ª¨ÂÆö‰πâÂõæÂ±Ç„ÄÇ</p>
<p>Êàë‰∏çËÆ§‰∏∫Áî®ÊñáÂ≠óÊù•Ëß£ÈáäÂÆÉÔºåÊØî‰Ω†Ëä±Êó∂Èó¥Ê∂àÂåñ‰ª£Á†ÅÂíåÊ≥®ÈáäÊõ¥Â•Ω„ÄÇ</p>
<p>Âú®‰Ω†ÂºÄÂßãÊµ™Ë¥πÊó∂Èó¥Â∞ùËØï‚Äú‰ªéÂ§¥ÂºÄÂßã‚ÄùÂºÑÊ∏ÖÊ•ö‰πãÂâçÔºåÂèØ‰ª•ÂÖàËßÇÁúã‰ΩúËÄÖÂú® GAT ‰∏äÁöÑËßÜÈ¢ë„ÄÇÊâãÂ§¥Êúâ‰∏Ä‰∫õÁêÜËÆ∫ËÉåÊôØÊÄªÊòØÂ•ΩÁöÑ„ÄÇ</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br><span class="line">116</span><br><span class="line">117</span><br><span class="line">118</span><br><span class="line">119</span><br><span class="line">120</span><br><span class="line">121</span><br><span class="line">122</span><br><span class="line">123</span><br><span class="line">124</span><br><span class="line">125</span><br><span class="line">126</span><br><span class="line">127</span><br><span class="line">128</span><br><span class="line">129</span><br><span class="line">130</span><br><span class="line">131</span><br><span class="line">132</span><br><span class="line">133</span><br><span class="line">134</span><br><span class="line">135</span><br><span class="line">136</span><br><span class="line">137</span><br><span class="line">138</span><br><span class="line">139</span><br><span class="line">140</span><br><span class="line">141</span><br><span class="line">142</span><br><span class="line">143</span><br><span class="line">144</span><br><span class="line">145</span><br><span class="line">146</span><br><span class="line">147</span><br><span class="line">148</span><br><span class="line">149</span><br><span class="line">150</span><br><span class="line">151</span><br><span class="line">152</span><br><span class="line">153</span><br><span class="line">154</span><br><span class="line">155</span><br><span class="line">156</span><br><span class="line">157</span><br><span class="line">158</span><br><span class="line">159</span><br><span class="line">160</span><br><span class="line">161</span><br><span class="line">162</span><br><span class="line">163</span><br><span class="line">164</span><br><span class="line">165</span><br><span class="line">166</span><br><span class="line">167</span><br><span class="line">168</span><br><span class="line">169</span><br><span class="line">170</span><br><span class="line">171</span><br><span class="line">172</span><br><span class="line">173</span><br><span class="line">174</span><br><span class="line">175</span><br><span class="line">176</span><br><span class="line">177</span><br><span class="line">178</span><br><span class="line">179</span><br><span class="line">180</span><br><span class="line">181</span><br><span class="line">182</span><br><span class="line">183</span><br><span class="line">184</span><br><span class="line">185</span><br><span class="line">186</span><br><span class="line">187</span><br><span class="line">188</span><br><span class="line">189</span><br><span class="line">190</span><br><span class="line">191</span><br><span class="line">192</span><br><span class="line">193</span><br><span class="line">194</span><br><span class="line">195</span><br><span class="line">196</span><br><span class="line">197</span><br><span class="line">198</span><br><span class="line">199</span><br><span class="line">200</span><br><span class="line">201</span><br><span class="line">202</span><br><span class="line">203</span><br><span class="line">204</span><br><span class="line">205</span><br><span class="line">206</span><br><span class="line">207</span><br><span class="line">208</span><br><span class="line">209</span><br><span class="line">210</span><br><span class="line">211</span><br><span class="line">212</span><br><span class="line">213</span><br><span class="line">214</span><br><span class="line">215</span><br><span class="line">216</span><br><span class="line">217</span><br><span class="line">218</span><br><span class="line">219</span><br><span class="line">220</span><br><span class="line">221</span><br><span class="line">222</span><br><span class="line">223</span><br><span class="line">224</span><br><span class="line">225</span><br><span class="line">226</span><br><span class="line">227</span><br><span class="line">228</span><br><span class="line">229</span><br><span class="line">230</span><br><span class="line">231</span><br><span class="line">232</span><br><span class="line">233</span><br><span class="line">234</span><br><span class="line">235</span><br><span class="line">236</span><br><span class="line">237</span><br><span class="line">238</span><br><span class="line">239</span><br><span class="line">240</span><br><span class="line">241</span><br><span class="line">242</span><br><span class="line">243</span><br><span class="line">244</span><br><span class="line">245</span><br><span class="line">246</span><br><span class="line">247</span><br><span class="line">248</span><br><span class="line">249</span><br><span class="line">250</span><br><span class="line">251</span><br><span class="line">252</span><br><span class="line">253</span><br></pre></td><td class="code"><pre><code class="hljs python"><span class="hljs-keyword">class</span> <span class="hljs-title class_">GATLayer</span>(torch.nn.Module):<br>    <span class="hljs-string">&quot;&quot;&quot;</span><br><span class="hljs-string">    ÂÆûÁé∞ #3 ÂèóÂà∞ PyTorch Geometric ÂêØÂèëÔºöhttps://github.com/rusty1s/pytorch_geometric</span><br><span class="hljs-string"></span><br><span class="hljs-string">    ‰ΩÜÊòØÔºåËøôÈáåÁöÑÂÆûÁé∞Â∫îËØ•Êõ¥ÂÆπÊòìÁêÜËß£ÔºÅÔºàÂπ∂‰∏îÊÄßËÉΩÁõ∏‰ººÔºâ</span><br><span class="hljs-string"></span><br><span class="hljs-string">    &quot;&quot;&quot;</span><br>    <br>    <span class="hljs-comment"># Êàë‰ª¨‰ºöÂú®ËÆ∏Â§öÂáΩÊï∞‰∏≠‰ΩøÁî®Ëøô‰∫õÂ∏∏ÈáèÔºåÊâÄ‰ª•Âú®ËøôÈáåÊèêÂèñ‰∏∫ÊàêÂëòÂ≠óÊÆµ</span><br>    src_nodes_dim = <span class="hljs-number">0</span>  <span class="hljs-comment"># ËæπÁ¥¢Âºï‰∏≠Ê∫êËäÇÁÇπÁöÑ‰ΩçÁΩÆ</span><br>    trg_nodes_dim = <span class="hljs-number">1</span>  <span class="hljs-comment"># ËæπÁ¥¢Âºï‰∏≠ÁõÆÊ†áËäÇÁÇπÁöÑ‰ΩçÁΩÆ</span><br><br>    <span class="hljs-comment"># Âú®ÂΩíÁ∫≥ËÆæÁΩÆ‰∏≠ÔºåËøô‰∫õÂèØËÉΩ‰ºöÊîπÂèò - ÊöÇÊó∂‰øùÁïôËøôÊ†∑ÁöÑËÆæÁΩÆÔºàÊú™Êù•ÂèØËÉΩ‰∏çÈÄÇÁî®Ôºâ</span><br>    nodes_dim = <span class="hljs-number">0</span>      <span class="hljs-comment"># ËäÇÁÇπÁª¥Â∫¶ÔºàËΩ¥Âú®Âº†Èáè‰∏≠ÂèØËÉΩÊòØ‰∏Ä‰∏™Êõ¥ÁÜüÊÇâÁöÑÊúØËØ≠ÔºåËäÇÁÇπÁª¥Â∫¶ÊòØ&quot;N&quot;ÁöÑ‰ΩçÁΩÆÔºâ</span><br>    head_dim = <span class="hljs-number">1</span>       <span class="hljs-comment"># Ê≥®ÊÑèÂäõÂ§¥Áª¥Â∫¶</span><br><br>    <span class="hljs-keyword">def</span> <span class="hljs-title function_">__init__</span>(<span class="hljs-params">self, num_in_features, num_out_features, num_of_heads, concat=<span class="hljs-literal">True</span>, activation=nn.ELU(<span class="hljs-params"></span>),</span><br><span class="hljs-params">                 dropout_prob=<span class="hljs-number">0.6</span>, add_skip_connection=<span class="hljs-literal">True</span>, bias=<span class="hljs-literal">True</span>, log_attention_weights=<span class="hljs-literal">False</span></span>):<br><br>        <span class="hljs-built_in">super</span>().__init__()<br><br>        <span class="hljs-variable language_">self</span>.num_of_heads = num_of_heads<br>        <span class="hljs-variable language_">self</span>.num_out_features = num_out_features<br>        <span class="hljs-variable language_">self</span>.concat = concat  <span class="hljs-comment"># ÊòØÂê¶Â∫îËØ•ËøûÊé•ËøòÊòØÂπ≥ÂùáÊ≥®ÊÑèÂäõÂ§¥</span><br>        <span class="hljs-variable language_">self</span>.add_skip_connection = add_skip_connection<br><br>        <span class="hljs-comment">#</span><br>        <span class="hljs-comment"># ÂèØËÆ≠ÁªÉÊùÉÈáçÔºöÁ∫øÊÄßÊäïÂΩ±Áü©ÈòµÔºàÂú®ËÆ∫Êñá‰∏≠Ë°®Á§∫‰∏∫&quot;W&quot;Ôºâ„ÄÅÊ≥®ÊÑèÂäõÁõÆÊ†á/Ê∫êÔºàÂú®ËÆ∫Êñá‰∏≠Ë°®Á§∫‰∏∫&quot;a&quot;ÔºâÂíåÂÅèÂ∑ÆÔºàÂú®ËÆ∫Êñá‰∏≠Êú™ÊèêÂà∞Ôºå‰ΩÜÂú®ÂÆòÊñπGATÂ≠òÂÇ®Â∫ì‰∏≠Â≠òÂú®Ôºâ</span><br>        <span class="hljs-comment">#</span><br><br>        <span class="hljs-comment"># ÂèØ‰ª•Â∞ÜËøô‰∏™Áü©ÈòµËßÜ‰∏∫ num_of_heads ‰∏™Áã¨Á´ãÁöÑ W Áü©Èòµ</span><br>        <span class="hljs-variable language_">self</span>.linear_proj = nn.Linear(num_in_features, num_of_heads * num_out_features, bias=<span class="hljs-literal">False</span>)<br><br>        <span class="hljs-comment"># Âú®Êàë‰ª¨ËøûÊé•ÁõÆÊ†áËäÇÁÇπÔºàËäÇÁÇπ iÔºâÂíåÊ∫êËäÇÁÇπÔºàËäÇÁÇπ jÔºâ‰πãÂêéÔºåÊàë‰ª¨Â∫îÁî®‚ÄúÂä†Ê≥ï‚ÄùËØÑÂàÜÂáΩÊï∞</span><br>        <span class="hljs-comment"># ÂÆÉÁªôÊàë‰ª¨Êú™Ê†áÂáÜÂåñÁöÑÂàÜÊï∞ &quot;e&quot;„ÄÇÂú®ËøôÈáåÔºåÊàë‰ª¨ÂàÜÂâ≤ &quot;a&quot; ÂêëÈáè - ‰ΩÜËØ≠‰πâ‰øùÊåÅ‰∏çÂèò„ÄÇ</span><br>        <span class="hljs-comment"># Âü∫Êú¨‰∏äÔºå‰∏éÊâßË°å [x, y]ÔºàËøûÊé•Ôºåx/y ÊòØËäÇÁÇπÁâπÂæÅÂêëÈáèÔºâÂíå‰∏é &quot;a&quot; ÁöÑÁÇπÁßØ‰∏çÂêåÔºå</span><br>        <span class="hljs-comment"># Êàë‰ª¨ÂàÜÂà´ÂØπ x Âíå &quot;a_left&quot; ËøõË°åÁÇπÁßØÔºåÂØπ y Âíå &quot;a_right&quot; ËøõË°åÁÇπÁßØÔºåÁÑ∂ÂêéÂ∞ÜÂÆÉ‰ª¨Áõ∏Âä†</span><br>        <span class="hljs-variable language_">self</span>.scoring_fn_target = nn.Parameter(torch.Tensor(<span class="hljs-number">1</span>, num_of_heads, num_out_features))<br>        <span class="hljs-variable language_">self</span>.scoring_fn_source = nn.Parameter(torch.Tensor(<span class="hljs-number">1</span>, num_of_heads, num_out_features))<br><br>        <span class="hljs-comment"># Âú® GAT ‰∏≠ÂÅèÁΩÆÁªùÂØπ‰∏çÊòØÂÖ≥ÈîÆÁöÑ - ÈöèÊó∂ÂÆûÈ™åÔºàÊàëÂú®Ëøô‰∏™ÈóÆÈ¢ò‰∏äÂêë‰∏ªË¶Å‰ΩúËÄÖ Petar ËØ¢ÈóÆËøáÔºâ</span><br>        <span class="hljs-keyword">if</span> bias <span class="hljs-keyword">and</span> concat:<br>            <span class="hljs-variable language_">self</span>.bias = nn.Parameter(torch.Tensor(num_of_heads * num_out_features))<br>        <span class="hljs-keyword">elif</span> bias <span class="hljs-keyword">and</span> <span class="hljs-keyword">not</span> concat:<br>            <span class="hljs-variable language_">self</span>.bias = nn.Parameter(torch.Tensor(num_out_features))<br>        <span class="hljs-keyword">else</span>:<br>            <span class="hljs-variable language_">self</span>.register_parameter(<span class="hljs-string">&#x27;bias&#x27;</span>, <span class="hljs-literal">None</span>)<br><br>        <span class="hljs-keyword">if</span> add_skip_connection:<br>            <span class="hljs-variable language_">self</span>.skip_proj = nn.Linear(num_in_features, num_of_heads * num_out_features, bias=<span class="hljs-literal">False</span>)<br>        <span class="hljs-keyword">else</span>:<br>            <span class="hljs-variable language_">self</span>.register_parameter(<span class="hljs-string">&#x27;skip_proj&#x27;</span>, <span class="hljs-literal">None</span>)<br><br>        <span class="hljs-comment">#</span><br>        <span class="hljs-comment"># ÂèØËÆ≠ÁªÉÊùÉÈáçÁªìÊùü</span><br>        <span class="hljs-comment">#</span><br><br>        <span class="hljs-variable language_">self</span>.leakyReLU = nn.LeakyReLU(<span class="hljs-number">0.2</span>)  <span class="hljs-comment"># ‰ΩøÁî® 0.2ÔºåÂ∞±ÂÉèÂú®ËÆ∫Êñá‰∏≠‰∏ÄÊ†∑Ôºå‰∏çÈúÄË¶ÅÂÖ¨ÂºÄÊØè‰∏™ËÆæÁΩÆ</span><br>        <span class="hljs-variable language_">self</span>.activation = activation<br>        <span class="hljs-comment"># ÂèØËÉΩ‰∏çÊòØÊúÄÂ•ΩÁöÑËÆæËÆ°Ôºå‰ΩÜÊàëÂú® 3 ‰∏™‰ΩçÁΩÆ‰ΩøÁî®Áõ∏ÂêåÁöÑÊ®°ÂùóÔºåÁî®‰∫éÁâπÂæÅÊäïÂΩ±‰πãÂâç/‰πãÂêéÂíåÊ≥®ÊÑèÂäõÁ≥ªÊï∞„ÄÇ</span><br>        <span class="hljs-comment"># Â∞±ÂäüËÉΩËÄåË®ÄÔºåÂÆÉ‰∏é‰ΩøÁî®Áã¨Á´ãÊ®°ÂùóÊòØÁõ∏ÂêåÁöÑ„ÄÇ</span><br>        <span class="hljs-variable language_">self</span>.dropout = nn.Dropout(p=dropout_prob)<br><br>        <span class="hljs-variable language_">self</span>.log_attention_weights = log_attention_weights  <span class="hljs-comment"># ÊòØÂê¶Â∫îËÆ∞ÂΩïÊ≥®ÊÑèÂäõÊùÉÈáç</span><br>        <span class="hljs-variable language_">self</span>.attention_weights = <span class="hljs-literal">None</span>  <span class="hljs-comment"># Áî®‰∫éÂêéÁª≠ÂèØËßÜÂåñÁõÆÁöÑÔºåÊàëÂú®ËøôÈáåÁºìÂ≠òÊùÉÈáç</span><br><br>        <span class="hljs-variable language_">self</span>.init_params()<br>        <br>    <span class="hljs-keyword">def</span> <span class="hljs-title function_">forward</span>(<span class="hljs-params">self, data</span>):<br>        <span class="hljs-comment">#</span><br>        <span class="hljs-comment"># Ê≠•È™§ 1ÔºöÁ∫øÊÄßÊäïÂΩ± + Ê≠£ÂàôÂåñ</span><br>        <span class="hljs-comment">#</span><br><br>        in_nodes_features, edge_index = data  <span class="hljs-comment"># Ëß£ÂåÖÊï∞ÊçÆ</span><br>        num_of_nodes = in_nodes_features.shape[<span class="hljs-variable language_">self</span>.nodes_dim]<br>        <span class="hljs-keyword">assert</span> edge_index.shape[<span class="hljs-number">0</span>] == <span class="hljs-number">2</span>, <span class="hljs-string">f&#x27;ÊúüÊúõÂΩ¢Áä∂‰∏∫ (2,E) ÁöÑËæπÁ¥¢ÂºïÔºåÂæóÂà∞‰∫Ü <span class="hljs-subst">&#123;edge_index.shape&#125;</span>&#x27;</span><br><br>        <span class="hljs-comment"># ÂΩ¢Áä∂ = (N, FIN)ÔºåÂÖ∂‰∏≠ N ÊòØÂõæ‰∏≠ÁöÑËäÇÁÇπÊï∞ÔºåFIN ÊòØÊØè‰∏™ËäÇÁÇπÁöÑËæìÂÖ•ÁâπÂæÅÊï∞</span><br>        <span class="hljs-comment"># Êàë‰ª¨ÂØπÊâÄÊúâËæìÂÖ•ËäÇÁÇπÁâπÂæÅÂ∫îÁî® dropoutÔºàÊ≠£Â¶ÇËÆ∫Êñá‰∏≠ÊâÄÊèêÂà∞ÁöÑÔºâ</span><br>        <span class="hljs-comment"># Ê≥®ÊÑèÔºöÂØπ‰∫é CoraÔºåÁâπÂæÅÂ∑≤ÁªèÈùûÂ∏∏Á®ÄÁñèÔºåÊâÄ‰ª•ÂÆûÈôÖ‰∏äÂèØËÉΩÂ∏ÆÂä©‰∏çÂ§ß</span><br>        in_nodes_features = <span class="hljs-variable language_">self</span>.dropout(in_nodes_features)<br><br>        <span class="hljs-comment"># ÂΩ¢Áä∂ = (N, FIN) * (FIN, NH*FOUT) -&gt; (N, NH, FOUT)ÔºåÂÖ∂‰∏≠ NH ÊòØÊ≥®ÊÑèÂäõÂ§¥ÁöÑÊï∞ÈáèÔºåFOUT ÊòØËæìÂá∫ÁâπÂæÅÁöÑÊï∞Èáè</span><br>        <span class="hljs-comment"># Êàë‰ª¨Â∞ÜËæìÂÖ•ËäÇÁÇπÁâπÂæÅÊäïÂΩ±Âà∞ NH ‰∏™Áã¨Á´ãÁöÑËæìÂá∫ÁâπÂæÅ‰∏≠ÔºàÊØè‰∏™Ê≥®ÊÑèÂäõÂ§¥‰∏Ä‰∏™Ôºâ</span><br>        nodes_features_proj = <span class="hljs-variable language_">self</span>.linear_proj(in_nodes_features).view(-<span class="hljs-number">1</span>, <span class="hljs-variable language_">self</span>.num_of_heads, <span class="hljs-variable language_">self</span>.num_out_features)<br><br>        nodes_features_proj = <span class="hljs-variable language_">self</span>.dropout(nodes_features_proj)  <span class="hljs-comment"># Âú®ÂÆòÊñπ GAT ÂÆûÁé∞‰∏≠Ôºå‰ªñ‰ª¨Âú®ËøôÈáå‰πü‰ΩøÁî®‰∫Ü dropout</span><br><br>        <span class="hljs-comment">#</span><br>        <span class="hljs-comment"># Ê≠•È™§ 2ÔºöËæπÊ≥®ÊÑèÂäõËÆ°ÁÆó</span><br>        <span class="hljs-comment">#</span><br><br>        <span class="hljs-comment"># Â∫îÁî®ËØÑÂàÜÂáΩÊï∞Ôºà* Ë°®Á§∫ÊåâÂÖÉÁ¥†Ôºà‰πüÁß∞‰∏∫HadamardÔºâ‰πòÊ≥ïÔºâ</span><br>        <span class="hljs-comment"># ÂΩ¢Áä∂ = (N, NH, FOUT) * (1, NH, FOUT) -&gt; (N, NH, 1) -&gt; (N, NH)ÔºåÂõ†‰∏∫ sum ÂéãÁº©‰∫ÜÊúÄÂêé‰∏Ä‰∏™Áª¥Â∫¶</span><br>        <span class="hljs-comment"># ‰ºòÂåñÊ≥®ÔºöÂú®ÊàëÁöÑÂÆûÈ™å‰∏≠Ôºåtorch.sum() ÁöÑÊÄßËÉΩ‰∏é .sum() ‰∏ÄÊ†∑Â•Ω</span><br>        scores_source = (nodes_features_proj * <span class="hljs-variable language_">self</span>.scoring_fn_source).<span class="hljs-built_in">sum</span>(dim=-<span class="hljs-number">1</span>)<br>        scores_target = (nodes_features_proj * <span class="hljs-variable language_">self</span>.scoring_fn_target).<span class="hljs-built_in">sum</span>(dim=-<span class="hljs-number">1</span>)<br><br>        <span class="hljs-comment"># Êàë‰ª¨Âè™ÈúÄÊ†πÊçÆËæπÁ¥¢ÂºïÂ§çÂà∂ÔºàÊèêÂçáÔºâÊ∫ê/ÁõÆÊ†áËäÇÁÇπÁöÑÂàÜÊï∞„ÄÇÊàë‰ª¨‰∏çÈúÄË¶ÅÂáÜÂ§áÊâÄÊúâÂèØËÉΩÁöÑÂàÜÊï∞ÁªÑÂêàÔºå</span><br>        <span class="hljs-comment"># Êàë‰ª¨Âè™ÈúÄË¶ÅÂáÜÂ§áÈÇ£‰∫õÂ∞ÜÂÆûÈôÖ‰ΩøÁî®ÁöÑÂàÜÊï∞ÁªÑÂêàÔºåËøôÁî±ËæπÁ¥¢ÂºïÂÆö‰πâ</span><br>        <span class="hljs-comment"># ÂàÜÊï∞ÂΩ¢Áä∂ = (E, NH)Ôºånodes_features_proj_lifted ÂΩ¢Áä∂ = (E, NH, FOUT)ÔºåE ÊòØÂõæ‰∏≠ÁöÑËæπÊï∞</span><br>        scores_source_lifted, scores_target_lifted, nodes_features_proj_lifted = <span class="hljs-variable language_">self</span>.lift(scores_source, scores_target, nodes_features_proj, edge_index)<br>        scores_per_edge = <span class="hljs-variable language_">self</span>.leakyReLU(scores_source_lifted + scores_target_lifted)<br><br>        <span class="hljs-comment"># ÂΩ¢Áä∂ = (E, NH, 1)</span><br>        attentions_per_edge = <span class="hljs-variable language_">self</span>.neighborhood_aware_softmax(scores_per_edge, edge_index[<span class="hljs-variable language_">self</span>.trg_nodes_dim], num_of_nodes)<br>        <span class="hljs-comment"># ÂØπÈÇªÂ±ÖËÅöÂêàÊ∑ªÂä†ÈöèÊú∫ÊÄß</span><br>        attentions_per_edge = <span class="hljs-variable language_">self</span>.dropout(attentions_per_edge)<br><br>        <span class="hljs-comment">#</span><br>        <span class="hljs-comment"># Ê≠•È™§ 3ÔºöÈÇªÂ±ÖËÅöÂêà</span><br>        <span class="hljs-comment">#</span><br><br>        <span class="hljs-comment"># ÈÄêÂÖÉÁ¥†Ôºà‰πüÁß∞‰∏∫HadamardÔºâ‰πòÊ≥ï„ÄÇËøêÁÆóÁ¨¶ * ÊâßË°å‰∏é torch.mul Áõ∏ÂêåÁöÑÊìç‰Ωú</span><br>        <span class="hljs-comment"># ÂΩ¢Áä∂ = (E, NH, FOUT) * (E, NH, 1) -&gt; (E, NH, FOUT)Ôºå1 Ë¢´ÂπøÊí≠Âà∞ FOUT</span><br>        nodes_features_proj_lifted_weighted = nodes_features_proj_lifted * attentions_per_edge<br><br>        <span class="hljs-comment"># Ëøô‰∏ÄÈÉ®ÂàÜÂØπÊØè‰∏™ÁõÆÊ†áËäÇÁÇπÁ¥ØÁßØÂä†ÊùÉÂíåÊäïÂΩ±ÁöÑÈÇªÂ±ÖÁâπÂæÅÂêëÈáè</span><br>        <span class="hljs-comment"># ÂΩ¢Áä∂ = (N, NH, FOUT)</span><br>        out_nodes_features = <span class="hljs-variable language_">self</span>.aggregate_neighbors(nodes_features_proj_lifted_weighted, edge_index, in_nodes_features, num_of_nodes)<br><br>        <span class="hljs-comment">#</span><br>        <span class="hljs-comment"># Ê≠•È™§ 4ÔºöÊÆãÂ∑Æ/Ë∑≥Ë∑ÉËøûÊé•„ÄÅËøûÊé•ÂíåÂÅèÂ∑Æ</span><br>        <span class="hljs-comment">#</span><br><br>        out_nodes_features = <span class="hljs-variable language_">self</span>.skip_concat_bias(attentions_per_edge, in_nodes_features, out_nodes_features)<br>        <span class="hljs-keyword">return</span> (out_nodes_features, edge_index)<br><br>    <span class="hljs-comment">#</span><br>    <span class="hljs-comment"># ËæÖÂä©ÂáΩÊï∞ÔºàÊ≤°ÊúâÊ≥®ÈáäÂá†‰πéÊ≤°Êúâ‰ª£Á†ÅÔºåÊâÄ‰ª•‰∏çË¶ÅÂÆ≥ÊÄïÔºÅÔºâ</span><br>    <span class="hljs-comment">#</span><br><br>    <span class="hljs-keyword">def</span> <span class="hljs-title function_">neighborhood_aware_softmax</span>(<span class="hljs-params">self, scores_per_edge, trg_index, num_of_nodes</span>):<br>        <span class="hljs-string">&quot;&quot;&quot;</span><br><span class="hljs-string">        Ê≠£Â¶ÇÂáΩÊï∞ÂêçÊâÄÁ§∫ÔºåÂÆÉÂØπÈÇªÂ±ÖÊâßË°å softmax„ÄÇ‰æãÂ¶ÇÔºöÂÅáËÆæÂõæ‰∏≠Êúâ 5 ‰∏™ËäÇÁÇπ„ÄÇÂÖ∂‰∏≠ÁöÑ‰∏§‰∏™ËäÇÁÇπ 1„ÄÅ2 ‰∏éËäÇÁÇπ 3 Áõ∏Ëøû„ÄÇ</span><br><span class="hljs-string">        Â¶ÇÊûúÊàë‰ª¨Ë¶ÅËÆ°ÁÆóËäÇÁÇπ 3 ÁöÑË°®Á§∫ÔºåÊàë‰ª¨Â∫îËØ•ËÄÉËôëËäÇÁÇπ 1„ÄÅ2 ÂíåËäÇÁÇπ 3 Êú¨Ë∫´ÁöÑÁâπÂæÅÂêëÈáè„ÄÇÁî±‰∫éÊàë‰ª¨ÂØπËæπ 1-3„ÄÅ2-3 Âíå 3-3 ÁöÑÂàÜÊï∞</span><br><span class="hljs-string">        ËøõË°å‰∫ÜËØÑ‰º∞ÔºåËøô‰∏™ÂáΩÊï∞Â∞ÜËÆ°ÁÆóÁ±ª‰ººËøôÊ†∑ÁöÑÊ≥®ÊÑèÂäõÂàÜÊï∞Ôºö1-3 / (1-3 + 2-3 + 3-3)ÔºàÂÖ∂‰∏≠ 1-3 ÊòØËøáËΩΩÁöÑÁ¨¶Âè∑ÔºåÂÆÉË°®Á§∫Ëæπ 1-3 ÂèäÂÖ∂ÔºàexpÔºâÂàÜÊï∞ÔºâÔºå</span><br><span class="hljs-string">        Á±ª‰ººÂú∞ÂØπ‰∫é 2-3 Âíå 3-3ÔºåÂç≥ÂØπ‰∫éËøô‰∏™ÈÇªÂ±ÖÔºåÊàë‰ª¨‰∏çÂÖ≥ÂøÉÂåÖÂê´ËäÇÁÇπ 4 Âíå 5 ÁöÑÂÖ∂‰ªñËæπÂàÜÊï∞„ÄÇ</span><br><span class="hljs-string"></span><br><span class="hljs-string">        Ê≥®ÊÑèÔºö</span><br><span class="hljs-string">        ‰ªé logits ‰∏≠ÂáèÂéªÊúÄÂ§ßÂÄº‰∏ç‰ºöÊîπÂèòÊúÄÁªàÁªìÊûúÔºå‰ΩÜÂÆÉÊèêÈ´ò‰∫ÜÊï∞ÂÄºÁ®≥ÂÆöÊÄßÔºåÂπ∂‰∏îÂú®Âá†‰πéÊØè‰∏™Ê∑±Â∫¶Â≠¶‰π†Ê°ÜÊû∂‰∏≠ÔºåËøôÊòØ‰∏Ä‰∏™Áõ∏ÂΩìÂ∏∏ËßÅÁöÑ‚ÄúÊäÄÂ∑ß‚Äù„ÄÇ</span><br><span class="hljs-string">        ÊúâÂÖ≥Êõ¥Â§öËØ¶ÁªÜ‰ø°ÊÅØÔºåËØ∑Êü•ÁúãÊ≠§ÈìæÊé•Ôºö</span><br><span class="hljs-string"></span><br><span class="hljs-string">        https://stats.stackexchange.com/questions/338285/how-does-the-subtraction-of-the-logit-maximum-improve-learning</span><br><span class="hljs-string"></span><br><span class="hljs-string">        &quot;&quot;&quot;</span><br>        <span class="hljs-comment"># ËÆ°ÁÆóÂàÜÂ≠ê„ÄÇ‰Ωø logits &lt;= 0Ôºå‰ª•‰æø e^logit &lt;= 1ÔºàËøôÂ∞ÜÊèêÈ´òÊï∞ÂÄºÁ®≥ÂÆöÊÄßÔºâ</span><br>        scores_per_edge = scores_per_edge - scores_per_edge.<span class="hljs-built_in">max</span>()<br>        exp_scores_per_edge = scores_per_edge.exp()  <span class="hljs-comment"># softmax</span><br><br>        <span class="hljs-comment"># ËÆ°ÁÆóÂàÜÊØç„ÄÇÂΩ¢Áä∂ = (E, NH)</span><br>        neigborhood_aware_denominator = <span class="hljs-variable language_">self</span>.sum_edge_scores_neighborhood_aware(exp_scores_per_edge, trg_index, num_of_nodes)<br><br>        <span class="hljs-comment"># 1e-16 Âú®ÁêÜËÆ∫‰∏ä‰∏çÊòØÂøÖÈúÄÁöÑÔºå‰ΩÜÂÆÉ‰ªÖÂá∫‰∫éÊï∞ÂÄºÁ®≥ÂÆöÊÄßËÄÉËôëÂ≠òÂú®ÔºàÈÅøÂÖçÈô§‰ª• 0Ôºâ- Áî±‰∫éËÆ°ÁÆóÊú∫Â∞ÜÈùûÂ∏∏Â∞èÁöÑÊï∞Â≠óÂõõËàç‰∫îÂÖ•Âà∞ 0ÔºåËøôÊòØÂèØËÉΩÁöÑ</span><br>        attentions_per_edge = exp_scores_per_edge / (neigborhood_aware_denominator + <span class="hljs-number">1e-16</span>)<br><br>        <span class="hljs-comment"># shape = (E, NH) -&gt; (E, NH, 1) so that we can do element-wise multiplication with projected node features</span><br>        <span class="hljs-keyword">return</span> attentions_per_edge.unsqueeze(-<span class="hljs-number">1</span>)<br><br>    <span class="hljs-keyword">def</span> <span class="hljs-title function_">sum_edge_scores_neighborhood_aware</span>(<span class="hljs-params">self, exp_scores_per_edge, trg_index, num_of_nodes</span>):<br>        <span class="hljs-comment"># ÂΩ¢Áä∂ÂøÖÈ°ª‰∏é exp_scores_per_edge Áõ∏ÂêåÔºàÁî± scatter_add_ Ë¶ÅÊ±ÇÔºâÔºåÂç≥‰ªé E Âèò‰∏∫ (E, NH)</span><br>        trg_index_broadcasted = <span class="hljs-variable language_">self</span>.explicit_broadcast(trg_index, exp_scores_per_edge)<br><br>        <span class="hljs-comment"># ÂΩ¢Áä∂‰∏∫ (N, NH)ÔºåÂÖ∂‰∏≠ N ÊòØËäÇÁÇπÊï∞ÈáèÔºåNH ÊòØÊ≥®ÊÑèÂäõÂ§¥ÁöÑÊï∞Èáè</span><br>        size = <span class="hljs-built_in">list</span>(exp_scores_per_edge.shape)  <span class="hljs-comment"># ËΩ¨Êç¢‰∏∫ÂàóË°®ÔºåÂê¶ÂàôÊó†Ê≥ïËøõË°åËµãÂÄº</span><br>        size[<span class="hljs-variable language_">self</span>.nodes_dim] = num_of_nodes<br>        neighborhood_sums = torch.zeros(size, dtype=exp_scores_per_edge.dtype, device=exp_scores_per_edge.device)<br><br>        <span class="hljs-comment"># ‰ΩçÁΩÆ i ÂåÖÂê´ÊâÄÊúâÊåáÂêëËäÇÁÇπ i ÁöÑËäÇÁÇπÁöÑ exp ÂàÜÊï∞‰πãÂíåÔºàÁî±ÁõÆÊ†áÁ¥¢ÂºïÊåáÂÆöÔºâ</span><br>        neighborhood_sums.scatter_add_(<span class="hljs-variable language_">self</span>.nodes_dim, trg_index_broadcasted, exp_scores_per_edge)<br><br>        <span class="hljs-comment"># ÂÜçÊ¨°Êâ©Â±ïÔºå‰ª•‰æøÂ∞ÜÂÖ∂Áî®‰Ωú softmax ÂàÜÊØç„ÄÇ‰æãÂ¶ÇÔºåËäÇÁÇπ i ÁöÑÊÄªÂíåÂ∞ÜÂ§çÂà∂Âà∞Ê∫êËäÇÁÇπÊåáÂêë i ÁöÑÊâÄÊúâ‰ΩçÁΩÆÔºàÁî±ÁõÆÊ†áÁ¥¢ÂºïÊåáÂÆöÔºâ</span><br>        <span class="hljs-comment"># ÂΩ¢Áä∂‰∏∫ (N, NH) -&gt; (E, NH)</span><br>        <span class="hljs-keyword">return</span> neighborhood_sums.index_select(<span class="hljs-variable language_">self</span>.nodes_dim, trg_index)<br><br>    <span class="hljs-keyword">def</span> <span class="hljs-title function_">aggregate_neighbors</span>(<span class="hljs-params">self, nodes_features_proj_lifted_weighted, edge_index, in_nodes_features, num_of_nodes</span>):<br>        size = <span class="hljs-built_in">list</span>(nodes_features_proj_lifted_weighted.shape)  <span class="hljs-comment"># ËΩ¨Êç¢‰∏∫ÂàóË°®ÔºåÂê¶ÂàôÊó†Ê≥ïËøõË°åËµãÂÄº</span><br>        size[<span class="hljs-variable language_">self</span>.nodes_dim] = num_of_nodes  <span class="hljs-comment"># ÂΩ¢Áä∂‰∏∫ (N, NH, FOUT)</span><br>        out_nodes_features = torch.zeros(size, dtype=in_nodes_features.dtype, device=in_nodes_features.device)<br><br>        <span class="hljs-comment"># ÂΩ¢Áä∂‰∏∫ (E) -&gt; (E, NH, FOUT)</span><br>        trg_index_broadcasted = <span class="hljs-variable language_">self</span>.explicit_broadcast(edge_index[<span class="hljs-variable language_">self</span>.trg_nodes_dim], nodes_features_proj_lifted_weighted)<br>        <span class="hljs-comment"># ËÅöÂêàÊ≠•È™§ - Êàë‰ª¨Á¥ØÁßØÊâÄÊúâÊ≥®ÊÑèÂäõÂ§¥ÁöÑÊäïÂΩ±Âä†ÊùÉËäÇÁÇπÁâπÂæÅ</span><br>        <span class="hljs-comment"># ÂΩ¢Áä∂‰∏∫ (E, NH, FOUT) -&gt; (N, NH, FOUT)</span><br>        out_nodes_features.scatter_add_(<span class="hljs-variable language_">self</span>.nodes_dim, trg_index_broadcasted, nodes_features_proj_lifted_weighted)<br><br>        <span class="hljs-keyword">return</span> out_nodes_features<br><br>    <span class="hljs-keyword">def</span> <span class="hljs-title function_">lift</span>(<span class="hljs-params">self, scores_source, scores_target, nodes_features_matrix_proj, edge_index</span>):<br>        <span class="hljs-string">&quot;&quot;&quot;</span><br><span class="hljs-string">        Êä¨ÂçáÔºàLiftÔºâÂç≥Ê†πÊçÆËæπÁ¥¢ÂºïÂ§çÂà∂ÁâπÂÆöÂêëÈáè„ÄÇ</span><br><span class="hljs-string">        Âº†ÈáèÁöÑÁª¥Â∫¶‰πã‰∏Ä‰ªé N Âèò‰∏∫ EÔºàËøôÂ∞±ÊòØ‚ÄúÊä¨Âçá‚Äù‰∏ÄËØçÁöÑÊù•Ê∫êÔºâ„ÄÇ</span><br><span class="hljs-string"></span><br><span class="hljs-string">        &quot;&quot;&quot;</span><br>        src_nodes_index = edge_index[<span class="hljs-variable language_">self</span>.src_nodes_dim]<br>        trg_nodes_index = edge_index[<span class="hljs-variable language_">self</span>.trg_nodes_dim]<br><br>        <span class="hljs-comment"># ‰ΩøÁî® index_select ÊØîÂú® PyTorch ‰∏≠‰ΩøÁî® &quot;normal&quot; Á¥¢ÂºïÔºàscores_source[src_nodes_index]ÔºâÊõ¥Âø´ÔºÅ</span><br>        scores_source = scores_source.index_select(<span class="hljs-variable language_">self</span>.nodes_dim, src_nodes_index)<br>        scores_target = scores_target.index_select(<span class="hljs-variable language_">self</span>.nodes_dim, trg_nodes_index)<br>        nodes_features_matrix_proj_lifted = nodes_features_matrix_proj.index_select(<span class="hljs-variable language_">self</span>.nodes_dim, src_nodes_index)<br><br>        <span class="hljs-keyword">return</span> scores_source, scores_target, nodes_features_matrix_proj_lifted<br><br>    <span class="hljs-keyword">def</span> <span class="hljs-title function_">explicit_broadcast</span>(<span class="hljs-params">self, this, other</span>):<br>        <span class="hljs-comment"># ÈôÑÂä†Âçï‰æãÁª¥Â∫¶ÔºåÁõ¥Âà∞ this.dim() == other.dim()</span><br>        <span class="hljs-keyword">for</span> _ <span class="hljs-keyword">in</span> <span class="hljs-built_in">range</span>(this.dim(), other.dim()):<br>            this = this.unsqueeze(-<span class="hljs-number">1</span>)<br><br>        <span class="hljs-comment"># ÊòéÁ°ÆÊâ©Â±ï‰ª•‰ΩøÂΩ¢Áä∂Áõ∏Âêå</span><br>        <span class="hljs-keyword">return</span> this.expand_as(other)<br><br>    <span class="hljs-keyword">def</span> <span class="hljs-title function_">init_params</span>(<span class="hljs-params">self</span>):<br>        <span class="hljs-string">&quot;&quot;&quot;</span><br><span class="hljs-string">        Êàë‰ª¨‰ΩøÁî® GlorotÔºà‰πüÁß∞‰∏∫ Xavier ÂùáÂåÄÔºâÂàùÂßãÂåñÁöÑÂéüÂõ†ÊòØÂõ†‰∏∫ÂÆÉÊòØ TF ÁöÑÈªòËÆ§ÂàùÂßãÂåñÊñπÂºèÔºö</span><br><span class="hljs-string">            https://stackoverflow.com/questions/37350131/what-is-the-default-variable-initializer-in-tensorflow</span><br><span class="hljs-string"></span><br><span class="hljs-string">        ÂéüÂßãÂ∫ìÂú® TensorFlowÔºàTFÔºâ‰∏≠ÂºÄÂèëÔºåÂπ∂‰∏î‰ªñ‰ª¨‰ΩøÁî®‰∫ÜÈªòËÆ§ÂàùÂßãÂåñ„ÄÇ</span><br><span class="hljs-string">        ÈöèÊó∂ËøõË°åÂÆûÈ™å - Ê†πÊçÆÈóÆÈ¢òÂèØËÉΩÊúâÊõ¥Â•ΩÁöÑÂàùÂßãÂåñÊñπÊ≥ï„ÄÇ</span><br><span class="hljs-string"></span><br><span class="hljs-string">        &quot;&quot;&quot;</span><br>        nn.init.xavier_uniform_(<span class="hljs-variable language_">self</span>.linear_proj.weight)<br>        nn.init.xavier_uniform_(<span class="hljs-variable language_">self</span>.scoring_fn_target)<br>        nn.init.xavier_uniform_(<span class="hljs-variable language_">self</span>.scoring_fn_source)<br><br>        <span class="hljs-keyword">if</span> <span class="hljs-variable language_">self</span>.bias <span class="hljs-keyword">is</span> <span class="hljs-keyword">not</span> <span class="hljs-literal">None</span>:<br>            torch.nn.init.zeros_(<span class="hljs-variable language_">self</span>.bias)<br><br>    <span class="hljs-keyword">def</span> <span class="hljs-title function_">skip_concat_bias</span>(<span class="hljs-params">self, attention_coefficients, in_nodes_features, out_nodes_features</span>):<br>        <span class="hljs-keyword">if</span> <span class="hljs-variable language_">self</span>.log_attention_weights:  <span class="hljs-comment"># ÂèØËÉΩËÆ∞ÂΩï‰ª•‰æõÁ®çÂêéÂú® playground.py ‰∏≠ÂèØËßÜÂåñ</span><br>            <span class="hljs-variable language_">self</span>.attention_weights = attention_coefficients<br><br>        <span class="hljs-keyword">if</span> <span class="hljs-variable language_">self</span>.add_skip_connection:  <span class="hljs-comment"># Ê∑ªÂä†Ë∑≥Ë∑ÉÊàñÊÆãÂ∑ÆËøûÊé•</span><br>            <span class="hljs-keyword">if</span> out_nodes_features.shape[-<span class="hljs-number">1</span>] == in_nodes_features.shape[-<span class="hljs-number">1</span>]:  <span class="hljs-comment"># Â¶ÇÊûú FIN == FOUT</span><br>                <span class="hljs-comment"># unsqueeze ÂÆûÁé∞‰ª•‰∏ãÊïàÊûúÔºö(N, FIN) -&gt; (N, 1, FIN)ÔºåËæìÂá∫ÁâπÂæÅ‰∏∫ (N, NH, FOUT) ÊâÄ‰ª• 1 Ë¢´ÂπøÊí≠Âà∞ NH</span><br>                <span class="hljs-comment"># Âõ†Ê≠§ÔºåÂü∫Êú¨‰∏äÊàë‰ª¨Â∞ÜËæìÂÖ•ÂêëÈáè NH Ê¨°Â§çÂà∂Âπ∂Ê∑ªÂä†Âà∞Â§ÑÁêÜËøáÁöÑÂêëÈáè‰∏≠</span><br>                out_nodes_features += in_nodes_features.unsqueeze(<span class="hljs-number">1</span>)<br>            <span class="hljs-keyword">else</span>:<br>                <span class="hljs-comment"># FIN != FOUTÔºåÂõ†Ê≠§Êàë‰ª¨ÈúÄË¶ÅÂ∞ÜËæìÂÖ•ÁâπÂæÅÂêëÈáèÊäïÂΩ±Âà∞ÂèØ‰ª•Ê∑ªÂä†Âà∞ËæìÂá∫ÁâπÂæÅÂêëÈáèÁöÑÁª¥Â∫¶„ÄÇ</span><br>                <span class="hljs-comment"># skip_proj Ê∑ªÂä†‰∫ÜÂ§ßÈáèÈ¢ùÂ§ñÁöÑÂÆπÈáèÔºåËøôÂèØËÉΩÂØºËá¥ËøáÊãüÂêà„ÄÇ</span><br>                out_nodes_features += <span class="hljs-variable language_">self</span>.skip_proj(in_nodes_features).view(-<span class="hljs-number">1</span>, <span class="hljs-variable language_">self</span>.num_of_heads, <span class="hljs-variable language_">self</span>.num_out_features)<br><br>        <span class="hljs-keyword">if</span> <span class="hljs-variable language_">self</span>.concat:<br>            <span class="hljs-comment"># ÂΩ¢Áä∂‰∏∫ (N, NH, FOUT) -&gt; (N, NH*FOUT)</span><br>            out_nodes_features = out_nodes_features.view(-<span class="hljs-number">1</span>, <span class="hljs-variable language_">self</span>.num_of_heads * <span class="hljs-variable language_">self</span>.num_out_features)<br>        <span class="hljs-keyword">else</span>:<br>            <span class="hljs-comment"># ÂΩ¢Áä∂‰∏∫ (N, NH, FOUT) -&gt; (N, FOUT)</span><br>            out_nodes_features = out_nodes_features.mean(dim=<span class="hljs-variable language_">self</span>.head_dim)<br><br>        <span class="hljs-keyword">if</span> <span class="hljs-variable language_">self</span>.bias <span class="hljs-keyword">is</span> <span class="hljs-keyword">not</span> <span class="hljs-literal">None</span>:<br>            out_nodes_features += <span class="hljs-variable language_">self</span>.bias<br><br>        <span class="hljs-keyword">return</span> out_nodes_features <span class="hljs-keyword">if</span> <span class="hljs-variable language_">self</span>.activation <span class="hljs-keyword">is</span> <span class="hljs-literal">None</span> <span class="hljs-keyword">else</span> <span class="hljs-variable language_">self</span>.activation(out_nodes_features)<br></code></pre></td></tr></table></figure>

<p>Â∑®Â§ßËäÇÁúÅÁöÑÊÄùÊÉ≥ÊòØ‰ªÖËÆ°ÁÆóÂÆûÈôÖ‰ΩøÁî®ÁöÑËäÇÁÇπÁöÑÂàÜÊï∞ÔºåËÄå‰∏çÊòØËÆ°ÁÆóÊØè‰∏™ÂèØÊÉ≥Ë±°ÁöÑÁªÑÂêàÁöÑÂàÜÊï∞ÔºàËøô‰ªÖÂú®ÂÆåÂÖ®ËøûÊé•ÁöÑÂõæ‰∏≠ÊúâÊïàÔºâ„ÄÇ</p>
<p>‰∏ÄÊó¶Êàë‰ª¨ËÆ°ÁÆóÂá∫‚Äùleft‚ÄùÂàÜÊï∞Âíå‚Äùright‚ÄùÂàÜÊï∞ÔºåÊàë‰ª¨Â∞±‰ΩøÁî®ËæπÁ¥¢Âºï‚Äúlift‚ÄùÂÆÉ‰ª¨„ÄÇËøôÊ†∑ÔºåÂ¶ÇÊûú1-&gt;2Âõæ‰∏≠‰∏çÂ≠òÂú®ËæπÔºåÊàë‰ª¨ÁöÑÊï∞ÊçÆÁªìÊûÑ‰∏≠Â∞±‰∏ç‰ºöÊúâËøô‰∫õÂàÜÊï∞ÂØπ„ÄÇ</p>
<p>Âú®Ê∑ªÂä†ÊèêÂçáÁöÑ‚ÄúÂ∑¶‚ÄùÂíå‚ÄúÂè≥‚ÄùÔºàÊàñËÄÖÊõ¥Â•ΩÁöÑÂëΩÂêçÊñπÂºèÊòØÊ∫êÂíåÁõÆÊ†áÔºâÂàÜÊï∞ÂêéÔºåÊàë‰ª¨ÂæàËÅ™ÊòéÁöÑÁî®neighborhood-aware softmax-ËøôÊ†∑ GATÁöÑËØ≠‰πâÂ∞±ÂæóÂà∞‰∫ÜË°®Ëææ„ÄÇÂÆåÊàêÂêéscatter addÔºàÊÇ®Â∫îËØ•Ëä±Êó∂Èó¥ÁêÜËß£Âπ∂ÈòÖËØªÊñáÊ°£ÔºâÔºåÊàë‰ª¨ÂèØ‰ª•ÁªÑÂêàÊäïÂΩ±ÁöÑÁâπÂæÅÂêëÈáèÔºåÁûßÔºåÊàë‰ª¨ÂæóÂà∞‰∫Ü‰∏Ä‰∏™ÊàêÁÜüÁöÑ GAT Â±Ç„ÄÇ</p>
<hr>
<p>ÊÖ¢ÊÖ¢Êù•ÔºåË¶ÅÊúâËÄêÂøÉÔºÅÁâπÂà´ÊòØÂ¶ÇÊûúÊÇ®ÊòØ GNN Êñ∞Êâã„ÄÇ</p>
<p>Êàë‰∏çÊòØ‰∏ÄÂ§©Â∞±ËÉΩÂ≠¶‰ºöÊâÄÊúâËøô‰∫õÁöÑÔºåÈúÄË¶ÅÊó∂Èó¥Êù•Ê∂àÂåñÁü•ËØÜ„ÄÇ</p>
<p>ËØùËôΩÂ¶ÇÊ≠§ÔºåÊàë‰ª¨Â∑≤ÁªèËß£ÈîÅ‰∫ÜÁ¨¨ 3 Á∫ßÔºàÊ®°ÂûãËÆ≠ÁªÉ üí™Ôºâ„ÄÇüòç<br>Êàë‰ª¨Â∑≤ÁªèÂáÜÂ§áÂ•Ω‰∫ÜÊï∞ÊçÆüìúÔºåÊàë‰ª¨Â∑≤ÁªèÂáÜÂ§áÂ•Ω‰∫ÜGATÊ®°Âûãü¶ÑÔºåËÆ©Êàë‰ª¨ÂºÄÂßãËÆ≠ÁªÉËøôÂ§¥ÈáéÂÖΩÂêßÔºÅüí™</p>
<h1 id="Á¨¨-3-ÈÉ®ÂàÜÔºöËÆ≠ÁªÉ-GAT-üí™ÔºàCora-‰∏äÁöÑÂàÜÁ±ªÔºÅÔºâ"><a href="#Á¨¨-3-ÈÉ®ÂàÜÔºöËÆ≠ÁªÉ-GAT-üí™ÔºàCora-‰∏äÁöÑÂàÜÁ±ªÔºÅÔºâ" class="headerlink" title="Á¨¨ 3 ÈÉ®ÂàÜÔºöËÆ≠ÁªÉ GAT üí™ÔºàCora ‰∏äÁöÑÂàÜÁ±ªÔºÅÔºâ"></a>Á¨¨ 3 ÈÉ®ÂàÜÔºöËÆ≠ÁªÉ GAT üí™ÔºàCora ‰∏äÁöÑÂàÜÁ±ªÔºÅÔºâ</h1><p>Âî∑ÔºåÂ•ΩÂêßÔºåÊúÄÂõ∞ÈöæÁöÑÈÉ®ÂàÜÂ∑≤ÁªèËøáÂéª‰∫Ü„ÄÇËÆ©Êàë‰ª¨ÂàõÂª∫‰∏Ä‰∏™ÁÆÄÂçïÁöÑËÆ≠ÁªÉÂæ™ÁéØÔºåÂÖ∂ÁõÆÊ†áÊòØÂ≠¶‰π†ÂØπ Cora ËäÇÁÇπËøõË°åÂàÜÁ±ª„ÄÇ</p>
<p>‰ΩÜÈ¶ñÂÖàËÆ©Êàë‰ª¨ÂÆö‰πâ‰∏Ä‰∫õÁõ∏ÂÖ≥ÁöÑÂ∏∏Èáè„ÄÇ</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br></pre></td><td class="code"><pre><code class="hljs python"><span class="hljs-keyword">from</span> torch.utils.tensorboard <span class="hljs-keyword">import</span> SummaryWriter<br><br><span class="hljs-comment"># train.py ‰∏≠‰ΩøÁî®ÁöÑ 3 ‰∏™‰∏çÂêåÁöÑÊ®°ÂûãËÆ≠ÁªÉ/ËØÑ‰º∞Èò∂ÊÆµ</span><br><span class="hljs-keyword">class</span> <span class="hljs-title class_">LoopPhase</span>(enum.Enum):<br>    TRAIN = <span class="hljs-number">0</span>,  <span class="hljs-comment"># ËÆ≠ÁªÉÈò∂ÊÆµ</span><br>    VAL = <span class="hljs-number">1</span>,    <span class="hljs-comment"># È™åËØÅÈò∂ÊÆµ</span><br>    TEST = <span class="hljs-number">2</span>    <span class="hljs-comment"># ÊµãËØïÈò∂ÊÆµ</span><br><br>writer = SummaryWriter()  <span class="hljs-comment"># ÔºàtensorboardÔºâwriter ÈªòËÆ§Â∞ÜËæìÂá∫Âà∞ ./runs/ ÁõÆÂΩï</span><br><br><span class="hljs-comment"># Áî®‰∫éÊèêÂâçÂÅúÊ≠¢ÁöÑÂÖ®Â±ÄÂèòÈáè„ÄÇÂú®Ê≤°ÊúâÂú®È™åËØÅÊï∞ÊçÆÈõÜ‰∏äÊúâ‰ªª‰ΩïÊîπËøõÔºàÈÄöËøáÂáÜÁ°ÆÊÄßÂ∫¶ÈáèÔºâÁöÑÊÉÖÂÜµ‰∏ãÔºå</span><br><span class="hljs-comment"># ÁªèËøá‰∏ÄÂÆöÊï∞ÈáèÁöÑ epochsÔºàÁî± patience_period ÂèòÈáèÂÆö‰πâÔºâÔºåÊàë‰ª¨Â∞ÜÈÄÄÂá∫ËÆ≠ÁªÉÂæ™ÁéØ„ÄÇ</span><br>BEST_VAL_ACC = <span class="hljs-number">0</span>      <span class="hljs-comment"># ÊúÄ‰Ω≥È™åËØÅÂáÜÁ°ÆÊÄß</span><br>BEST_VAL_LOSS = <span class="hljs-number">0</span>     <span class="hljs-comment"># ÊúÄ‰Ω≥È™åËØÅÊçüÂ§±</span><br>PATIENCE_CNT = <span class="hljs-number">0</span>      <span class="hljs-comment"># ÂøçËÄêËÆ°Êï∞</span><br><br>BINARIES_PATH = os.path.join(os.getcwd(), <span class="hljs-string">&#x27;models&#x27;</span>, <span class="hljs-string">&#x27;binaries&#x27;</span>)  <span class="hljs-comment"># Â≠òÂÇ®‰∫åËøõÂà∂Êñá‰ª∂ÁöÑË∑ØÂæÑ</span><br>CHECKPOINTS_PATH = os.path.join(os.getcwd(), <span class="hljs-string">&#x27;models&#x27;</span>, <span class="hljs-string">&#x27;checkpoints&#x27;</span>)  <span class="hljs-comment"># Â≠òÂÇ®Ê£ÄÊü•ÁÇπÁöÑË∑ØÂæÑ</span><br><br><span class="hljs-comment"># Á°Æ‰øùËøô‰∫õË∑ØÂæÑÂ≠òÂú®ÔºåÂõ†‰∏∫‰ª£Á†ÅÁöÑÂÖ∂‰ΩôÈÉ®ÂàÜÂÅáÂÆöÂ≠òÂú®ÂÆÉ‰ª¨</span><br>os.makedirs(BINARIES_PATH, exist_ok=<span class="hljs-literal">True</span>)<br>os.makedirs(CHECKPOINTS_PATH, exist_ok=<span class="hljs-literal">True</span>)<br><br></code></pre></td></tr></table></figure>

<p>Âè¶Â§ñÔºåÊàë‰ª¨ÂÆö‰πâÂá†‰∏™Âú®ËÆ≠ÁªÉÊ®°ÂûãÊó∂ÊúâÁî®ÁöÑÂáΩÊï∞„ÄÇ</p>
<p>ËÆ≠ÁªÉÁä∂ÊÄÅÂåÖÂê´ÂæàÂ§öÊúâÁî®ÁöÑÂÜÖÂÆπmetadataÔºåÊàë‰ª¨ÂèØ‰ª•Âú®‰ª•Âêé‰ΩøÁî®„ÄÇÊÇ®ÂèØ‰ª•ÊÉ≥Ë±°Ôºå‰øùÂ≠òÊ®°ÂûãÁöÑÊµãËØïÂáÜÁ°ÆÊÄßÈùûÂ∏∏ÈáçË¶ÅÔºåÂ∞§ÂÖ∂ÊòØÂΩìÊÇ®Âú®‰∫ë‰∏äËÆ≠ÁªÉÊ®°ÂûãÊó∂ - ÂÆÉ‰ΩøÁªÑÁªáÂèòÂæóÊõ¥Â•Ω„ÄÇ</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br></pre></td><td class="code"><pre><code class="hljs python"><span class="hljs-keyword">import</span> git<br><span class="hljs-keyword">import</span> re  <span class="hljs-comment"># Ê≠£ÂàôË°®ËææÂºè</span><br><br><br><span class="hljs-keyword">def</span> <span class="hljs-title function_">get_training_state</span>(<span class="hljs-params">training_config, model</span>):<br>    training_state = &#123;<br>        <span class="hljs-string">&quot;commit_hash&quot;</span>: git.Repo(search_parent_directories=<span class="hljs-literal">True</span>).head.<span class="hljs-built_in">object</span>.hexsha,<br><br>        <span class="hljs-comment"># ËÆ≠ÁªÉËØ¶ÁªÜ‰ø°ÊÅØ</span><br>        <span class="hljs-string">&quot;dataset_name&quot;</span>: training_config[<span class="hljs-string">&#x27;dataset_name&#x27;</span>],  <span class="hljs-comment"># Êï∞ÊçÆÈõÜÂêçÁß∞</span><br>        <span class="hljs-string">&quot;num_of_epochs&quot;</span>: training_config[<span class="hljs-string">&#x27;num_of_epochs&#x27;</span>],  <span class="hljs-comment"># ËÆ≠ÁªÉÁöÑ epochs Êï∞Èáè</span><br>        <span class="hljs-string">&quot;test_acc&quot;</span>: training_config[<span class="hljs-string">&#x27;test_acc&#x27;</span>],  <span class="hljs-comment"># ÊµãËØïÂáÜÁ°ÆÂ∫¶</span><br><br>        <span class="hljs-comment"># Ê®°ÂûãÁªìÊûÑ</span><br>        <span class="hljs-string">&quot;num_of_layers&quot;</span>: training_config[<span class="hljs-string">&#x27;num_of_layers&#x27;</span>],  <span class="hljs-comment"># Â±ÇÁöÑÊï∞Èáè</span><br>        <span class="hljs-string">&quot;num_heads_per_layer&quot;</span>: training_config[<span class="hljs-string">&#x27;num_heads_per_layer&#x27;</span>],  <span class="hljs-comment"># ÊØèÂ±ÇÁöÑÊ≥®ÊÑèÂäõÂ§¥Êï∞</span><br>        <span class="hljs-string">&quot;num_features_per_layer&quot;</span>: training_config[<span class="hljs-string">&#x27;num_features_per_layer&#x27;</span>],  <span class="hljs-comment"># ÊØèÂ±ÇÁöÑÁâπÂæÅÊï∞</span><br>        <span class="hljs-string">&quot;add_skip_connection&quot;</span>: training_config[<span class="hljs-string">&#x27;add_skip_connection&#x27;</span>],  <span class="hljs-comment"># ÊòØÂê¶Ê∑ªÂä†Ë∑≥Ë∑ÉËøûÊé•</span><br>        <span class="hljs-string">&quot;bias&quot;</span>: training_config[<span class="hljs-string">&#x27;bias&#x27;</span>],  <span class="hljs-comment"># ÊòØÂê¶‰ΩøÁî®ÂÅèÁΩÆ</span><br>        <span class="hljs-string">&quot;dropout&quot;</span>: training_config[<span class="hljs-string">&#x27;dropout&#x27;</span>],  <span class="hljs-comment"># ‰∏¢ÂºÉÁéá</span><br><br>        <span class="hljs-comment"># Ê®°ÂûãÁä∂ÊÄÅ</span><br>        <span class="hljs-string">&quot;state_dict&quot;</span>: model.state_dict()  <span class="hljs-comment"># Ê®°ÂûãÁöÑÁä∂ÊÄÅÂ≠óÂÖ∏</span><br>    &#125;<br><br>    <span class="hljs-keyword">return</span> training_state<br><br><br><span class="hljs-keyword">def</span> <span class="hljs-title function_">print_model_metadata</span>(<span class="hljs-params">training_state</span>):<br>    header = <span class="hljs-string">f&#x27;\n<span class="hljs-subst">&#123;<span class="hljs-string">&quot;*&quot;</span>*<span class="hljs-number">5</span>&#125;</span> Ê®°ÂûãËÆ≠ÁªÉÂÖÉÊï∞ÊçÆ: <span class="hljs-subst">&#123;<span class="hljs-string">&quot;*&quot;</span>*<span class="hljs-number">5</span>&#125;</span>&#x27;</span><br>    <span class="hljs-built_in">print</span>(header)<br><br>    <span class="hljs-keyword">for</span> key, value <span class="hljs-keyword">in</span> training_state.items():<br>        <span class="hljs-keyword">if</span> key != <span class="hljs-string">&#x27;state_dict&#x27;</span>:  <span class="hljs-comment"># ‰∏çÊâìÂç∞ state_dictÔºåÂõ†‰∏∫ÂÆÉÂè™ÊòØ‰∏ÄÂ†ÜÊï∞Â≠ó...</span><br>            <span class="hljs-built_in">print</span>(<span class="hljs-string">f&#x27;<span class="hljs-subst">&#123;key&#125;</span>: <span class="hljs-subst">&#123;value&#125;</span>&#x27;</span>)<br>    <span class="hljs-built_in">print</span>(<span class="hljs-string">f&#x27;<span class="hljs-subst">&#123;<span class="hljs-string">&quot;*&quot;</span> * <span class="hljs-built_in">len</span>(header)&#125;</span>\n&#x27;</span>)<br><br><br><span class="hljs-comment"># Á°Æ‰øùÊàë‰ª¨‰∏çË¶ÜÁõñÊúâ‰ª∑ÂÄºÁöÑÊ®°Âûã‰∫åËøõÂà∂Êñá‰ª∂ÔºàÂèØ‰ª•ÂøΩÁï• - ÂØπ GAT ÊñπÊ≥ï‰∏çÊòØÂÖ≥ÈîÆÁöÑÔºâ</span><br><span class="hljs-keyword">def</span> <span class="hljs-title function_">get_available_binary_name</span>():<br>    prefix = <span class="hljs-string">&#x27;gat&#x27;</span><br><br>    <span class="hljs-keyword">def</span> <span class="hljs-title function_">valid_binary_name</span>(<span class="hljs-params">binary_name</span>):<br>        <span class="hljs-comment"># Á¨¨‰∏ÄÊ¨°ÁúãÂà∞ÂéüÂßã f-Â≠óÁ¨¶‰∏≤Ôºü‰∏çÁî®ÊãÖÂøÉÔºåÂîØ‰∏ÄÁöÑÊäÄÂ∑ßÊòØË¶ÅÂä†ÂÄçÂ§ßÊã¨Âè∑„ÄÇ</span><br>        pattern = re.<span class="hljs-built_in">compile</span>(<span class="hljs-string">rf&#x27;<span class="hljs-subst">&#123;prefix&#125;</span>_[0-9]&#123;&#123;6&#125;&#125;\.pth&#x27;</span>)<br>        <span class="hljs-keyword">return</span> re.fullmatch(pattern, binary_name) <span class="hljs-keyword">is</span> <span class="hljs-keyword">not</span> <span class="hljs-literal">None</span><br><br>    <span class="hljs-comment"># Âè™ÈúÄÂàóÂá∫Áé∞ÊúâÁöÑ‰∫åËøõÂà∂Êñá‰ª∂Ôºå‰ª•‰æøÊàë‰ª¨‰∏ç‰ºöË¶ÜÁõñÂÆÉ‰ª¨ÔºåËÄåÊòØÂÜôÂÖ•Êñ∞ÁöÑ‰∫åËøõÂà∂Êñá‰ª∂</span><br>    valid_binary_names = <span class="hljs-built_in">list</span>(<span class="hljs-built_in">filter</span>(valid_binary_name, os.listdir(BINARIES_PATH)))<br>    <span class="hljs-keyword">if</span> <span class="hljs-built_in">len</span>(valid_binary_names) &gt; <span class="hljs-number">0</span>:<br>        last_binary_name = <span class="hljs-built_in">sorted</span>(valid_binary_names)[-<span class="hljs-number">1</span>]<br>        new_suffix = <span class="hljs-built_in">int</span>(last_binary_name.split(<span class="hljs-string">&#x27;.&#x27;</span>)[<span class="hljs-number">0</span>][-<span class="hljs-number">6</span>:]) + <span class="hljs-number">1</span>  <span class="hljs-comment"># ÈÄíÂ¢û 1</span><br>        <span class="hljs-keyword">return</span> <span class="hljs-string">f&#x27;<span class="hljs-subst">&#123;prefix&#125;</span>_<span class="hljs-subst">&#123;<span class="hljs-built_in">str</span>(new_suffix).zfill(<span class="hljs-number">6</span>)&#125;</span>.pth&#x27;</span><br>    <span class="hljs-keyword">else</span>:<br>        <span class="hljs-keyword">return</span> <span class="hljs-string">f&#x27;<span class="hljs-subst">&#123;prefix&#125;</span>_000000.pth&#x27;</span><br><br></code></pre></td></tr></table></figure>

<p>ÂæàÂ•ΩÔºåÁé∞Âú®ÊòØÁªÑÁªáÁ®ãÂ∫èËÆæÁΩÆÁöÑargparseÂ•ΩÊñπÊ≥ïÔºö</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br></pre></td><td class="code"><pre><code class="hljs python"><span class="hljs-keyword">import</span> argparse<br><br><span class="hljs-keyword">def</span> <span class="hljs-title function_">get_training_args</span>():<br>    parser = argparse.ArgumentParser()<br><br>    <span class="hljs-comment"># ‰∏éËÆ≠ÁªÉÁõ∏ÂÖ≥</span><br>    parser.add_argument(<span class="hljs-string">&quot;--num_of_epochs&quot;</span>, <span class="hljs-built_in">type</span>=<span class="hljs-built_in">int</span>, <span class="hljs-built_in">help</span>=<span class="hljs-string">&quot;ËÆ≠ÁªÉËΩÆÊï∞&quot;</span>, default=<span class="hljs-number">10000</span>)<br>    parser.add_argument(<span class="hljs-string">&quot;--patience_period&quot;</span>, <span class="hljs-built_in">type</span>=<span class="hljs-built_in">int</span>, <span class="hljs-built_in">help</span>=<span class="hljs-string">&quot;Âú®ÁªàÊ≠¢‰πãÂâçÂú®È™åËØÅÈõÜ‰∏äÊ≤°ÊúâÊîπËøõÁöÑËΩÆÊï∞&quot;</span>, default=<span class="hljs-number">1000</span>)<br>    parser.add_argument(<span class="hljs-string">&quot;--lr&quot;</span>, <span class="hljs-built_in">type</span>=<span class="hljs-built_in">float</span>, <span class="hljs-built_in">help</span>=<span class="hljs-string">&quot;Ê®°ÂûãÂ≠¶‰π†Áéá&quot;</span>, default=<span class="hljs-number">5e-3</span>)<br>    parser.add_argument(<span class="hljs-string">&quot;--weight_decay&quot;</span>, <span class="hljs-built_in">type</span>=<span class="hljs-built_in">float</span>, <span class="hljs-built_in">help</span>=<span class="hljs-string">&quot;Ê®°ÂûãÊùÉÈáçÁöÑL2Ê≠£ÂàôÂåñ&quot;</span>, default=<span class="hljs-number">5e-4</span>)<br>    parser.add_argument(<span class="hljs-string">&quot;--should_test&quot;</span>, <span class="hljs-built_in">type</span>=<span class="hljs-built_in">bool</span>, <span class="hljs-built_in">help</span>=<span class="hljs-string">&#x27;ÊòØÂê¶Âú®ÊµãËØïÈõÜ‰∏äÊµãËØïÊ®°ÂûãÔºü&#x27;</span>, default=<span class="hljs-literal">True</span>)<br><br>    <span class="hljs-comment"># Êï∞ÊçÆÈõÜÁõ∏ÂÖ≥</span><br>    parser.add_argument(<span class="hljs-string">&quot;--dataset_name&quot;</span>, choices=[el.name <span class="hljs-keyword">for</span> el <span class="hljs-keyword">in</span> DatasetType], <span class="hljs-built_in">help</span>=<span class="hljs-string">&#x27;Áî®‰∫éËÆ≠ÁªÉÁöÑÊï∞ÊçÆÈõÜ&#x27;</span>, default=DatasetType.CORA.name)<br>    parser.add_argument(<span class="hljs-string">&quot;--should_visualize&quot;</span>, <span class="hljs-built_in">type</span>=<span class="hljs-built_in">bool</span>, <span class="hljs-built_in">help</span>=<span class="hljs-string">&#x27;ÊòØÂê¶ÂèØËßÜÂåñÊï∞ÊçÆÈõÜÔºü&#x27;</span>, default=<span class="hljs-literal">False</span>)<br><br>    <span class="hljs-comment"># Êó•Âøó/Ë∞ÉËØï/Ê£ÄÊü•ÁÇπÁõ∏ÂÖ≥ÔºàÂØπÂÆûÈ™åÈùûÂ∏∏ÊúâÂ∏ÆÂä©Ôºâ</span><br>    parser.add_argument(<span class="hljs-string">&quot;--enable_tensorboard&quot;</span>, <span class="hljs-built_in">type</span>=<span class="hljs-built_in">bool</span>, <span class="hljs-built_in">help</span>=<span class="hljs-string">&quot;ÂêØÁî®TensorBoardÊó•Âøó&quot;</span>, default=<span class="hljs-literal">False</span>)<br>    parser.add_argument(<span class="hljs-string">&quot;--console_log_freq&quot;</span>, <span class="hljs-built_in">type</span>=<span class="hljs-built_in">int</span>, <span class="hljs-built_in">help</span>=<span class="hljs-string">&quot;ËæìÂá∫Âà∞ÊéßÂà∂Âè∞ÁöÑÊó•ÂøóÔºàÊØèËΩÆÔºâÈ¢ëÁéáÔºàÊó†Êó•ÂøóÂàô‰∏∫NoneÔºâ&quot;</span>, default=<span class="hljs-number">100</span>)<br>    parser.add_argument(<span class="hljs-string">&quot;--checkpoint_freq&quot;</span>, <span class="hljs-built_in">type</span>=<span class="hljs-built_in">int</span>, <span class="hljs-built_in">help</span>=<span class="hljs-string">&quot;Ê£ÄÊü•ÁÇπÊ®°Âûã‰øùÂ≠òÔºàÊØèËΩÆÔºâÈ¢ëÁéáÔºàÊó†Êó•ÂøóÂàô‰∏∫NoneÔºâ&quot;</span>, default=<span class="hljs-number">1000</span>)<br>    args = parser.parse_args(<span class="hljs-string">&quot;&quot;</span>)<br><br>    <span class="hljs-comment"># Ê®°ÂûãÊû∂ÊûÑÁõ∏ÂÖ≥ - ËøôÊòØÂú®ÂÆòÊñπËÆ∫Êñá‰∏≠ÂÆö‰πâÁöÑÁî®‰∫éCoraÂàÜÁ±ªÁöÑÊû∂ÊûÑ</span><br>    gat_config = &#123;<br>        <span class="hljs-string">&quot;num_of_layers&quot;</span>: <span class="hljs-number">2</span>,  <span class="hljs-comment"># GNNs‰∏éCNNsÁõ∏ÂèçÔºåÈÄöÂ∏∏ÊòØÊµÖÂ±ÇÁöÑÔºàÊúÄÁªàÂèñÂÜ≥‰∫éÂõæÁöÑÂ±ûÊÄßÔºâ</span><br>        <span class="hljs-string">&quot;num_heads_per_layer&quot;</span>: [<span class="hljs-number">8</span>, <span class="hljs-number">1</span>],<br>        <span class="hljs-string">&quot;num_features_per_layer&quot;</span>: [CORA_NUM_INPUT_FEATURES, <span class="hljs-number">8</span>, CORA_NUM_CLASSES],<br>        <span class="hljs-string">&quot;add_skip_connection&quot;</span>: <span class="hljs-literal">False</span>,  <span class="hljs-comment"># Âú®Cora‰∏äÂΩ±ÂìçÊÄßËÉΩ</span><br>        <span class="hljs-string">&quot;bias&quot;</span>: <span class="hljs-literal">True</span>,  <span class="hljs-comment"># ÁªìÊûúÂØπÂÅèÁΩÆ‰∏çÂ§™ÊïèÊÑü</span><br>        <span class="hljs-string">&quot;dropout&quot;</span>: <span class="hljs-number">0.6</span>,  <span class="hljs-comment"># ÂØπ‰∏¢Â§±ÁÅµÊïè</span><br>    &#125;<br><br>    <span class="hljs-comment"># Â∞ÜËÆ≠ÁªÉÈÖçÁΩÆÂ∞ÅË£ÖÂà∞Â≠óÂÖ∏‰∏≠</span><br>    training_config = <span class="hljs-built_in">dict</span>()<br>    <span class="hljs-keyword">for</span> arg <span class="hljs-keyword">in</span> <span class="hljs-built_in">vars</span>(args):<br>        training_config[arg] = <span class="hljs-built_in">getattr</span>(args, arg)<br><br>    <span class="hljs-comment"># Ê∑ªÂä†ÈôÑÂä†ÁöÑÈÖçÁΩÆ‰ø°ÊÅØ</span><br>    training_config.update(gat_config)<br><br>    <span class="hljs-keyword">return</span> training_config<br><br></code></pre></td></tr></table></figure>

<p>Âú®ËøôÈáåÔºåÊàë‰ª¨ÁªÑÁªá‰∫ÜÈ´òÁ∫ßÂà´ÁöÑ GAT ËÆ≠ÁªÉÊâÄÈúÄÁöÑ‰∏ÄÂàá„ÄÇÂè™ÈúÄÁªìÂêàÊàë‰ª¨Â∑≤ÁªèÂ≠¶ËøáÁöÑÈÉ®ÂàÜÂç≥ÂèØ„ÄÇ</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br></pre></td><td class="code"><pre><code class="hljs python"><span class="hljs-keyword">import</span> time<br><br><span class="hljs-keyword">def</span> <span class="hljs-title function_">train_gat</span>(<span class="hljs-params">config</span>):<br>    <span class="hljs-keyword">global</span> BEST_VAL_ACC, BEST_VAL_LOSS<br><br>    device = torch.device(<span class="hljs-string">&quot;cuda&quot;</span> <span class="hljs-keyword">if</span> torch.cuda.is_available() <span class="hljs-keyword">else</span> <span class="hljs-string">&quot;cpu&quot;</span>)  <span class="hljs-comment"># Ê£ÄÊü•ÊòØÂê¶ÊúâGPUÔºåÂ∏åÊúõÊúâÔºÅ</span><br><br>    <span class="hljs-comment"># Ê≠•È™§1ÔºöÂä†ËΩΩÂõæÊï∞ÊçÆ</span><br>    node_features, node_labels, edge_index, train_indices, val_indices, test_indices = load_graph_data(config, device)<br><br>    <span class="hljs-comment"># Ê≠•È™§2ÔºöÂáÜÂ§áÊ®°Âûã</span><br>    gat = GAT(<br>        num_of_layers=config[<span class="hljs-string">&#x27;num_of_layers&#x27;</span>],<br>        num_heads_per_layer=config[<span class="hljs-string">&#x27;num_heads_per_layer&#x27;</span>],<br>        num_features_per_layer=config[<span class="hljs-string">&#x27;num_features_per_layer&#x27;</span>],<br>        add_skip_connection=config[<span class="hljs-string">&#x27;add_skip_connection&#x27;</span>],<br>        bias=config[<span class="hljs-string">&#x27;bias&#x27;</span>],<br>        dropout=config[<span class="hljs-string">&#x27;dropout&#x27;</span>],<br>        log_attention_weights=<span class="hljs-literal">False</span>  <span class="hljs-comment"># ‰∏çÈúÄË¶ÅÂ≠òÂÇ®Ê≥®ÊÑèÂäõÔºå‰ªÖÂú® playground.py ‰∏≠Áî®‰∫éÂèØËßÜÂåñ</span><br>    ).to(device)<br><br>    <span class="hljs-comment"># Ê≠•È™§3ÔºöÂáÜÂ§áÂÖ∂‰ªñ‰∏éËÆ≠ÁªÉÁõ∏ÂÖ≥ÁöÑÂ∑•ÂÖ∑ÔºàÊçüÂ§±Âíå‰ºòÂåñÂô®‰ª•ÂèäË£ÖÈ•∞ÂáΩÊï∞Ôºâ</span><br>    loss_fn = nn.CrossEntropyLoss(reduction=<span class="hljs-string">&#x27;mean&#x27;</span>)<br>    optimizer = Adam(gat.parameters(), lr=config[<span class="hljs-string">&#x27;lr&#x27;</span>], weight_decay=config[<span class="hljs-string">&#x27;weight_decay&#x27;</span>])<br><br>    <span class="hljs-comment"># ËøôÊòØËÆ≠ÁªÉÁöÑÊ†∏ÂøÉÈÉ®ÂàÜÔºàÊàë‰ª¨Á®çÂêé‰ºöÂÆö‰πâÂÆÉÔºâ</span><br>    <span class="hljs-comment"># Ë£ÖÈ•∞ÂáΩÊï∞‰ΩøÂæó‰ª£Á†ÅÊõ¥Êï¥Ê¥ÅÔºåÂõ†‰∏∫Âú®ËÆ≠ÁªÉÂíåÈ™åËØÅÂæ™ÁéØ‰πãÈó¥ÊúâÂæàÂ§öÂÜó‰Ωô</span><br>    main_loop = get_main_loop(<br>        config,<br>        gat,<br>        loss_fn,<br>        optimizer,<br>        node_features,<br>        node_labels,<br>        edge_index,<br>        train_indices,<br>        val_indices,<br>        test_indices,<br>        config[<span class="hljs-string">&#x27;patience_period&#x27;</span>],<br>        time.time())<br><br>    BEST_VAL_ACC, BEST_VAL_LOSS, PATIENCE_CNT = [<span class="hljs-number">0</span>, <span class="hljs-number">0</span>, <span class="hljs-number">0</span>]  <span class="hljs-comment"># ÈáçÁΩÆÁî®‰∫éÊèêÂâçÂÅúÊ≠¢ÁöÑÂèòÈáè</span><br><br>    <span class="hljs-comment"># Ê≠•È™§4ÔºöÂºÄÂßãËÆ≠ÁªÉËøáÁ®ã</span><br>    <span class="hljs-keyword">for</span> epoch <span class="hljs-keyword">in</span> <span class="hljs-built_in">range</span>(config[<span class="hljs-string">&#x27;num_of_epochs&#x27;</span>]):<br>        <span class="hljs-comment"># ËÆ≠ÁªÉÂæ™ÁéØ</span><br>        main_loop(phase=LoopPhase.TRAIN, epoch=epoch)<br><br>        <span class="hljs-comment"># È™åËØÅÂæ™ÁéØ</span><br>        <span class="hljs-keyword">with</span> torch.no_grad():<br>            <span class="hljs-keyword">try</span>:<br>                main_loop(phase=LoopPhase.VAL, epoch=epoch)<br>            <span class="hljs-keyword">except</span> Exception <span class="hljs-keyword">as</span> e:  <span class="hljs-comment"># &quot;ÂøçËÄêÂ∑≤ÁªèÁî®ÂÆå&quot; ÁöÑÂºÇÂ∏∏ :O</span><br>                <span class="hljs-built_in">print</span>(<span class="hljs-built_in">str</span>(e))<br>                <span class="hljs-keyword">break</span>  <span class="hljs-comment"># ÈÄÄÂá∫ËÆ≠ÁªÉÂæ™ÁéØ</span><br><br>    <span class="hljs-comment"># Ê≠•È™§5ÔºöÂèØËÉΩÊµãËØïÊÇ®ÁöÑÊ®°Âûã</span><br>    <span class="hljs-comment"># ‰∏çË¶ÅËøáÂ∫¶ÊãüÂêàÊµãËØïÊï∞ÊçÆÈõÜ - ‰ªÖÂΩìÊÇ®Âú®È™åËØÅÊï∞ÊçÆÈõÜ‰∏äÂæÆË∞É‰∫ÜÊ®°ÂûãÊó∂ÔºåÊâçÂ∫îËØ•Êä•ÂëäÊµãËØïÊï∞ÊçÆÈõÜ‰∏äÁöÑÊúÄÁªàÊçüÂ§±ÂíåÂáÜÁ°ÆÊÄß„ÄÇ</span><br>    <span class="hljs-keyword">if</span> config[<span class="hljs-string">&#x27;should_test&#x27;</span>]:<br>        test_acc = main_loop(phase=LoopPhase.TEST)<br>        config[<span class="hljs-string">&#x27;test_acc&#x27;</span>] = test_acc<br>        <span class="hljs-built_in">print</span>(<span class="hljs-string">f&#x27;Test accuracy = <span class="hljs-subst">&#123;test_acc&#125;</span>&#x27;</span>)<br>    <span class="hljs-keyword">else</span>:<br>        config[<span class="hljs-string">&#x27;test_acc&#x27;</span>] = -<span class="hljs-number">1</span><br><br>    <span class="hljs-comment"># Â∞ÜÊúÄÊñ∞ÁöÑGAT‰øùÂ≠òÂú®‰∫åËøõÂà∂ÁõÆÂΩï‰∏≠</span><br>    torch.save(get_training_state(config, gat), os.path.join(BINARIES_PATH, get_available_binary_name()))<br><br></code></pre></td></tr></table></figure>

<p>üéâüéâüéâ</p>
<p>Áé∞Âú®ÊòØËÆ≠ÁªÉÁöÑÊ†∏ÂøÉÈÉ®ÂàÜ - ‰∏ªÂæ™ÁéØÔºåÊ≠£Â¶ÇÊàëÊâÄËØ¥ÁöÑÈÇ£Ê†∑„ÄÇ</p>
<p>ÊàëËøôÊ†∑ÁªÑÁªáÂÆÉÔºåËøôÊ†∑ÊàëÂ∞±‰∏çÂøÖ‰∏∫ËÆ≠ÁªÉ&#x2F;È™åËØÅ&#x2F;ÊµãËØïÂæ™ÁéØÂ§çÂà∂&#x2F;Á≤òË¥¥‰∏ÄÂ†ÜÁõ∏ÂêåÁöÑ‰ª£Á†Å„ÄÇ</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br></pre></td><td class="code"><pre><code class="hljs python"><span class="hljs-comment"># ÁÆÄÂçïÁöÑË£ÖÈ•∞ÂáΩÊï∞ÔºåËøôÊ†∑ÊàëÂ∞±‰∏çÂøÖ‰º†ÈÄí‰ªé‰∏Ä‰∏™Êó∂ÊúüÂà∞Âè¶‰∏Ä‰∏™Êó∂ÊúüÈÉΩ‰∏çÂèòÁöÑÂèÇÊï∞</span><br><span class="hljs-keyword">def</span> <span class="hljs-title function_">get_main_loop</span>(<span class="hljs-params">config, gat, cross_entropy_loss, optimizer, node_features, node_labels, edge_index, train_indices, val_indices, test_indices, patience_period, time_start</span>):<br><br>    node_dim = <span class="hljs-number">0</span>  <span class="hljs-comment"># ËøôÂèØËÉΩ‰ºöÂú®ÊàëÊ∑ªÂä†ÂΩíÁ∫≥Á§∫‰æãÔºàCoraÊòØÂΩíÁ∫≥ÁöÑÔºâÊó∂ÂèëÁîüÂèòÂåñ</span><br><br>    train_labels = node_labels.index_select(node_dim, train_indices)<br>    val_labels = node_labels.index_select(node_dim, val_indices)<br>    test_labels = node_labels.index_select(node_dim, test_indices)<br><br>    <span class="hljs-comment"># node_features ÂΩ¢Áä∂ = (N, FIN)Ôºåedge_index ÂΩ¢Áä∂ = (2, E)</span><br>    graph_data = (node_features, edge_index)  <span class="hljs-comment"># ÊàëÂ∞ÜÊï∞ÊçÆÊâìÂåÖÂà∞ÂÖÉÁªÑ‰∏≠ÔºåÂõ†‰∏∫GAT‰ΩøÁî®nn.SequentialÔºåÂÆÉË¶ÅÊ±ÇËøôÊ†∑ÂÅö</span><br><br>    <span class="hljs-keyword">def</span> <span class="hljs-title function_">get_node_indices</span>(<span class="hljs-params">phase</span>):<br>        <span class="hljs-keyword">if</span> phase == LoopPhase.TRAIN:<br>            <span class="hljs-keyword">return</span> train_indices<br>        <span class="hljs-keyword">elif</span> phase == LoopPhase.VAL:<br>            <span class="hljs-keyword">return</span> val_indices<br>        <span class="hljs-keyword">else</span>:<br>            <span class="hljs-keyword">return</span> test_indices<br><br>    <span class="hljs-keyword">def</span> <span class="hljs-title function_">get_node_labels</span>(<span class="hljs-params">phase</span>):<br>        <span class="hljs-keyword">if</span> phase == LoopPhase.TRAIN:<br>            <span class="hljs-keyword">return</span> train_labels<br>        <span class="hljs-keyword">elif</span> phase == LoopPhase.VAL:<br>            <span class="hljs-keyword">return</span> val_labels<br>        <span class="hljs-keyword">else</span>:<br>            <span class="hljs-keyword">return</span> test_labels<br><br>    <span class="hljs-keyword">def</span> <span class="hljs-title function_">main_loop</span>(<span class="hljs-params">phase, epoch=<span class="hljs-number">0</span></span>):<br>        <span class="hljs-keyword">global</span> BEST_VAL_ACC, BEST_VAL_LOSS, PATIENCE_CNT, writer<br><br>        <span class="hljs-comment"># Êüê‰∫õÊ®°ÂùóÁöÑË°å‰∏∫ÂèñÂÜ≥‰∫éÊàë‰ª¨ÊòØÂê¶Ê≠£Âú®ËÆ≠ÁªÉÊ®°Âûã„ÄÇ</span><br>        <span class="hljs-comment"># ‰æãÂ¶Ç nn.Dropout - Êàë‰ª¨Âè™ÊÉ≥Âú®ËÆ≠ÁªÉÊúüÈó¥‰∏¢ÂºÉÊ®°ÂûãÊùÉÈáç„ÄÇ</span><br>        <span class="hljs-keyword">if</span> phase == LoopPhase.TRAIN:<br>            gat.train()<br>        <span class="hljs-keyword">else</span>:<br>            gat.<span class="hljs-built_in">eval</span>()<br><br>        node_indices = get_node_indices(phase)<br>        gt_node_labels = get_node_labels(phase)  <span class="hljs-comment"># gt ‰ª£Ë°® ground truthÔºàÂÆûÈôÖÊ†áÁ≠æÔºâ</span><br><br>        <span class="hljs-comment"># ËøõË°åÂâçÂêë‰º†Êí≠Âπ∂‰ªÖÊèêÂèñÁõ∏ÂÖ≥ËäÇÁÇπÂæóÂàÜÔºàtrain/valÊàñtestÔºâ</span><br>        <span class="hljs-comment"># Ê≥®ÊÑèÔºö[0] Âè™ÊòØÊèêÂèñÊï∞ÊçÆÁöÑ node_features ÈÉ®ÂàÜÔºàÁ¥¢Âºï 1 ÂåÖÂê´ edge_indexÔºâ</span><br>        <span class="hljs-comment"># ÂΩ¢Áä∂ = (N, C)ÔºåÂÖ∂‰∏≠ N ÊòØÂàÜÂâ≤‰∏≠ËäÇÁÇπÁöÑÊï∞ÈáèÔºàtrain/val/testÔºâÔºåC ÊòØÁ±ªÁöÑÊï∞Èáè</span><br>        nodes_unnormalized_scores = gat(graph_data)[<span class="hljs-number">0</span>].index_select(node_dim, node_indices)<br><br>        <span class="hljs-comment"># ‰æãÂ¶ÇÔºöËÆ©Êàë‰ª¨Âèñ Cora ‰∏äÂçï‰∏™ËäÇÁÇπÁöÑËæìÂá∫ - ÂÆÉÊòØ‰∏Ä‰∏™Â§ßÂ∞è‰∏∫ 7 ÁöÑÂêëÈáèÔºåÂåÖÂê´Êú™ËßÑËåÉÂåñÁöÑÂàÜÊï∞ÔºåÂ¶Ç‰∏ãÊâÄÁ§∫Ôºö</span><br>        <span class="hljs-comment"># V = [-1.393,  3.0765, -2.4445,  9.6219,  2.1658, -5.5243, -4.6247]</span><br>        <span class="hljs-comment"># PyTorchÁöÑ‰∫§ÂèâÁÜµÊçüÂ§±ÊâÄÂÅöÁöÑÊòØÔºåÂØπ‰∫éÊØè‰∏™ËøôÊ†∑ÁöÑÂêëÈáèÔºåÈ¶ñÂÖàÂ∫îÁî® softmaxÔºåÊâÄ‰ª•Êàë‰ª¨Â∞Ü V ËΩ¨Êç¢‰∏∫Ôºö</span><br>        <span class="hljs-comment"># [1.6421e-05, 1.4338e-03, 5.7378e-06, 0.99797, 5.7673e-04, 2.6376e-07, 6.4848e-07]</span><br>        <span class="hljs-comment"># ÂÖ∂Ê¨°ÔºåÊó†ËÆ∫Ê≠£Á°ÆÁ±ªÂà´ÊòØ‰ªÄ‰πàÔºàÂÅáËÆæÊòØ 3ÔºâÔºåÂÆÉÈÉΩÂ∞ÜÂú®‰ΩçÁΩÆ 3 Â§ÑÂèñÂÖÉÁ¥†Ôºå0.99797 Âú®ËøôÁßçÊÉÖÂÜµ‰∏ãÔºå</span><br>        <span class="hljs-comment"># ÊçüÂ§±Â∞Ü‰∏∫ -log(0.99797)„ÄÇÂØπ‰∫éÊØè‰∏™ËäÇÁÇπÔºåÂÆÉÈÉΩ‰ºöËøôÊ†∑ÂÅöÂπ∂Â∫îÁî®ÂùáÂÄº„ÄÇ</span><br>        <span class="hljs-comment"># ÂèØ‰ª•ÁúãÂà∞ÔºåÈöèÁùÄÂ§ßÂ§öÊï∞ËäÇÁÇπÁöÑÊ≠£Á°ÆÁ±ªÂà´ÁöÑÊ¶ÇÁéáÊé•Ëøë 1ÔºåÊçüÂ§±Ë∂ãËøë‰∫é 0ÔºÅ &lt;3</span><br>        loss = cross_entropy_loss(nodes_unnormalized_scores, gt_node_labels)<br><br>        <span class="hljs-keyword">if</span> phase == LoopPhase.TRAIN:<br>            optimizer.zero_grad()  <span class="hljs-comment"># Ê∏ÖÁêÜËÆ°ÁÆóÂõæ‰∏≠ÂèØËÆ≠ÁªÉÊùÉÈáçÁöÑÊ¢ØÂ∫¶Ôºà.grad Â≠óÊÆµÔºâ</span><br>            loss.backward()  <span class="hljs-comment"># ‰∏∫ËÆ°ÁÆóÂõæ‰∏≠ÁöÑÊØè‰∏™ÂèØËÆ≠ÁªÉÊùÉÈáçËÆ°ÁÆóÊ¢ØÂ∫¶</span><br>            optimizer.step()  <span class="hljs-comment"># Â∞ÜÊ¢ØÂ∫¶Â∫îÁî®Âà∞ÊùÉÈáç‰∏ä</span><br><br>        <span class="hljs-comment"># ÊâæÂà∞ÊØè‰∏™ËäÇÁÇπÊúÄÂ§ßÔºàÊú™ËßÑËåÉÂåñÔºâÂæóÂàÜÁöÑÁ¥¢ÂºïÔºåËøôÊòØËØ•ËäÇÁÇπÁöÑÁ±ªÂà´È¢ÑÊµã„ÄÇ</span><br>        <span class="hljs-comment"># Â∞ÜËøô‰∫õ‰∏éÁúüÂÆûÔºàÂÆûÈôÖÊ†áÁ≠æÔºâÊ†áÁ≠æËøõË°åÊØîËæÉÔºåÂπ∂ÊâæÂà∞Ê≠£Á°ÆÈ¢ÑÊµãÁöÑÊØî‰æã -&gt; ÂáÜÁ°ÆÊÄßÊåáÊ†á„ÄÇ</span><br>        class_predictions = torch.argmax(nodes_unnormalized_scores, dim=-<span class="hljs-number">1</span>)<br>        accuracy = torch.<span class="hljs-built_in">sum</span>(torch.eq(class_predictions, gt_node_labels).long()).item() / <span class="hljs-built_in">len</span>(gt_node_labels)<br><br>        <span class="hljs-keyword">if</span> phase == LoopPhase.TRAIN:<br>            <span class="hljs-comment"># ËÆ∞ÂΩïÊåáÊ†á</span><br>            <span class="hljs-keyword">if</span> config[<span class="hljs-string">&#x27;enable_tensorboard&#x27;</span>]:<br>                writer.add_scalar(<span class="hljs-string">&#x27;training_loss&#x27;</span>, loss.item(), epoch)<br>                writer.add_scalar(<span class="hljs-string">&#x27;training_acc&#x27;</span>, accuracy, epoch)<br><br>            <span class="hljs-comment"># ‰øùÂ≠òÊ®°ÂûãÊ£ÄÊü•ÁÇπ</span><br>            <span class="hljs-keyword">if</span> config[<span class="hljs-string">&#x27;checkpoint_freq&#x27;</span>] <span class="hljs-keyword">is</span> <span class="hljs-keyword">not</span> <span class="hljs-literal">None</span> <span class="hljs-keyword">and</span> (epoch + <span class="hljs-number">1</span>) % config[<span class="hljs-string">&#x27;checkpoint_freq&#x27;</span>] == <span class="hljs-number">0</span>:<br>                ckpt_model_name = <span class="hljs-string">f&quot;gat_ckpt_epoch_<span class="hljs-subst">&#123;epoch + <span class="hljs-number">1</span>&#125;</span>.pth&quot;</span><br>                config[<span class="hljs-string">&#x27;test_acc&#x27;</span>] = -<span class="hljs-number">1</span><br>                torch.save(get_training_state(config, gat), os.path.join(CHECKPOINTS_PATH, ckpt_model_name))<br><br>        <span class="hljs-keyword">elif</span> phase == LoopPhase.VAL:<br>            <span class="hljs-comment"># ËÆ∞ÂΩïÊåáÊ†á</span><br>            <span class="hljs-keyword">if</span> config[<span class="hljs-string">&#x27;enable_tensorboard&#x27;</span>]:<br>                writer.add_scalar(<span class="hljs-string">&#x27;val_loss&#x27;</span>, loss.item(), epoch)<br>                writer.add_scalar(<span class="hljs-string">&#x27;val_acc&#x27;</span>, accuracy, epoch)<br><br>            <span class="hljs-comment"># ËÆ∞ÂΩïÂà∞ÊéßÂà∂Âè∞</span><br>            <span class="hljs-keyword">if</span> config[<span class="hljs-string">&#x27;console_log_freq&#x27;</span>] <span class="hljs-keyword">is</span> <span class="hljs-keyword">not</span> <span class="hljs-literal">None</span> <span class="hljs-keyword">and</span> epoch % config[<span class="hljs-string">&#x27;console_log_freq&#x27;</span>] == <span class="hljs-number">0</span>:<br>                <span class="hljs-built_in">print</span>(<span class="hljs-string">f&#x27;GAT training: time elapsed= <span class="hljs-subst">&#123;(time.time() - time_start):<span class="hljs-number">.2</span>f&#125;</span> [s] | epoch=<span class="hljs-subst">&#123;epoch + <span class="hljs-number">1</span>&#125;</span> | val acc=<span class="hljs-subst">&#123;accuracy&#125;</span>&#x27;</span>)<br><br>            <span class="hljs-comment"># ‚ÄúËÄêÂøÉ‚ÄùÈÄªËæë - Êàë‰ª¨ÊòØÂê¶Â∫îËØ•‰ªéËÆ≠ÁªÉÂæ™ÁéØ‰∏≠ÈÄÄÂá∫ÔºüÂ¶ÇÊûúÈ™åËØÅÂáÜÁ°ÆÊÄß‰∏çÊñ≠ÊèêÈ´ò</span><br>            <span class="hljs-comment"># ÊàñÈ™åËØÅÊçüÂ§±‰∏çÊñ≠‰∏ãÈôçÔºåÊàë‰ª¨Â∞±‰∏ç‰ºöÂÅúÊ≠¢</span><br>            <span class="hljs-keyword">if</span> accuracy &gt; BEST_VAL_ACC <span class="hljs-keyword">or</span> loss.item() &lt; BEST_VAL_LOSS:<br>                BEST_VAL_ACC = <span class="hljs-built_in">max</span>(accuracy, BEST_VAL_ACC)  <span class="hljs-comment"># Ë∑üË∏™Âà∞ÁõÆÂâç‰∏∫Ê≠¢ÁöÑÊúÄ‰Ω≥È™åËØÅÂáÜÁ°ÆÊÄß</span><br>                BEST_VAL_LOSS = <span class="hljs-built_in">min</span>(loss.item(), BEST_VAL_LOSS)<br>                PATIENCE_CNT = <span class="hljs-number">0</span>  <span class="hljs-comment"># ÊØèÊ¨°ÈÅáÂà∞Êñ∞ÁöÑÊúÄ‰Ω≥ÂáÜÁ°ÆÊÄßÊó∂ÈáçÁΩÆËÆ°Êï∞Âô®</span><br>            <span class="hljs-keyword">else</span>:<br>                PATIENCE_CNT += <span class="hljs-number">1</span>  <span class="hljs-comment"># Âê¶ÂàôÁªßÁª≠ËÆ°Êï∞</span><br><br>            <span class="hljs-keyword">if</span> PATIENCE_CNT &gt;= patience_period:<br>                <span class="hljs-keyword">raise</span> Exception(<span class="hljs-string">&#x27;ÂÅúÊ≠¢ËÆ≠ÁªÉÔºåÂÆáÂÆôÂØπËøôÊ¨°ËÆ≠ÁªÉÊ≤°ÊúâÊõ¥Â§öÁöÑËÄêÂøÉ‰∫Ü„ÄÇ&#x27;</span>)<br><br>        <span class="hljs-keyword">else</span>:<br>            <span class="hljs-keyword">return</span> accuracy  <span class="hljs-comment"># Âú®ÊµãËØïÈò∂ÊÆµÔºåÊàë‰ª¨Âè™ËøîÂõûÊµãËØïÂáÜÁ°ÆÊÄß</span><br><br>    <span class="hljs-keyword">return</span> main_loop  <span class="hljs-comment"># ËøîÂõûË£ÖÈ•∞ÂáΩÊï∞</span><br><br></code></pre></td></tr></table></figure>

<p>ÂºÄÂßãËÆ≠ÁªÉÂêß</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><code class="hljs python"><span class="hljs-comment"># Train the graph attention network (GAT)</span><br>train_gat(get_training_args())<br></code></pre></td></tr></table></figure>

<pre><code class="hljs">/var/folders/f0/812mfv7x63vbytjs3yf4gxtc0000gn/T/ipykernel_16269/2448994618.py:6: DeprecationWarning: Please use `csr_matrix` from the `scipy.sparse` namespace, the `scipy.sparse.csr` namespace is deprecated.
  data = pickle.load(file)


GAT training: time elapsed= 0.22 [s] | epoch=1 | val acc=0.124
GAT training: time elapsed= 5.56 [s] | epoch=101 | val acc=0.79
GAT training: time elapsed= 10.72 [s] | epoch=201 | val acc=0.8
GAT training: time elapsed= 15.92 [s] | epoch=301 | val acc=0.8
GAT training: time elapsed= 21.13 [s] | epoch=401 | val acc=0.782
GAT training: time elapsed= 26.34 [s] | epoch=501 | val acc=0.784
GAT training: time elapsed= 31.68 [s] | epoch=601 | val acc=0.816
GAT training: time elapsed= 36.79 [s] | epoch=701 | val acc=0.804
GAT training: time elapsed= 41.91 [s] | epoch=801 | val acc=0.806
GAT training: time elapsed= 47.01 [s] | epoch=901 | val acc=0.814
GAT training: time elapsed= 52.20 [s] | epoch=1001 | val acc=0.81
GAT training: time elapsed= 57.41 [s] | epoch=1101 | val acc=0.798
GAT training: time elapsed= 62.52 [s] | epoch=1201 | val acc=0.816
GAT training: time elapsed= 67.61 [s] | epoch=1301 | val acc=0.796
GAT training: time elapsed= 72.71 [s] | epoch=1401 | val acc=0.79
GAT training: time elapsed= 77.82 [s] | epoch=1501 | val acc=0.812
GAT training: time elapsed= 82.94 [s] | epoch=1601 | val acc=0.796
GAT training: time elapsed= 88.08 [s] | epoch=1701 | val acc=0.798
GAT training: time elapsed= 93.26 [s] | epoch=1801 | val acc=0.794
GAT training: time elapsed= 98.39 [s] | epoch=1901 | val acc=0.8
GAT training: time elapsed= 103.64 [s] | epoch=2001 | val acc=0.806
ÂÅúÊ≠¢ËÆ≠ÁªÉÔºåÂÆáÂÆôÂØπËøôÊ¨°ËÆ≠ÁªÉÊ≤°ÊúâÊõ¥Â§öÁöÑËÄêÂøÉ‰∫Ü„ÄÇ
Test accuracy = 0.817
</code></pre>
<p>Â•ΩÁöÑÔºÅÔºÅÔºÅüéâüéâüéâ 4 Á∫ßËß£ÈîÅÔºàGAT ÂèØËßÜÂåñüîÆÔºâ„ÄÇ</p>
<p>Êàë‰ª¨ÂàöÂàö82.9 %Âú® Cora ÁöÑÊµãËØïËäÇÁÇπ‰∏äÂÆûÁé∞‰∫ÜÔºÅ‰∏éÂéüÂßã GAT ËÆ∫Êñá‰∏≠Êä•ÂëäÁöÑÊï∞Â≠óÁõ∏ÂêåÔºÅ</p>
<p>Áé∞Âú®Êàë‰ª¨Â∑≤Áªè‰∏ÄÂàáÂ∞±Áª™Ôºö</p>
<ol>
<li>Êï∞ÊçÆÂä†ËΩΩÂíåÂèØËßÜÂåñüìú -&gt; Á°ÆËÆ§</li>
<li>GAT Ê®°ÂûãÂÆö‰πâ ü¶Ñ -&gt; Á°ÆËÆ§</li>
<li>ËÆ≠ÁªÉÂæ™ÁéØËÆæÁΩÆÂíåËÆ≠ÁªÉÂêéÁöÑÊ®°Âûã‰∫åËøõÂà∂Êñá‰ª∂ üí™ -&gt; Á°ÆËÆ§</li>
</ol>
<p>Áé∞Âú®ËÆ©Êàë‰ª¨Âú®ÊòæÂæÆÈïúüî¨‰∏ãËßÇÂØü GAT Ê®°ÂûãÂπ∂‰∫ÜËß£Êàë‰ª¨ÂæóÂà∞ÁöÑÊùÉÈáç - Êàë‰ª¨ÂèØ‰ª•ÈÄöËøáÂ§öÁßçÊñπÂºèÂÅöÂà∞ËøôÁÇπ„ÄÇ</p>
<h1 id="Á¨¨-4-ÈÉ®ÂàÜÔºöÂèØËßÜÂåñ-GAT-üîÆ"><a href="#Á¨¨-4-ÈÉ®ÂàÜÔºöÂèØËßÜÂåñ-GAT-üîÆ" class="headerlink" title="Á¨¨ 4 ÈÉ®ÂàÜÔºöÂèØËßÜÂåñ GAT üîÆ"></a>Á¨¨ 4 ÈÉ®ÂàÜÔºöÂèØËßÜÂåñ GAT üîÆ</h1><p>ËÆ©Êàë‰ª¨È¶ñÂÖàÂÆö‰πâ‰∏Ä‰∫õÊàë‰ª¨ÈúÄË¶ÅÁöÑÂáΩÊï∞„ÄÇ</p>
<p>‰ª•‰∏ãÂçïÂÖÉÊ†ºÁöÑ‰ª£Á†ÅÁâáÊÆµÂ∞ÜË¢´Â§öÊ¨°Ë∞ÉÁî®ÔºåÂõ†Ê≠§Êàë‰ª¨Â∞ÜÂÖ∂ÊèêÂèñÂà∞‰∏Ä‰∏™ÂáΩÊï∞‰∏≠ - ‰∏Ä‰∏™ÂæàÂ•ΩÁöÑÊ®°ÂùóÂåñËÆæËÆ°„ÄÇ</p>
<p>Ê≥®ÊÑèÔºö‰∏ªË¶ÅÂéüÂõ†ÂÆûÈôÖ‰∏äÊòØ igraph Âú® Jupyter ‰∏äÂá∫Áé∞ÈóÆÈ¢òÔºåÊâÄ‰ª•ÊàëÊ≠£Âú®Ëß£ÂÜ≥Ëøô‰∏™ÈóÆÈ¢òÔºåÂ¶ÇÊûú‰Ω†Â•ΩÂ•áÁöÑËØùÔºåËØ∑Êü•Áúã<a target="_blank" rel="noopener" href="https://github.com/gordicaleksa/pytorch-GAT/blob/main/playground.py#L147">ÂéüÂßã‰ª£Á†Å</a> üòÇ</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br></pre></td><td class="code"><pre><code class="hljs python"><span class="hljs-keyword">def</span> <span class="hljs-title function_">gat_forward_pass</span>(<span class="hljs-params">model_name, dataset_name</span>):<br>    device = torch.device(<span class="hljs-string">&quot;cuda&quot;</span> <span class="hljs-keyword">if</span> torch.cuda.is_available() <span class="hljs-keyword">else</span> <span class="hljs-string">&quot;cpu&quot;</span>)  <span class="hljs-comment"># Ê£ÄÊü•ÊòØÂê¶Êúâ GPUÔºåÂ∏åÊúõÊúâÔºÅ</span><br><br>    config = &#123;<br>        <span class="hljs-string">&#x27;dataset_name&#x27;</span>: dataset_name,<br>        <span class="hljs-string">&#x27;should_visualize&#x27;</span>: <span class="hljs-literal">False</span>  <span class="hljs-comment"># ‰∏çÂèØËßÜÂåñÊï∞ÊçÆÈõÜ</span><br>    &#125;<br><br>    <span class="hljs-comment"># Ê≠•È™§ 1ÔºöÂáÜÂ§áÊï∞ÊçÆ</span><br>    node_features, node_labels, edge_index, _, _, _ = load_graph_data(config, device)<br><br>    <span class="hljs-comment"># Ê≠•È™§ 2ÔºöÂáÜÂ§áÊ®°Âûã</span><br>    model_path = os.path.join(BINARIES_PATH, model_name)<br>    model_state = torch.load(model_path, map_location=torch.device(<span class="hljs-string">&#x27;cpu&#x27;</span>))<br><br>    gat = GAT(<br>        num_of_layers=model_state[<span class="hljs-string">&#x27;num_of_layers&#x27;</span>],<br>        num_heads_per_layer=model_state[<span class="hljs-string">&#x27;num_heads_per_layer&#x27;</span>],<br>        num_features_per_layer=model_state[<span class="hljs-string">&#x27;num_features_per_layer&#x27;</span>],<br>        add_skip_connection=model_state[<span class="hljs-string">&#x27;add_skip_connection&#x27;</span>],<br>        bias=model_state[<span class="hljs-string">&#x27;bias&#x27;</span>],<br>        dropout=model_state[<span class="hljs-string">&#x27;dropout&#x27;</span>],<br>        log_attention_weights=<span class="hljs-literal">True</span><br>    ).to(device)<br><br>    print_model_metadata(model_state)<br>    gat.load_state_dict(model_state[<span class="hljs-string">&quot;state_dict&quot;</span>], strict=<span class="hljs-literal">True</span>)<br>    gat.<span class="hljs-built_in">eval</span>()  <span class="hljs-comment"># ‰∏Ä‰∫õÂ±ÇÔºåÊØîÂ¶Ç nn.DropoutÔºåÂú®ËÆ≠ÁªÉÊ®°ÂºèÂíåËØÑ‰º∞Ê®°Âºè‰∏ãÁöÑË°å‰∏∫ÊòØ‰∏çÂêåÁöÑÔºåÂõ†Ê≠§Ëøô‰∏ÄÈÉ®ÂàÜÂæàÈáçË¶Å</span><br><br>    <span class="hljs-comment"># Ê≠•È™§ 3ÔºöËÆ°ÁÆóÊàë‰ª¨Â∞ÜÈúÄË¶Å‰∏çÂêåÂèØËßÜÂåñÁ±ªÂûãÁöÑÊâÄÊúâ‰∏úË•øÔºàÊ≥®ÊÑèÂäõ„ÄÅÂàÜÊï∞„ÄÅedge_indexÔºâ</span><br><br>    <span class="hljs-comment"># Ëøô‰∏™‰∏ä‰∏ãÊñáÁÆ°ÁêÜÂô®ÂæàÈáçË¶ÅÔºà‰Ω†ÁªèÂ∏∏‰ºöÁúãÂà∞ÂÆÉÔºâÔºåÂê¶Âàô PyTorch ‰ºöÂç†Áî®Êõ¥Â§öÂÜÖÂ≠ò„ÄÇ</span><br>    <span class="hljs-comment"># ÂÆÉ‰ºö‰øùÂ≠òÂèçÂêë‰º†Êí≠ÁöÑÊøÄÊ¥ªÔºå‰ΩÜÊàë‰ª¨‰∏ç‰ºöËøõË°å‰ªª‰ΩïÊ®°ÂûãËÆ≠ÁªÉÔºåÂè™ÊòØÈ¢ÑÊµã„ÄÇ</span><br>    <span class="hljs-keyword">with</span> torch.no_grad():<br>        <span class="hljs-comment"># Ê≠•È™§ 3ÔºöËøêË°åÈ¢ÑÊµãÂπ∂Êî∂ÈõÜÈ´òÁª¥Êï∞ÊçÆ</span><br>        all_nodes_unnormalized_scores, _ = gat((node_features, edge_index))  <span class="hljs-comment"># ÂΩ¢Áä∂ = (N, Á±ªÂà´Êï∞)</span><br>        all_nodes_unnormalized_scores = all_nodes_unnormalized_scores.cpu().numpy()<br><br>    <span class="hljs-keyword">return</span> all_nodes_unnormalized_scores, edge_index, node_labels, gat<br><br></code></pre></td></tr></table></figure>

<p>ÂæàÈ´òÂÖ¥Âè™ÁîüÊàêÂ∞ÜÂú®‰∏ãÊ∏∏ÂèØËßÜÂåñ‰∏≠‰ΩøÁî®ÁöÑÊï∞ÊçÆÔºåÊÇ®Â∞ÜÂú®‰ª•‰∏ãÂçïÂÖÉÊ†º‰∏≠ÁúãÂà∞ÂÆö‰πâÁöÑÊï∞ÊçÆ„ÄÇ</p>
<p>Êàë‰ª¨ËøòÈúÄË¶Å‰∏Ä‰∏™ËæÖÂä©ÂáΩÊï∞ÔºåÂ∑≤ÁªèÂáÜÂ§áÂ•Ω‰∫ÜÔºÅ</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><code class="hljs python"><span class="hljs-comment"># ÁªòÂà∂Ôºà‰ΩÜÂ∞öÊú™ÁªòÂà∂ÔºâÁÜµÁõ¥ÊñπÂõæ„ÄÇÂ¶ÇÊûú‰Ω†ÂØπ‰∏∫‰ªÄ‰πàÁ™ÅÁÑ∂Âá∫Áé∞ÁÜµÊÑüÂà∞Âõ∞ÊÉëÔºåËØ∑Ë∑üÊàëËµ∞Ôºå‰Ω†ÂæàÂø´Â∞±‰ºöÊòéÁôΩÁöÑ„ÄÇ</span><br><span class="hljs-comment"># Âü∫Êú¨‰∏äÔºåÂÆÉÂ∏ÆÂä©Êàë‰ª¨ÈáèÂåñ GAT Â≠¶Âà∞ÁöÑÊ≥®ÊÑèÂäõÊ®°ÂºèÁöÑÊúâÁî®ÊÄß„ÄÇ</span><br><span class="hljs-keyword">def</span> <span class="hljs-title function_">draw_entropy_histogram</span>(<span class="hljs-params">entropy_array, title, color=<span class="hljs-string">&#x27;blue&#x27;</span>, uniform_distribution=<span class="hljs-literal">False</span>, num_bins=<span class="hljs-number">30</span></span>):<br>    max_value = np.<span class="hljs-built_in">max</span>(entropy_array)<br>    bar_width = (max_value / num_bins) * (<span class="hljs-number">1.0</span> <span class="hljs-keyword">if</span> uniform_distribution <span class="hljs-keyword">else</span> <span class="hljs-number">0.75</span>)<br>    histogram_values, histogram_bins = np.histogram(entropy_array, bins=num_bins, <span class="hljs-built_in">range</span>=(<span class="hljs-number">0.0</span>, max_value))<br><br>    plt.bar(histogram_bins[:num_bins], histogram_values[:num_bins], width=bar_width, color=color)<br>    plt.xlabel(<span class="hljs-string">f&#x27;ÁÜµÂå∫Èó¥&#x27;</span>)<br>    plt.ylabel(<span class="hljs-string">f&#x27;ËäÇÁÇπÈÇªÂ±ÖÊï∞Èáè&#x27;</span>)<br>    plt.title(title)<br><br></code></pre></td></tr></table></figure>

<p>ÂæàÂ•ΩÔºåÊé•‰∏ãÊù•ÊòØÊàë‰ª¨Â∞ÜÁî®Êù•ÂèØËßÜÂåñ GAT ÂµåÂÖ•ÔºàÈÄöËøá t-SNEÔºâÂíåÁÜµÁõ¥ÊñπÂõæÁöÑ‰∏ªË¶ÅÂáΩÊï∞Ôºö</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br></pre></td><td class="code"><pre><code class="hljs python"><span class="hljs-keyword">from</span> sklearn.manifold <span class="hljs-keyword">import</span> TSNE<br><span class="hljs-keyword">from</span> scipy.stats <span class="hljs-keyword">import</span> entropy<br><br><br><span class="hljs-comment"># ËÆ©Êàë‰ª¨ÂÆö‰πâ‰∏Ä‰∏™Êûö‰∏æ‰Ωú‰∏∫ÈÄâÊã©‰∏çÂêåÂèØËßÜÂåñÈÄâÈ°πÁöÑÊ∏ÖÊô∞ÊñπÂºè</span><br><span class="hljs-keyword">class</span> <span class="hljs-title class_">VisualizationType</span>(enum.Enum):<br>    ATTENTION = <span class="hljs-number">0</span>,<br>    EMBEDDINGS = <span class="hljs-number">1</span>,<br>    ENTROPY = <span class="hljs-number">2</span>,<br><br><br><span class="hljs-keyword">def</span> <span class="hljs-title function_">visualize_gat_properties</span>(<span class="hljs-params">model_name=<span class="hljs-string">r&#x27;gat_000000.pth&#x27;</span>, dataset_name=DatasetType.CORA.name, visualization_type=VisualizationType.ATTENTION</span>):<br>    <span class="hljs-string">&quot;&quot;&quot;</span><br><span class="hljs-string">    Âú®ÂèØËßÜÂåñÈÄâÈ°π‰πãÈó¥ÈÄâÊã© t-SNE ÊàñÁÜµÁõ¥ÊñπÂõæ„ÄÇ</span><br><span class="hljs-string">    </span><br><span class="hljs-string">    t-SNE ÁöÑÊ≥®ÊÑè‰∫ãÈ°πÔºö</span><br><span class="hljs-string">    Êü•ÁúãÊ≠§ÈìæÊé•‰ª•Ëé∑ÂèñÊúâÂÖ≥Â¶Ç‰ΩïË∞ÉÊï¥ t-SNE ÁöÑÊõ¥Â§öÁõ¥ËßÇ‰ø°ÊÅØÔºöhttps://distill.pub/2016/misread-tsne/</span><br><span class="hljs-string"></span><br><span class="hljs-string">    Â¶ÇÊûúÊÇ®ËÆ§‰∏∫ÂÆûÁé∞ t-SNE Âπ∂Ëß£ÈáäÊØè‰∏™ÁªÜËäÇÁöÑÊúâÁî®ÊÄßÔºåÂπ∂‰∏îÊÑøÊÑèËÆ©ÊàëÁü•ÈÅìÔºåÂèØ‰ª•ÊâìÂºÄ‰∏Ä‰∏™ÈóÆÈ¢òÊàñÂú®Á§æ‰∫§Â™í‰Ωì‰∏äÁßÅ‰ø°ÊàëÔºÅ&lt;3</span><br><span class="hljs-string"></span><br><span class="hljs-string">    Ê≥®ÊÑèÔºöÊàëËøòÂ∞ùËØïËøá‰ΩøÁî® UMAPÔºå‰ΩÜÂÆÉÂπ∂Ê≤°ÊúâÊèê‰æõÊØî t-SNE Êõ¥Â§öÁöÑËßÅËß£„ÄÇ</span><br><span class="hljs-string">    ÔºàÁº∫ÁÇπÔºöÂ¶ÇÊûúË¶Å‰ΩøÁî®ÂÖ∂ÁªòÂõæÂäüËÉΩÔºåÂÆÉÊúâÂæàÂ§ö‰æùËµñÈ°πÔºâ</span><br><span class="hljs-string">    </span><br><span class="hljs-string">    &quot;&quot;&quot;</span><br>    <br>    <span class="hljs-comment"># Ëé∑ÂèñÂàõÂª∫ÂèØËßÜÂåñÊâÄÈúÄÁöÑÊï∞ÊçÆ</span><br>    all_nodes_unnormalized_scores, edge_index, node_labels, gat = gat_forward_pass(model_name, dataset_name)<br>    <br>    <span class="hljs-comment"># ÊâßË°åÁâπÂÆöÁöÑÂèØËßÜÂåñÔºàt-SNE ÊàñÁÜµÁõ¥ÊñπÂõæÔºâ</span><br>    <span class="hljs-keyword">if</span> visualization_type == VisualizationType.EMBEDDINGS:  <span class="hljs-comment"># ÂèØËßÜÂåñÂµåÂÖ•Ôºà‰ΩøÁî® t-SNEÔºâ</span><br>        node_labels = node_labels.cpu().numpy()<br>        num_classes = <span class="hljs-built_in">len</span>(<span class="hljs-built_in">set</span>(node_labels))<br><br>        <span class="hljs-comment"># Â§öÂ∞ùËØï perplexityÔºåËøôÂèØËÉΩÊòØ t-SNE ‰∏≠ÊúÄÈáçË¶ÅÁöÑÂèÇÊï∞‰πã‰∏ÄÔºåÂÆÉÂü∫Êú¨‰∏äÊéßÂà∂‰∫ÜÈ´òÁª¥ÔºàÂéüÂßãÔºâÁ©∫Èó¥‰∏≠ Gaussians ÁöÑÊ†áÂáÜÂ∑ÆÔºåÂç≥È´òÁª¥Á©∫Èó¥‰∏≠ÈÇªÂ±ÖÁöÑÂ§ßÂ∞è„ÄÇ</span><br>        <span class="hljs-comment"># ÁÆÄËÄåË®Ä‰πãÔºåt-SNE ÁöÑÁõÆÊ†áÊòØÊúÄÂ∞èÂåñÈ´òÁª¥ÁÇπ‰∏äÊãüÂêàÁöÑËÅîÂêàÈ´òÊñØÂàÜÂ∏É‰∏é‰ΩéÁª¥ÁÇπ‰∏äÊãüÂêàÁöÑ t-Student ÂàÜÂ∏É‰πãÈó¥ÁöÑ KL Êï£Â∫¶</span><br>        <span class="hljs-comment"># Áõ¥ËßÇÂú∞ËØ¥ÔºåÈÄöËøáËøôÊ†∑ÂÅöÔºåÊàë‰ª¨‰øùÁïô‰∫ÜÈ´òÁª¥Âíå‰ΩéÁª¥ÁÇπ‰πãÈó¥ÁöÑÁõ∏‰ººÊÄßÔºàÂÖ≥Á≥ªÔºâ„ÄÇ</span><br>        <span class="hljs-comment"># Â¶ÇÊûúÊÇ®ÂØπ t-SNEÂ∞ö‰∏çÁÜüÊÇâÔºåËøôÂèØËÉΩ‰∏ç‰ºöÊúâÂ§™Â§öÊÑè‰πâÔºåÊàëÂ∑≤ÁªèÂ∞ùËØïËøá‰∫Ü„ÄÇ:P</span><br>        t_sne_embeddings = TSNE(n_components=<span class="hljs-number">2</span>, perplexity=<span class="hljs-number">30</span>, method=<span class="hljs-string">&#x27;barnes_hut&#x27;</span>).fit_transform(all_nodes_unnormalized_scores)<br><br>        fig = plt.figure(figsize=(<span class="hljs-number">12</span>,<span class="hljs-number">8</span>), dpi=<span class="hljs-number">80</span>)  <span class="hljs-comment"># Âê¶ÂàôÂú® Jupyter Notebook ‰∏≠ÔºåÁªòÂõæ‰ºöÂæàÂ∞è</span><br>        <span class="hljs-keyword">for</span> class_id <span class="hljs-keyword">in</span> <span class="hljs-built_in">range</span>(num_classes):<br>            <span class="hljs-comment"># Êàë‰ª¨ÊèêÂèñÁúüÂÆûÊ†áÁ≠æÁ≠â‰∫é class_id ÁöÑÁÇπÔºåÂπ∂‰ª•Áõ∏ÂêåÁöÑÊñπÂºèÂØπÂÆÉ‰ª¨ËøõË°åÁùÄËâ≤ÔºåÂ∏åÊúõÂÆÉ‰ª¨Âú® 2D Âõæ‰∏äËÅöÈõÜÂú®‰∏ÄËµ∑ -</span><br>            <span class="hljs-comment"># ËøôÊÑèÂë≥ÁùÄ GAT Â∑≤ÁªèÂ≠¶Âà∞‰∫ÜÂæàÂ•ΩÁöÑË°®Á§∫ÔºÅ</span><br>            plt.scatter(t_sne_embeddings[node_labels == class_id, <span class="hljs-number">0</span>], t_sne_embeddings[node_labels == class_id, <span class="hljs-number">1</span>], s=<span class="hljs-number">20</span>, color=cora_label_to_color_map[class_id], edgecolors=<span class="hljs-string">&#x27;black&#x27;</span>, linewidths=<span class="hljs-number">0.2</span>)<br>        plt.show()<br><br>    <span class="hljs-comment"># Êàë‰ª¨Â∏åÊúõÊàë‰ª¨ÁöÑÂ±ÄÈÉ®Ê¶ÇÁéáÂàÜÂ∏ÉÔºàÂØπÈÇªÂ±ÖÁöÑÊ≥®ÊÑèÂäõÊùÉÈáçÔºâÊòØÈùûÂùáÂåÄÁöÑÔºåÂõ†‰∏∫ËøôÊÑèÂë≥ÁùÄ GAT Â≠¶Âà∞‰∫ÜÊúâÁî®ÁöÑÊ®°Âºè„ÄÇÁÜµÁõ¥ÊñπÂõæÂ∏ÆÂä©Êàë‰ª¨ÂèØËßÜÂåñ</span><br>    <span class="hljs-comment"># Ëøô‰∫õÈÇªÂ±ÖÂàÜÂ∏É‰∏éÂùáÂåÄÂàÜÂ∏ÉÔºàÂ∏∏Êï∞ÂÖ≥Ê≥®ÔºâÊúâÂ§ö‰πà‰∏çÂêå„ÄÇÂ¶ÇÊûú GAT Â≠¶Âà∞‰∫ÜÂ∏∏ÈáèÊ≥®ÊÑèÂäõÔºåÊàë‰ª¨ÂèØËÉΩÂæàÂ•ΩÂú∞‰ΩøÁî® GCN Êàñ‰∏Ä‰∫õÊõ¥ÁÆÄÂçïÁöÑÊ®°Âûã„ÄÇ</span><br>    <span class="hljs-keyword">elif</span> visualization_type == VisualizationType.ENTROPY:<br>        num_heads_per_layer = [layer.num_of_heads <span class="hljs-keyword">for</span> layer <span class="hljs-keyword">in</span> gat.gat_net]<br>        num_layers = <span class="hljs-built_in">len</span>(num_heads_per_layer)<br><br>        num_of_nodes = <span class="hljs-built_in">len</span>(node_features)<br>        target_node_ids = edge_index[<span class="hljs-number">1</span>].cpu().numpy()<br><br>        <span class="hljs-comment"># ÂØπ‰∫éÊØè‰∏™ GAT Â±ÇÂíåÊØè‰∏™ GAT Ê≥®ÊÑèÂäõÂ§¥ÔºåÁªòÂà∂ÁÜµÁõ¥ÊñπÂõæ</span><br>        <span class="hljs-keyword">for</span> layer_id <span class="hljs-keyword">in</span> <span class="hljs-built_in">range</span>(num_layers):<br>            <span class="hljs-comment"># Ëé∑ÂèñËæπÁºòÁöÑÊ≥®ÊÑèÂäõÊùÉÈáçÔºàÂú®‰∏äÈù¢ÁöÑ GAT Ê≠£Âêë‰º†ÈÄíÊúüÈó¥ËÆ∞ÂΩï‰∫ÜÊ≥®ÊÑèÂäõÔºâ</span><br>            <span class="hljs-comment"># Ê≥®ÊÑèÂäõÂΩ¢Áä∂ = (N, NH, 1) -&gt; (N, NH) - Êàë‰ª¨Âè™Êå§Âéã‰∫ÜÊúÄÂêé‰∏Ä‰∏™Áª¥Â∫¶ÔºåÂÆÉÊòØÂ§ö‰ΩôÁöÑ</span><br>            all_attention_weights = gat.gat_net[layer_id].attention_weights.squeeze(dim=-<span class="hljs-number">1</span>).cpu().numpy()<br><br>            <span class="hljs-keyword">for</span> head_id <span class="hljs-keyword">in</span> <span class="hljs-built_in">range</span>(num_heads_per_layer[layer_id]):<br>                uniform_dist_entropy_list = []  <span class="hljs-comment"># Â∞ÜÁêÜÊÉ≥ÁöÑÂùáÂåÄÁõ¥ÊñπÂõæ‰øùÂ≠ò‰∏∫ÂèÇËÄÉ</span><br>                neighborhood_entropy_list = []<br><br>                <span class="hljs-comment"># Ëøô‰πüÂèØ‰ª•ÈÄöËøá scatter_add_ÔºàÊ≤°Êúâ for Âæ™ÁéØÔºâÊõ¥ÊúâÊïàÂú∞ÂÆåÊàê</span><br>                <span class="hljs-comment"># ‰º™Ôºöout.scatter_add_(node_dim, -all_attention_weights * log(all_attention_weights), target_index)</span><br>                <span class="hljs-keyword">for</span> target_node_id <span class="hljs-keyword">in</span> <span class="hljs-built_in">range</span>(num_of_nodes):  <span class="hljs-comment"># ÊâæÂà∞Âõæ‰∏≠ÊØè‰∏™ËäÇÁÇπÁöÑÈÇªÂ±Ö</span><br>                    <span class="hljs-comment"># Ëøô‰∫õÊ≥®ÊÑèÂäõÊùÉÈáçÊÄªÂíå‰∏∫ 1ÔºåÂõ†‰∏∫ GAT ÁöÑËÆæËÆ°ÔºåÊâÄ‰ª•Êàë‰ª¨ÂèØ‰ª•Â∞ÜÂÖ∂ËßÜ‰∏∫Ê¶ÇÁéáÂàÜÂ∏É</span><br>                    neigborhood_attention = all_attention_weights[target_node_ids == target_node_id].flatten()<br>                    <span class="hljs-comment"># ÂêåÊ†∑ÈïøÂ∫¶ÁöÑÂèÇËÄÉÂùáÂåÄÂàÜÂ∏É</span><br>                    ideal_uniform_attention = np.ones(<span class="hljs-built_in">len</span>(neigborhood_attention))/<span class="hljs-built_in">len</span>(neigborhood_attention)<br><br>                    <span class="hljs-comment"># ËÆ°ÁÆóÁÜµÔºåÂ¶ÇÊûúÊÇ®ÂØπËØ•Ê¶ÇÂøµ‰∏çÁÜüÊÇâÔºåËØ∑Êü•ÁúãÊ≠§ËßÜÈ¢ëÔºö</span><br>                    <span class="hljs-comment"># https://www.youtube.com/watch?v=ErfnhcEV1O8ÔºàAur√©lien G√©ronÔºâ</span><br>                    neighborhood_entropy_list.append(entropy(neigborhood_attention, base=<span class="hljs-number">2</span>))<br>                    uniform_dist_entropy_list.append(entropy(ideal_uniform_attention, base=<span class="hljs-number">2</span>))<br><br>                title = <span class="hljs-string">f&#x27;Cora ÁÜµÁõ¥ÊñπÂõæ Â±Ç=<span class="hljs-subst">&#123;layer_id&#125;</span>ÔºåÊ≥®ÊÑèÂäõÂ§¥=<span class="hljs-subst">&#123;head_id&#125;</span>&#x27;</span><br>                draw_entropy_histogram(uniform_dist_entropy_list, title, color=<span class="hljs-string">&#x27;orange&#x27;</span>, uniform_distribution=<span class="hljs-literal">True</span>)<br>                draw_entropy_histogram(neighborhood_entropy_list, title, color=<span class="hljs-string">&#x27;dodgerblue&#x27;</span>)<br><br>                fig = plt.gcf()  <span class="hljs-comment"># Ëé∑ÂèñÂΩìÂâçÂõæÂΩ¢</span><br>                plt.show()<br>                fig.savefig(os.path.join(DATA_DIR_PATH, <span class="hljs-string">f&#x27;layer_<span class="hljs-subst">&#123;layer_id&#125;</span>_head_<span class="hljs-subst">&#123;head_id&#125;</span>.jpg&#x27;</span>))<br>                plt.close()<br>    <span class="hljs-keyword">else</span>:<br>        <span class="hljs-keyword">raise</span> Exception(<span class="hljs-string">f&#x27;‰∏çÊîØÊåÅÁöÑÂèØËßÜÂåñÁ±ªÂûã <span class="hljs-subst">&#123;visualization_type&#125;</span>„ÄÇ&#x27;</span>)<br><br></code></pre></td></tr></table></figure>

<p>Â•ΩÁöÑÔºÅÊúÄÂêéËÆ©Êàë‰ª¨Áî®Áî®ÂêßÔºÅÈ¶ñÂÖàÊòØ-t-SNE„ÄÇ</p>
<h1 id="‰ΩøÁî®-t-SNE-ÂèØËßÜÂåñ-GAT-ÁöÑÂµåÂÖ•-üìà"><a href="#‰ΩøÁî®-t-SNE-ÂèØËßÜÂåñ-GAT-ÁöÑÂµåÂÖ•-üìà" class="headerlink" title="‰ΩøÁî® t-SNE ÂèØËßÜÂåñ GAT ÁöÑÂµåÂÖ• üìà"></a>‰ΩøÁî® t-SNE ÂèØËßÜÂåñ GAT ÁöÑÂµåÂÖ• üìà</h1><p>t-SNE Â±û‰∫é‰∏ÄÂ§ßÁ±ªÈôçÁª¥ÊñπÊ≥ï„ÄÇ</p>
<p>ÂÆÉÂú®Á§æÂå∫‰∏≠Ëé∑Âæó‰∫ÜÂ∑®Â§ßÁöÑÂÖ≥Ê≥®ÔºåÂõ†‰∏∫ÂÆÉ‰ΩøÁî®ÁÆÄÂçïÂπ∂‰∏îÊïàÊûúËâØÂ•ΩÔºàÂèØËÉΩÊòØÂõ†‰∏∫ÂÆÉÊòØÁî± Geoffrey Hinton khmÂÖ±ÂêåÂàõ‰ΩúÁöÑÔºâ</p>
<p>ËøòÊúâÂÖ∂‰ªñËæÉÊñ∞ÁöÑÊñπÊ≥ïÊØîÂ¶ÇUMAPÔºå‰ΩÜÂ∞öÊú™Ëé∑ÂæóË∂≥Â§üÁöÑÂÖ≥Ê≥®ÔºàÊçÆÊàëÊâÄÁü•Ôºâ„ÄÇ</p>
<p>‰ΩÜÁêÜËÆ∫Â∑≤ÁªèË∂≥Â§ü‰∫ÜÔºåËÆ©Êàë‰ª¨Áúã‰∏Ä‰∫õÂõæË°®ÔºÅ</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><code class="hljs python">model_name=<span class="hljs-string">r&#x27;gat_000000.pth&#x27;</span>  <span class="hljs-comment"># This model is checked-in, feel free to use the one you trained</span><br>dataset_name=DatasetType.CORA.name<br><br><br>visualize_gat_properties(<br>        model_name,<br>        dataset_name,<br>        visualization_type=VisualizationType.EMBEDDINGS  <span class="hljs-comment"># pick between attention, t-SNE embeddings and entropy</span><br>)<br></code></pre></td></tr></table></figure>

<pre><code class="hljs">/var/folders/f0/812mfv7x63vbytjs3yf4gxtc0000gn/T/ipykernel_16269/2448994618.py:6: DeprecationWarning: Please use `csr_matrix` from the `scipy.sparse` namespace, the `scipy.sparse.csr` namespace is deprecated.
  data = pickle.load(file)



***** Ê®°ÂûãËÆ≠ÁªÉÂÖÉÊï∞ÊçÆ: *****
commit_hash: 91fb864b8f9ddefd401bf5399cea779bd3c0a63b
dataset_name: CORA
num_of_epochs: 10000
test_acc: 0.822
num_of_layers: 2
num_heads_per_layer: [8, 1]
num_features_per_layer: [1433, 8, 7]
add_skip_connection: False
bias: True
dropout: 0.6
layer_type: IMP3
*********************



/Users/gawaintan/miniforge3/envs/torch/lib/python3.9/site-packages/IPython/core/pylabtools.py:152: UserWarning: Glyph 8722 (\N&#123;MINUS SIGN&#125;) missing from current font.
  fig.canvas.print_figure(bytes_io, **kw)
</code></pre>
<p><img src="https://ptpimg.me/yt72e1.png" srcset="/img/loading.gif" lazyload alt="ËØ∑Ê∑ªÂä†ÂõæÁâáÊèèËø∞"></p>
<p>ÊºÇ‰∫ÆÔºÅ</p>
<p>Êàë‰ª¨ÂèØ‰ª•ÁúãÂà∞‰ª•‰∏ãÂÜÖÂÆπ - ‰∏ÄÊó¶Êàë‰ª¨ÈÄöËøá GAT ËøõË°åÂâçÂêë‰º†ÈÄíÔºåÂÆÉÂ∞±‰ºöÂ∞ÜÁª¥Â∫¶ÔºàËäÇÁÇπÊï∞„ÄÅÊØè‰∏™ÁâπÂæÅÂêëÈáèÁöÑÁâπÂæÅÊï∞Ôºâ&#x3D; ÁöÑËæìÂÖ•ÁâπÂæÅÂêëÈáèËΩ¨Êç¢‰∏∫ Âõ†‰∏∫ Cora Êúâ 7 ‰∏™(2708, 1433)Á±ª(2708, 7)„ÄÇ</p>
<p>Ëøô‰∫õÁ±ªÊòØÔºöGenetic Algorithms„ÄÅReinforcement LearningÁ≠âÔºå‰ΩøÂÖ∂‰∏çÈÇ£‰πàÊäΩË±°Ôºå‰ΩÜÊúÄÁªàÂÆÉÈÄÇÁî®‰∫é‰ªª‰Ωï 7 ‰∏™Á±ªÁöÑÈõÜÂêàÂπ∂‰∏çÈáçË¶Å„ÄÇ</p>
<p>Áé∞Âú®Ôºå‰∏ÄÊó¶Êàë‰ª¨Ëé∑Âæó‰∫Ü 7 Áª¥ÂêëÈáèÔºåÊàë‰ª¨Â∞±‰ΩøÁî® t-SNE Â∞ÜÂÆÉ‰ª¨Êò†Â∞ÑÂà∞ 2D ÂêëÈáèÔºàÂõ†‰∏∫‰Ω†Áü•ÈÅìÂæàÈöæÁªòÂà∂ 7D ÂêëÈáèÔºâ„ÄÇt-SNE ÁöÑÊäÄÂ∑ßÂú®‰∫éÔºåÂÆÉ‰øùÁïô‰∫ÜÂêëÈáè‰πãÈó¥ÁöÑÂÖ≥Á≥ªÔºåÂõ†Ê≠§ÔºåÁ≤óÁï•Âú∞ËØ¥ÔºåÂ¶ÇÊûúÂÆÉ‰ª¨Âú® 7D Á©∫Èó¥‰∏≠Êé•ËøëÔºà‰ΩÜÊòØÊàë‰ª¨ÂÆö‰πâ‚ÄúÊé•ËøëÂ∫¶‚ÄùÔºâÔºåÈÇ£‰πàÂÆÉ‰ª¨Âú® 2D Á©∫Èó¥‰∏≠‰πü‰ºöÊé•Ëøë„ÄÇ</p>
<p>Áé∞Âú®ÊÇ®ÂèØ‰ª•ÁúãÂà∞Âêå‰∏ÄÁ±ªÁöÑÁÇπÔºàÂÆÉ‰ª¨ÂÖ∑ÊúâÁõ∏ÂêåÁöÑÈ¢úËâ≤ÔºâËÅöÈõÜÂú®‰∏ÄËµ∑ÔºÅËøôÊòØ‰∏Ä‰∏™ÁêÜÊÉ≥ÁöÑÁâπÊÄßÔºåÂõ†‰∏∫Áé∞Âú®ËÆ≠ÁªÉ‰∏Ä‰∏™ËÉΩÂ§üÊ≠£Á°ÆÈ¢ÑÊµãÁ±ªÂà´ÁöÑÂàÜÁ±ªÂô®Ë¶ÅÂÆπÊòìÂæóÂ§ö„ÄÇ</p>
<hr>
<p>Â§™Ê£í‰∫ÜÔºåÁé∞Âú®ËÆ©Êàë‰ª¨Â∞ÜÊ≥®ÊÑèÂäõËΩ¨ÁßªÂà∞Ê≥®ÊÑèÂäõ‰∏äÔºåÂõ†‰∏∫Êàë‰ª¨ÊØïÁ´üÊ≠£Âú®Â§ÑÁêÜÂõæÊ≥®ÊÑèÂäõÁΩëÁªú„ÄÇ</p>
<h1 id="ÂèØËßÜÂåñÈÇªÂ±ÖÁöÑÊ≥®ÊÑèÂäõüì£"><a href="#ÂèØËßÜÂåñÈÇªÂ±ÖÁöÑÊ≥®ÊÑèÂäõüì£" class="headerlink" title="ÂèØËßÜÂåñÈÇªÂ±ÖÁöÑÊ≥®ÊÑèÂäõüì£"></a>ÂèØËßÜÂåñÈÇªÂ±ÖÁöÑÊ≥®ÊÑèÂäõüì£</h1><p>ÊâÄ‰ª•Ôºå‰Ω†Áé∞Âú®Â∏åÊúõ‰∫ÜËß£ GAT ÁöÑÂ§ßËá¥Â∑•‰ΩúÂéüÁêÜÔºåÂπ∂‰∏îÁü•ÈÅìÂú®ËÅöÂêàÈò∂ÊÆµÔºåÊØè‰∏™ËäÇÁÇπÈÉΩ‰ºö‰∏∫ÂÖ∂ÊØè‰∏™ÈÇªÂ±ÖÂàÜÈÖç‰∏Ä‰∏™Ê≥®ÊÑèÂäõÁ≥ªÊï∞ÔºàÂåÖÊã¨ÂÆÉËá™Â∑±ÔºåÂõ†‰∏∫Êàë‰ª¨Ê∑ªÂä†‰∫ÜËá™ËæπÔºâ„ÄÇ</p>
<p>ÂÖ≥‰∫éÊàë‰ª¨ÂèØ‰ª•ÊÉ≥Ë±°‰ªÄ‰πàÊúâ‰ªÄ‰πàÊÉ≥Ê≥ïÂêóÔºüÂ•ΩÂêßÔºåËÆ©Êàë‰ª¨ÈÄâÊã©‰∏Ä‰∫õËäÇÁÇπÔºåÁúãÁúã‰ªñ‰ª¨Â≠¶Âà∞‰∫ÜÂì™‰∫õÊ≥®ÊÑèÂäõÊ®°ÂºèÔºÅ</p>
<p>ÊÇ®ÂèØËÉΩÊÉ≥Âà∞ÁöÑÁ¨¨‰∏Ä‰∏™ÊÉ≥Ê≥ïÊòØÔºåÂ¶ÇÊûúÊ≥®ÊÑèÂäõËæÉÂ§ßÔºåÂàôÂ∞ÜËæπÁîªÂæóÊõ¥ÂéöÔºåÂèç‰πã‰∫¶ÁÑ∂ÔºàËøô‰πüÊòØÊàëÊÉ≥Âà∞ÁöÑÊúÄÂêé‰∏Ä‰∏™ÊÉ≥Ê≥ïÔºâ„ÄÇ</p>
<p>Êàë‰ª¨ÂºÄÂßãÂêßÔºÅ</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br></pre></td><td class="code"><pre><code class="hljs python"><span class="hljs-comment"># Ëé∑ÂèñÂàõÂª∫ÂèØËßÜÂåñÊâÄÈúÄÁöÑÊï∞ÊçÆ</span><br>all_nodes_unnormalized_scores, edge_index, node_labels, gat = gat_forward_pass(model_name, dataset_name)<br><br><span class="hljs-comment"># Êàë‰ª¨Ë¶ÅÂèØËßÜÂåñÂÖ∂ÈÇªËøëËäÇÁÇπÁöÑÂÖ≥Ê≥®Â∫¶ÁöÑËäÇÁÇπÊï∞Èáè</span><br>num_nodes_of_interest = <span class="hljs-number">4</span>  <span class="hljs-comment"># 4 ÊòØ‰∏Ä‰∏™ÊÇ®ÂèØ‰ª•Â∞ùËØï‰∏çÂêåÂÄºÁöÑ‰ªªÊÑèÊï∞Â≠ó</span><br>head_to_visualize = <span class="hljs-number">0</span>  <span class="hljs-comment"># ÁªòÂà∂Êù•Ëá™ËØ•Â§öÂ§¥Ê≥®ÊÑèÂäõÂ§¥ÁöÑÊ≥®ÊÑèÂäõÔºà‰ªÖÊúÄÂêé‰∏ÄÂ±ÇÊúâ‰∏Ä‰∏™Â§öÂ§¥Ôºâ</span><br>gat_layer_id = <span class="hljs-number">1</span>  <span class="hljs-comment"># ÁªòÂà∂Êù•Ëá™ËØ• GAT Â±ÇÁöÑÊ≥®ÊÑèÂäõÔºàÁî±‰∫éÊàë‰ª¨ÁöÑ GAT Âè™Êúâ 2 Â±ÇÔºåËøôÊòØÊúÄÂêé‰∏ÄÂ±ÇÔºâ</span><br><br><span class="hljs-comment"># ÊûÑÂª∫ÂÆåÊï¥Âõæ</span><br><span class="hljs-comment"># node_features ÂΩ¢Áä∂ =ÔºàNÔºåFINÔºâÔºåÂÖ∂‰∏≠ N ÊòØËäÇÁÇπÊï∞ÔºåFIN ÊòØËæìÂÖ•ÁâπÂæÅÊï∞</span><br>total_num_of_nodes = <span class="hljs-built_in">len</span>(node_features)<br>complete_graph = ig.Graph()<br>complete_graph.add_vertices(total_num_of_nodes)  <span class="hljs-comment"># igraph ‰ΩøÁî®ËøôÁßçÊ†ºÂºèÂàõÂª∫Â∏¶Êúâ [0Ôºåtotal_num_of_nodes - 1] ID ÁöÑËäÇÁÇπ</span><br>edge_index_tuples = <span class="hljs-built_in">list</span>(<span class="hljs-built_in">zip</span>(edge_index[<span class="hljs-number">0</span>, :], edge_index[<span class="hljs-number">1</span>, :]))  <span class="hljs-comment"># igraph ÈúÄË¶ÅËøôÁßçÊ†ºÂºè</span><br>complete_graph.add_edges(edge_index_tuples)<br><br><span class="hljs-comment"># ÈÄâÊã©Ë¶ÅÁªòÂà∂ÁöÑÁõÆÊ†áËäÇÁÇπÔºàÂÖ∑ÊúâÊúÄÈ´òÂ∫¶Êï∞ÁöÑËäÇÁÇπ + ÈöèÊú∫ËäÇÁÇπÔºâ</span><br><span class="hljs-comment"># Ê≥®ÊÑèÔºöÈöèÊú∫ËäÇÁÇπÂíåÂÖ∑ÊúâÊúÄÈ´òÂ∫¶Êï∞ÁöÑËäÇÁÇπ‰πãÈó¥ÂèØËÉΩÂ≠òÂú®ÈáçÂè† - ‰ΩÜËøôÊòØÈùûÂ∏∏‰∏çÂèØËÉΩÁöÑ</span><br>highest_degree_node_ids = np.argpartition(complete_graph.degree(), -num_nodes_of_interest)[-num_nodes_of_interest:]<br>random_node_ids = np.random.randint(low=<span class="hljs-number">0</span>, high=total_num_of_nodes, size=num_nodes_of_interest)<br><br><span class="hljs-built_in">print</span>(<span class="hljs-string">f&#x27;Highest degree nodes = <span class="hljs-subst">&#123;highest_degree_node_ids&#125;</span>&#x27;</span>)<br><br>target_node_ids = edge_index[<span class="hljs-number">1</span>]<br>source_nodes = edge_index[<span class="hljs-number">0</span>]<br><br><span class="hljs-comment">#</span><br><span class="hljs-comment"># ÈÄâÊã©Ë¶Å‰∏∫ÂÖ∂ÂèØËßÜÂåñÂÖ≥Ê≥®Â∫¶ÁöÑËäÇÁÇπ IDÔºÅ</span><br><span class="hljs-comment">#</span><br><br><span class="hljs-comment"># Áî±‰∫éÂú® Jupyter ‰∏≠Êó†Ê≥ï‰ΩøÁî® for Âæ™ÁéØÔºåÂè™ÈúÄËÆæÁΩÆ‰∏Ä‰∫õÊï∞Â≠ó</span><br>target_node_id = <span class="hljs-number">306</span>  <span class="hljs-comment"># 306 ÊòØÁ¨¨‰∫åÂ∫¶Êï∞ÊúÄÈ´òÁöÑËäÇÁÇπ</span><br><br><span class="hljs-comment"># Ê≠•È™§ 1ÔºöÊü•ÊâæÁõÆÊ†áËäÇÁÇπÁöÑÈÇªËøëËäÇÁÇπ</span><br><span class="hljs-comment"># Ê≥®ÊÑèÔºöÂØπ‰∫é CORAÔºåÂåÖÊã¨Ëá™ÁéØÔºåÂõ†Ê≠§ÁõÆÊ†áËäÇÁÇπÊòØÂÖ∂Ëá™Ë∫´ÁöÑÈÇªÂ±ÖÔºàAlexandroÔºåyo soy tu madreÔºâ</span><br>src_nodes_indices = torch.eq(target_node_ids, target_node_id)<br>source_node_ids = source_nodes[src_nodes_indices].cpu().numpy()<br>size_of_neighborhood = <span class="hljs-built_in">len</span>(source_node_ids)<br><br><span class="hljs-comment"># Ê≠•È™§ 2ÔºöËé∑ÂèñÂÆÉ‰ª¨ÁöÑÊ†áÁ≠æ</span><br>labels = node_labels[source_node_ids].cpu().numpy()<br><br><span class="hljs-comment"># Ê≠•È™§ 3ÔºöËé∑ÂèñËæπÁºòÁöÑÊ≥®ÊÑèÂäõÊùÉÈáçÔºàÂú®‰∏äÈù¢ÁöÑ GAT Ê≠£Âêë‰º†ÈÄíÊúüÈó¥ËÆ∞ÂΩï‰∫ÜÊ≥®ÊÑèÂäõÔºâ</span><br><span class="hljs-comment"># attention ÂΩ¢Áä∂ =ÔºàNÔºåNHÔºå1Ôºâ-&gt;ÔºàNÔºåNHÔºâ - Êàë‰ª¨Âè™Êå§Âéã‰∫ÜÊúÄÂêé‰∏Ä‰∏™Áª¥Â∫¶ÔºåÂÆÉÊòØÂ§ö‰ΩôÁöÑ</span><br>all_attention_weights = gat.gat_net[gat_layer_id].attention_weights.squeeze(dim=-<span class="hljs-number">1</span>)<br>attention_weights = all_attention_weights[src_nodes_indices, head_to_visualize].cpu().numpy()<br><span class="hljs-comment"># Ê≠§ÈÉ®ÂàÜÊòæÁ§∫‰∫ÜÂØπ‰∫é CORAÔºåGAT Â≠¶Âà∞ÁöÑÊ≥®ÊÑèÂäõÊùÉÈáçÂá†‰πéÊòØÂ∏∏ÈáèÔºÅ Â∞±ÂÉèÂú® GCN ‰∏≠‰∏ÄÊ†∑ÔºÅ</span><br><span class="hljs-built_in">print</span>(<span class="hljs-string">f&#x27;Max attention weight = <span class="hljs-subst">&#123;np.<span class="hljs-built_in">max</span>(attention_weights)&#125;</span> and min = <span class="hljs-subst">&#123;np.<span class="hljs-built_in">min</span>(attention_weights)&#125;</span>&#x27;</span>)<br>attention_weights /= np.<span class="hljs-built_in">max</span>(attention_weights)  <span class="hljs-comment"># ÈáçÊñ∞Áº©ÊîæÊúÄÂ§ßÊùÉÈáç‰∏∫ 1Ôºå‰ª•‰æøÊõ¥Â•ΩÂú∞ÁªòÂà∂</span><br><br><span class="hljs-comment"># ÊûÑÂª∫Êàë‰ª¨ÊÉ≥Ë¶ÅÂèØËßÜÂåñÊ≥®ÊÑèÂäõÁöÑÈÇªÂ±ÖÂõæ</span><br><span class="hljs-comment"># igraph Á∫¶Êùü - ÂÆÉ‰∏éËøûÁª≠ËåÉÂõ¥ÁöÑ ID ‰∏ÄËµ∑‰ΩøÁî®ÔºåÂõ†Ê≠§Êàë‰ª¨Â∞Ü‰æãÂ¶ÇËäÇÁÇπ 497 Êò†Â∞ÑÂà∞ 0Ôºå12 Âà∞ 1ÔºåÁ≠âÁ≠â„ÄÇ</span><br>id_to_igraph_id = <span class="hljs-built_in">dict</span>(<span class="hljs-built_in">zip</span>(source_node_ids, <span class="hljs-built_in">range</span>(<span class="hljs-built_in">len</span>(source_node_ids))))<br>ig_graph = ig.Graph()<br>ig_graph.add_vertices(size_of_neighborhood)<br>ig_graph.add_edges([(id_to_igraph_id[neighbor], id_to_igraph_id[target_node_id]) <span class="hljs-keyword">for</span> neighbor <span class="hljs-keyword">in</span> source_node_ids])<br><br><span class="hljs-comment"># ÂáÜÂ§áÂèØËßÜÂåñËÆæÁΩÆÂ≠óÂÖ∏Âπ∂ÁªòÂõæ</span><br>visual_style = &#123;<br>    <span class="hljs-string">&quot;edge_width&quot;</span>: attention_weights,  <span class="hljs-comment"># ‰ΩøËæπÁºòÂ∞ΩÂèØËÉΩÁ≤ó</span><br>    <span class="hljs-string">&quot;layout&quot;</span>: ig_graph.layout_reingold_tilford_circular()  <span class="hljs-comment"># Ê†ëÁä∂ÂõæÁöÑÂ∏ÉÂ±Ä</span><br>&#125;<br><span class="hljs-comment"># ËøôÊòØÂîØ‰∏ÄÈíàÂØπ Cora ÁöÑÈÉ®ÂàÜÔºåÂõ†‰∏∫ Cora Êúâ 7 ‰∏™Ê†áÁ≠æ</span><br><span class="hljs-keyword">if</span> dataset_name.lower() == DatasetType.CORA.name.lower():<br>    visual_style[<span class="hljs-string">&quot;vertex_color&quot;</span>] = [cora_label_to_color_map[label] <span class="hljs-keyword">for</span> label <span class="hljs-keyword">in</span> labels]<br><span class="hljs-keyword">else</span>:<br>    <span class="hljs-built_in">print</span>(<span class="hljs-string">&#x27;‰∏∫ÊÇ®ÁâπÂÆöÁöÑÊï∞ÊçÆÈõÜÊ∑ªÂä†Ëá™ÂÆö‰πâÈ¢úËâ≤ÊñπÊ°à„ÄÇ ‰ΩøÁî® igraph ÈªòËÆ§ÁùÄËâ≤„ÄÇ&#x27;</span>)<br><br>ig.plot(ig_graph, **visual_style)<br><br></code></pre></td></tr></table></figure>

<pre><code class="hljs">***** Ê®°ÂûãËÆ≠ÁªÉÂÖÉÊï∞ÊçÆ: *****
commit_hash: 91fb864b8f9ddefd401bf5399cea779bd3c0a63b
dataset_name: CORA
num_of_epochs: 10000
test_acc: 0.822
num_of_layers: 2
num_heads_per_layer: [8, 1]
num_features_per_layer: [1433, 8, 7]
add_skip_connection: False
bias: True
dropout: 0.6
layer_type: IMP3
*********************

Highest degree nodes = [1986 1701  306 1358]
Max attention weight = 0.012915871106088161 and min = 0.012394174002110958


/var/folders/f0/812mfv7x63vbytjs3yf4gxtc0000gn/T/ipykernel_16269/2448994618.py:6: DeprecationWarning: Please use `csr_matrix` from the `scipy.sparse` namespace, the `scipy.sparse.csr` namespace is deprecated.
  data = pickle.load(file)
</code></pre>
<p><img src="https://ptpimg.me/mv5zat.png" srcset="/img/loading.gif" lazyload alt="ËØ∑Ê∑ªÂä†ÂõæÁâáÊèèËø∞"><br><img src="https://ptpimg.me/855sl2.png" srcset="/img/loading.gif" lazyload alt="ËØ∑Ê∑ªÂä†ÂõæÁâáÊèèËø∞"><br><img src="https://ptpimg.me/kk5k1q.png" srcset="/img/loading.gif" lazyload alt="ËØ∑Ê∑ªÂä†ÂõæÁâáÊèèËø∞"><br><img src="https://ptpimg.me/02bw9r.png" srcset="/img/loading.gif" lazyload alt="ËØ∑Ê∑ªÂä†ÂõæÁâáÊèèËø∞"><br><img src="https://ptpimg.me/8c77s3.png" srcset="/img/loading.gif" lazyload alt="ËØ∑Ê∑ªÂä†ÂõæÁâáÊèèËø∞"><br><img src="https://ptpimg.me/6pt7d4.png" srcset="/img/loading.gif" lazyload alt="ËØ∑Ê∑ªÂä†ÂõæÁâáÊèèËø∞"><br><img src="https://ptpimg.me/6q14cf.png" srcset="/img/loading.gif" lazyload alt="ËØ∑Ê∑ªÂä†ÂõæÁâáÊèèËø∞"><br><img src="https://ptpimg.me/vdku0v.png" srcset="/img/loading.gif" lazyload alt="ËØ∑Ê∑ªÂä†ÂõæÁâáÊèèËø∞"></p>
<p>ÁûßÔºåÊµÖËìùËâ≤Áõ¥ÊñπÂõæÔºàÁªèËøáËÆ≠ÁªÉÁöÑ GATÔºâ‰∏éÊ©ôËâ≤Áõ¥ÊñπÂõæÔºàÁªü‰∏ÄÊ≥®ÊÑèÂäõ GATÔºâÂÆåÂÖ®ÂåπÈÖç„ÄÇ</p>
<p>Â¶ÇÊûú‰πãÂâçÁªòÂà∂ÁöÑËæπÁöÑÂéöÂ∫¶ÂèØËßÜÂåñ‰∏çËÉΩËÆ©ÊÇ®‰ø°ÊúçÔºåÊàëÁõ∏‰ø°ÁÜµÂèØ‰ª•ÔºÅ</p>
<p>ËøôÁßçÂèØËßÜÂåñÁöÑÊÉ≥Ê≥ïÊù•Ëá™Petar Veliƒçkoviƒá ÂêëÊàëÊé®ËçêÁöÑ<a target="_blank" rel="noopener" href="https://www.dgl.ai/blog/2019/02/17/gat.html">ËøôÁØáÂçöÂÆ¢ÊñáÁ´†</a>„ÄÇ</p>
<hr>
<p>Âî∑ÔºÅÔºÅÔºÅÂÆåÊàê‰∫ÜÔºÅÂ¶ÇÊûú‰Ω†‰∏ÄÁõ¥Èô™ÊàëÂà∞ËøôÈáåÔºåÊÅ≠Âñú‰Ω†ÔºÅÔºàÊàêÂ∞±Â∑≤Ëß£ÈîÅ - GATÂ§ßÂ∏àüòçÔºâ</p>
<p>Âª∫ËÆÆËä±ÁÇπÊó∂Èó¥ÂàÜÊûê‰∏Ä‰∏ãËøôÁØáÂçöÂÆ¢„ÄÇËøô‰∏çÊòØ‰∏Ä‰∏™Áé©ÂÖ∑È°πÁõÆÔºå‰ΩúËÄÖËä±‰∫ÜÂ§ßÁ∫¶ 3 Âë®ÁöÑÊó∂Èó¥ÊâçÂÆåÊàêÔºåÊâÄ‰ª•‰∏çË¶ÅÊåáÊúõÂú® 30 ÂàÜÈíüÂÜÖÁêÜËß£ÊâÄÊúâÂÜÖÂÆπÔºåÈô§ÈùûÊÇ®ÁúüÁöÑÁÜüÊÇâËøôÈáåÊèêÂà∞ÁöÑÂ§ßÂ§öÊï∞Ê¶ÇÂøµ„ÄÇ</p>

                
              </div>
            
            <hr/>
            <div>
              <div class="post-metas my-3">
  
  
</div>


              
  

  <div class="license-box my-3">
    <div class="license-title">
      <div>GATÊïôÁ®ã</div>
      <div>https://gawain12.github.io/2023/11/01/GAT&#39;s Toturial/</div>
    </div>
    <div class="license-meta">
      
        <div class="license-meta-item">
          <div>‰ΩúËÄÖ</div>
          <div>Gawain</div>
        </div>
      
      
        <div class="license-meta-item license-meta-date">
          <div>ÂèëÂ∏É‰∫é</div>
          <div>2023Âπ¥11Êúà1Êó•</div>
        </div>
      
      
      
        <div class="license-meta-item">
          <div>ËÆ∏ÂèØÂçèËÆÆ</div>
          <div>
            
              
              
                <a class="print-no-link" target="_blank" href="https://creativecommons.org/licenses/by/4.0/">
                  <span class="hint--top hint--rounded" aria-label="BY - ÁΩ≤Âêç">
                    <i class="iconfont icon-cc-by"></i>
                  </span>
                </a>
              
            
          </div>
        </div>
      
    </div>
    <div class="license-icon iconfont"></div>
  </div>



              
                <div class="post-prevnext my-3">
                  <article class="post-prev col-6">
                    
                    
                      <a href="/2024/09/11/Rag/" title="RAG ÊäÄÊúØÊ¶ÇË¶Å">
                        <i class="iconfont icon-arrowleft"></i>
                        <span class="hidden-mobile">RAG ÊäÄÊúØÊ¶ÇË¶Å</span>
                        <span class="visible-mobile">‰∏ä‰∏ÄÁØá</span>
                      </a>
                    
                  </article>
                  <article class="post-next col-6">
                    
                    
                      <a href="/2022/11/07/StanfordCars/" title="ÊñØÂù¶Á¶èÊ±ΩËΩ¶ËØÜÂà´">
                        <span class="hidden-mobile">ÊñØÂù¶Á¶èÊ±ΩËΩ¶ËØÜÂà´</span>
                        <span class="visible-mobile">‰∏ã‰∏ÄÁØá</span>
                        <i class="iconfont icon-arrowright"></i>
                      </a>
                    
                  </article>
                </div>
              
            </div>

            
  
  
    <article id="comments" lazyload>
      
  <script type="text/javascript">
    Fluid.utils.loadComments('#comments', function() {
      var light = 'github-light';
      var dark = 'github-dark';
      var schema = document.documentElement.getAttribute('data-user-color-scheme');
      if (schema === 'dark') {
        schema = dark;
      } else {
        schema = light;
      }
      window.UtterancesThemeLight = light;
      window.UtterancesThemeDark = dark;
      var s = document.createElement('script');
      s.setAttribute('src', 'https://utteranc.es/client.js');
      s.setAttribute('repo', 'Gawain12/comment-utterances');
      s.setAttribute('issue-term', 'pathname');
      
      s.setAttribute('label', 'utterances');
      
      s.setAttribute('theme', schema);
      s.setAttribute('crossorigin', 'anonymous');
      document.getElementById('comments').appendChild(s);
    })
  </script>
  <noscript>Please enable JavaScript to view the comments</noscript>


    </article>
  


          </article>
        </div>
      </div>
    </div>

    <div class="side-col d-none d-lg-block col-lg-2">
      
  <aside class="sidebar" style="margin-left: -1rem">
    <div id="toc">
  <p class="toc-header">
    <i class="iconfont icon-list"></i>
    <span>ÁõÆÂΩï</span>
  </p>
  <div class="toc-body" id="toc-body"></div>
</div>



  </aside>


    </div>
  </div>
</div>





  



  



  



  



  







    

    
      <a id="scroll-top-button" aria-label="TOP" href="#" role="button">
        <i class="iconfont icon-arrowup" aria-hidden="true"></i>
      </a>
    

    
      <div class="modal fade" id="modalSearch" tabindex="-1" role="dialog" aria-labelledby="ModalLabel"
     aria-hidden="true">
  <div class="modal-dialog modal-dialog-scrollable modal-lg" role="document">
    <div class="modal-content">
      <div class="modal-header text-center">
        <h4 class="modal-title w-100 font-weight-bold">ÊêúÁ¥¢</h4>
        <button type="button" id="local-search-close" class="close" data-dismiss="modal" aria-label="Close">
          <span aria-hidden="true">&times;</span>
        </button>
      </div>
      <div class="modal-body mx-3">
        <div class="md-form mb-5">
          <input type="text" id="local-search-input" class="form-control validate">
          <label data-error="x" data-success="v" for="local-search-input">ÂÖ≥ÈîÆËØç</label>
        </div>
        <div class="list-group" id="local-search-result"></div>
      </div>
    </div>
  </div>
</div>

    

    
  </main>

  <footer>
    <div class="footer-inner">
  
    <div class="footer-content">
       <a href="https://hexo.io" target="_blank" rel="nofollow noopener"><span>Hexo</span></a> <i class="iconfont icon-love"></i> <a href="https://github.com/fluid-dev/hexo-theme-fluid" target="_blank" rel="nofollow noopener"><span>Fluid</span></a> 
    </div>
  
  
  
</div>

  </footer>

  <!-- Scripts -->
  
  <script  src="https://lib.baomitu.com/nprogress/0.2.0/nprogress.min.js" ></script>
  <link  rel="stylesheet" href="https://lib.baomitu.com/nprogress/0.2.0/nprogress.min.css" />

  <script>
    NProgress.configure({"showSpinner":false,"trickleSpeed":100})
    NProgress.start()
    window.addEventListener('load', function() {
      NProgress.done();
    })
  </script>


<script  src="https://lib.baomitu.com/jquery/3.6.4/jquery.min.js" ></script>
<script  src="https://lib.baomitu.com/twitter-bootstrap/4.6.1/js/bootstrap.min.js" ></script>
<script  src="/js/events.js" ></script>
<script  src="/js/plugins.js" ></script>


  <script  src="https://lib.baomitu.com/typed.js/2.0.12/typed.min.js" ></script>
  <script>
    (function (window, document) {
      var typing = Fluid.plugins.typing;
      var subtitle = document.getElementById('subtitle');
      if (!subtitle || !typing) {
        return;
      }
      var text = subtitle.getAttribute('data-typed-text');
      
        typing(text);
      
    })(window, document);
  </script>




  
    <script  src="/js/img-lazyload.js" ></script>
  




  
<script>
  Fluid.utils.createScript('https://lib.baomitu.com/tocbot/4.20.1/tocbot.min.js', function() {
    var toc = jQuery('#toc');
    if (toc.length === 0 || !window.tocbot) { return; }
    var boardCtn = jQuery('#board-ctn');
    var boardTop = boardCtn.offset().top;

    window.tocbot.init(Object.assign({
      tocSelector     : '#toc-body',
      contentSelector : '.markdown-body',
      linkClass       : 'tocbot-link',
      activeLinkClass : 'tocbot-active-link',
      listClass       : 'tocbot-list',
      isCollapsedClass: 'tocbot-is-collapsed',
      collapsibleClass: 'tocbot-is-collapsible',
      scrollSmooth    : true,
      includeTitleTags: true,
      headingsOffset  : -boardTop,
    }, CONFIG.toc));
    if (toc.find('.toc-list-item').length > 0) {
      toc.css('visibility', 'visible');
    }

    Fluid.events.registerRefreshCallback(function() {
      if ('tocbot' in window) {
        tocbot.refresh();
        var toc = jQuery('#toc');
        if (toc.length === 0 || !tocbot) {
          return;
        }
        if (toc.find('.toc-list-item').length > 0) {
          toc.css('visibility', 'visible');
        }
      }
    });
  });
</script>


  <script src=https://lib.baomitu.com/clipboard.js/2.0.11/clipboard.min.js></script>

  <script>Fluid.plugins.codeWidget();</script>


  
<script>
  Fluid.utils.createScript('https://lib.baomitu.com/anchor-js/5.0.0/anchor.min.js', function() {
    window.anchors.options = {
      placement: CONFIG.anchorjs.placement,
      visible  : CONFIG.anchorjs.visible
    };
    if (CONFIG.anchorjs.icon) {
      window.anchors.options.icon = CONFIG.anchorjs.icon;
    }
    var el = (CONFIG.anchorjs.element || 'h1,h2,h3,h4,h5,h6').split(',');
    var res = [];
    for (var item of el) {
      res.push('.markdown-body > ' + item.trim());
    }
    if (CONFIG.anchorjs.placement === 'left') {
      window.anchors.options.class = 'anchorjs-link-left';
    }
    window.anchors.add(res.join(', '));

    Fluid.events.registerRefreshCallback(function() {
      if ('anchors' in window) {
        anchors.removeAll();
        var el = (CONFIG.anchorjs.element || 'h1,h2,h3,h4,h5,h6').split(',');
        var res = [];
        for (var item of el) {
          res.push('.markdown-body > ' + item.trim());
        }
        if (CONFIG.anchorjs.placement === 'left') {
          anchors.options.class = 'anchorjs-link-left';
        }
        anchors.add(res.join(', '));
      }
    });
  });
</script>


  
<script>
  Fluid.utils.createScript('https://lib.baomitu.com/fancybox/3.5.7/jquery.fancybox.min.js', function() {
    Fluid.plugins.fancyBox();
  });
</script>


  <script>Fluid.plugins.imageCaption();</script>

  <script  src="/js/local-search.js" ></script>





<!-- ‰∏ªÈ¢òÁöÑÂêØÂä®È°πÔºåÂ∞ÜÂÆÉ‰øùÊåÅÂú®ÊúÄÂ∫ïÈÉ® -->
<!-- the boot of the theme, keep it at the bottom -->
<script  src="/js/boot.js" ></script>


  

  <noscript>
    <div class="noscript-warning">ÂçöÂÆ¢Âú®ÂÖÅËÆ∏ JavaScript ËøêË°åÁöÑÁéØÂ¢É‰∏ãÊµèËßàÊïàÊûúÊõ¥‰Ω≥</div>
  </noscript>
</body>
</html>
