<?xml version="1.0" encoding="utf-8"?>
<search>
  <entry>
    <title>DeepLearningTextCNN</title>
    <url>/2021/08/22/DeepLearningTextCNN/</url>
    <content><![CDATA[<h1 id="æ·±åº¦å­¦ä¹ ç®—æ³•èƒŒæ™¯"><a href="#æ·±åº¦å­¦ä¹ ç®—æ³•èƒŒæ™¯" class="headerlink" title="æ·±åº¦å­¦ä¹ ç®—æ³•èƒŒæ™¯"></a>æ·±åº¦å­¦ä¹ ç®—æ³•èƒŒæ™¯</h1><h2 id="äººå·¥æ™ºèƒ½å‘å±•å†å²"><a href="#äººå·¥æ™ºèƒ½å‘å±•å†å²" class="headerlink" title="äººå·¥æ™ºèƒ½å‘å±•å†å²"></a>äººå·¥æ™ºèƒ½å‘å±•å†å²</h2><p><img src="https://ptpimg.me/r97b26.jpg" alt="äººå·¥æ™ºèƒ½çš„å‘å±•å†å²"><br>éšç€ç®—åŠ›æé«˜ä»¥åŠæ·±åº¦å­¦ä¹ çš„åº”ç”¨ï¼Œè¿‘å‡ å¹´ç®—æ³•å‘å±•å¾ˆå¿«</p>
<h2 id="åº”ç”¨åœºæ™¯"><a href="#åº”ç”¨åœºæ™¯" class="headerlink" title="åº”ç”¨åœºæ™¯"></a>åº”ç”¨åœºæ™¯</h2><ul>
<li><strong>è®¡ç®—æœºè§†è§‰</strong> ç”¨äºè½¦ç‰Œè¯†åˆ«å’Œé¢éƒ¨è¯†åˆ«ç­‰çš„åº”ç”¨ã€‚</li>
<li><strong>ä¿¡æ¯æ£€ç´¢</strong> ç”¨äºè¯¸å¦‚æœç´¢å¼•æ“çš„åº”ç”¨ - åŒ…æ‹¬æ–‡æœ¬æœç´¢å’Œå›¾åƒæœç´¢ã€‚</li>
<li><strong>å¸‚åœºè¥é”€</strong> é’ˆå¯¹è‡ªåŠ¨ç”µå­é‚®ä»¶è¥é”€å’Œç›®æ ‡ç¾¤ä½“è¯†åˆ«ç­‰çš„åº”ç”¨ã€‚</li>
<li><strong>åŒ»ç–—è¯Šæ–­</strong> è¯¸å¦‚ç™Œç—‡è¯†åˆ«å’Œå¼‚å¸¸æ£€æµ‹ç­‰çš„åº”ç”¨ã€‚</li>
<li><strong>è‡ªç„¶è¯­è¨€å¤„ç†</strong> å¦‚æƒ…ç»ªåˆ†æå’Œç…§ç‰‡æ ‡è®°æ ‡é¢˜å½’ç±»ç­‰çš„åº”ç”¨ã€‚</li>
</ul>
<h2 id="æœºå™¨å­¦ä¹ å’Œæ·±åº¦å­¦ä¹ å…³ç³»ä¸åŒºåˆ«"><a href="#æœºå™¨å­¦ä¹ å’Œæ·±åº¦å­¦ä¹ å…³ç³»ä¸åŒºåˆ«" class="headerlink" title="æœºå™¨å­¦ä¹ å’Œæ·±åº¦å­¦ä¹ å…³ç³»ä¸åŒºåˆ«"></a>æœºå™¨å­¦ä¹ å’Œæ·±åº¦å­¦ä¹ å…³ç³»ä¸åŒºåˆ«</h2><h4 id="å…³ç³»"><a href="#å…³ç³»" class="headerlink" title="å…³ç³»"></a>å…³ç³»</h4><p>æ·±åº¦å­¦ä¹ å®šä¹‰ï¼šæ·±åº¦å­¦ä¹ æ˜¯ä¸€ç§ç‰¹æ®Šçš„æœºå™¨å­¦ä¹ ï¼Œé€šè¿‡å­¦ä¹ å°†ä¸–ç•Œä½¿ç”¨åµŒå¥—çš„æ¦‚å¿µå±‚æ¬¡æ¥è¡¨ç¤ºå¹¶å®ç°å·¨å¤§çš„åŠŸèƒ½å’Œçµæ´»æ€§ï¼Œå…¶ä¸­æ¯ä¸ªæ¦‚å¿µéƒ½å®šä¹‰ä¸ºä¸ç®€å•æ¦‚å¿µç›¸å…³è”ï¼Œè€Œæ›´ä¸ºæŠ½è±¡çš„è¡¨ç¤ºåˆ™ä»¥è¾ƒä¸æŠ½è±¡çš„æ–¹å¼æ¥è®¡ç®—ã€‚</p>
<h4 id="åŒºåˆ«"><a href="#åŒºåˆ«" class="headerlink" title="åŒºåˆ«"></a>åŒºåˆ«</h4><p>æ·±åº¦å­¦ä¹ å¯¹æ¯”å¸¸è§„çš„çš„æœºå™¨å­¦ä¹ æ¥è¯´ï¼Œå®ƒéœ€è¦è®­ç»ƒçš„æ•°æ®æ›´å¤šï¼Œè€Œä¸”å‚æ•°å¯ä»¥è‡ªåŠ¨è°ƒèŠ‚ï¼Œæœºå™¨å­¦ä¹ é€šå¸¸cpuä¹Ÿèƒ½è®­ç»ƒï¼Œä½†æ˜¯æ·±åº¦å­¦ä¹ éœ€è¦æ˜¾å¡è®­ç»ƒ</p>
<h1 id="TextCNNç®—æ³•åŸç†"><a href="#TextCNNç®—æ³•åŸç†" class="headerlink" title="TextCNNç®—æ³•åŸç†"></a>TextCNNç®—æ³•åŸç†</h1><p>è‹¥æœ‰å…´è¶£å¯ä»¥çœ‹è¿™ç¯‡æ–‡ç« ï¼š<a href="http://www.wildml.com/2015/11/understanding-convolutional-neural-networks-for-nlp/"><em>Understanding Convolutional Neural Networks for NLP</em></a></p>
<p>Yoon Kimäº2014å¹´å‘è¡¨è®ºæ–‡<a href="https://arxiv.org/pdf/1408.5882.pdf"><em>Convolutional Neural Networks for Sentence Classification</em></a>å°†CNNç¬¬ä¸€æ¬¡å¼•å…¥NLPï¼ˆè‡ªç„¶è¯­è¨€å¤„ç†ï¼‰çš„åº”ç”¨ï¼Œæ­¤å‰CNNå‡ ä¹éƒ½æ˜¯åº”ç”¨äºå›¾åƒè¯†åˆ«é¢†åŸŸã€‚</p>
<h2 id="CNN"><a href="#CNN" class="headerlink" title="CNN"></a>CNN</h2><p>CNNå…¨ç§° Convolutional Neural Networks ï¼Œå·ç§¯ç¥ç»ç½‘ç»œï¼Œæ­£å¦‚ä»–çš„åå­—ä»–çš„çµæ„Ÿæ¥æºæ˜¯äººçš„ç¥ç»ç»“æ„ï¼Œæœ€å…ˆç”±ç§‘å­¦å®¶æ¨ç«‹æ˜†(Yann Lee Cun)æå‡ºï¼Œ</p>
<p>ä½•è°“å·ç§¯ï¼Œå°±æ˜¯åˆ©ç”¨ä¸€ç§æ•°å­¦æ–¹æ³•æå–ä¿¡æ¯çš„ç‰¹å¾ã€‚å¯¹äºå›¾ç‰‡ç”¨çŸ©é˜µå¯ä»¥å¾ˆå¥½æè¿°åƒç´ ç‚¹çš„åˆ†å¸ƒç‰¹å¾ï¼Œ<br><img src="https://ptpimg.me/739919.gif" alt="åœ¨è¿™é‡Œæ’å…¥å›¾ç‰‡æè¿°"><br>åŠ¨å›¾ç†è§£å·ç§¯è¿ç®—çš„è¿‡ç¨‹ï¼Œ</p>
<h2 id="TextCNNç»“æ„"><a href="#TextCNNç»“æ„" class="headerlink" title="TextCNNç»“æ„"></a>TextCNNç»“æ„</h2><p><img src="https://ptpimg.me/533622.png" alt="åœ¨è¿™é‡Œæ’å…¥å›¾ç‰‡æè¿°"></p>
<h3 id="åµŒå…¥å±‚-embedding-layer"><a href="#åµŒå…¥å±‚-embedding-layer" class="headerlink" title="åµŒå…¥å±‚(embedding layer)"></a>åµŒå…¥å±‚(embedding layer)</h3><p><strong>TextCNN</strong>ä½¿ç”¨é¢„å…ˆè®­ç»ƒå¥½çš„è¯å‘é‡ä½œembedding layerã€‚å¯¹äºæ•°æ®é›†é‡Œçš„æ‰€æœ‰è¯ï¼Œå› ä¸ºæ¯ä¸ªè¯éƒ½å¯ä»¥è¡¨å¾æˆä¸€ä¸ªå‘é‡ï¼Œå› æ­¤æˆ‘ä»¬å¯ä»¥å¾—åˆ°ä¸€ä¸ªåµŒå…¥çŸ©é˜µMM, MMé‡Œçš„æ¯ä¸€è¡Œéƒ½æ˜¯è¯å‘é‡ã€‚è¿™ä¸ªMMå¯ä»¥æ˜¯é™æ€(static)çš„ï¼Œä¹Ÿå°±æ˜¯å›ºå®šä¸å˜ã€‚å¯ä»¥æ˜¯éé™æ€(non-static)çš„ï¼Œä¹Ÿå°±æ˜¯å¯ä»¥æ ¹æ®åå‘ä¼ æ’­æ›´æ–°ã€‚<br>å¤šç§æ¨¡å‹ï¼šConvolutional Neural Networks for Sentence Classificationæ–‡ç« ä¸­ç»™å‡ºäº†å‡ ç§æ¨¡å‹ï¼Œå…¶å®è¿™é‡ŒåŸºæœ¬éƒ½æ˜¯é’ˆå¯¹Embedding layeråšçš„å˜åŒ–ã€‚<strong>CNN-randã€CNN-staticã€CNN-non-staticã€CNN-multichannel</strong><br>å…·ä½“ä»‹ç»åŠå®éªŒç»“æœå¯è§åŸè®ºæ–‡ï¼Œä»¥ä¸Šæ˜¯å­¦æœ¯å®šä¹‰</p>
<p>æˆ‘ä¸ªäººç†è§£æ˜¯ï¼š<br>æ–‡å­—æ— æ³•è¢«ç›´æ¥è¢«è®¡ç®—æœºè¯†åˆ«ï¼Œéœ€è¦ç¼–ç ï¼Œå°†å…¶æ˜ å°„ä¸º2ç»´çš„çŸ©é˜µ</p>
<h3 id="å·ç§¯æ± åŒ–å±‚-convolution-and-pooling"><a href="#å·ç§¯æ± åŒ–å±‚-convolution-and-pooling" class="headerlink" title="å·ç§¯æ± åŒ–å±‚(convolution and pooling)"></a>å·ç§¯æ± åŒ–å±‚(convolution and pooling)</h3><h4 id="å·ç§¯-convolution"><a href="#å·ç§¯-convolution" class="headerlink" title="å·ç§¯(convolution)"></a>å·ç§¯(convolution)</h4><p>è¾“å…¥ä¸€ä¸ªå¥å­ï¼Œé¦–å…ˆå¯¹è¿™ä¸ªå¥å­è¿›è¡Œåˆ‡è¯ï¼Œå‡è®¾æœ‰sä¸ªå•è¯ã€‚å¯¹æ¯ä¸ªè¯ï¼Œè·Ÿå¥åµŒå…¥çŸ©é˜µM, å¯ä»¥å¾—åˆ°è¯å‘é‡ã€‚å‡è®¾è¯å‘é‡ä¸€å…±æœ‰dç»´ã€‚é‚£ä¹ˆå¯¹äºè¿™ä¸ªå¥å­ï¼Œä¾¿å¯ä»¥å¾—åˆ°sè¡Œdåˆ—çš„çŸ©é˜µAÏµRsÃ—d.<br>æˆ‘ä»¬å¯ä»¥æŠŠçŸ©é˜µAçœ‹æˆæ˜¯ä¸€å¹…å›¾åƒï¼Œä½¿ç”¨å·ç§¯ç¥ç»ç½‘ç»œå»æå–ç‰¹å¾ã€‚ç”±äºå¥å­ä¸­ç›¸é‚»çš„å•è¯å…³è”æ€§æ€»æ˜¯å¾ˆé«˜çš„ï¼Œå› æ­¤å¯ä»¥ä½¿ç”¨ä¸€ç»´å·ç§¯ï¼Œå³æ–‡æœ¬å·ç§¯ä¸å›¾åƒå·ç§¯çš„ä¸åŒä¹‹å¤„åœ¨äºåªåœ¨æ–‡æœ¬åºåˆ—çš„ä¸€ä¸ªæ–¹å‘ï¼ˆå‚ç›´ï¼‰åšå·ç§¯ï¼Œå·ç§¯æ ¸çš„å®½åº¦å›ºå®šä¸ºè¯å‘é‡çš„ç»´åº¦dã€‚é«˜åº¦æ˜¯è¶…å‚æ•°ï¼Œå¯ä»¥è®¾ç½®ã€‚ å¯¹å¥å­å•è¯æ¯ä¸ªå¯èƒ½çš„çª—å£åšå·ç§¯æ“ä½œå¾—åˆ°ç‰¹å¾å›¾(feature map) c &#x3D; [c_1, c_2, â€¦, c_s-h+1]ã€‚</p>
<p>ç°åœ¨å‡è®¾æœ‰ä¸€ä¸ªå·ç§¯æ ¸ï¼Œæ˜¯å®½åº¦ä¸ºdï¼Œé«˜åº¦ä¸ºhçš„çŸ©é˜µwï¼Œé‚£ä¹ˆwæœ‰hâˆ—dä¸ªå‚æ•°éœ€è¦è¢«æ›´æ–°ã€‚å¯¹äºä¸€ä¸ªå¥å­ï¼Œç»è¿‡åµŒå…¥å±‚ä¹‹åå¯ä»¥å¾—åˆ°çŸ©é˜µAÏµRsÃ—dã€‚ A[i:j]è¡¨ç¤ºAçš„ç¬¬iè¡Œåˆ°ç¬¬jè¡Œ, é‚£ä¹ˆå·ç§¯æ“ä½œå¯ä»¥ç”¨å…¬å¼è¡¨ç¤ºï¼šo<del>i</del> &#x3D; w Â· A[i : i + h âˆ’ 1] , i &#x3D; 1 . . . s âˆ’ h + 1<br>å åŠ ä¸Šåç½®b,åœ¨ä½¿ç”¨æ¿€æ´»å‡½æ•°fæ¿€æ´», å¾—åˆ°æ‰€éœ€çš„ç‰¹å¾ã€‚å…¬å¼å¦‚ä¸‹ï¼šc<del>i</del> &#x3D; f(o<del>i</del> + b). </p>
<p>å¯¹ä¸€ä¸ªå·ç§¯æ ¸ï¼Œå¯ä»¥å¾—åˆ°ç‰¹å¾cÏµRsâˆ’h+1, æ€»å…±sâˆ’h+1ä¸ªç‰¹å¾ã€‚æˆ‘ä»¬å¯ä»¥ä½¿ç”¨æ›´å¤šé«˜hä¸åŒçš„å·ç§¯æ ¸ï¼Œå¾—åˆ°æ›´ä¸°å¯Œçš„ç‰¹å¾è¡¨è¾¾ã€‚</p>
<p>Note: </p>
<ol>
<li><p>TextCNNç½‘ç»œåŒ…æ‹¬å¾ˆå¤šä¸åŒçª—å£å¤§å°çš„å·ç§¯æ ¸ï¼Œå¸¸ç”¨çš„filter size âˆˆ {3,4,5}ï¼Œæ¯ä¸ªfilterçš„feature maps&#x3D;100ã€‚è¿™é‡Œçš„ç‰¹å¾å›¾å°±æ˜¯ä¸åŒçš„kå…ƒè¯­æ³•ã€‚å¦‚ä¸Šå›¾ä¸­åˆ†åˆ«æœ‰ä¸¤ä¸ªä¸åŒçš„äºŒã€ä¸‰å’Œå››å…ƒè¯­æ³•ã€‚<br>å¦‚æœè®¾ç½®padding&#x3D;â€™sameâ€™å³ä½¿ç”¨å®½å·ç§¯ï¼Œåˆ™æ¯ä¸ªfeature maps for each region sizeéƒ½æ˜¯seq_len<em>1ï¼Œæ‰€æœ‰çš„feature mapå¯ä»¥æ‹¼æ¥æˆseq_len</em>(num_filters*num_filter_size)çš„çŸ©é˜µï¼Œå›åˆ°è¾“å…¥ç±»ä¼¼ç»´åº¦ï¼Œè¿™æ ·å°±å¯ä»¥ä½¿ç”¨å¤šå±‚cnnäº†ã€‚</p>
</li>
<li><p>é€šé“ï¼ˆChannelsï¼‰ï¼šå›¾åƒä¸­å¯ä»¥åˆ©ç”¨ (R, G, B) ä½œä¸ºä¸åŒchannelã€‚è€Œæ–‡æœ¬çš„è¾“å…¥çš„channelé€šå¸¸æ˜¯ä¸åŒæ–¹å¼çš„embeddingæ–¹å¼ï¼ˆæ¯”å¦‚ word2vecæˆ–Gloveï¼‰ï¼Œå®è·µä¸­ä¹Ÿæœ‰åˆ©ç”¨é™æ€è¯å‘é‡å’Œfine-tunningè¯å‘é‡ä½œä¸ºä¸åŒchannelçš„åšæ³•ï¼›channelä¹Ÿå¯ä»¥ä¸€ä¸ªæ˜¯è¯åºåˆ—ï¼Œå¦ä¸€ä¸ªchannelæ˜¯å¯¹åº”çš„è¯æ€§åºåˆ—ã€‚æ¥ä¸‹æ¥å°±å¯ä»¥é€šè¿‡åŠ å’Œæˆ–è€…æ‹¼æ¥è¿›è¡Œç»“åˆã€‚</p>
</li>
</ol>
<h3 id="æ± åŒ–-pooling"><a href="#æ± åŒ–-pooling" class="headerlink" title="æ± åŒ–(pooling)"></a>æ± åŒ–(pooling)</h3><p>ä¸åŒå°ºå¯¸çš„å·ç§¯æ ¸å¾—åˆ°çš„ç‰¹å¾(feature map)å¤§å°ä¹Ÿæ˜¯ä¸ä¸€æ ·çš„ï¼Œå› æ­¤æˆ‘ä»¬å¯¹æ¯ä¸ªfeature mapä½¿ç”¨æ± åŒ–å‡½æ•°ï¼Œä½¿å®ƒä»¬çš„ç»´åº¦ç›¸åŒã€‚</p>
<h5 id="Max-Pooling"><a href="#Max-Pooling" class="headerlink" title="Max Pooling"></a>Max Pooling</h5><p>æœ€å¸¸ç”¨çš„å°±æ˜¯1-max poolingï¼Œæå–å‡ºfeature mapç…§ç‰‡é‚£ä¸ªçš„æœ€å¤§å€¼ï¼Œé€šè¿‡é€‰æ‹©æ¯ä¸ªfeature mapçš„æœ€å¤§å€¼ï¼Œå¯æ•è·å…¶æœ€é‡è¦çš„ç‰¹å¾ã€‚è¿™æ ·æ¯ä¸€ä¸ªå·ç§¯æ ¸å¾—åˆ°ç‰¹å¾å°±æ˜¯ä¸€ä¸ªå€¼ï¼Œå¯¹æ‰€æœ‰å·ç§¯æ ¸ä½¿ç”¨1-max poolingï¼Œå†çº§è”èµ·æ¥ï¼Œå¯ä»¥å¾—åˆ°æœ€ç»ˆçš„ç‰¹å¾å‘é‡ï¼Œè¿™ä¸ªç‰¹å¾å‘é‡å†è¾“å…¥softmax layeråšåˆ†ç±»ã€‚è¿™ä¸ªåœ°æ–¹å¯ä»¥ä½¿ç”¨drop outé˜²æ­¢è¿‡æ‹Ÿåˆã€‚</p>
<h5 id="Average-Pooling"><a href="#Average-Pooling" class="headerlink" title="Average Pooling"></a>Average Pooling</h5><p>average poolingå³å–æ¯ä¸ªç»´åº¦çš„å‡å€¼è€Œä¸æ˜¯æœ€å¤§å€¼ã€‚ç†è§£æ˜¯å¯¹å¥å­ä¸­çš„è¿ç»­è¯è¢‹(CBOW)è€Œä¸æ˜¯è¯è¿›è¡Œå·ç§¯å¾—åˆ°çš„è¡¨ç¤ºï¼ˆlzï¼šæ¯ä¸ªfilteréƒ½æ˜¯å¯¹cbowæ¥çš„ï¼‰ã€‚<br>å…¶ä»–æ± åŒ–æ–¹å¼K-Max Poolingã€åŠ¨æ€k-max poolingå¯è§è®ºæ–‡<a href="https://www.cnblogs.com/szxspark/p/10262681.html">ã€ŠEvent Extraction via Dynamic Multi-Pooling Convolutional Neural Networkã€‹</a>[2]</p>
<h3 id="ç®€å•æ¨¡å‹ç»“æ„çš„ç¤ºä¾‹åˆ†æ"><a href="#ç®€å•æ¨¡å‹ç»“æ„çš„ç¤ºä¾‹åˆ†æ" class="headerlink" title="ç®€å•æ¨¡å‹ç»“æ„çš„ç¤ºä¾‹åˆ†æ"></a>ç®€å•æ¨¡å‹ç»“æ„çš„ç¤ºä¾‹åˆ†æ</h3><p>åˆ†æ<a href="http://link.zhihu.com/?target=https://arxiv.org/pdf/1510.03820.pdf">ã€ŠA Sensitivity Analysis â€¦ã€‹</a>[2]æ¨¡å‹ç¤ºæ„å›¾ï¼š</p>
<p><img src="https://ptpimg.me/q61c16.png" alt="åœ¨è¿™é‡Œæ’å…¥å›¾ç‰‡æè¿°"></p>
<p>word embeddingçš„ç»´åº¦æ˜¯5ï¼Œå¯¹äºå¥å­ i like this movie very muchï¼Œè½¬æ¢æˆçŸ©é˜µAÏµR7Ã—5ï¼›<br>æœ‰6ä¸ªå·ç§¯æ ¸ï¼Œå°ºå¯¸ä¸º(2Ã—5), (3Ã—5), (4Ã—5)ï¼Œæ¯ç§å°ºå¯¸å„2ä¸ªï¼ŒAåˆ†åˆ«ä¸ä»¥ä¸Šå·ç§¯æ ¸è¿›è¡Œå·ç§¯æ“ä½œï¼ˆè¿™é‡Œçš„Stride Sizeç›¸å½“äºç­‰äºé«˜åº¦hï¼‰ï¼›</p>
<p>å†ç”¨æ¿€æ´»å‡½æ•°æ¿€æ´»ï¼Œæ¯ä¸ªå·ç§¯æ ¸å¾—åˆ°äº†ç‰¹å¾å‘é‡(feature maps)ï¼›<br>ä½¿ç”¨1-max poolingæå–å‡ºæ¯ä¸ªfeature mapçš„æœ€å¤§å€¼ï¼›</p>
<p>ç„¶ååœ¨çº§è”å¾—åˆ°æœ€ç»ˆçš„ç‰¹å¾è¡¨è¾¾ï¼›<br>å°†ç‰¹å¾è¾“å…¥è‡³softmax layerè¿›è¡Œåˆ†ç±», åœ¨è¿™å±‚å¯ä»¥è¿›è¡Œæ­£åˆ™åŒ–æ“ä½œ( l2-regulariation)ã€‚</p>
<h2 id="å®éªŒå‚æ•°åˆ†æ"><a href="#å®éªŒå‚æ•°åˆ†æ" class="headerlink" title="å®éªŒå‚æ•°åˆ†æ"></a>å®éªŒå‚æ•°åˆ†æ</h2><p>TextCNNæ¨¡å‹ä¸­ï¼Œè¶…å‚æ•°ä¸»è¦æœ‰è¯å‘é‡ï¼ŒRegion Sizeçš„å¤§å°ï¼ŒFeature Mapçš„æ•°é‡ï¼Œæ¿€æ´»å‡½æ•°çš„é€‰æ‹©ï¼ŒPoolingçš„æ–¹æ³•ï¼Œæ­£åˆ™åŒ–çš„å½±å“ã€‚ã€ŠA Sensitivity Analysisâ€¦ã€‹è®ºæ–‡å‰é¢å‡ ç« å¯¹å®éªŒå†…å®¹å’Œç»“æœè¿›è¡Œäº†è¯¦ç»†ä»‹ç»ï¼Œåœ¨9ä¸ªæ•°æ®é›†ä¸ŠåŸºäºKim Yçš„æ¨¡å‹åšäº†å¤§é‡çš„è°ƒå‚å®éªŒï¼Œå¾—å‡ºAUCè¿›è¡Œæ¯”è¾ƒï¼Œæ ¹æ®çš„å®éªŒå¯¹æ¯”ï¼š</p>
<p>1ï¼‰<strong>åˆå§‹åŒ–è¯å‘é‡</strong>ï¼šä¸€èˆ¬ä¸ç›´æ¥ä½¿ç”¨One-hotã€‚é™¤äº†éšæœºåˆå§‹åŒ–Embedding layerçš„å¤–ï¼Œä½¿ç”¨é¢„è®­ç»ƒçš„word2vecã€ GloVeåˆå§‹åŒ–çš„æ•ˆæœéƒ½æ›´åŠ å¥½ï¼ˆå…·ä½“å“ªä¸ªæ›´å¥½ä¾èµ–äºä»»åŠ¡æœ¬èº«ï¼‰ã€‚éé™æ€çš„æ¯”é™æ€çš„æ•ˆæœå¥½ä¸€äº›ã€‚</p>
<p>2ï¼‰<strong>å·ç§¯æ ¸çš„å°ºå¯¸filter_sizes</strong>ï¼šå½±å“è¾ƒå¤§ï¼Œé€šå¸¸è¿‡æ»¤å™¨çš„å¤§å°èŒƒå›´åœ¨1-10ä¹‹é—´ï¼Œä¸€èˆ¬å–ä¸º3-5ï¼Œå¯¹äºå¥å­è¾ƒé•¿çš„æ–‡æœ¬ï¼ˆ100+ï¼‰ï¼Œåˆ™åº”é€‰æ‹©å¤§ä¸€äº›ã€‚ä¸ºäº†æ‰¾åˆ°æœ€ä¼˜çš„è¿‡æ»¤å™¨å¤§å°(Filter Region Size)ï¼Œå¯ä»¥ä½¿ç”¨çº¿æ€§æœç´¢çš„æ–¹æ³•ã€‚å¯¹ä¸åŒå°ºå¯¸wsçš„çª—å£è¿›è¡Œç»“åˆä¼šå¯¹ç»“æœäº§ç”Ÿå½±å“ã€‚å½“æŠŠä¸æœ€ä¼˜wsç›¸è¿‘çš„wsç»“åˆæ—¶ä¼šæå‡æ•ˆæœï¼Œä½†æ˜¯å¦‚æœå°†è·ç¦»æœ€ä¼˜wsè¾ƒè¿œçš„wsç›¸ç»“åˆæ—¶ä¼šæŸå®³åˆ†ç±»æ€§èƒ½ã€‚åˆšå¼€å§‹ï¼Œæˆ‘ä»¬å¯ä»¥åªç”¨ä¸€ä¸ªfilterï¼Œè°ƒèŠ‚Region Sizeæ¥æ¯”å¯¹å„è‡ªçš„æ•ˆæœï¼Œæ¥çœ‹çœ‹é‚£ç§sizeæœ‰æœ€å¥½çš„è¡¨ç°ï¼Œç„¶ååœ¨è¿™ä¸ªèŒƒå›´åœ¨è°ƒèŠ‚ä¸åŒRegionçš„åŒ¹é…ã€‚</p>
<p>3ï¼‰<strong>å·ç§¯æ ¸çš„æ•°é‡num_filtersï¼ˆå¯¹æ¯ä¸ªå·»ç§¯æ ¸å°ºå¯¸æ¥è¯´ï¼‰</strong>ï¼šæœ‰è¾ƒå¤§çš„å½±å“ï¼Œä¸€èˆ¬å–100<del>600ï¼ˆéœ€è¦å…¼é¡¾æ¨¡å‹çš„è®­ç»ƒæ•ˆç‡ï¼‰ ï¼ŒåŒæ—¶ä¸€èˆ¬ä½¿ç”¨Dropoutï¼ˆ0</del>0.5ï¼‰ã€‚æœ€å¥½ä¸è¦è¶…è¿‡600ï¼Œè¶…è¿‡600å¯èƒ½ä¼šå¯¼è‡´è¿‡æ‹Ÿåˆã€‚å¯è®¾ä¸º100-200ã€‚</p>
<p>4ï¼‰<strong>æ¿€æ´»å‡½æ•°</strong>ï¼šå¯ä»¥å°½é‡å¤šå°è¯•æ¿€æ´»å‡½æ•°ï¼Œå®éªŒå‘ç°ReLUå’Œtanhä¸¤ç§æ¿€æ´»å‡½æ•°è¡¨ç°è¾ƒä½³ã€‚</p>
<p>5ï¼‰<strong>æ± åŒ–é€‰æ‹©</strong>ï¼š1-max poolingï¼ˆ1-max poolingçš„æ–¹å¼å·²ç»è¶³å¤Ÿå¥½äº†ï¼Œç›¸æ¯”äºå…¶ä»–çš„poolingæ–¹å¼è€Œè¨€ï¼‰ã€‚</p>
<p>6ï¼‰<strong>Dropoutå’Œæ­£åˆ™åŒ–</strong>ï¼šDropout rate &#x2F; dropout_keep_probï¼šdropoutä¸€èˆ¬è®¾ä¸º0.5ã€‚éšç€feature mapæ•°é‡å¢åŠ ï¼Œæ€§èƒ½å‡å°‘æ—¶ï¼Œå¯ä»¥è€ƒè™‘å¢å¤§æ­£åˆ™åŒ–çš„åŠ›åº¦ï¼Œå¦‚å°è¯•å¤§äº0.5çš„Dropoutã€‚</p>
<p>   æ­£åˆ™åŒ–çš„ä½œç”¨å¾®ä¹å…¶å¾®ï¼Œæ­£åˆ™é¡¹å¯¹æœ€ç»ˆæ¨¡å‹æ€§èƒ½çš„å½±å“å¾ˆå°ã€‚l2æ­£åˆ™åŒ–æ•ˆç›Šå¾ˆå°ï¼Œæ‰€ä»¥è¿™é‡Œå»ºè®®è®¾ç½®ä¸€ä¸ªæ¯”è¾ƒå¤§çš„L2 norm constrainï¼Œç›¸æ¯”è€Œè¨€ï¼Œdropoutåœ¨ç¥ç»ç½‘ç»œä¸­æœ‰ç€å¹¿æ³›çš„ä½¿ç”¨å’Œå¾ˆå¥½çš„æ•ˆæœã€‚</p>
<p>7ï¼‰ä¸ºäº†æ£€éªŒæ¨¡å‹çš„æ€§èƒ½æ°´å¹³ï¼Œå¤šæ¬¡åå¤çš„äº¤å‰éªŒè¯æ˜¯å¿…è¦çš„ï¼Œè¿™å¯ä»¥ç¡®ä¿æ¨¡å‹çš„é«˜æ€§èƒ½å¹¶ä¸æ˜¯å¶ç„¶ã€‚</p>
<p>8ï¼‰ <strong>éšæœºæ€§å½±å“</strong>ï¼šç”±äºæ¨¡å‹è®­ç»ƒè¿‡ç¨‹ä¸­çš„éšæœºæ€§å› ç´ ï¼Œå¦‚éšæœºåˆå§‹åŒ–çš„æƒé‡å‚æ•°ï¼Œmini-batchï¼Œéšæœºæ¢¯åº¦ä¸‹é™ä¼˜åŒ–ç®—æ³•ç­‰ï¼Œé€ æˆæ¨¡å‹åœ¨æ•°æ®é›†ä¸Šçš„ç»“æœæœ‰ä¸€å®šçš„æµ®åŠ¨ï¼Œå¦‚å‡†ç¡®ç‡(accuracy)èƒ½è¾¾åˆ°1.5%çš„æµ®åŠ¨ï¼Œè€ŒAUCåˆ™æœ‰3.4%çš„æµ®åŠ¨ã€‚</p>
<p>å…¶å®ƒçš„è®­ç»ƒå‚æ•°ï¼šbatch_sizeï¼š64ï¼›num_epochsï¼š10ï¼›æ¯checkpoint_everyï¼š100è½®ä¾¿ä¿å­˜æ¨¡å‹ï¼›ä»…ä¿å­˜æœ€è¿‘num_checkpointsï¼š5æ¬¡æ¨¡å‹</p>
<h1 id="å®ç°æ–‡æœ¬åˆ†ç±»çš„è¿‡ç¨‹"><a href="#å®ç°æ–‡æœ¬åˆ†ç±»çš„è¿‡ç¨‹" class="headerlink" title="å®ç°æ–‡æœ¬åˆ†ç±»çš„è¿‡ç¨‹"></a>å®ç°æ–‡æœ¬åˆ†ç±»çš„è¿‡ç¨‹</h1><h2 id="Text-Classification-with-CNN"><a href="#Text-Classification-with-CNN" class="headerlink" title="Text Classification with CNN"></a>Text Classification with CNN</h2><p>ä½¿ç”¨å·ç§¯ç¥ç»ç½‘ç»œè¿›è¡Œä¸­æ–‡æ–‡æœ¬åˆ†ç±»</p>
<h2 id="è½¯ä»¶ç¯å¢ƒ"><a href="#è½¯ä»¶ç¯å¢ƒ" class="headerlink" title="è½¯ä»¶ç¯å¢ƒ"></a>è½¯ä»¶ç¯å¢ƒ</h2><ul>
<li>Python 3.6.8</li>
<li>TensorFlow 1.8.0</li>
<li>numpy</li>
<li>scikit-learn</li>
<li>scipy</li>
</ul>
<h2 id="ç¡¬ä»¶ç¯å¢ƒ"><a href="#ç¡¬ä»¶ç¯å¢ƒ" class="headerlink" title="ç¡¬ä»¶ç¯å¢ƒ"></a>ç¡¬ä»¶ç¯å¢ƒ</h2><ul>
<li>CPU:Ryzen 2500U(2.0GHZ)</li>
<li>Menmory: 16G</li>
<li><strong>æ³¨</strong>ï¼šè½»è–„æœ¬ä¸é€‚åˆè®­ç»ƒæ·±åº¦å­¦ä¹ ï¼Œè¯¥ç¯å¢ƒè¿è¡Œ10+å°æ—¶ï¼ŒåŒæ—¶å†…å­˜å¿…é¡»å¤§äº8Gï¼Œä¸ç„¶ä¼šçˆ†å†…å­˜</li>
</ul>
<h2 id="æ•°æ®é›†"><a href="#æ•°æ®é›†" class="headerlink" title="æ•°æ®é›†"></a>æ•°æ®é›†</h2><p>æœ¬è®­ç»ƒé›†ç”±predict_check_dataè¡¨çš„17ä¸‡æ¡äº§å“åç§°å’Œå¯¹åº”åˆ†ç±»ç»„æˆã€‚</p>
<h2 id="é¢„å¤„ç†"><a href="#é¢„å¤„ç†" class="headerlink" title="é¢„å¤„ç†"></a>é¢„å¤„ç†</h2><p><code>data_prepare.py</code>è¿è¡Œè¯¥ç¨‹åºï¼Œå³å¯æ ¹æ®æ•°æ®è¡¨ï¼Œç”ŸæˆæŒ‡å®šçš„è®­ç»ƒï¼Œæµ‹è¯•ï¼ŒéªŒè¯é›†ã€‚</p>
<p><code>data/cnews_loader.py</code>ä¸ºæ•°æ®çš„é¢„å¤„ç†æ–‡ä»¶ã€‚</p>
<ul>
<li><code>read_file()</code>: è¯»å–æ–‡ä»¶æ•°æ®;</li>
<li><code>build_vocab()</code>: æ„å»ºè¯æ±‡è¡¨ï¼Œä½¿ç”¨å­—ç¬¦çº§çš„è¡¨ç¤ºï¼Œè¿™ä¸€å‡½æ•°ä¼šå°†è¯æ±‡è¡¨å­˜å‚¨ä¸‹æ¥ï¼Œé¿å…æ¯ä¸€æ¬¡é‡å¤å¤„ç†;</li>
<li><code>read_vocab()</code>: è¯»å–ä¸Šä¸€æ­¥å­˜å‚¨çš„è¯æ±‡è¡¨ï¼Œè½¬æ¢ä¸º<code>&#123;è¯ï¼šid&#125;</code>è¡¨ç¤º;</li>
<li><code>read_category()</code>: å°†åˆ†ç±»ç›®å½•å›ºå®šï¼Œè½¬æ¢ä¸º<code>&#123;ç±»åˆ«: id&#125;</code>è¡¨ç¤º;</li>
<li><code>to_words()</code>: å°†ä¸€æ¡ç”±idè¡¨ç¤ºçš„æ•°æ®é‡æ–°è½¬æ¢ä¸ºæ–‡å­—;</li>
<li><code>process_file()</code>: å°†æ•°æ®é›†ä»æ–‡å­—è½¬æ¢ä¸ºå›ºå®šé•¿åº¦çš„idåºåˆ—è¡¨ç¤º;</li>
<li><code>batch_iter()</code>: ä¸ºç¥ç»ç½‘ç»œçš„è®­ç»ƒå‡†å¤‡ç»è¿‡shuffleçš„æ‰¹æ¬¡çš„æ•°æ®ã€‚</li>
</ul>
<p>ç»è¿‡æ•°æ®é¢„å¤„ç†ï¼Œæ•°æ®çš„æ ¼å¼å¦‚ä¸‹ï¼š</p>
<table>
<thead>
<tr>
<th align="left">Data</th>
<th align="left">Shape</th>
<th align="left">Data</th>
<th align="left">Shape</th>
</tr>
</thead>
<tbody><tr>
<td align="left">x_train</td>
<td align="left">[50000, 600]</td>
<td align="left">y_train</td>
<td align="left">[50000, 10]</td>
</tr>
<tr>
<td align="left">x_val</td>
<td align="left">[5000, 600]</td>
<td align="left">y_val</td>
<td align="left">[5000, 10]</td>
</tr>
<tr>
<td align="left">x_test</td>
<td align="left">[10000, 600]</td>
<td align="left">y_test</td>
<td align="left">[10000, 10]</td>
</tr>
</tbody></table>
<h2 id="CNNå·ç§¯ç¥ç»ç½‘ç»œ"><a href="#CNNå·ç§¯ç¥ç»ç½‘ç»œ" class="headerlink" title="CNNå·ç§¯ç¥ç»ç½‘ç»œ"></a>CNNå·ç§¯ç¥ç»ç½‘ç»œ</h2><h3 id="é…ç½®é¡¹"><a href="#é…ç½®é¡¹" class="headerlink" title="é…ç½®é¡¹"></a>é…ç½®é¡¹</h3><p>CNNå¯é…ç½®çš„å‚æ•°å¦‚ä¸‹æ‰€ç¤ºï¼Œåœ¨<code>cnn_model.py</code>ä¸­ã€‚</p>
<figure class="highlight python"><table><tr><td class="code"><pre><code class="hljs python"><span class="hljs-keyword">class</span> <span class="hljs-title class_">TCNNConfig</span>(<span class="hljs-title class_ inherited__">object</span>):<br>    <span class="hljs-string">&quot;&quot;&quot;CNNé…ç½®å‚æ•°&quot;&quot;&quot;</span><br><br>    embedding_dim = <span class="hljs-number">128</span>  <span class="hljs-comment"># è¯å‘é‡ç»´åº¦</span><br>    seq_length = <span class="hljs-number">300</span>  <span class="hljs-comment"># åºåˆ—é•¿åº¦</span><br>    <span class="hljs-comment"># num_classes = 668  # ç±»åˆ«æ•°</span><br>    num_filters = <span class="hljs-number">1024</span>  <span class="hljs-comment"># å·ç§¯æ ¸æ•°ç›®</span><br>    kernel_size = <span class="hljs-number">3</span>  <span class="hljs-comment"># å·ç§¯æ ¸å°ºå¯¸</span><br>    vocab_size = <span class="hljs-number">8000</span>  <span class="hljs-comment"># è¯æ±‡è¡¨å¤§å°</span><br><br>    hidden_dim = <span class="hljs-number">256</span>  <span class="hljs-comment"># å…¨è¿æ¥å±‚ç¥ç»å…ƒ</span><br><br>    dropout_keep_prob = <span class="hljs-number">0.55</span>  <span class="hljs-comment"># dropoutä¿ç•™æ¯”ä¾‹</span><br>    learning_rate = <span class="hljs-number">1e-3</span>  <span class="hljs-comment"># å­¦ä¹ ç‡</span><br><br>    batch_size = <span class="hljs-number">64</span>  <span class="hljs-comment"># æ¯æ‰¹è®­ç»ƒå¤§å°</span><br>    num_epochs = <span class="hljs-number">20</span>  <span class="hljs-comment"># æ€»è¿­ä»£è½®æ¬¡</span><br><br>    print_per_batch = <span class="hljs-number">100</span>  <span class="hljs-comment"># æ¯å¤šå°‘è½®è¾“å‡ºä¸€æ¬¡ç»“æœ</span><br>    save_per_batch = <span class="hljs-number">10</span>  <span class="hljs-comment"># æ¯å¤šå°‘è½®å­˜å…¥tensorboard</span><br></code></pre></td></tr></table></figure>

<h3 id="CNNæ¨¡å‹"><a href="#CNNæ¨¡å‹" class="headerlink" title="CNNæ¨¡å‹"></a>CNNæ¨¡å‹</h3><figure class="highlight python"><table><tr><td class="code"><pre><code class="hljs python"><span class="hljs-keyword">class</span> <span class="hljs-title class_">TextCNN</span>(<span class="hljs-title class_ inherited__">object</span>):<br>    <span class="hljs-string">&quot;&quot;&quot;æ–‡æœ¬åˆ†ç±»ï¼ŒCNNæ¨¡å‹&quot;&quot;&quot;</span><br>    <br>    <span class="hljs-keyword">def</span> <span class="hljs-title function_">__init__</span>(<span class="hljs-params">self, config</span>):<br>        <span class="hljs-variable language_">self</span>.config = config<br>        <span class="hljs-comment"># ä¸‰ä¸ªå¾…è¾“å…¥çš„æ•°æ®</span><br>        <span class="hljs-variable language_">self</span>.input_x = tf.placeholder(tf.int32, [<span class="hljs-literal">None</span>, <span class="hljs-variable language_">self</span>.config.seq_length], name=<span class="hljs-string">&#x27;input_x&#x27;</span>)<br>        <span class="hljs-variable language_">self</span>.input_y = tf.placeholder(tf.float32, [<span class="hljs-literal">None</span>, <span class="hljs-variable language_">self</span>.config.num_classes], name=<span class="hljs-string">&#x27;input_y&#x27;</span>)<br>        <span class="hljs-variable language_">self</span>.keep_prob = tf.placeholder(tf.float32, name=<span class="hljs-string">&#x27;keep_prob&#x27;</span>)<br><br>        <span class="hljs-variable language_">self</span>.cnn()<br><br>    <span class="hljs-keyword">def</span> <span class="hljs-title function_">cnn</span>(<span class="hljs-params">self</span>):<br>        <span class="hljs-string">&quot;&quot;&quot;CNNæ¨¡å‹&quot;&quot;&quot;</span><br>        <span class="hljs-comment"># è¯å‘é‡æ˜ å°„</span><br>        <span class="hljs-keyword">with</span> tf.device(<span class="hljs-string">&#x27;/cpu:0&#x27;</span>):<br>            embedding = tf.get_variable(<span class="hljs-string">&#x27;embedding&#x27;</span>, [<span class="hljs-variable language_">self</span>.config.vocab_size, <span class="hljs-variable language_">self</span>.config.embedding_dim])<br>            embedding_inputs = tf.nn.embedding_lookup(embedding, <span class="hljs-variable language_">self</span>.input_x)<br><br>        <span class="hljs-keyword">with</span> tf.name_scope(<span class="hljs-string">&quot;cnn&quot;</span>):<br>            <span class="hljs-comment"># CNN layer 3*3</span><br>            conv_1 = tf.layers.conv1d(embedding_inputs, <span class="hljs-variable language_">self</span>.config.num_filters, <span class="hljs-variable language_">self</span>.config.kernel_size, name=<span class="hljs-string">&#x27;conv_1&#x27;</span>)<br>            <span class="hljs-comment"># global max pooling layer</span><br>            gmp_1 = tf.reduce_max(conv_1, reduction_indices=[<span class="hljs-number">1</span>], name=<span class="hljs-string">&#x27;gmp_1&#x27;</span>)<br><br>        <span class="hljs-keyword">with</span> tf.name_scope(<span class="hljs-string">&quot;score&quot;</span>):<br>            <span class="hljs-comment"># å…¨è¿æ¥å±‚ï¼Œåé¢æ¥dropoutä»¥åŠreluæ¿€æ´»</span><br>            fc_1 = tf.layers.dense(gmp_1, <span class="hljs-variable language_">self</span>.config.hidden_dim, name=<span class="hljs-string">&#x27;fc_1&#x27;</span>)<br>            fc_1 = tf.contrib.layers.dropout(fc_1, <span class="hljs-variable language_">self</span>.keep_prob)<br>            fc_1 = tf.nn.relu(fc_1)<br>            <span class="hljs-comment"># åˆ†ç±»å™¨</span><br>            <span class="hljs-variable language_">self</span>.logits = tf.layers.dense(fc_1, <span class="hljs-variable language_">self</span>.config.num_classes, name=<span class="hljs-string">&#x27;fc_2&#x27;</span>)<br>            <span class="hljs-variable language_">self</span>.y_pred_cls = tf.argmax(tf.nn.softmax(<span class="hljs-variable language_">self</span>.logits), <span class="hljs-number">1</span>)  <span class="hljs-comment"># é¢„æµ‹ç±»åˆ«</span><br><br>        <span class="hljs-keyword">with</span> tf.name_scope(<span class="hljs-string">&quot;optimize&quot;</span>):<br>            <span class="hljs-comment"># æŸå¤±å‡½æ•°ï¼Œäº¤å‰ç†µ</span><br>            cross_entropy = tf.nn.softmax_cross_entropy_with_logits(logits=<span class="hljs-variable language_">self</span>.logits, labels=<span class="hljs-variable language_">self</span>.input_y)<br>            <span class="hljs-variable language_">self</span>.loss = tf.reduce_mean(cross_entropy)<br>            <span class="hljs-comment"># ä¼˜åŒ–å™¨</span><br>            <span class="hljs-variable language_">self</span>.optim = tf.train.AdamOptimizer(learning_rate=<span class="hljs-variable language_">self</span>.config.learning_rate).minimize(<span class="hljs-variable language_">self</span>.loss)<br><br>        <span class="hljs-keyword">with</span> tf.name_scope(<span class="hljs-string">&quot;accuracy&quot;</span>):<br>            <span class="hljs-comment"># å‡†ç¡®ç‡</span><br>            correct_pred = tf.equal(tf.argmax(<span class="hljs-variable language_">self</span>.input_y, <span class="hljs-number">1</span>), <span class="hljs-variable language_">self</span>.y_pred_cls)<br>            <span class="hljs-variable language_">self</span>.acc = tf.reduce_mean(tf.cast(correct_pred, tf.float32))<br></code></pre></td></tr></table></figure>
<h3 id="è®­ç»ƒä¸éªŒè¯"><a href="#è®­ç»ƒä¸éªŒè¯" class="headerlink" title="è®­ç»ƒä¸éªŒè¯"></a>è®­ç»ƒä¸éªŒè¯</h3><p>è¿è¡Œ <code>python run_cnn.py train</code>ï¼Œå¯ä»¥å¼€å§‹è®­ç»ƒã€‚</p>
<blockquote>
<p>è‹¥ä¹‹å‰è¿›è¡Œè¿‡è®­ç»ƒï¼Œè¯·æŠŠtensorboard&#x2F;textcnnåˆ é™¤ï¼Œé¿å…TensorBoardå¤šæ¬¡è®­ç»ƒç»“æœé‡å ã€‚</p>
</blockquote>
<figure class="highlight shell"><table><tr><td class="code"><pre><code class="hljs shell">Configuring CNN model...<br>Configuring TensorBoard and Saver...<br>Loading training and validation data...<br>Time usage: 0:00:14<br>Training and evaluating...<br>Epoch: 1<br>Iter:      0, Train Loss:    8.9, Train Acc:   0.00%, Val Loss:    8.9, Val Acc:   0.00%, Time: 0:00:15<br>Iter:    100, Train Loss:    7.1, Train Acc:   3.12%, Val Loss:    7.3, Val Acc:   1.75%, Time: 0:00:22 *<br>Iter:    200, Train Loss:    6.7, Train Acc:   9.38%, Val Loss:    6.9, Val Acc:   7.68%, Time: 0:00:29 *<br>Iter:    300, Train Loss:    5.8, Train Acc:  20.31%, Val Loss:    6.4, Val Acc:  15.43%, Time: 0:00:35 *<br>Iter:    400, Train Loss:    5.8, Train Acc:  18.75%, Val Loss:    5.8, Val Acc:  23.33%, Time: 0:00:42 *<br>Iter:    500, Train Loss:    5.4, Train Acc:  29.69%, Val Loss:    5.3, Val Acc:  30.68%, Time: 0:00:49 *<br>Iter:    600, Train Loss:    4.1, Train Acc:  40.62%, Val Loss:    5.0, Val Acc:  37.10%, Time: 0:00:56 *<br>Iter:    700, Train Loss:    4.3, Train Acc:  40.62%, Val Loss:    4.7, Val Acc:  39.64%, Time: 0:01:03 *<br>Iter:    800, Train Loss:    4.1, Train Acc:  48.44%, Val Loss:    4.5, Val Acc:  43.47%, Time: 0:01:10 *<br>Iter:    900, Train Loss:    4.2, Train Acc:  37.50%, Val Loss:    4.3, Val Acc:  45.70%, Time: 0:01:17 *<br>Iter:   1000, Train Loss:    3.0, Train Acc:  56.25%, Val Loss:    4.1, Val Acc:  48.36%, Time: 0:01:23 *<br>Iter:   1100, Train Loss:    4.3, Train Acc:  50.00%, Val Loss:    4.0, Val Acc:  50.28%, Time: 0:01:30 *<br>Iter:   1200, Train Loss:    3.5, Train Acc:  53.12%, Val Loss:    3.9, Val Acc:  51.55%, Time: 0:01:37 *<br>Iter:   1300, Train Loss:    4.2, Train Acc:  50.00%, Val Loss:    3.8, Val Acc:  52.80%, Time: 0:01:44 *<br>Iter:   1400, Train Loss:    2.6, Train Acc:  59.38%, Val Loss:    3.6, Val Acc:  54.80%, Time: 0:01:51 *<br>Iter:   1500, Train Loss:    4.0, Train Acc:  51.56%, Val Loss:    3.5, Val Acc:  55.76%, Time: 0:01:58 *<br>Iter:   1600, Train Loss:    4.1, Train Acc:  46.88%, Val Loss:    3.5, Val Acc:  56.52%, Time: 0:02:05 *<br>Iter:   1700, Train Loss:    3.0, Train Acc:  59.38%, Val Loss:    3.4, Val Acc:  57.38%, Time: 0:02:12 *<br>Iter:   1800, Train Loss:    2.9, Train Acc:  60.94%, Val Loss:    3.3, Val Acc:  58.31%, Time: 0:02:19 *<br>Iter:   1900, Train Loss:    3.8, Train Acc:  50.00%, Val Loss:    3.2, Val Acc:  58.58%, Time: 0:02:26 *<br>Iter:   2000, Train Loss:    3.9, Train Acc:  54.69%, Val Loss:    3.2, Val Acc:  59.42%, Time: 0:02:33 *<br>.<br>.#è®­ç»ƒè¿­ä»£10æ¬¡å<br>. <br>Epoch: 11<br>Iter:  20800, Train Loss:  0.013, Train Acc: 100.00%, Val Loss:   0.44, Val Acc:  92.10%, Time: 0:24:38 *<br>Iter:  20900, Train Loss:  0.012, Train Acc: 100.00%, Val Loss:   0.44, Val Acc:  92.15%, Time: 0:24:45 *<br>Iter:  21000, Train Loss:  0.025, Train Acc:  98.44%, Val Loss:   0.47, Val Acc:  91.75%, Time: 0:24:51<br>Iter:  21100, Train Loss:  0.026, Train Acc: 100.00%, Val Loss:   0.43, Val Acc:  92.22%, Time: 0:24:58 *<br>Iter:  21200, Train Loss:  0.094, Train Acc:  98.44%, Val Loss:   0.46, Val Acc:  91.80%, Time: 0:25:05<br>Iter:  21300, Train Loss:   0.17, Train Acc:  98.44%, Val Loss:   0.45, Val Acc:  92.25%, Time: 0:25:12 *<br>Iter:  21400, Train Loss:  0.094, Train Acc:  96.88%, Val Loss:   0.46, Val Acc:  92.18%, Time: 0:25:18<br>Iter:  21500, Train Loss:  0.029, Train Acc:  98.44%, Val Loss:   0.45, Val Acc:  91.92%, Time: 0:25:25<br>Iter:  21600, Train Loss:   0.11, Train Acc:  98.44%, Val Loss:   0.44, Val Acc:  92.10%, Time: 0:25:31<br>Iter:  21700, Train Loss:  0.099, Train Acc:  98.44%, Val Loss:   0.46, Val Acc:  91.93%, Time: 0:25:38<br>Iter:  21800, Train Loss:  0.069, Train Acc:  98.44%, Val Loss:   0.46, Val Acc:  91.68%, Time: 0:25:45<br>Iter:  21900, Train Loss:  0.097, Train Acc:  96.88%, Val Loss:   0.46, Val Acc:  91.90%, Time: 0:25:51<br>Iter:  22000, Train Loss:  0.024, Train Acc:  98.44%, Val Loss:   0.45, Val Acc:  92.13%, Time: 0:25:58<br>Iter:  22100, Train Loss:   0.01, Train Acc: 100.00%, Val Loss:   0.43, Val Acc:  92.14%, Time: 0:26:05<br>Iter:  22200, Train Loss:   0.11, Train Acc:  98.44%, Val Loss:   0.43, Val Acc:  92.25%, Time: 0:26:11<br>Iter:  22300, Train Loss:  0.011, Train Acc: 100.00%, Val Loss:   0.43, Val Acc:  92.21%, Time: 0:26:18<br>No optimization for a long time, auto-stopping...<br></code></pre></td></tr></table></figure>


<p>åœ¨éªŒè¯é›†ä¸Šçš„æœ€ä½³æ•ˆæœä¸º92.25%.</p>
<h3 id="æµ‹è¯•"><a href="#æµ‹è¯•" class="headerlink" title="æµ‹è¯•"></a>æµ‹è¯•</h3><p>è¿è¡Œ <code>python run_cnn.py test</code> åœ¨æµ‹è¯•é›†ä¸Šè¿›è¡Œæµ‹è¯•ã€‚</p>
<figure class="highlight shell"><table><tr><td class="code"><pre><code class="hljs shell">Configuring CNN model...<br>Loading test data...<br>Testing...<br>Test Loss:   0.46, Test Acc:  91.85%<br></code></pre></td></tr></table></figure>
<p>åœ¨æµ‹è¯•é›†ä¸Šçš„å‡†ç¡®ç‡è¾¾åˆ°äº†91.85%ã€‚</p>
<h3 id="é¢„æµ‹"><a href="#é¢„æµ‹" class="headerlink" title="é¢„æµ‹"></a>é¢„æµ‹</h3><p>è¿è¡Œ <code>python run_cnn.py predict</code> åœ¨é¢„æµ‹é›†ä¸Šè¿›è¡Œé¢„æµ‹ã€‚</p>
<p>é¢„æµ‹é›†å‘½åä¸º<code>name2category.predict.txt</code>,æ”¾å…¥dataä¸­çš„name2categoryæ–‡ä»¶å¤¹ï¼Œæ¯è¡Œä¸€ä¸ªäº§å“åç§°ã€‚</p>
<p>è¾“å‡ºåœ¨ç›®å½•æ–‡ä»¶å¤¹ï¼Œåç§°ä¸º<code>predicted_data.txt</code></p>
<h3 id="åŠŸèƒ½è°ƒç”¨"><a href="#åŠŸèƒ½è°ƒç”¨" class="headerlink" title="åŠŸèƒ½è°ƒç”¨"></a>åŠŸèƒ½è°ƒç”¨</h3><p>è°ƒç”¨æ–¹æ³•ä¸º:</p>
<figure class="highlight python"><table><tr><td class="code"><pre><code class="hljs python"><span class="hljs-keyword">from</span> run_cnn <span class="hljs-keyword">import</span> name2subcategory<br><br>name_list = [<span class="hljs-string">&#x27;ä¹”æ€ä¼¯ JONSBO CR-201RGBç‰ˆæœ¬RGBCPUæ•£çƒ­å™¨ï¼ˆé»‘è‰²/å¤šå¹³å°/4çƒ­ç®¡/æ¸©æ§/12CMé£æ‰‡/æ”¯æŒAURARGB/é™„ç¡…è„‚ï¼‰&#x27;</span>] <br>a = name2subcategory()<br>category = a.namelyst_predict(name_list)<br></code></pre></td></tr></table></figure>

<p>è¾“å…¥ä¸€ä¸ªå«æœ‰å¤šä¸ªäº§å“åç§°çš„åˆ—è¡¨ï¼Œè¿”å›ä¸€ä¸ªå„åç§°å­ç±»çš„åˆ—è¡¨ã€‚</p>
]]></content>
  </entry>
  <entry>
    <title>GATæ•™ç¨‹</title>
    <url>/2023/11/01/GAT&#39;s%20Toturial/</url>
    <content><![CDATA[<h1 id="GATæ•™ç¨‹"><a href="#GATæ•™ç¨‹" class="headerlink" title="GATæ•™ç¨‹"></a>GATæ•™ç¨‹</h1><h3 id="æœ¬æ–‡æ¥è‡ªå¯¹ä½œè€…gordicaleksaçš„notebookä»£ç pytorch-GATçš„ç¿»è¯‘ã€‚æ„Ÿè°¢ä½œè€…"><a href="#æœ¬æ–‡æ¥è‡ªå¯¹ä½œè€…gordicaleksaçš„notebookä»£ç pytorch-GATçš„ç¿»è¯‘ã€‚æ„Ÿè°¢ä½œè€…" class="headerlink" title="æœ¬æ–‡æ¥è‡ªå¯¹ä½œè€…gordicaleksaçš„notebookä»£ç pytorch-GATçš„ç¿»è¯‘ã€‚æ„Ÿè°¢ä½œè€…"></a><strong>æœ¬æ–‡æ¥è‡ªå¯¹ä½œè€…gordicaleksaçš„notebookä»£ç <a href="https://github.com/gordicaleksa/pytorch-GAT">pytorch-GAT</a>çš„ç¿»è¯‘ã€‚æ„Ÿè°¢ä½œè€…</strong></h3><p>æœ¬æ–‡çš„æƒ³æ³•æ˜¯è®©éç ”ç©¶äººå‘˜ä¹Ÿèƒ½æ›´è½»æ¾åœ°ç†è§£å›¾æ³¨æ„åŠ›ç½‘ç»œï¼ˆä»¥åŠé€šç”¨çš„GNNï¼‰ï¼</p>
<p>åœ¨æœ¬æ–‡ä¸­ï¼Œæ‚¨å°†è·å¾—ä»¥ä¸‹é—®é¢˜çš„ç­”æ¡ˆï¼š</p>
<p>âœ… GAT åˆ°åº•æ˜¯ä»€ä¹ˆï¼Ÿ<br/><br>âœ… å¦‚ä½•åŠ è½½å’Œå¯è§†åŒ–Coraå¼•æ–‡ç½‘ç»œï¼Ÿ<br/><br>âœ… æˆ‘ä»¬å¦‚ä½•è®­ç»ƒGATï¼ˆCoraåˆ†ç±»ç¤ºä¾‹ï¼‰ï¼Ÿ<br/><br>âœ… å¦‚ä½•å¯è§†åŒ–ä¸åŒGATçš„å±æ€§ï¼Ÿ<br/></p>
<p>å®Œæˆæœ¬è¯¾ç¨‹åï¼Œæ‚¨å°†å¯¹å›¾ç¥ç»ç½‘ç»œæœ‰æ›´å¥½çš„ç†è§£ï¼</p>
<p><em>æ³¨æ„ï¼šåœ¨æœ¬ç¬”è®°æœ¬ä¸­ï¼Œæˆ‘ä»¬å°†é‡ç‚¹å…³æ³¨ Coraï¼ˆä¼ å¯¼æ³•ç¤ºä¾‹ï¼‰ï¼Œå¦‚æœéœ€è¦å¯ä»¥æŸ¥çœ‹å…¶ä»–ç¬”è®°æœ¬ä¸­çš„PPI - è›‹ç™½è´¨ç›¸äº’ä½œç”¨æ•°æ®é›†ï¼ˆå½’çº³æ³•ï¼‰ã€‚</em></p>
<p>å¾ˆå¥½ï¼Œè®©æˆ‘ä»¬å¼€å§‹å§ï¼</p>
<hr>
<h2 id="å›¾æ³¨æ„åŠ›ç½‘ç»œåˆ°åº•æ˜¯ä»€ä¹ˆï¼Ÿ"><a href="#å›¾æ³¨æ„åŠ›ç½‘ç»œåˆ°åº•æ˜¯ä»€ä¹ˆï¼Ÿ" class="headerlink" title="å›¾æ³¨æ„åŠ›ç½‘ç»œåˆ°åº•æ˜¯ä»€ä¹ˆï¼Ÿ"></a>å›¾æ³¨æ„åŠ›ç½‘ç»œåˆ°åº•æ˜¯ä»€ä¹ˆï¼Ÿ</h2><p>å›¾æ³¨æ„åŠ›ç½‘ç»œï¼ˆGraph Attention Networkï¼‰ï¼Œç®€ç§° GATï¼Œæ˜¯ä¸€ç§å›¾ç¥ç»ç½‘ç»œï¼ˆGNNï¼‰ï¼Œæ—©åœ¨ 2017 å¹´å°±åœ¨ä¸€ç¯‡åä¸º<a href="https://arxiv.org/abs/1710.10903">ã€ŠGraph Attention Networksã€‹</a>VeliÄkoviÄ‡ et al.çš„è®ºæ–‡ä¸­å‘è¡¨ã€‚</p>
<p>äº‹å®è¯æ˜ï¼Œå°†æ³¨æ„åŠ›çš„æƒ³æ³•ä¸ç°æœ‰çš„å›¾å·ç§¯ç½‘ç»œï¼ˆGCNï¼‰ç›¸ç»“åˆæ˜¯ä¸€ä¸ªå¾ˆå¥½çš„ä¸¾æªï¼ŒGATæ˜¯GNNæ–‡çŒ®ä¸­è¢«å¼•ç”¨æ¬¡æ•°ç¬¬äºŒå¤šçš„è®ºæ–‡ï¼ˆæˆªè‡³æ’°å†™æœ¬æ–‡æ—¶ï¼‰ã€‚</p>
<p>å› ä¸º<code>GCN + attention = GAT</code>ä¸ºäº†ç†è§£GATï¼Œä½ åŸºæœ¬ä¸Šéœ€è¦ç†è§£GCNã€‚</p>
<p>æ•´ä¸ªæƒ³æ³•æ¥è‡ª CNNã€‚å·ç§¯ç¥ç»ç½‘ç»œå‘å±•éå¸¸å¥½ï¼Œè§£å†³äº†å„ç§è®¡ç®—æœºè§†è§‰ä»»åŠ¡ï¼Œå¹¶åœ¨æ·±åº¦å­¦ä¹ é¢†åŸŸå¼•èµ·äº†å·¨å¤§çš„è½°åŠ¨ï¼Œå› æ­¤ä¸€äº›äººå†³å®šå°†è¿™ä¸ªæƒ³æ³•è½¬ç§»åˆ°å›¾ä¸Šã€‚</p>
<p>åŸºæœ¬é—®é¢˜æ˜¯ï¼Œè™½ç„¶å›¾åƒä½äºè§„åˆ™ç½‘æ ¼ä¸Šï¼ˆæ‚¨ä¹Ÿå¯ä»¥å°†å…¶è§†ä¸ºå›¾å½¢ï¼‰ï¼Œä½†å› æ­¤å…·æœ‰ç²¾ç¡®çš„é¡ºåºæ¦‚å¿µï¼ˆä¾‹å¦‚æˆ‘çš„å·¦ä¸Šè§’é‚»å±…ï¼ˆé€šå¸¸ç§°ä¸ºCVä¸–ç•Œé‡Œçš„åƒç´ ï¼‰))ï¼Œå›¾ä¸å…·å¤‡è¿™ç§è‰¯å¥½çš„ç‰¹æ€§ï¼Œå¹¶ä¸”é‚»å±…çš„æ•°é‡ä»¥åŠé‚»å±…çš„é¡ºåºéƒ½å¯èƒ½ä¼šæœ‰æ‰€ä¸åŒã€‚</p>
<p>é‚£ä¹ˆå¦‚ä½•ä¸ºå›¾å®šä¹‰å†…æ ¸å‘¢ï¼Ÿå†…æ ¸å¤§å°ä¸èƒ½æ˜¯è¿™æ ·3x3ï¼Œå› ä¸ºæœ‰æ—¶ä¸€ä¸ªèŠ‚ç‚¹æœ‰2ä¸ªé‚»å±…ï¼Œæœ‰æ—¶æ˜¯ 233240ï¼ˆ<em>æŠ“ç‹‚</em>ï¼‰ã€‚</p>
<p>å‡ºç°äº† 2 ä¸ªä¸»è¦æƒ³æ³•ï¼š</p>
<ul>
<li>è°±æ–¹æ³•ï¼ˆå®ƒä»¬éƒ½ä»¥æŸç§æ–¹å¼åˆ©ç”¨å›¾æ‹‰æ™®æ‹‰æ–¯ç‰¹å¾åŸºï¼ˆæˆ‘åœ¨è¿™é‡Œå®Œå…¨å¿½ç•¥å®ƒä»¬ï¼‰ï¼‰</li>
<li>ç©ºé—´æ–¹æ³•</li>
</ul>
<p>å°½ç®¡ç©ºé—´æ–¹æ³•å¯èƒ½éšçº¦å—åˆ°è°±æ–¹æ³•çš„å¯å‘ï¼Œä½†ç›´æ¥ä»ç©ºé—´è§’åº¦æ€è€ƒå®ƒä»¬è¦å¥½å¾—å¤šã€‚å¥½çš„ï¼Œå°±è¿™æ ·å§ã€‚</p>
<hr>
<p><strong>ç©ºé—´ï¼ˆæ¶ˆæ¯ä¼ é€’ï¼‰æ–¹æ³•çš„é«˜çº§è§£é‡Šï¼š</strong></p>
<p>æ‰€ä»¥ä½ å¯ä»¥ä½¿ç”¨æ¥è‡ªé‚»å±…çš„ç‰¹å¾å‘é‡ã€‚æ‚¨æ‰§è¡Œä»¥ä¸‹æ“ä½œï¼š</p>
<ol>
<li>ä½ ä»¥æŸç§æ–¹å¼å˜æ¢å®ƒä»¬ï¼ˆä¹Ÿè®¸æ˜¯çº¿æ€§æŠ•å½±ï¼‰</li>
<li>ä½ ä»¥æŸç§æ–¹å¼èšåˆå®ƒä»¬ï¼ˆä¹Ÿè®¸ç”¨æ³¨æ„åŠ›ç³»æ•°æ¥è¡¡é‡å®ƒä»¬ï¼Œç§ï¼Œæˆ‘ä»¬å¾—åˆ°äº† GATï¼ˆä½ çœ‹æˆ‘åœ¨é‚£é‡Œåšäº†ä»€ä¹ˆï¼‰ï¼‰</li>
<li>æ‚¨å¯ä»¥é€šè¿‡å°†å½“å‰èŠ‚ç‚¹ï¼ˆå˜æ¢åçš„ï¼‰ç‰¹å¾å‘é‡ä¸èšåˆé‚»å±…è¡¨ç¤ºç›¸ç»“åˆæ¥æ›´æ–°å½“å‰èŠ‚ç‚¹çš„ç‰¹å¾å‘é‡ï¼ˆä»¥æŸç§æ–¹å¼ï¼‰ã€‚<br>å·®ä¸å¤šå°±æ˜¯è¿™æ ·ï¼Œä½ å¯ä»¥å°†è®¸å¤šä¸åŒçš„ GNN æ”¾å…¥è¿™ä¸ªæ¡†æ¶ä¸­ã€‚</li>
</ol>
<p>GAT ç¤ºæ„å›¾å¦‚ä¸‹ï¼ˆä¸åŒé¢œè‰²çš„è¾¹ä»£è¡¨ä¸åŒçš„æ³¨æ„åŠ›å¤´ï¼‰ï¼š<br><img src="https://i-blog.csdnimg.cn/blog_migrate/45d6723d19b7b712df7a148478dd9256.png" alt="transformer architecture" align="center" style="width: 500px;"/> <br/></p>
<p><strong>æœ‰è¶£çš„äº‹å®:</strong> <em>transformers</em> å¯ä»¥è¢«è®¤ä¸ºæ˜¯GATçš„ä¸€ä¸ªç‰¹ä¾‹â€”å½“è¾“å…¥å›¾æ˜¯<strong>å…¨è¿æ¥</strong>æ—¶ã€‚æŸ¥çœ‹<a href="https://thegradient.pub/transformers-are-graph-neural-networks/">æ­¤åšå®¢</a>äº†è§£æ›´å¤šè¯¦ç»†ä¿¡æ¯ã€‚</p>
<hr>
<p>è¿™å°±æ˜¯æ‚¨ç°åœ¨éœ€è¦äº†è§£çš„ä¸€åˆ‡ï¼</p>
<p>å¦‚æœæ‚¨éœ€è¦è¿›ä¸€æ­¥å¸®åŠ©ç†è§£æ‰€æœ‰ç»†èŠ‚ï¼Œæˆ‘ä»¬åˆ›å»ºäº† <a href="https://www.youtube.com/watch?v=uFLeKkXWq2c">in-depth overview of the GAT paper:</a>è¿™ç¯‡GAT è®ºæ–‡çš„æ·±å…¥æ¦‚è¿°ï¼š</p>
<p>é‡è¦æç¤ºï¼šæ­¤ç¬”è®°æœ¬ä¸­çš„ä»£ç æ˜¯è¿™ä¸ªrepoä¸­å¯ä»¥ä½¿ç”¨çš„ä»£ç çš„å­é›†ã€‚æˆ‘å°†åœ¨è¿™é‡Œé‡ç‚¹å…³æ³¨å•ä¸ªGATå®ç°ï¼ˆæ¦‚å¿µä¸Šæœ€éš¾ç†è§£çš„å®ç°ï¼Œä½†åŒæ—¶ä¹Ÿæ˜¯æœ€æœ‰æ•ˆçš„å®ç°ï¼‰ã€‚è¯·æ³¨æ„ï¼Œæˆ‘å®é™…ä¸Šåœ¨repoä¸­æœ‰3ä¸ªGATå®ç°ã€‚</p>
<p>æŠ›å¼€è¿™äº›ï¼Œè®©æˆ‘ä»¬å¼€å§‹æ·±å…¥ç ”ç©¶å§ï¼è®©æˆ‘ä»¬ä»ä¸æ•°æ®åŠ è½½å’Œå¯è§†åŒ–ç›¸å…³çš„å¯¼å…¥å¼€å§‹ã€‚</p>
<figure class="highlight python"><table><tr><td class="code"><pre><code class="hljs python"><span class="hljs-comment"># I always like to structure my imports into Python&#x27;s native libs,</span><br><span class="hljs-comment"># stuff I installed via conda/pip and local file imports (but we don&#x27;t have those here)</span><br><br><span class="hljs-keyword">import</span> pickle<br><br><span class="hljs-comment"># å¯è§†åŒ–ç›¸å…³å¯¼å…¥</span><br><span class="hljs-keyword">import</span> matplotlib.pyplot <span class="hljs-keyword">as</span> plt<br><span class="hljs-keyword">import</span> networkx <span class="hljs-keyword">as</span> nx<br><span class="hljs-keyword">import</span> igraph <span class="hljs-keyword">as</span> ig<br>plt.rcParams[<span class="hljs-string">&#x27;font.sans-serif&#x27;</span>] = [<span class="hljs-string">&#x27;SimHei&#x27;</span>]<br><span class="hljs-comment"># ä¸»è¦çš„è®¡ç®—ä¾èµ–</span><br><span class="hljs-keyword">import</span> scipy.sparse <span class="hljs-keyword">as</span> sp<br><span class="hljs-keyword">import</span> numpy <span class="hljs-keyword">as</span> np<br><br><span class="hljs-comment"># æ·±åº¦å­¦ä¹ ç›¸å…³</span><br><span class="hljs-keyword">import</span> torch<br></code></pre></td></tr></table></figure>


<figure class="highlight python"><table><tr><td class="code"><pre><code class="hljs python"><span class="hljs-keyword">import</span> os<br><span class="hljs-keyword">import</span> enum<br><br><span class="hljs-comment"># æ”¯æŒçš„æ•°æ®é›† - ä»…åœ¨æ­¤ç¬”è®°æœ¬ä¸­ä½¿ç”¨ Cora</span><br><span class="hljs-keyword">class</span> <span class="hljs-title class_">DatasetType</span>(enum.Enum):<br>    CORA = <span class="hljs-number">0</span><br><br>    <br><span class="hljs-comment"># Networkx å¹¶ä¸æ˜¯ä¸“ä¸ºç»˜å›¾è€Œåˆ¶ä½œçš„ï¼Œä½†æˆ‘è¿›è¡Œäº†ä¸€äº›å®éªŒ</span><br><span class="hljs-keyword">class</span> <span class="hljs-title class_">GraphVisualizationTool</span>(enum.Enum):<br>    NETWORKX = <span class="hljs-number">0</span>,<br>    IGRAPH = <span class="hljs-number">1</span><br><br><br><span class="hljs-comment"># æˆ‘ä»¬å°†ä»æ­¤ç›®å½•ä¸­å¯¼å‡ºå’Œè¯»å–æ•°æ®</span><br>DATA_DIR_PATH = os.path.join(os.getcwd(), <span class="hljs-string">&#x27;data&#x27;</span>)<br>CORA_PATH = os.path.join(DATA_DIR_PATH, <span class="hljs-string">&#x27;cora&#x27;</span>)  <span class="hljs-comment"># è¿™æ˜¯å·²ç»æ£€å…¥çš„ï¼Œæ— éœ€åˆ›å»ºç›®å½•</span><br><br><span class="hljs-comment">#</span><br><span class="hljs-comment"># Cora ç‰¹å®šå¸¸é‡</span><br><span class="hljs-comment">#</span><br><br><span class="hljs-comment"># Thomas Kipf ç­‰äººåœ¨ GCN è®ºæ–‡ä¸­é¦–æ¬¡ä½¿ç”¨äº†æ­¤æ‹†åˆ†ï¼Œåæ¥ Petar VeliÄkoviÄ‡ ç­‰äººåœ¨ GAT è®ºæ–‡ä¸­ä¹Ÿä½¿ç”¨äº†å®ƒ</span><br>CORA_TRAIN_RANGE = [<span class="hljs-number">0</span>, <span class="hljs-number">140</span>]  <span class="hljs-comment"># æˆ‘ä»¬å°†å‰ 140 ä¸ªèŠ‚ç‚¹ç”¨ä½œè®­ç»ƒèŠ‚ç‚¹</span><br>CORA_VAL_RANGE = [<span class="hljs-number">140</span>, <span class="hljs-number">140</span>+<span class="hljs-number">500</span>]<br>CORA_TEST_RANGE = [<span class="hljs-number">1708</span>, <span class="hljs-number">1708</span>+<span class="hljs-number">1000</span>]<br>CORA_NUM_INPUT_FEATURES = <span class="hljs-number">1433</span><br>CORA_NUM_CLASSES = <span class="hljs-number">7</span><br><br><span class="hljs-comment"># æ— è®ºä½•æ—¶æˆ‘ä»¬éœ€è¦å¯è§†åŒ–æ¥è‡ªä¸åŒç±»åˆ«çš„ç‚¹æ—¶ï¼ˆt-SNEã€CORA å¯è§†åŒ–ï¼‰</span><br>cora_label_to_color_map = &#123;<span class="hljs-number">0</span>: <span class="hljs-string">&quot;red&quot;</span>, <span class="hljs-number">1</span>: <span class="hljs-string">&quot;blue&quot;</span>, <span class="hljs-number">2</span>: <span class="hljs-string">&quot;green&quot;</span>, <span class="hljs-number">3</span>: <span class="hljs-string">&quot;orange&quot;</span>, <span class="hljs-number">4</span>: <span class="hljs-string">&quot;yellow&quot;</span>, <span class="hljs-number">5</span>: <span class="hljs-string">&quot;pink&quot;</span>, <span class="hljs-number">6</span>: <span class="hljs-string">&quot;gray&quot;</span>&#125;<br><br></code></pre></td></tr></table></figure>

<p>è¿™æ ·æˆ‘ä»¬å°±è§£é”äº†1çº§ï¼ˆæ•°æ®ğŸ“œï¼‰ã€‚æˆ‘ä»¬ç»§ç»­ï¼</p>
<h1 id="ç¬¬-1-éƒ¨åˆ†ï¼šäº†è§£æ‚¨çš„æ•°æ®ï¼ˆä¸æ•°æ®åˆè€Œä¸ºä¸€ğŸ“œâ¤ï¸ï¼‰"><a href="#ç¬¬-1-éƒ¨åˆ†ï¼šäº†è§£æ‚¨çš„æ•°æ®ï¼ˆä¸æ•°æ®åˆè€Œä¸ºä¸€ğŸ“œâ¤ï¸ï¼‰" class="headerlink" title="ç¬¬ 1 éƒ¨åˆ†ï¼šäº†è§£æ‚¨çš„æ•°æ®ï¼ˆä¸æ•°æ®åˆè€Œä¸ºä¸€ğŸ“œâ¤ï¸ï¼‰"></a>ç¬¬ 1 éƒ¨åˆ†ï¼šäº†è§£æ‚¨çš„æ•°æ®ï¼ˆä¸æ•°æ®åˆè€Œä¸ºä¸€ğŸ“œâ¤ï¸ï¼‰</h1><p>æˆ‘å°†ä½¿ç”¨ Cora å¼•æ–‡ç½‘ç»œä½œä¸ºæœ¬ç¬”è®°æœ¬ä¸­çš„è¿è¡Œç¤ºä¾‹ã€‚</p>
<p>è¯´åˆ°è¿™é‡Œï¼Œä½ å¯èƒ½ä¼šæƒ³ï¼Œä¼ å¯¼å­¦ä¹ å’Œå½’çº³å­¦ä¹ æœ‰ä»€ä¹ˆåŒºåˆ«ï¼Ÿå¦‚æœæ‚¨ä¸ç†Ÿæ‚‰ GNNï¼Œè¿™å¯èƒ½çœ‹èµ·æ¥æ˜¯ä¸€ä¸ªå¥‡æ€ªçš„æ¦‚å¿µã€‚ä½†å®é™…ä¸Šå¾ˆç®€å•ã€‚</p>
<p><strong>ä¼ å¯¼æ³•</strong> - ä½ æœ‰ä¸€ä¸ªå›¾ï¼ˆå¦‚ Coraï¼‰ï¼Œä½ å°†ä¸€äº›èŠ‚ç‚¹ï¼ˆè€Œä¸æ˜¯å›¾ï¼‰åˆ†æˆè®­ç»ƒ&#x2F;éªŒè¯&#x2F;æµ‹è¯•è®­ç»ƒé›†ã€‚åœ¨è®­ç»ƒæ—¶ï¼Œæ‚¨å°†ä»…ä½¿ç”¨è®­ç»ƒèŠ‚ç‚¹ä¸­çš„æ ‡ç­¾ã€‚ä½†ã€‚åœ¨å‰å‘ä¼ æ’­æœŸé—´ï¼Œæ ¹æ®ç©ºé—´ GNN å·¥ä½œæ–¹å¼çš„æœ¬è´¨ï¼Œæ‚¨å°†èšåˆæ¥è‡ªé‚»å±…çš„ç‰¹å¾å‘é‡ï¼Œå…¶ä¸­ä¸€äº›å¯èƒ½å±äºéªŒè¯ç”šè‡³æµ‹è¯•é›†ï¼è¦ç‚¹æ˜¯ - æ‚¨æ²¡æœ‰ä½¿ç”¨å®ƒä»¬çš„æ ‡ç­¾ä¿¡æ¯ï¼Œè€Œæ˜¯ä½¿ç”¨äº†ç»“æ„ä¿¡æ¯åŠå…¶ç‰¹å¾ã€‚</p>
<p><strong>å½’çº³æ³•</strong> - å¦‚æœæ‚¨æœ‰è®¡ç®—æœºè§†è§‰æˆ– NLPåŸºç¡€ï¼Œæ‚¨å¯èƒ½ä¼šæ›´ç†Ÿæ‚‰è¿™ä¸€æ¦‚å¿µã€‚æ‚¨æœ‰ä¸€ç»„è®­ç»ƒå›¾ã€ä¸€ç»„å•ç‹¬çš„éªŒè¯å›¾ï¼Œå½“ç„¶è¿˜æœ‰ä¸€ç»„å•ç‹¬çš„æµ‹è¯•å›¾ã€‚ä¾‹å¦‚ï¼Œåœ¨å›¾åˆ†ç±»ä»»åŠ¡ä¸­ï¼Œè®­ç»ƒæ•°æ®å¯ä»¥åŒ…å«å¸¦æ ‡ç­¾çš„å›¾ï¼Œæµ‹è¯•æ•°æ®å¯ä»¥åŒ…å«ä¸å¸¦æ ‡ç­¾çš„å›¾ã€‚æ¨¡å‹åªèƒ½åˆ©ç”¨è®­ç»ƒæ•°æ®ä¸­çš„å›¾æ¥å­¦ä¹ å›¾åˆ†ç±»æ¨¡å‹ã€‚</p>
<p>è§£é‡Šè¿™äº›å®Œåï¼Œè®©æˆ‘ä»¬è¿›å…¥ä»£ç å¹¶åŠ è½½å’Œå¯è§†åŒ– Coraã€‚</p>
<figure class="highlight python"><table><tr><td class="code"><pre><code class="hljs python"><span class="hljs-comment"># é¦–å…ˆï¼Œè®©æˆ‘ä»¬å®šä¹‰è¿™äº›ç®€å•çš„åŠŸèƒ½ç”¨äºåŠ è½½/ä¿å­˜pickleæ–‡ä»¶ - ä¸ºäº†Coraæˆ‘ä»¬éœ€è¦å®ƒä»¬</span><br><br><span class="hljs-comment"># æ‰€æœ‰Coraæ•°æ®éƒ½å­˜å‚¨ä¸ºpickleæ–‡ä»¶</span><br><span class="hljs-keyword">def</span> <span class="hljs-title function_">pickle_read</span>(<span class="hljs-params">path</span>):<br>    <span class="hljs-keyword">with</span> <span class="hljs-built_in">open</span>(path, <span class="hljs-string">&#x27;rb&#x27;</span>) <span class="hljs-keyword">as</span> file:<br>        data = pickle.load(file)<br><br>    <span class="hljs-keyword">return</span> data<br><br><span class="hljs-keyword">def</span> <span class="hljs-title function_">pickle_save</span>(<span class="hljs-params">path, data</span>):<br>    <span class="hljs-keyword">with</span> <span class="hljs-built_in">open</span>(path, <span class="hljs-string">&#x27;wb&#x27;</span>) <span class="hljs-keyword">as</span> file:<br>        pickle.dump(data, file, protocol=pickle.HIGHEST_PROTOCOL)<br></code></pre></td></tr></table></figure>

<p>ç°åœ¨è®©æˆ‘ä»¬çœ‹çœ‹å¦‚ä½•åŠ è½½ Coraï¼</p>
<figure class="highlight python"><table><tr><td class="code"><pre><code class="hljs python"><span class="hljs-comment"># æˆ‘ä»¬ç¨åä¼šä¼ å…¥è®­ç»ƒé…ç½®å­—å…¸</span><br><span class="hljs-keyword">def</span> <span class="hljs-title function_">load_graph_data</span>(<span class="hljs-params">training_config, device</span>):<br>    dataset_name = training_config[<span class="hljs-string">&#x27;dataset_name&#x27;</span>].lower()<br>    should_visualize = training_config[<span class="hljs-string">&#x27;should_visualize&#x27;</span>]<br><br>    <span class="hljs-keyword">if</span> dataset_name == DatasetType.CORA.name.lower():<br><br>        <span class="hljs-comment"># å½¢çŠ¶ = (N, FIN)ï¼Œå…¶ä¸­ N æ˜¯èŠ‚ç‚¹æ•°ï¼ŒFIN æ˜¯è¾“å…¥ç‰¹å¾æ•°</span><br>        node_features_csr = pickle_read(os.path.join(CORA_PATH, <span class="hljs-string">&#x27;node_features.csr&#x27;</span>))<br>        <span class="hljs-comment"># å½¢çŠ¶ = (N, 1)</span><br>        node_labels_npy = pickle_read(os.path.join(CORA_PATH, <span class="hljs-string">&#x27;node_labels.npy&#x27;</span>))<br>        <span class="hljs-comment"># å½¢çŠ¶ = (N, ç›¸é‚»èŠ‚ç‚¹æ•°) &lt;- è¿™æ˜¯ä¸€ä¸ªå­—å…¸ï¼Œä¸æ˜¯çŸ©é˜µï¼</span><br>        adjacency_list_dict = pickle_read(os.path.join(CORA_PATH, <span class="hljs-string">&#x27;adjacency_list.dict&#x27;</span>))<br><br>        <span class="hljs-comment"># æ ‡å‡†åŒ–ç‰¹å¾ï¼ˆæœ‰åŠ©äºè®­ç»ƒï¼‰</span><br>        node_features_csr = normalize_features_sparse(node_features_csr)<br>        num_of_nodes = <span class="hljs-built_in">len</span>(node_labels_npy)<br><br>        <span class="hljs-comment"># å½¢çŠ¶ = (2, E)ï¼Œå…¶ä¸­ E æ˜¯è¾¹æ•°ï¼Œ2 æ˜¯æºèŠ‚ç‚¹å’Œç›®æ ‡èŠ‚ç‚¹ã€‚åŸºæœ¬ä¸Šè¾¹ç¼˜ç´¢å¼•</span><br>        <span class="hljs-comment"># åŒ…å«æ ¼å¼ä¸º S-&gt;T çš„å…ƒç»„ï¼Œä¾‹å¦‚ 0-&gt;3 è¡¨ç¤ºå…·æœ‰ ID 0 çš„èŠ‚ç‚¹æŒ‡å‘å…·æœ‰ ID 3 çš„èŠ‚ç‚¹ã€‚</span><br>        topology = build_edge_index(adjacency_list_dict, num_of_nodes, add_self_edges=<span class="hljs-literal">True</span>)<br><br>        <span class="hljs-comment"># æ³¨æ„ï¼štopology åªæ˜¯å‘½åå›¾ç»“æ„æ•°æ®çš„èŠ±å“¨æ–¹å¼</span><br>        <span class="hljs-comment"># ï¼ˆé™¤è¾¹ç¼˜ç´¢å¼•ä¹‹å¤–ï¼Œå®ƒå¯ä»¥æ˜¯é‚»æ¥çŸ©é˜µçš„å½¢å¼ï¼‰</span><br><br>        <span class="hljs-keyword">if</span> should_visualize:  <span class="hljs-comment"># ç½‘ç»œåˆ†æå’Œå›¾ç»˜åˆ¶</span><br>            plot_in_out_degree_distributions(topology, num_of_nodes, dataset_name)  <span class="hljs-comment"># æˆ‘ä»¬å°†åœ¨ç¬¬äºŒéƒ¨åˆ†å®šä¹‰è¿™äº›</span><br>            visualize_graph(topology, node_labels_npy, dataset_name)<br><br>        <span class="hljs-comment"># è½¬æ¢ä¸ºç¨ å¯† PyTorch å¼ é‡</span><br><br>        <span class="hljs-comment"># éœ€è¦æ˜¯ long int ç±»å‹ï¼Œå› ä¸ºä»¥ååƒ PyTorch çš„ index_select è¿™æ ·çš„å‡½æ•°æœŸæœ›å®ƒ</span><br>        topology = torch.tensor(topology, dtype=torch.long, device=device)<br>        node_labels = torch.tensor(node_labels_npy, dtype=torch.long, device=device)  <span class="hljs-comment"># äº¤å‰ç†µæœŸæœ›ä¸€ä¸ª long int</span><br>        node_features = torch.tensor(node_features_csr.todense(), device=device)<br><br>        <span class="hljs-comment"># å¸®åŠ©æˆ‘ä»¬æå–å±äºè®­ç»ƒ/éªŒè¯å’Œæµ‹è¯•æ‹†åˆ†çš„èŠ‚ç‚¹çš„ç´¢å¼•</span><br>        train_indices = torch.arange(CORA_TRAIN_RANGE[<span class="hljs-number">0</span>], CORA_TRAIN_RANGE[<span class="hljs-number">1</span>], dtype=torch.long, device=device)<br>        val_indices = torch.arange(CORA_VAL_RANGE[<span class="hljs-number">0</span>], CORA_VAL_RANGE[<span class="hljs-number">1</span>], dtype=torch.long, device=device)<br>        test_indices = torch.arange(CORA_TEST_RANGE[<span class="hljs-number">0</span>], CORA_TEST_RANGE[<span class="hljs-number">1</span>], dtype=torch.long, device=device)<br><br>        <span class="hljs-keyword">return</span> node_features, node_labels, topology, train_indices, val_indices, test_indices<br>    <span class="hljs-keyword">else</span>:<br>        <span class="hljs-keyword">raise</span> Exception(<span class="hljs-string">f&#x27;<span class="hljs-subst">&#123;dataset_name&#125;</span> not yet supported.&#x27;</span>)<br><br></code></pre></td></tr></table></figure>

<p>å¾ˆå¥½ï¼Œæˆ‘è¿˜ä½¿ç”¨äº†å¦å¤– 2 ä¸ªå°šæœªå®šä¹‰çš„å‡½æ•°ã€‚é¦–å…ˆè®©æˆ‘ä»¬çœ‹çœ‹å¦‚ä½•åœ¨ Cora ä¸Šè¿›è¡Œç‰¹å¾æ ‡å‡†åŒ–ï¼š</p>
<figure class="highlight python"><table><tr><td class="code"><pre><code class="hljs python"><span class="hljs-keyword">def</span> <span class="hljs-title function_">normalize_features_sparse</span>(<span class="hljs-params">node_features_sparse</span>):<br>    <span class="hljs-keyword">assert</span> sp.issparse(node_features_sparse), <span class="hljs-string">f&#x27;Expected a sparse matrix, got <span class="hljs-subst">&#123;node_features_sparse&#125;</span>.&#x27;</span><br><br>    <span class="hljs-comment"># è€Œä¸æ˜¯åƒ normalize_features_dense() ä¸­é‚£æ ·è¿›è¡Œé™¤æ³•ï¼Œæˆ‘ä»¬å¯¹ç‰¹å¾çš„é€†å’Œè¿›è¡Œä¹˜æ³•ã€‚</span><br>    <span class="hljs-comment"># ç°ä»£ç¡¬ä»¶ï¼ˆGPUã€TPUã€ASICï¼‰é’ˆå¯¹å¿«é€ŸçŸ©é˜µä¹˜æ³•è¿›è¡Œäº†ä¼˜åŒ–ï¼ ^^ (* &gt;&gt; /)</span><br>    <span class="hljs-comment"># å½¢çŠ¶ = (N, FIN) -&gt; (N, 1)ï¼Œå…¶ä¸­ N è¡¨ç¤ºèŠ‚ç‚¹æ•°ï¼ŒFIN è¡¨ç¤ºè¾“å…¥ç‰¹å¾æ•°</span><br>    node_features_sum = np.array(node_features_sparse.<span class="hljs-built_in">sum</span>(-<span class="hljs-number">1</span>))  <span class="hljs-comment"># å¯¹æ¯ä¸ªèŠ‚ç‚¹ç‰¹å¾å‘é‡æ±‚å’Œç‰¹å¾</span><br><br>    <span class="hljs-comment"># åˆ›å»ºä¸€ä¸ªé€†çŸ©é˜µï¼ˆè®°ä½ * by 1/x ä¼˜äºï¼ˆæ›´å¿«ï¼‰/ by xï¼‰</span><br>    <span class="hljs-comment"># å½¢çŠ¶ = (N, 1) -&gt; (N)</span><br>    node_features_inv_sum = np.power(node_features_sum, -<span class="hljs-number">1</span>).squeeze()<br><br>    <span class="hljs-comment"># å†æ¬¡æŸäº›å’Œå°†ä¸º 0ï¼Œå› æ­¤ 1/0 å°†ä¸ºæˆ‘ä»¬æä¾› infï¼Œå› æ­¤æˆ‘ä»¬å°†å®ƒä»¬æ›¿æ¢ä¸º 1ï¼Œå®ƒæ˜¯ mul çš„ä¸­æ€§å…ƒç´ </span><br>    node_features_inv_sum[np.isinf(node_features_inv_sum)] = <span class="hljs-number">1.</span><br><br>    <span class="hljs-comment"># åˆ›å»ºä¸€ä¸ªå¯¹è§’çŸ©é˜µï¼Œå…¶å¯¹è§’çº¿ä¸Šçš„å€¼æ¥è‡ª node_features_inv_sum</span><br>    diagonal_inv_features_sum_matrix = sp.diags(node_features_inv_sum)<br><br>    <span class="hljs-comment"># æˆ‘ä»¬è¿”å›å½’ä¸€åŒ–çš„ç‰¹å¾ã€‚</span><br>    <span class="hljs-keyword">return</span> diagonal_inv_features_sum_matrix.dot(node_features_sparse)<br><br></code></pre></td></tr></table></figure>

<p>å®ƒåŸºæœ¬ä¸Šä½¿Cora çš„äºŒå…ƒèŠ‚ç‚¹ç‰¹å¾å‘é‡æ€»å’Œä¸º1ã€‚ä¾‹å¦‚ï¼Œå¦‚æœæˆ‘ä»¬æœ‰[1, 0, 1, 0, 1]ï¼ˆCoraçš„ç‰¹å¾å‘é‡æ›´é•¿ï¼Œæˆ‘ä»¬å¾ˆå¿«å°±ä¼šçœ‹åˆ°ï¼Œä½†æˆ‘ä»¬æš‚æ—¶é‡‡ç”¨â€‹â€‹è¿™ä¸ªï¼‰ï¼Œå®ƒå°†è¢«è½¬æ¢ä¸º[0.33, 0, 0.33, 0, 0.33]. å°±é‚£ä¹ˆç®€å•ã€‚ç†è§£å®é™…çš„å®ç°æ€»æ˜¯æ¯”è¾ƒå›°éš¾ï¼Œä½†ä»æ¦‚å¿µä¸Šè®²ï¼Œè¿™æ˜¯å°èœä¸€ç¢Ÿã€‚</p>
<p>è®©æˆ‘ä»¬å»ºç«‹è¾¹ç´¢å¼•ï¼š</p>
<figure class="highlight python"><table><tr><td class="code"><pre><code class="hljs python"><span class="hljs-keyword">def</span> <span class="hljs-title function_">build_edge_index</span>(<span class="hljs-params">adjacency_list_dict, num_of_nodes, add_self_edges=<span class="hljs-literal">True</span></span>):<br>    source_nodes_ids, target_nodes_ids = [], []<br>    seen_edges = <span class="hljs-built_in">set</span>()<br><br>    <span class="hljs-keyword">for</span> src_node, neighboring_nodes <span class="hljs-keyword">in</span> adjacency_list_dict.items():<br>        <span class="hljs-keyword">for</span> trg_node <span class="hljs-keyword">in</span> neighboring_nodes:<br>            <span class="hljs-comment"># if this edge hasn&#x27;t been seen so far we add it to the edge index (coalescing - removing duplicates)</span><br>            <span class="hljs-keyword">if</span> (src_node, trg_node) <span class="hljs-keyword">not</span> <span class="hljs-keyword">in</span> seen_edges:  <span class="hljs-comment"># it&#x27;d be easy to explicitly remove self-edges (Cora has none..)</span><br>                source_nodes_ids.append(src_node)<br>                target_nodes_ids.append(trg_node)<br><br>                seen_edges.add((src_node, trg_node))<br><br>    <span class="hljs-keyword">if</span> add_self_edges:<br>        source_nodes_ids.extend(np.arange(num_of_nodes))<br>        target_nodes_ids.extend(np.arange(num_of_nodes))<br><br>    <span class="hljs-comment"># shape = (2, E), where E is the number of edges in the graph</span><br>    edge_index = np.row_stack((source_nodes_ids, target_nodes_ids))<br><br>    <span class="hljs-keyword">return</span> edge_index<br></code></pre></td></tr></table></figure>

<p>è¿™ä¸ªåº”è¯¥ç›¸å½“ç®€å• - æˆ‘ä»¬åªæ˜¯ä»¥è¿™ç§æ ¼å¼ç´¯ç§¯è¾¹ï¼š<br>[[0, 1], [2, 2], â€¦] å…¶ä¸­ [s, t] å…ƒç»„åŸºæœ¬ä¸Šå®šä¹‰äº†èŠ‚ç‚¹sï¼ˆæºï¼‰æŒ‡å‘çš„è¾¹åˆ°èŠ‚ç‚¹tï¼ˆç›®æ ‡ï¼‰ã€‚</p>
<p>å…¶ä»–æµè¡Œçš„æ ¼å¼ï¼ˆåœ¨æºç å¦å¤–ä¸ªå®ç°ä¸­ä½¿ç”¨ï¼‰æ˜¯é‚»æ¥çŸ©é˜µ- ä½†å®ƒä»¬å ç”¨æ›´å¤šçš„å†…å­˜ï¼ˆå‡†ç¡®åœ°è¯´ï¼ŒO(N^2)ï¼Œä¸è¾¹ç¼˜ç´¢å¼•ç»“æ„çš„ O(E) è¿›è¡Œæ¯”è¾ƒï¼‰ã€‚</p>
<p>å¾ˆå¥½ï¼Œæœ€åè®©æˆ‘ä»¬å°è¯•åŠ è½½å®ƒã€‚æˆ‘ä»¬è¿˜åº”è¯¥åˆ†æå½¢çŠ¶â€”â€”è¿™æ€»æ˜¯ä¸€ä¸ªå¥½ä¸»æ„ã€‚</p>
<figure class="highlight python"><table><tr><td class="code"><pre><code class="hljs python"><span class="hljs-comment"># Let&#x27;s just define dummy visualization functions for now - just to stop Python interpreter from complaining!</span><br><br><span class="hljs-keyword">def</span> <span class="hljs-title function_">plot_in_out_degree_distributions</span>():<br>    <span class="hljs-keyword">pass</span><br><br><span class="hljs-keyword">def</span> <span class="hljs-title function_">visualize_graph</span>():<br>    <span class="hljs-keyword">pass</span><br><br>device = torch.device(<span class="hljs-string">&quot;cuda&quot;</span> <span class="hljs-keyword">if</span> torch.cuda.is_available() <span class="hljs-keyword">else</span> <span class="hljs-string">&quot;cpu&quot;</span>)  <span class="hljs-comment"># checking whether you have a GPU</span><br><br>config = &#123;<br>    <span class="hljs-string">&#x27;dataset_name&#x27;</span>: DatasetType.CORA.name,<br>    <span class="hljs-string">&#x27;should_visualize&#x27;</span>: <span class="hljs-literal">False</span><br>&#125;<br><br>node_features, node_labels, edge_index, train_indices, val_indices, test_indices = load_graph_data(config, device)<br><br><span class="hljs-built_in">print</span>(node_features.shape, node_features.dtype)<br><span class="hljs-built_in">print</span>(node_labels.shape, node_labels.dtype)<br><span class="hljs-built_in">print</span>(edge_index.shape, edge_index.dtype)<br><span class="hljs-built_in">print</span>(train_indices.shape, train_indices.dtype)<br><span class="hljs-built_in">print</span>(val_indices.shape, val_indices.dtype)<br><span class="hljs-built_in">print</span>(test_indices.shape, test_indices.dtype)<br></code></pre></td></tr></table></figure>

<pre><code class="hljs">torch.Size([2708, 1433]) torch.float32
torch.Size([2708]) torch.int64
torch.Size([2, 13264]) torch.int64
torch.Size([140]) torch.int64
torch.Size([500]) torch.int64
torch.Size([1000]) torch.int64


/var/folders/f0/812mfv7x63vbytjs3yf4gxtc0000gn/T/ipykernel_16269/2448994618.py:6: DeprecationWarning: Please use `csr_matrix` from the `scipy.sparse` namespace, the `scipy.sparse.csr` namespace is deprecated.
  data = pickle.load(file)
</code></pre>
<p>å¥½çš„ï¼åˆ†æå½¢çŠ¶æˆ‘ä»¬å¯ä»¥çœ‹åˆ°ä»¥ä¸‹å†…å®¹ï¼š</p>
<ol>
<li>Coraæœ‰2708ä¸ªèŠ‚ç‚¹</li>
<li>æ¯ä¸ªèŠ‚ç‚¹æœ‰ 1433 ä¸ªç‰¹å¾ï¼ˆæŸ¥çœ‹data_loading.pyäº†è§£æ›´å¤šè¯¦ç»†ä¿¡æ¯ï¼‰</li>
<li>æˆ‘ä»¬æœ‰ 13264 æ¡è¾¹ï¼ï¼ˆåŒ…æ‹¬è‡ªèº«è¾¹ï¼‰</li>
<li>æˆ‘ä»¬æœ‰140ä¸ªè®­ç»ƒèŠ‚ç‚¹</li>
<li>æˆ‘ä»¬æœ‰ 500 ä¸ªéªŒè¯èŠ‚ç‚¹</li>
<li>æˆ‘ä»¬æœ‰1000ä¸ªæµ‹è¯•èŠ‚ç‚¹<br>æ­¤å¤–ï¼Œå‡ ä¹æ‰€æœ‰æ•°æ®éƒ½æ˜¯ int 64 ç±»å‹ã€‚ä¸ºä»€ä¹ˆï¼Ÿè¿™æ˜¯ PyTorch å¼ºåŠ ç»™æˆ‘ä»¬çš„ä¸€ä¸ªé™åˆ¶ã€‚æŸå¤±å‡½æ•°nn.CrossEntropyLosså’Œindex_selectå‡½æ•°éœ€è¦ torch.long ï¼ˆå³ 64 ä½æ•´æ•°ï¼‰-æ‰€ä»¥è¿™æ ·ã€‚</li>
</ol>
<ul>
<li><code>node_labels</code>æ˜¯ int64 å› ä¸º<code>nn.CrossEntropyLoss</code></li>
<li>å…¶ä»–å˜é‡æ˜¯ int64 å› ä¸º<code>index_select</code><br>åœ¨â€œæ—æ³¨â€ä¸­ï¼Œéšç€æ‚¨çš„è¿›å±•æµ‹è¯•æ‚¨çš„ä»£ç æ€»æ˜¯ä¸€ä¸ªå¥½ä¸»æ„ã€‚</li>
</ul>
<p>æ•°æ®åŠ è½½ä¸æ­¤ç¬”è®°æœ¬çš„å…¶ä½™éƒ¨åˆ†å®Œå…¨æ­£äº¤ï¼Œå› æ­¤æˆ‘ä»¬å¯ä»¥ç‹¬ç«‹æµ‹è¯•å®ƒï¼Œå¹¶ç¡®ä¿å½¢çŠ¶å’Œæ•°æ®ç±»å‹æœ‰æ„ä¹‰ã€‚æˆ‘åœ¨å¼€å‘åƒè¿™æ ·çš„é¡¹ç›®ï¼ˆä»¥åŠä¸€èˆ¬æƒ…å†µä¸‹ï¼‰æ—¶ä½¿ç”¨è¿™ä¸€ç­–ç•¥ã€‚</p>
<p>æˆ‘ä»æ•°æ®å¼€å§‹ï¼Œæ·»åŠ åŠ è½½åŠŸèƒ½ï¼Œæ·»åŠ ä¸€äº›å¯è§†åŒ–ï¼Œç„¶åæˆ‘é€šå¸¸æ‰å¼€å§‹å¼€å‘æ·±åº¦å­¦ä¹ æ¨¡å‹æœ¬èº«ã€‚</p>
<p>å¯è§†åŒ–æ˜¯ä¸€ä¸ªå·¨å¤§çš„å¥½å¤„ï¼Œæ‰€ä»¥è®©æˆ‘ä»¬å¼€å‘å®ƒä»¬ã€‚</p>
<h1 id="å¯è§†åŒ–æ•°æ®ğŸ”®ğŸ‘“"><a href="#å¯è§†åŒ–æ•°æ®ğŸ”®ğŸ‘“" class="headerlink" title="å¯è§†åŒ–æ•°æ®ğŸ”®ğŸ‘“"></a>å¯è§†åŒ–æ•°æ®ğŸ”®ğŸ‘“</h1><p>è®©æˆ‘ä»¬é¦–å…ˆäº†è§£ Cora ä¸­èŠ‚ç‚¹çš„åº¦åˆ†å¸ƒ - å³èŠ‚ç‚¹æœ‰å¤šå°‘æ¡è¾“å…¥&#x2F;è¾“å‡ºè¾¹ï¼Œè¿™æ˜¯å›¾è¿é€šæ€§çš„æŸç§åº¦é‡ã€‚</p>
<p>è¿è¡Œä»¥ä¸‹ä»£ç ï¼š</p>
<figure class="highlight python"><table><tr><td class="code"><pre><code class="hljs python"><span class="hljs-keyword">def</span> <span class="hljs-title function_">plot_in_out_degree_distributions</span>(<span class="hljs-params">edge_index, num_of_nodes, dataset_name</span>):<br>    <span class="hljs-string">&quot;&quot;&quot;</span><br><span class="hljs-string">        æ³¨æ„ï¼šä½¿ç”¨ igraph/networkx ç­‰å·¥å…·å¯ä»¥è½»æ¾è¿›è¡Œå„ç§å¼ºå¤§çš„ç½‘ç»œåˆ†æã€‚</span><br><span class="hljs-string">        æˆ‘é€‰æ‹©åœ¨æ­¤å¤„æ˜¾å¼è®¡ç®—ä»…èŠ‚ç‚¹åº¦é‡ç»Ÿè®¡ï¼Œä½†å¦‚æœéœ€è¦ï¼Œæ‚¨å¯ä»¥æ·±å…¥ç ”ç©¶å¹¶è®¡ç®—å›¾ç›´å¾„ã€ä¸‰è§’å½¢æ•°é‡ä»¥åŠè®¸å¤šå…¶ä»–ç½‘ç»œåˆ†æé¢†åŸŸçš„æ¦‚å¿µã€‚</span><br><span class="hljs-string"></span><br><span class="hljs-string">    &quot;&quot;&quot;</span><br>    <span class="hljs-keyword">if</span> <span class="hljs-built_in">isinstance</span>(edge_index, torch.Tensor):<br>        edge_index = edge_index.cpu().numpy()<br>        <br>    <span class="hljs-keyword">assert</span> <span class="hljs-built_in">isinstance</span>(edge_index, np.ndarray), <span class="hljs-string">f&#x27;Expected NumPy array got <span class="hljs-subst">&#123;<span class="hljs-built_in">type</span>(edge_index)&#125;</span>.&#x27;</span><br><br>    <span class="hljs-comment"># å­˜å‚¨æ¯ä¸ªèŠ‚ç‚¹çš„è¾“å…¥å’Œè¾“å‡ºåº¦ï¼ˆå¯¹äºæ— å‘å›¾å¦‚ Coraï¼Œå®ƒä»¬æ˜¯ç›¸åŒçš„ï¼‰</span><br>    in_degrees = np.zeros(num_of_nodes, dtype=<span class="hljs-built_in">int</span>)<br>    out_degrees = np.zeros(num_of_nodes, dtype=<span class="hljs-built_in">int</span>)<br><br>    <span class="hljs-comment"># è¾¹ç´¢å¼•å½¢çŠ¶ = (2, E)ï¼Œç¬¬ä¸€è¡ŒåŒ…å«æºèŠ‚ç‚¹ï¼Œç¬¬äºŒè¡ŒåŒ…å«ç›®æ ‡/æ±‡èŠ‚ç‚¹</span><br>    <span class="hljs-comment"># æœ¯è¯­è¯´æ˜ï¼šæºèŠ‚ç‚¹æŒ‡å‘ç›®æ ‡/æ±‡èŠ‚ç‚¹</span><br>    num_of_edges = edge_index.shape[<span class="hljs-number">1</span>]<br>    <span class="hljs-keyword">for</span> cnt <span class="hljs-keyword">in</span> <span class="hljs-built_in">range</span>(num_of_edges):<br>        source_node_id = edge_index[<span class="hljs-number">0</span>, cnt]<br>        target_node_id = edge_index[<span class="hljs-number">1</span>, cnt]<br><br>        out_degrees[source_node_id] += <span class="hljs-number">1</span>  <span class="hljs-comment"># æºèŠ‚ç‚¹æŒ‡å‘å…¶ä»–èŠ‚ç‚¹ -&gt; å¢åŠ å…¶å‡ºåº¦</span><br>        in_degrees[target_node_id] += <span class="hljs-number">1</span>  <span class="hljs-comment"># ç±»ä¼¼åœ°</span><br><br>    hist = np.zeros(np.<span class="hljs-built_in">max</span>(out_degrees) + <span class="hljs-number">1</span>)<br>    <span class="hljs-keyword">for</span> out_degree <span class="hljs-keyword">in</span> out_degrees:<br>        hist[out_degree] += <span class="hljs-number">1</span><br><br>    fig = plt.figure(figsize=(<span class="hljs-number">12</span>,<span class="hljs-number">8</span>), dpi=<span class="hljs-number">100</span>)  <span class="hljs-comment"># å¦åˆ™åœ¨ Jupyter Notebook ä¸­å›¾è¡¨ä¼šå¾ˆå°</span><br>    fig.subplots_adjust(hspace=<span class="hljs-number">0.6</span>)<br><br>    plt.subplot(<span class="hljs-number">311</span>)<br>    plt.plot(in_degrees, color=<span class="hljs-string">&#x27;red&#x27;</span>)<br>    plt.xlabel(<span class="hljs-string">&#x27;node id&#x27;</span>); plt.ylabel(<span class="hljs-string">&#x27;in-degree count&#x27;</span>); plt.title(<span class="hljs-string">&#x27;ä¸åŒèŠ‚ç‚¹ id çš„è¾“å…¥åº¦&#x27;</span>)<br><br>    plt.subplot(<span class="hljs-number">312</span>)<br>    plt.plot(out_degrees, color=<span class="hljs-string">&#x27;green&#x27;</span>)<br>    plt.xlabel(<span class="hljs-string">&#x27;node id&#x27;</span>); plt.ylabel(<span class="hljs-string">&#x27;out-degree count&#x27;</span>); plt.title(<span class="hljs-string">&#x27;ä¸åŒèŠ‚ç‚¹ id çš„è¾“å‡ºåº¦&#x27;</span>)<br><br>    plt.subplot(<span class="hljs-number">313</span>)<br>    plt.plot(hist, color=<span class="hljs-string">&#x27;blue&#x27;</span>)<br>    plt.xlabel(<span class="hljs-string">&#x27;node degree&#x27;</span>)<br>    plt.ylabel(<span class="hljs-string">&#x27;ç»™å®šå‡ºåº¦çš„èŠ‚ç‚¹æ•°é‡&#x27;</span>) <br>    plt.title(<span class="hljs-string">f&#x27;<span class="hljs-subst">&#123;dataset_name&#125;</span> æ•°æ®é›†çš„èŠ‚ç‚¹å‡ºåº¦åˆ†å¸ƒ&#x27;</span>)<br>    plt.xticks(np.arange(<span class="hljs-number">0</span>, <span class="hljs-built_in">len</span>(hist), <span class="hljs-number">5.0</span>))<br><br>    plt.grid(<span class="hljs-literal">True</span>)<br>    plt.show()<br><br></code></pre></td></tr></table></figure>

<p>å¤ªæ£’äº†ï¼Œç°åœ¨è®©æˆ‘ä»¬å¯è§†åŒ– Cora çš„åº¦åˆ†å¸ƒï¼</p>
<figure class="highlight python"><table><tr><td class="code"><pre><code class="hljs python">num_of_nodes = <span class="hljs-built_in">len</span>(node_labels)<br>plot_in_out_degree_distributions(edge_index, num_of_nodes, config[<span class="hljs-string">&#x27;dataset_name&#x27;</span>])<br></code></pre></td></tr></table></figure>


<p><img src="https://ptpimg.me/92t60u.png" alt="è¯·æ·»åŠ å›¾ç‰‡æè¿°"></p>
<p>æ‚¨å¯ä»¥ç«‹å³æ³¨æ„åˆ°ä»¥ä¸‹å‡ ä»¶äº‹ï¼š</p>
<ul>
<li>å‰2ä¸ªå›¾æ˜¯ç›¸åŒçš„ï¼Œå› ä¸ºæˆ‘ä»¬å°† Cora è§†ä¸ºæ— å‘å›¾ï¼ˆå³ä½¿å®ƒè‡ªç„¶åº”è¯¥å»ºæ¨¡ä¸ºæœ‰å‘å›¾ï¼‰</li>
<li>æŸäº›èŠ‚ç‚¹å…·æœ‰å¤§é‡è¾¹ï¼ˆä¸­é—´çš„å³°å€¼ï¼‰ï¼Œä½†å¤§å¤šæ•°èŠ‚ç‚¹çš„è¾¹è¦å°‘å¾—å¤š</li>
<li>ç¬¬ä¸‰å¼ å›¾ä»¥ç›´æ–¹å›¾çš„å½¢å¼å¾ˆå¥½åœ°å¯è§†åŒ–äº†è¿™ä¸€ç‚¹ - å¤§å¤šæ•°èŠ‚ç‚¹åªæœ‰2-5æ¡è¾¹ï¼ˆå› æ­¤å³°å€¼ä½äºæœ€å·¦ä¾§ï¼‰<br>å¥½å§ï¼Œæˆ‘ä»¬å¼€å§‹å¯¹ Cora æœ‰äº†ä¸€äº›æœ‰ä»·å€¼çš„è§è§£ï¼Œè®©æˆ‘ä»¬ç»§ç»­è¿›ä¸€æ­¥ï¼Œä»å­—é¢ä¸Šæƒ³è±¡&#x2F;çœ‹åˆ° Coraã€‚</li>
</ul>
<p>ä¸‹é¢çš„å•å…ƒæ ¼å°†ç»˜åˆ¶ Coraï¼Œè¿è¡Œå®ƒã€‚</p>
<figure class="highlight python"><table><tr><td class="code"><pre><code class="hljs python"><span class="hljs-string">&quot;&quot;&quot;</span><br><span class="hljs-string">è¯·å‚é˜…æ­¤åšå®¢ä»¥äº†è§£å¯ç”¨çš„å›¾å½¢å¯è§†åŒ–å·¥å…·ï¼š</span><br><span class="hljs-string">  https://towardsdatascience.com/large-graph-visualization-tools-and-approaches-2b8758a1cd59</span><br><span class="hljs-string"></span><br><span class="hljs-string">åŸºæœ¬ä¸Šï¼Œå–å†³äºæ‚¨çš„å›¾å½¢å¤§å°ï¼Œå¯èƒ½ä¼šæœ‰ä¸€äº›æ¯” igraph æ›´å¥½çš„ç»˜å›¾å·¥å…·ã€‚</span><br><span class="hljs-string"></span><br><span class="hljs-string">æ³¨æ„ï¼šä¸å¹¸çš„æ˜¯ï¼Œæˆ‘ä¸å¾—ä¸å°†æ­¤å‡½æ•°æ‰å¹³åŒ–ï¼Œå› ä¸º igraph åœ¨ Jupyter Notebook ä¸­é‡åˆ°äº†ä¸€äº›é—®é¢˜ï¼Œ</span><br><span class="hljs-string">æˆ‘ä»¬åªä¼šåœ¨è¿™é‡Œè°ƒç”¨å®ƒï¼Œæ‰€ä»¥æ²¡å…³ç³»ï¼</span><br><span class="hljs-string"></span><br><span class="hljs-string">&quot;&quot;&quot;</span><br><br>dataset_name = config[<span class="hljs-string">&#x27;dataset_name&#x27;</span>]<br>visualization_tool=GraphVisualizationTool.IGRAPH<br><br><span class="hljs-keyword">if</span> <span class="hljs-built_in">isinstance</span>(edge_index, torch.Tensor):<br>    edge_index_np = edge_index.cpu().numpy()<br><br><span class="hljs-keyword">if</span> <span class="hljs-built_in">isinstance</span>(node_labels, torch.Tensor):<br>    node_labels_np = node_labels.cpu().numpy()<br><br>num_of_nodes = <span class="hljs-built_in">len</span>(node_labels_np)<br>edge_index_tuples = <span class="hljs-built_in">list</span>(<span class="hljs-built_in">zip</span>(edge_index_np[<span class="hljs-number">0</span>, :], edge_index_np[<span class="hljs-number">1</span>, :]))  <span class="hljs-comment"># igraph è¦æ±‚è¿™ç§æ ¼å¼</span><br><br><span class="hljs-comment"># æ„å»º igraph å›¾</span><br>ig_graph = ig.Graph()<br>ig_graph.add_vertices(num_of_nodes)<br>ig_graph.add_edges(edge_index_tuples)<br><br><span class="hljs-comment"># å‡†å¤‡å¯è§†åŒ–è®¾ç½®å­—å…¸</span><br>visual_style = &#123;<br>    <span class="hljs-string">&quot;bbox&quot;</span>: (<span class="hljs-number">700</span>, <span class="hljs-number">700</span>),<br>    <span class="hljs-string">&quot;margin&quot;</span>: <span class="hljs-number">5</span>,<br>&#125;<br><br><span class="hljs-comment"># æˆ‘é€‰æ‹©è¾¹çš„åšåº¦ä¸é€šè¿‡æˆ‘ä»¬å›¾ä¸­æŸä¸ªè¾¹çš„æœ€çŸ­è·¯å¾„ï¼ˆæµ‹åœ°çº¿ï¼‰çš„æ•°é‡æˆæ¯”ä¾‹ï¼ˆedge_betweenness å‡½æ•°ï¼Œä¸€ä¸ªç®€å•çš„ ad hoc å¯å‘å¼ï¼‰</span><br><br><span class="hljs-comment"># line1ï¼šæˆ‘ä½¿ç”¨æ—¥å¿—ï¼Œå¦åˆ™ä¸€äº›è¾¹ä¼šå¤ªåšï¼Œè€Œå…¶ä»–è¾¹æ ¹æœ¬ä¸æ˜æ˜¾</span><br><span class="hljs-comment"># edge_betweenness è¿”å› &lt; 1 å¯¹äºæŸäº›è¾¹ï¼Œè¿™å°±æ˜¯ä¸ºä»€ä¹ˆæˆ‘ä½¿ç”¨ clip ä½œä¸º log å¯¹äºé‚£äº›è¾¹æ¥è¯´æ˜¯è´Ÿçš„</span><br><span class="hljs-comment"># line2ï¼šå½’ä¸€åŒ–ï¼Œä½¿æœ€åšçš„è¾¹ä¸º 1ï¼Œå¦åˆ™è¾¹åœ¨å›¾è¡¨ä¸Šçœ‹èµ·æ¥å¤ªåš</span><br><span class="hljs-comment"># line3ï¼šè¿™é‡Œçš„æƒ³æ³•æ˜¯è®©æœ€å¼ºçš„è¾¹ç¼˜ä¿æŒæ¯”å…¶ä»–è¾¹ç¼˜æ›´å¼ºï¼Œ6 åˆšåˆšå¥½ï¼Œä¸è¦çº ç»“äºæ­¤</span><br><br>edge_weights_raw = np.clip(np.log(np.asarray(ig_graph.edge_betweenness())+<span class="hljs-number">1e-16</span>), a_min=<span class="hljs-number">0</span>, a_max=<span class="hljs-literal">None</span>)<br>edge_weights_raw_normalized = edge_weights_raw / np.<span class="hljs-built_in">max</span>(edge_weights_raw)<br>edge_weights = [w**<span class="hljs-number">6</span> <span class="hljs-keyword">for</span> w <span class="hljs-keyword">in</span> edge_weights_raw_normalized]<br>visual_style[<span class="hljs-string">&quot;edge_width&quot;</span>] = edge_weights<br><br><span class="hljs-comment"># é¡¶ç‚¹å¤§å°çš„ç®€å•å¯å‘å¼ã€‚å¤§å° ~ (åº¦/4)ï¼ˆæˆ‘å°è¯•äº† log å’Œ sqrt ä¹Ÿå–å¾—äº†å¾ˆå¥½çš„æ•ˆæœï¼‰</span><br>visual_style[<span class="hljs-string">&quot;vertex_size&quot;</span>] = [deg / <span class="hljs-number">4</span> <span class="hljs-keyword">for</span> deg <span class="hljs-keyword">in</span> ig_graph.degree()]<br><br><span class="hljs-comment"># Cora ç‰¹æœ‰çš„éƒ¨åˆ†ï¼Œå› ä¸º Cora æœ‰ 7 ä¸ªæ ‡ç­¾</span><br><span class="hljs-keyword">if</span> dataset_name.lower() == DatasetType.CORA.name.lower():<br>    visual_style[<span class="hljs-string">&quot;vertex_color&quot;</span>] = [cora_label_to_color_map[label] <span class="hljs-keyword">for</span> label <span class="hljs-keyword">in</span> node_labels_np]<br><span class="hljs-keyword">else</span>:<br>    <span class="hljs-built_in">print</span>(<span class="hljs-string">&#x27;è¯·éšæ„ä¸ºæ‚¨çš„ç‰¹å®šæ•°æ®é›†æ·»åŠ è‡ªå®šä¹‰é…è‰²æ–¹æ¡ˆã€‚ä½¿ç”¨ igraph é»˜è®¤é…è‰²ã€‚&#x27;</span>)<br><br><span class="hljs-comment"># è®¾ç½®å¸ƒå±€ - å›¾è¡¨åœ¨ 2D å›¾è¡¨ä¸Šå‘ˆç°çš„æ–¹å¼ã€‚å›¾å½¢ç»˜åˆ¶æœ¬èº«æ˜¯ä¸€ä¸ªå­é¢†åŸŸï¼</span><br><span class="hljs-comment"># æˆ‘ä½¿ç”¨â€œKamada Kawaiâ€åŠ›å¯¼å‘æ–¹æ³•ï¼Œè¿™ç»„æ–¹æ³•åŸºäºç‰©ç†ç³»ç»Ÿæ¨¡æ‹Ÿã€‚</span><br><span class="hljs-comment"># ï¼ˆlayout_drl ä¹Ÿä¸º Cora æä¾›äº†ä¸é”™çš„ç»“æœï¼‰</span><br>visual_style[<span class="hljs-string">&quot;layout&quot;</span>] = ig_graph.layout_kamada_kawai()<br><br><span class="hljs-built_in">print</span>(<span class="hljs-string">&#x27;æ­£åœ¨ç»˜åˆ¶ç»“æœ...ï¼ˆå¯èƒ½éœ€è¦å‡ ç§’é’Ÿï¼‰ã€‚&#x27;</span>)<br>ig.plot(ig_graph, **visual_style)<br><br><span class="hljs-comment"># è¿™ä¸ªç½‘ç«™æœ‰ä¸€äº›å¾ˆæ£’çš„å¯è§†åŒ–æ•ˆæœï¼Œè¯·æŸ¥çœ‹ï¼š</span><br><span class="hljs-comment"># http://networkrepository.com/graphvis.php?d=./data/gsm50/labeled/cora.edges</span><br><br></code></pre></td></tr></table></figure>

<pre><code class="hljs">æ­£åœ¨ç»˜åˆ¶ç»“æœ...ï¼ˆå¯èƒ½éœ€è¦å‡ ç§’é’Ÿï¼‰ã€‚
</code></pre>
<p><img src="https://ptpimg.me/s94oh0.png" alt="è¯·æ·»åŠ å›¾ç‰‡æè¿°"></p>
<p>å°è¯•ä½¿ç”¨visual_style[â€œbboxâ€]è®¾ç½®åˆ°(3000, 3000)å’Œåœ¨vertex_sizeç”¨ &#x2F; 2è¿è¡Œï¼Œä½ ä¼šå¾—åˆ°ä¸€ä¸ªå·¨å·¨å·¨å¤§è€ŒæƒŠäººçš„ç»˜å›¾ï¼ˆCå¤„ç† igraph åé¢çš„ç»˜å›¾ï¼Œæ‰€ä»¥å®ƒè‡³å°‘åœ¨æˆ‘çš„æœºå™¨ä¸Šç›¸å½“å¿« - å½“ä½ æ»šåŠ¨å®ƒæ—¶æœ‰ä¸€äº›è½»å¾®çš„æ»åï¼‰ã€‚</p>
<p>å¥½çš„ï¼Œæˆ‘ä»¬å·²ç»å®Œæˆäº†å¯è§†åŒ–å¹¶ç†è§£äº†æˆ‘ä»¬çš„æ•°æ®ã€‚è¿™æ˜¯ä¸€ä¸ªå·¨å¤§çš„é‡Œç¨‹ç¢‘ï¼Œæ‰€ä»¥è¯·æ‹æ‹è‡ªå·±çš„è‚©è†€ã€‚ğŸ†ğŸ‚ğŸµ</p>
<p>æˆ‘ä»¬å·²ç»è§£é”äº† 2 çº§ï¼ˆGATæ¨¡å‹ğŸ¦„ï¼‰ã€‚ğŸ˜</p>
<p>ç°åœ¨ï¼Œè®©æˆ‘ä»¬äº†è§£è¿™ä¸ªæ¨¡å‹ï¼</p>
<h1 id="ç¬¬-2-éƒ¨åˆ†ï¼šäº†è§£-GAT-çš„å†…éƒ¨è¿ä½œæ–¹å¼"><a href="#ç¬¬-2-éƒ¨åˆ†ï¼šäº†è§£-GAT-çš„å†…éƒ¨è¿ä½œæ–¹å¼" class="headerlink" title="ç¬¬ 2 éƒ¨åˆ†ï¼šäº†è§£ GAT çš„å†…éƒ¨è¿ä½œæ–¹å¼"></a>ç¬¬ 2 éƒ¨åˆ†ï¼šäº†è§£ GAT çš„å†…éƒ¨è¿ä½œæ–¹å¼</h1><p>GATé¦–å…ˆï¼Œè®©æˆ‘ä»¬åˆ›å»ºä¸€ä¸ªé«˜çº§ç±»ï¼Œæˆ‘ä»¬å°†åœ¨å…¶ä¸­ä»GatLayerå¯¹è±¡æ„å»ºã€‚</p>
<p>å®ƒåŸºæœ¬ä¸Šåªæ˜¯å°†å±‚å †å åˆ° nn.Sequential å¯¹è±¡ä¸­ï¼Œæ­¤å¤–ï¼Œç”±äº nn.Sequential éœ€è¦å•ä¸ªè¾“å…¥ï¼ˆå¹¶ä¸”å®ƒæœ‰ä¸€ä¸ªè¾“å‡ºï¼‰ï¼Œæˆ‘åªæ˜¯å°†æ•°æ®ï¼ˆç‰¹å¾ã€è¾¹ç¼˜ç´¢å¼•ï¼‰æ‰“åŒ…åˆ°ä¸€ä¸ªå…ƒç»„ä¸­ - çº¯è¯­æ³•ç³–ã€‚</p>
<figure class="highlight python"><table><tr><td class="code"><pre><code class="hljs python"><span class="hljs-keyword">import</span> torch.nn <span class="hljs-keyword">as</span> nn<br><span class="hljs-keyword">from</span> torch.optim <span class="hljs-keyword">import</span> Adam<br><br><br><span class="hljs-keyword">class</span> <span class="hljs-title class_">GAT</span>(torch.nn.Module):<br>    <span class="hljs-string">&quot;&quot;&quot;</span><br><span class="hljs-string">    æœ€æœ‰è¶£å’Œæœ€éš¾çš„å®ç°æ˜¯å®ç°ï¼ƒ3ã€‚</span><br><span class="hljs-string">    Imp1å’Œimp2åœ¨ç»†èŠ‚ä¸Šæœ‰æ‰€ä¸åŒï¼Œä½†åŸºæœ¬ä¸Šæ˜¯ç›¸åŒçš„ä¸œè¥¿ã€‚</span><br><span class="hljs-string"></span><br><span class="hljs-string">    å› æ­¤ï¼Œæˆ‘å°†åœ¨æœ¬ç¬”è®°æœ¬ä¸­ä¸“æ³¨äºimpï¼ƒ3ã€‚</span><br><span class="hljs-string"></span><br><span class="hljs-string">    &quot;&quot;&quot;</span><br><br>    <span class="hljs-keyword">def</span> <span class="hljs-title function_">__init__</span>(<span class="hljs-params">self, num_of_layers, num_heads_per_layer, num_features_per_layer, add_skip_connection=<span class="hljs-literal">True</span>, bias=<span class="hljs-literal">True</span>,</span><br><span class="hljs-params">                 dropout=<span class="hljs-number">0.6</span>, log_attention_weights=<span class="hljs-literal">False</span></span>):<br>        <span class="hljs-built_in">super</span>().__init__()<br>        <span class="hljs-keyword">assert</span> num_of_layers == <span class="hljs-built_in">len</span>(num_heads_per_layer) == <span class="hljs-built_in">len</span>(num_features_per_layer) - <span class="hljs-number">1</span>, <span class="hljs-string">f&#x27;è¾“å…¥æœ‰æ•ˆçš„æ¶æ„å‚æ•°ã€‚&#x27;</span><br><br>        num_heads_per_layer = [<span class="hljs-number">1</span>] + num_heads_per_layer  <span class="hljs-comment"># æŠ€å·§-è¿™æ ·æˆ‘å¯ä»¥å¾ˆå¥½åœ°åˆ›å»ºä¸‹é¢çš„GATå±‚</span><br><br>        gat_layers = []  <span class="hljs-comment"># æ”¶é›†GATå±‚</span><br>        <span class="hljs-keyword">for</span> i <span class="hljs-keyword">in</span> <span class="hljs-built_in">range</span>(num_of_layers):<br>            layer = GATLayer(<br>                num_in_features=num_features_per_layer[i] * num_heads_per_layer[i],  <span class="hljs-comment"># è¿æ¥çš„ç»“æœ</span><br>                num_out_features=num_features_per_layer[i+<span class="hljs-number">1</span>],<br>                num_of_heads=num_heads_per_layer[i+<span class="hljs-number">1</span>],<br>                concat=<span class="hljs-literal">True</span> <span class="hljs-keyword">if</span> i &lt; num_of_layers - <span class="hljs-number">1</span> <span class="hljs-keyword">else</span> <span class="hljs-literal">False</span>,  <span class="hljs-comment"># æœ€åä¸€ä¸ªGATå±‚æ‰§è¡Œå¹³å‡å€¼ï¼Œå…¶ä»–å±‚æ‰§è¡Œè¿æ¥</span><br>                activation=nn.ELU() <span class="hljs-keyword">if</span> i &lt; num_of_layers - <span class="hljs-number">1</span> <span class="hljs-keyword">else</span> <span class="hljs-literal">None</span>,  <span class="hljs-comment"># æœ€åä¸€å±‚åªè¾“å‡ºåŸå§‹åˆ†æ•°</span><br>                dropout_prob=dropout,<br>                add_skip_connection=add_skip_connection,<br>                bias=bias,<br>                log_attention_weights=log_attention_weights<br>            )<br>            gat_layers.append(layer)<br><br>        <span class="hljs-variable language_">self</span>.gat_net = nn.Sequential(<br>            *gat_layers,<br>        )<br><br>    <span class="hljs-comment"># æ•°æ®åªæ˜¯ä¸€ä¸ªï¼ˆin_nodes_featuresï¼Œedge_indexï¼‰å…ƒç»„ï¼Œæˆ‘å¿…é¡»è¿™æ ·åšæ˜¯å› ä¸ºnn.Sequentialï¼š</span><br>    <span class="hljs-comment"># https://discuss.pytorch.org/t/forward-takes-2-positional-arguments-but-3-were-given-for-nn-sqeuential-with-linear-layers/65698</span><br>    <span class="hljs-keyword">def</span> <span class="hljs-title function_">forward</span>(<span class="hljs-params">self, data</span>):<br>        <span class="hljs-keyword">return</span> <span class="hljs-variable language_">self</span>.gat_net(data)<br><br></code></pre></td></tr></table></figure>

<p>ç°åœ¨ï¼Œæœ‰è¶£çš„éƒ¨åˆ†è®©æˆ‘ä»¬å®šä¹‰å›¾å±‚ã€‚</p>
<p>æˆ‘ä¸è®¤ä¸ºç”¨æ–‡å­—æ¥è§£é‡Šå®ƒï¼Œæ¯”ä½ èŠ±æ—¶é—´æ¶ˆåŒ–ä»£ç å’Œæ³¨é‡Šæ›´å¥½ã€‚</p>
<p>åœ¨ä½ å¼€å§‹æµªè´¹æ—¶é—´å°è¯•â€œä»å¤´å¼€å§‹â€å¼„æ¸…æ¥šä¹‹å‰ï¼Œå¯ä»¥å…ˆè§‚çœ‹ä½œè€…åœ¨ GAT ä¸Šçš„è§†é¢‘ã€‚æ‰‹å¤´æœ‰ä¸€äº›ç†è®ºèƒŒæ™¯æ€»æ˜¯å¥½çš„ã€‚</p>
<figure class="highlight python"><table><tr><td class="code"><pre><code class="hljs python"><span class="hljs-keyword">class</span> <span class="hljs-title class_">GATLayer</span>(torch.nn.Module):<br>    <span class="hljs-string">&quot;&quot;&quot;</span><br><span class="hljs-string">    å®ç° #3 å—åˆ° PyTorch Geometric å¯å‘ï¼šhttps://github.com/rusty1s/pytorch_geometric</span><br><span class="hljs-string"></span><br><span class="hljs-string">    ä½†æ˜¯ï¼Œè¿™é‡Œçš„å®ç°åº”è¯¥æ›´å®¹æ˜“ç†è§£ï¼ï¼ˆå¹¶ä¸”æ€§èƒ½ç›¸ä¼¼ï¼‰</span><br><span class="hljs-string"></span><br><span class="hljs-string">    &quot;&quot;&quot;</span><br>    <br>    <span class="hljs-comment"># æˆ‘ä»¬ä¼šåœ¨è®¸å¤šå‡½æ•°ä¸­ä½¿ç”¨è¿™äº›å¸¸é‡ï¼Œæ‰€ä»¥åœ¨è¿™é‡Œæå–ä¸ºæˆå‘˜å­—æ®µ</span><br>    src_nodes_dim = <span class="hljs-number">0</span>  <span class="hljs-comment"># è¾¹ç´¢å¼•ä¸­æºèŠ‚ç‚¹çš„ä½ç½®</span><br>    trg_nodes_dim = <span class="hljs-number">1</span>  <span class="hljs-comment"># è¾¹ç´¢å¼•ä¸­ç›®æ ‡èŠ‚ç‚¹çš„ä½ç½®</span><br><br>    <span class="hljs-comment"># åœ¨å½’çº³è®¾ç½®ä¸­ï¼Œè¿™äº›å¯èƒ½ä¼šæ”¹å˜ - æš‚æ—¶ä¿ç•™è¿™æ ·çš„è®¾ç½®ï¼ˆæœªæ¥å¯èƒ½ä¸é€‚ç”¨ï¼‰</span><br>    nodes_dim = <span class="hljs-number">0</span>      <span class="hljs-comment"># èŠ‚ç‚¹ç»´åº¦ï¼ˆè½´åœ¨å¼ é‡ä¸­å¯èƒ½æ˜¯ä¸€ä¸ªæ›´ç†Ÿæ‚‰çš„æœ¯è¯­ï¼ŒèŠ‚ç‚¹ç»´åº¦æ˜¯&quot;N&quot;çš„ä½ç½®ï¼‰</span><br>    head_dim = <span class="hljs-number">1</span>       <span class="hljs-comment"># æ³¨æ„åŠ›å¤´ç»´åº¦</span><br><br>    <span class="hljs-keyword">def</span> <span class="hljs-title function_">__init__</span>(<span class="hljs-params">self, num_in_features, num_out_features, num_of_heads, concat=<span class="hljs-literal">True</span>, activation=nn.ELU(<span class="hljs-params"></span>),</span><br><span class="hljs-params">                 dropout_prob=<span class="hljs-number">0.6</span>, add_skip_connection=<span class="hljs-literal">True</span>, bias=<span class="hljs-literal">True</span>, log_attention_weights=<span class="hljs-literal">False</span></span>):<br><br>        <span class="hljs-built_in">super</span>().__init__()<br><br>        <span class="hljs-variable language_">self</span>.num_of_heads = num_of_heads<br>        <span class="hljs-variable language_">self</span>.num_out_features = num_out_features<br>        <span class="hljs-variable language_">self</span>.concat = concat  <span class="hljs-comment"># æ˜¯å¦åº”è¯¥è¿æ¥è¿˜æ˜¯å¹³å‡æ³¨æ„åŠ›å¤´</span><br>        <span class="hljs-variable language_">self</span>.add_skip_connection = add_skip_connection<br><br>        <span class="hljs-comment">#</span><br>        <span class="hljs-comment"># å¯è®­ç»ƒæƒé‡ï¼šçº¿æ€§æŠ•å½±çŸ©é˜µï¼ˆåœ¨è®ºæ–‡ä¸­è¡¨ç¤ºä¸º&quot;W&quot;ï¼‰ã€æ³¨æ„åŠ›ç›®æ ‡/æºï¼ˆåœ¨è®ºæ–‡ä¸­è¡¨ç¤ºä¸º&quot;a&quot;ï¼‰å’Œåå·®ï¼ˆåœ¨è®ºæ–‡ä¸­æœªæåˆ°ï¼Œä½†åœ¨å®˜æ–¹GATå­˜å‚¨åº“ä¸­å­˜åœ¨ï¼‰</span><br>        <span class="hljs-comment">#</span><br><br>        <span class="hljs-comment"># å¯ä»¥å°†è¿™ä¸ªçŸ©é˜µè§†ä¸º num_of_heads ä¸ªç‹¬ç«‹çš„ W çŸ©é˜µ</span><br>        <span class="hljs-variable language_">self</span>.linear_proj = nn.Linear(num_in_features, num_of_heads * num_out_features, bias=<span class="hljs-literal">False</span>)<br><br>        <span class="hljs-comment"># åœ¨æˆ‘ä»¬è¿æ¥ç›®æ ‡èŠ‚ç‚¹ï¼ˆèŠ‚ç‚¹ iï¼‰å’ŒæºèŠ‚ç‚¹ï¼ˆèŠ‚ç‚¹ jï¼‰ä¹‹åï¼Œæˆ‘ä»¬åº”ç”¨â€œåŠ æ³•â€è¯„åˆ†å‡½æ•°</span><br>        <span class="hljs-comment"># å®ƒç»™æˆ‘ä»¬æœªæ ‡å‡†åŒ–çš„åˆ†æ•° &quot;e&quot;ã€‚åœ¨è¿™é‡Œï¼Œæˆ‘ä»¬åˆ†å‰² &quot;a&quot; å‘é‡ - ä½†è¯­ä¹‰ä¿æŒä¸å˜ã€‚</span><br>        <span class="hljs-comment"># åŸºæœ¬ä¸Šï¼Œä¸æ‰§è¡Œ [x, y]ï¼ˆè¿æ¥ï¼Œx/y æ˜¯èŠ‚ç‚¹ç‰¹å¾å‘é‡ï¼‰å’Œä¸ &quot;a&quot; çš„ç‚¹ç§¯ä¸åŒï¼Œ</span><br>        <span class="hljs-comment"># æˆ‘ä»¬åˆ†åˆ«å¯¹ x å’Œ &quot;a_left&quot; è¿›è¡Œç‚¹ç§¯ï¼Œå¯¹ y å’Œ &quot;a_right&quot; è¿›è¡Œç‚¹ç§¯ï¼Œç„¶åå°†å®ƒä»¬ç›¸åŠ </span><br>        <span class="hljs-variable language_">self</span>.scoring_fn_target = nn.Parameter(torch.Tensor(<span class="hljs-number">1</span>, num_of_heads, num_out_features))<br>        <span class="hljs-variable language_">self</span>.scoring_fn_source = nn.Parameter(torch.Tensor(<span class="hljs-number">1</span>, num_of_heads, num_out_features))<br><br>        <span class="hljs-comment"># åœ¨ GAT ä¸­åç½®ç»å¯¹ä¸æ˜¯å…³é”®çš„ - éšæ—¶å®éªŒï¼ˆæˆ‘åœ¨è¿™ä¸ªé—®é¢˜ä¸Šå‘ä¸»è¦ä½œè€… Petar è¯¢é—®è¿‡ï¼‰</span><br>        <span class="hljs-keyword">if</span> bias <span class="hljs-keyword">and</span> concat:<br>            <span class="hljs-variable language_">self</span>.bias = nn.Parameter(torch.Tensor(num_of_heads * num_out_features))<br>        <span class="hljs-keyword">elif</span> bias <span class="hljs-keyword">and</span> <span class="hljs-keyword">not</span> concat:<br>            <span class="hljs-variable language_">self</span>.bias = nn.Parameter(torch.Tensor(num_out_features))<br>        <span class="hljs-keyword">else</span>:<br>            <span class="hljs-variable language_">self</span>.register_parameter(<span class="hljs-string">&#x27;bias&#x27;</span>, <span class="hljs-literal">None</span>)<br><br>        <span class="hljs-keyword">if</span> add_skip_connection:<br>            <span class="hljs-variable language_">self</span>.skip_proj = nn.Linear(num_in_features, num_of_heads * num_out_features, bias=<span class="hljs-literal">False</span>)<br>        <span class="hljs-keyword">else</span>:<br>            <span class="hljs-variable language_">self</span>.register_parameter(<span class="hljs-string">&#x27;skip_proj&#x27;</span>, <span class="hljs-literal">None</span>)<br><br>        <span class="hljs-comment">#</span><br>        <span class="hljs-comment"># å¯è®­ç»ƒæƒé‡ç»“æŸ</span><br>        <span class="hljs-comment">#</span><br><br>        <span class="hljs-variable language_">self</span>.leakyReLU = nn.LeakyReLU(<span class="hljs-number">0.2</span>)  <span class="hljs-comment"># ä½¿ç”¨ 0.2ï¼Œå°±åƒåœ¨è®ºæ–‡ä¸­ä¸€æ ·ï¼Œä¸éœ€è¦å…¬å¼€æ¯ä¸ªè®¾ç½®</span><br>        <span class="hljs-variable language_">self</span>.activation = activation<br>        <span class="hljs-comment"># å¯èƒ½ä¸æ˜¯æœ€å¥½çš„è®¾è®¡ï¼Œä½†æˆ‘åœ¨ 3 ä¸ªä½ç½®ä½¿ç”¨ç›¸åŒçš„æ¨¡å—ï¼Œç”¨äºç‰¹å¾æŠ•å½±ä¹‹å‰/ä¹‹åå’Œæ³¨æ„åŠ›ç³»æ•°ã€‚</span><br>        <span class="hljs-comment"># å°±åŠŸèƒ½è€Œè¨€ï¼Œå®ƒä¸ä½¿ç”¨ç‹¬ç«‹æ¨¡å—æ˜¯ç›¸åŒçš„ã€‚</span><br>        <span class="hljs-variable language_">self</span>.dropout = nn.Dropout(p=dropout_prob)<br><br>        <span class="hljs-variable language_">self</span>.log_attention_weights = log_attention_weights  <span class="hljs-comment"># æ˜¯å¦åº”è®°å½•æ³¨æ„åŠ›æƒé‡</span><br>        <span class="hljs-variable language_">self</span>.attention_weights = <span class="hljs-literal">None</span>  <span class="hljs-comment"># ç”¨äºåç»­å¯è§†åŒ–ç›®çš„ï¼Œæˆ‘åœ¨è¿™é‡Œç¼“å­˜æƒé‡</span><br><br>        <span class="hljs-variable language_">self</span>.init_params()<br>        <br>    <span class="hljs-keyword">def</span> <span class="hljs-title function_">forward</span>(<span class="hljs-params">self, data</span>):<br>        <span class="hljs-comment">#</span><br>        <span class="hljs-comment"># æ­¥éª¤ 1ï¼šçº¿æ€§æŠ•å½± + æ­£åˆ™åŒ–</span><br>        <span class="hljs-comment">#</span><br><br>        in_nodes_features, edge_index = data  <span class="hljs-comment"># è§£åŒ…æ•°æ®</span><br>        num_of_nodes = in_nodes_features.shape[<span class="hljs-variable language_">self</span>.nodes_dim]<br>        <span class="hljs-keyword">assert</span> edge_index.shape[<span class="hljs-number">0</span>] == <span class="hljs-number">2</span>, <span class="hljs-string">f&#x27;æœŸæœ›å½¢çŠ¶ä¸º (2,E) çš„è¾¹ç´¢å¼•ï¼Œå¾—åˆ°äº† <span class="hljs-subst">&#123;edge_index.shape&#125;</span>&#x27;</span><br><br>        <span class="hljs-comment"># å½¢çŠ¶ = (N, FIN)ï¼Œå…¶ä¸­ N æ˜¯å›¾ä¸­çš„èŠ‚ç‚¹æ•°ï¼ŒFIN æ˜¯æ¯ä¸ªèŠ‚ç‚¹çš„è¾“å…¥ç‰¹å¾æ•°</span><br>        <span class="hljs-comment"># æˆ‘ä»¬å¯¹æ‰€æœ‰è¾“å…¥èŠ‚ç‚¹ç‰¹å¾åº”ç”¨ dropoutï¼ˆæ­£å¦‚è®ºæ–‡ä¸­æ‰€æåˆ°çš„ï¼‰</span><br>        <span class="hljs-comment"># æ³¨æ„ï¼šå¯¹äº Coraï¼Œç‰¹å¾å·²ç»éå¸¸ç¨€ç–ï¼Œæ‰€ä»¥å®é™…ä¸Šå¯èƒ½å¸®åŠ©ä¸å¤§</span><br>        in_nodes_features = <span class="hljs-variable language_">self</span>.dropout(in_nodes_features)<br><br>        <span class="hljs-comment"># å½¢çŠ¶ = (N, FIN) * (FIN, NH*FOUT) -&gt; (N, NH, FOUT)ï¼Œå…¶ä¸­ NH æ˜¯æ³¨æ„åŠ›å¤´çš„æ•°é‡ï¼ŒFOUT æ˜¯è¾“å‡ºç‰¹å¾çš„æ•°é‡</span><br>        <span class="hljs-comment"># æˆ‘ä»¬å°†è¾“å…¥èŠ‚ç‚¹ç‰¹å¾æŠ•å½±åˆ° NH ä¸ªç‹¬ç«‹çš„è¾“å‡ºç‰¹å¾ä¸­ï¼ˆæ¯ä¸ªæ³¨æ„åŠ›å¤´ä¸€ä¸ªï¼‰</span><br>        nodes_features_proj = <span class="hljs-variable language_">self</span>.linear_proj(in_nodes_features).view(-<span class="hljs-number">1</span>, <span class="hljs-variable language_">self</span>.num_of_heads, <span class="hljs-variable language_">self</span>.num_out_features)<br><br>        nodes_features_proj = <span class="hljs-variable language_">self</span>.dropout(nodes_features_proj)  <span class="hljs-comment"># åœ¨å®˜æ–¹ GAT å®ç°ä¸­ï¼Œä»–ä»¬åœ¨è¿™é‡Œä¹Ÿä½¿ç”¨äº† dropout</span><br><br>        <span class="hljs-comment">#</span><br>        <span class="hljs-comment"># æ­¥éª¤ 2ï¼šè¾¹æ³¨æ„åŠ›è®¡ç®—</span><br>        <span class="hljs-comment">#</span><br><br>        <span class="hljs-comment"># åº”ç”¨è¯„åˆ†å‡½æ•°ï¼ˆ* è¡¨ç¤ºæŒ‰å…ƒç´ ï¼ˆä¹Ÿç§°ä¸ºHadamardï¼‰ä¹˜æ³•ï¼‰</span><br>        <span class="hljs-comment"># å½¢çŠ¶ = (N, NH, FOUT) * (1, NH, FOUT) -&gt; (N, NH, 1) -&gt; (N, NH)ï¼Œå› ä¸º sum å‹ç¼©äº†æœ€åä¸€ä¸ªç»´åº¦</span><br>        <span class="hljs-comment"># ä¼˜åŒ–æ³¨ï¼šåœ¨æˆ‘çš„å®éªŒä¸­ï¼Œtorch.sum() çš„æ€§èƒ½ä¸ .sum() ä¸€æ ·å¥½</span><br>        scores_source = (nodes_features_proj * <span class="hljs-variable language_">self</span>.scoring_fn_source).<span class="hljs-built_in">sum</span>(dim=-<span class="hljs-number">1</span>)<br>        scores_target = (nodes_features_proj * <span class="hljs-variable language_">self</span>.scoring_fn_target).<span class="hljs-built_in">sum</span>(dim=-<span class="hljs-number">1</span>)<br><br>        <span class="hljs-comment"># æˆ‘ä»¬åªéœ€æ ¹æ®è¾¹ç´¢å¼•å¤åˆ¶ï¼ˆæå‡ï¼‰æº/ç›®æ ‡èŠ‚ç‚¹çš„åˆ†æ•°ã€‚æˆ‘ä»¬ä¸éœ€è¦å‡†å¤‡æ‰€æœ‰å¯èƒ½çš„åˆ†æ•°ç»„åˆï¼Œ</span><br>        <span class="hljs-comment"># æˆ‘ä»¬åªéœ€è¦å‡†å¤‡é‚£äº›å°†å®é™…ä½¿ç”¨çš„åˆ†æ•°ç»„åˆï¼Œè¿™ç”±è¾¹ç´¢å¼•å®šä¹‰</span><br>        <span class="hljs-comment"># åˆ†æ•°å½¢çŠ¶ = (E, NH)ï¼Œnodes_features_proj_lifted å½¢çŠ¶ = (E, NH, FOUT)ï¼ŒE æ˜¯å›¾ä¸­çš„è¾¹æ•°</span><br>        scores_source_lifted, scores_target_lifted, nodes_features_proj_lifted = <span class="hljs-variable language_">self</span>.lift(scores_source, scores_target, nodes_features_proj, edge_index)<br>        scores_per_edge = <span class="hljs-variable language_">self</span>.leakyReLU(scores_source_lifted + scores_target_lifted)<br><br>        <span class="hljs-comment"># å½¢çŠ¶ = (E, NH, 1)</span><br>        attentions_per_edge = <span class="hljs-variable language_">self</span>.neighborhood_aware_softmax(scores_per_edge, edge_index[<span class="hljs-variable language_">self</span>.trg_nodes_dim], num_of_nodes)<br>        <span class="hljs-comment"># å¯¹é‚»å±…èšåˆæ·»åŠ éšæœºæ€§</span><br>        attentions_per_edge = <span class="hljs-variable language_">self</span>.dropout(attentions_per_edge)<br><br>        <span class="hljs-comment">#</span><br>        <span class="hljs-comment"># æ­¥éª¤ 3ï¼šé‚»å±…èšåˆ</span><br>        <span class="hljs-comment">#</span><br><br>        <span class="hljs-comment"># é€å…ƒç´ ï¼ˆä¹Ÿç§°ä¸ºHadamardï¼‰ä¹˜æ³•ã€‚è¿ç®—ç¬¦ * æ‰§è¡Œä¸ torch.mul ç›¸åŒçš„æ“ä½œ</span><br>        <span class="hljs-comment"># å½¢çŠ¶ = (E, NH, FOUT) * (E, NH, 1) -&gt; (E, NH, FOUT)ï¼Œ1 è¢«å¹¿æ’­åˆ° FOUT</span><br>        nodes_features_proj_lifted_weighted = nodes_features_proj_lifted * attentions_per_edge<br><br>        <span class="hljs-comment"># è¿™ä¸€éƒ¨åˆ†å¯¹æ¯ä¸ªç›®æ ‡èŠ‚ç‚¹ç´¯ç§¯åŠ æƒå’ŒæŠ•å½±çš„é‚»å±…ç‰¹å¾å‘é‡</span><br>        <span class="hljs-comment"># å½¢çŠ¶ = (N, NH, FOUT)</span><br>        out_nodes_features = <span class="hljs-variable language_">self</span>.aggregate_neighbors(nodes_features_proj_lifted_weighted, edge_index, in_nodes_features, num_of_nodes)<br><br>        <span class="hljs-comment">#</span><br>        <span class="hljs-comment"># æ­¥éª¤ 4ï¼šæ®‹å·®/è·³è·ƒè¿æ¥ã€è¿æ¥å’Œåå·®</span><br>        <span class="hljs-comment">#</span><br><br>        out_nodes_features = <span class="hljs-variable language_">self</span>.skip_concat_bias(attentions_per_edge, in_nodes_features, out_nodes_features)<br>        <span class="hljs-keyword">return</span> (out_nodes_features, edge_index)<br><br>    <span class="hljs-comment">#</span><br>    <span class="hljs-comment"># è¾…åŠ©å‡½æ•°ï¼ˆæ²¡æœ‰æ³¨é‡Šå‡ ä¹æ²¡æœ‰ä»£ç ï¼Œæ‰€ä»¥ä¸è¦å®³æ€•ï¼ï¼‰</span><br>    <span class="hljs-comment">#</span><br><br>    <span class="hljs-keyword">def</span> <span class="hljs-title function_">neighborhood_aware_softmax</span>(<span class="hljs-params">self, scores_per_edge, trg_index, num_of_nodes</span>):<br>        <span class="hljs-string">&quot;&quot;&quot;</span><br><span class="hljs-string">        æ­£å¦‚å‡½æ•°åæ‰€ç¤ºï¼Œå®ƒå¯¹é‚»å±…æ‰§è¡Œ softmaxã€‚ä¾‹å¦‚ï¼šå‡è®¾å›¾ä¸­æœ‰ 5 ä¸ªèŠ‚ç‚¹ã€‚å…¶ä¸­çš„ä¸¤ä¸ªèŠ‚ç‚¹ 1ã€2 ä¸èŠ‚ç‚¹ 3 ç›¸è¿ã€‚</span><br><span class="hljs-string">        å¦‚æœæˆ‘ä»¬è¦è®¡ç®—èŠ‚ç‚¹ 3 çš„è¡¨ç¤ºï¼Œæˆ‘ä»¬åº”è¯¥è€ƒè™‘èŠ‚ç‚¹ 1ã€2 å’ŒèŠ‚ç‚¹ 3 æœ¬èº«çš„ç‰¹å¾å‘é‡ã€‚ç”±äºæˆ‘ä»¬å¯¹è¾¹ 1-3ã€2-3 å’Œ 3-3 çš„åˆ†æ•°</span><br><span class="hljs-string">        è¿›è¡Œäº†è¯„ä¼°ï¼Œè¿™ä¸ªå‡½æ•°å°†è®¡ç®—ç±»ä¼¼è¿™æ ·çš„æ³¨æ„åŠ›åˆ†æ•°ï¼š1-3 / (1-3 + 2-3 + 3-3)ï¼ˆå…¶ä¸­ 1-3 æ˜¯è¿‡è½½çš„ç¬¦å·ï¼Œå®ƒè¡¨ç¤ºè¾¹ 1-3 åŠå…¶ï¼ˆexpï¼‰åˆ†æ•°ï¼‰ï¼Œ</span><br><span class="hljs-string">        ç±»ä¼¼åœ°å¯¹äº 2-3 å’Œ 3-3ï¼Œå³å¯¹äºè¿™ä¸ªé‚»å±…ï¼Œæˆ‘ä»¬ä¸å…³å¿ƒåŒ…å«èŠ‚ç‚¹ 4 å’Œ 5 çš„å…¶ä»–è¾¹åˆ†æ•°ã€‚</span><br><span class="hljs-string"></span><br><span class="hljs-string">        æ³¨æ„ï¼š</span><br><span class="hljs-string">        ä» logits ä¸­å‡å»æœ€å¤§å€¼ä¸ä¼šæ”¹å˜æœ€ç»ˆç»“æœï¼Œä½†å®ƒæé«˜äº†æ•°å€¼ç¨³å®šæ€§ï¼Œå¹¶ä¸”åœ¨å‡ ä¹æ¯ä¸ªæ·±åº¦å­¦ä¹ æ¡†æ¶ä¸­ï¼Œè¿™æ˜¯ä¸€ä¸ªç›¸å½“å¸¸è§çš„â€œæŠ€å·§â€ã€‚</span><br><span class="hljs-string">        æœ‰å…³æ›´å¤šè¯¦ç»†ä¿¡æ¯ï¼Œè¯·æŸ¥çœ‹æ­¤é“¾æ¥ï¼š</span><br><span class="hljs-string"></span><br><span class="hljs-string">        https://stats.stackexchange.com/questions/338285/how-does-the-subtraction-of-the-logit-maximum-improve-learning</span><br><span class="hljs-string"></span><br><span class="hljs-string">        &quot;&quot;&quot;</span><br>        <span class="hljs-comment"># è®¡ç®—åˆ†å­ã€‚ä½¿ logits &lt;= 0ï¼Œä»¥ä¾¿ e^logit &lt;= 1ï¼ˆè¿™å°†æé«˜æ•°å€¼ç¨³å®šæ€§ï¼‰</span><br>        scores_per_edge = scores_per_edge - scores_per_edge.<span class="hljs-built_in">max</span>()<br>        exp_scores_per_edge = scores_per_edge.exp()  <span class="hljs-comment"># softmax</span><br><br>        <span class="hljs-comment"># è®¡ç®—åˆ†æ¯ã€‚å½¢çŠ¶ = (E, NH)</span><br>        neigborhood_aware_denominator = <span class="hljs-variable language_">self</span>.sum_edge_scores_neighborhood_aware(exp_scores_per_edge, trg_index, num_of_nodes)<br><br>        <span class="hljs-comment"># 1e-16 åœ¨ç†è®ºä¸Šä¸æ˜¯å¿…éœ€çš„ï¼Œä½†å®ƒä»…å‡ºäºæ•°å€¼ç¨³å®šæ€§è€ƒè™‘å­˜åœ¨ï¼ˆé¿å…é™¤ä»¥ 0ï¼‰- ç”±äºè®¡ç®—æœºå°†éå¸¸å°çš„æ•°å­—å››èˆäº”å…¥åˆ° 0ï¼Œè¿™æ˜¯å¯èƒ½çš„</span><br>        attentions_per_edge = exp_scores_per_edge / (neigborhood_aware_denominator + <span class="hljs-number">1e-16</span>)<br><br>        <span class="hljs-comment"># shape = (E, NH) -&gt; (E, NH, 1) so that we can do element-wise multiplication with projected node features</span><br>        <span class="hljs-keyword">return</span> attentions_per_edge.unsqueeze(-<span class="hljs-number">1</span>)<br><br>    <span class="hljs-keyword">def</span> <span class="hljs-title function_">sum_edge_scores_neighborhood_aware</span>(<span class="hljs-params">self, exp_scores_per_edge, trg_index, num_of_nodes</span>):<br>        <span class="hljs-comment"># å½¢çŠ¶å¿…é¡»ä¸ exp_scores_per_edge ç›¸åŒï¼ˆç”± scatter_add_ è¦æ±‚ï¼‰ï¼Œå³ä» E å˜ä¸º (E, NH)</span><br>        trg_index_broadcasted = <span class="hljs-variable language_">self</span>.explicit_broadcast(trg_index, exp_scores_per_edge)<br><br>        <span class="hljs-comment"># å½¢çŠ¶ä¸º (N, NH)ï¼Œå…¶ä¸­ N æ˜¯èŠ‚ç‚¹æ•°é‡ï¼ŒNH æ˜¯æ³¨æ„åŠ›å¤´çš„æ•°é‡</span><br>        size = <span class="hljs-built_in">list</span>(exp_scores_per_edge.shape)  <span class="hljs-comment"># è½¬æ¢ä¸ºåˆ—è¡¨ï¼Œå¦åˆ™æ— æ³•è¿›è¡Œèµ‹å€¼</span><br>        size[<span class="hljs-variable language_">self</span>.nodes_dim] = num_of_nodes<br>        neighborhood_sums = torch.zeros(size, dtype=exp_scores_per_edge.dtype, device=exp_scores_per_edge.device)<br><br>        <span class="hljs-comment"># ä½ç½® i åŒ…å«æ‰€æœ‰æŒ‡å‘èŠ‚ç‚¹ i çš„èŠ‚ç‚¹çš„ exp åˆ†æ•°ä¹‹å’Œï¼ˆç”±ç›®æ ‡ç´¢å¼•æŒ‡å®šï¼‰</span><br>        neighborhood_sums.scatter_add_(<span class="hljs-variable language_">self</span>.nodes_dim, trg_index_broadcasted, exp_scores_per_edge)<br><br>        <span class="hljs-comment"># å†æ¬¡æ‰©å±•ï¼Œä»¥ä¾¿å°†å…¶ç”¨ä½œ softmax åˆ†æ¯ã€‚ä¾‹å¦‚ï¼ŒèŠ‚ç‚¹ i çš„æ€»å’Œå°†å¤åˆ¶åˆ°æºèŠ‚ç‚¹æŒ‡å‘ i çš„æ‰€æœ‰ä½ç½®ï¼ˆç”±ç›®æ ‡ç´¢å¼•æŒ‡å®šï¼‰</span><br>        <span class="hljs-comment"># å½¢çŠ¶ä¸º (N, NH) -&gt; (E, NH)</span><br>        <span class="hljs-keyword">return</span> neighborhood_sums.index_select(<span class="hljs-variable language_">self</span>.nodes_dim, trg_index)<br><br>    <span class="hljs-keyword">def</span> <span class="hljs-title function_">aggregate_neighbors</span>(<span class="hljs-params">self, nodes_features_proj_lifted_weighted, edge_index, in_nodes_features, num_of_nodes</span>):<br>        size = <span class="hljs-built_in">list</span>(nodes_features_proj_lifted_weighted.shape)  <span class="hljs-comment"># è½¬æ¢ä¸ºåˆ—è¡¨ï¼Œå¦åˆ™æ— æ³•è¿›è¡Œèµ‹å€¼</span><br>        size[<span class="hljs-variable language_">self</span>.nodes_dim] = num_of_nodes  <span class="hljs-comment"># å½¢çŠ¶ä¸º (N, NH, FOUT)</span><br>        out_nodes_features = torch.zeros(size, dtype=in_nodes_features.dtype, device=in_nodes_features.device)<br><br>        <span class="hljs-comment"># å½¢çŠ¶ä¸º (E) -&gt; (E, NH, FOUT)</span><br>        trg_index_broadcasted = <span class="hljs-variable language_">self</span>.explicit_broadcast(edge_index[<span class="hljs-variable language_">self</span>.trg_nodes_dim], nodes_features_proj_lifted_weighted)<br>        <span class="hljs-comment"># èšåˆæ­¥éª¤ - æˆ‘ä»¬ç´¯ç§¯æ‰€æœ‰æ³¨æ„åŠ›å¤´çš„æŠ•å½±åŠ æƒèŠ‚ç‚¹ç‰¹å¾</span><br>        <span class="hljs-comment"># å½¢çŠ¶ä¸º (E, NH, FOUT) -&gt; (N, NH, FOUT)</span><br>        out_nodes_features.scatter_add_(<span class="hljs-variable language_">self</span>.nodes_dim, trg_index_broadcasted, nodes_features_proj_lifted_weighted)<br><br>        <span class="hljs-keyword">return</span> out_nodes_features<br><br>    <span class="hljs-keyword">def</span> <span class="hljs-title function_">lift</span>(<span class="hljs-params">self, scores_source, scores_target, nodes_features_matrix_proj, edge_index</span>):<br>        <span class="hljs-string">&quot;&quot;&quot;</span><br><span class="hljs-string">        æŠ¬å‡ï¼ˆLiftï¼‰å³æ ¹æ®è¾¹ç´¢å¼•å¤åˆ¶ç‰¹å®šå‘é‡ã€‚</span><br><span class="hljs-string">        å¼ é‡çš„ç»´åº¦ä¹‹ä¸€ä» N å˜ä¸º Eï¼ˆè¿™å°±æ˜¯â€œæŠ¬å‡â€ä¸€è¯çš„æ¥æºï¼‰ã€‚</span><br><span class="hljs-string"></span><br><span class="hljs-string">        &quot;&quot;&quot;</span><br>        src_nodes_index = edge_index[<span class="hljs-variable language_">self</span>.src_nodes_dim]<br>        trg_nodes_index = edge_index[<span class="hljs-variable language_">self</span>.trg_nodes_dim]<br><br>        <span class="hljs-comment"># ä½¿ç”¨ index_select æ¯”åœ¨ PyTorch ä¸­ä½¿ç”¨ &quot;normal&quot; ç´¢å¼•ï¼ˆscores_source[src_nodes_index]ï¼‰æ›´å¿«ï¼</span><br>        scores_source = scores_source.index_select(<span class="hljs-variable language_">self</span>.nodes_dim, src_nodes_index)<br>        scores_target = scores_target.index_select(<span class="hljs-variable language_">self</span>.nodes_dim, trg_nodes_index)<br>        nodes_features_matrix_proj_lifted = nodes_features_matrix_proj.index_select(<span class="hljs-variable language_">self</span>.nodes_dim, src_nodes_index)<br><br>        <span class="hljs-keyword">return</span> scores_source, scores_target, nodes_features_matrix_proj_lifted<br><br>    <span class="hljs-keyword">def</span> <span class="hljs-title function_">explicit_broadcast</span>(<span class="hljs-params">self, this, other</span>):<br>        <span class="hljs-comment"># é™„åŠ å•ä¾‹ç»´åº¦ï¼Œç›´åˆ° this.dim() == other.dim()</span><br>        <span class="hljs-keyword">for</span> _ <span class="hljs-keyword">in</span> <span class="hljs-built_in">range</span>(this.dim(), other.dim()):<br>            this = this.unsqueeze(-<span class="hljs-number">1</span>)<br><br>        <span class="hljs-comment"># æ˜ç¡®æ‰©å±•ä»¥ä½¿å½¢çŠ¶ç›¸åŒ</span><br>        <span class="hljs-keyword">return</span> this.expand_as(other)<br><br>    <span class="hljs-keyword">def</span> <span class="hljs-title function_">init_params</span>(<span class="hljs-params">self</span>):<br>        <span class="hljs-string">&quot;&quot;&quot;</span><br><span class="hljs-string">        æˆ‘ä»¬ä½¿ç”¨ Glorotï¼ˆä¹Ÿç§°ä¸º Xavier å‡åŒ€ï¼‰åˆå§‹åŒ–çš„åŸå› æ˜¯å› ä¸ºå®ƒæ˜¯ TF çš„é»˜è®¤åˆå§‹åŒ–æ–¹å¼ï¼š</span><br><span class="hljs-string">            https://stackoverflow.com/questions/37350131/what-is-the-default-variable-initializer-in-tensorflow</span><br><span class="hljs-string"></span><br><span class="hljs-string">        åŸå§‹åº“åœ¨ TensorFlowï¼ˆTFï¼‰ä¸­å¼€å‘ï¼Œå¹¶ä¸”ä»–ä»¬ä½¿ç”¨äº†é»˜è®¤åˆå§‹åŒ–ã€‚</span><br><span class="hljs-string">        éšæ—¶è¿›è¡Œå®éªŒ - æ ¹æ®é—®é¢˜å¯èƒ½æœ‰æ›´å¥½çš„åˆå§‹åŒ–æ–¹æ³•ã€‚</span><br><span class="hljs-string"></span><br><span class="hljs-string">        &quot;&quot;&quot;</span><br>        nn.init.xavier_uniform_(<span class="hljs-variable language_">self</span>.linear_proj.weight)<br>        nn.init.xavier_uniform_(<span class="hljs-variable language_">self</span>.scoring_fn_target)<br>        nn.init.xavier_uniform_(<span class="hljs-variable language_">self</span>.scoring_fn_source)<br><br>        <span class="hljs-keyword">if</span> <span class="hljs-variable language_">self</span>.bias <span class="hljs-keyword">is</span> <span class="hljs-keyword">not</span> <span class="hljs-literal">None</span>:<br>            torch.nn.init.zeros_(<span class="hljs-variable language_">self</span>.bias)<br><br>    <span class="hljs-keyword">def</span> <span class="hljs-title function_">skip_concat_bias</span>(<span class="hljs-params">self, attention_coefficients, in_nodes_features, out_nodes_features</span>):<br>        <span class="hljs-keyword">if</span> <span class="hljs-variable language_">self</span>.log_attention_weights:  <span class="hljs-comment"># å¯èƒ½è®°å½•ä»¥ä¾›ç¨ååœ¨ playground.py ä¸­å¯è§†åŒ–</span><br>            <span class="hljs-variable language_">self</span>.attention_weights = attention_coefficients<br><br>        <span class="hljs-keyword">if</span> <span class="hljs-variable language_">self</span>.add_skip_connection:  <span class="hljs-comment"># æ·»åŠ è·³è·ƒæˆ–æ®‹å·®è¿æ¥</span><br>            <span class="hljs-keyword">if</span> out_nodes_features.shape[-<span class="hljs-number">1</span>] == in_nodes_features.shape[-<span class="hljs-number">1</span>]:  <span class="hljs-comment"># å¦‚æœ FIN == FOUT</span><br>                <span class="hljs-comment"># unsqueeze å®ç°ä»¥ä¸‹æ•ˆæœï¼š(N, FIN) -&gt; (N, 1, FIN)ï¼Œè¾“å‡ºç‰¹å¾ä¸º (N, NH, FOUT) æ‰€ä»¥ 1 è¢«å¹¿æ’­åˆ° NH</span><br>                <span class="hljs-comment"># å› æ­¤ï¼ŒåŸºæœ¬ä¸Šæˆ‘ä»¬å°†è¾“å…¥å‘é‡ NH æ¬¡å¤åˆ¶å¹¶æ·»åŠ åˆ°å¤„ç†è¿‡çš„å‘é‡ä¸­</span><br>                out_nodes_features += in_nodes_features.unsqueeze(<span class="hljs-number">1</span>)<br>            <span class="hljs-keyword">else</span>:<br>                <span class="hljs-comment"># FIN != FOUTï¼Œå› æ­¤æˆ‘ä»¬éœ€è¦å°†è¾“å…¥ç‰¹å¾å‘é‡æŠ•å½±åˆ°å¯ä»¥æ·»åŠ åˆ°è¾“å‡ºç‰¹å¾å‘é‡çš„ç»´åº¦ã€‚</span><br>                <span class="hljs-comment"># skip_proj æ·»åŠ äº†å¤§é‡é¢å¤–çš„å®¹é‡ï¼Œè¿™å¯èƒ½å¯¼è‡´è¿‡æ‹Ÿåˆã€‚</span><br>                out_nodes_features += <span class="hljs-variable language_">self</span>.skip_proj(in_nodes_features).view(-<span class="hljs-number">1</span>, <span class="hljs-variable language_">self</span>.num_of_heads, <span class="hljs-variable language_">self</span>.num_out_features)<br><br>        <span class="hljs-keyword">if</span> <span class="hljs-variable language_">self</span>.concat:<br>            <span class="hljs-comment"># å½¢çŠ¶ä¸º (N, NH, FOUT) -&gt; (N, NH*FOUT)</span><br>            out_nodes_features = out_nodes_features.view(-<span class="hljs-number">1</span>, <span class="hljs-variable language_">self</span>.num_of_heads * <span class="hljs-variable language_">self</span>.num_out_features)<br>        <span class="hljs-keyword">else</span>:<br>            <span class="hljs-comment"># å½¢çŠ¶ä¸º (N, NH, FOUT) -&gt; (N, FOUT)</span><br>            out_nodes_features = out_nodes_features.mean(dim=<span class="hljs-variable language_">self</span>.head_dim)<br><br>        <span class="hljs-keyword">if</span> <span class="hljs-variable language_">self</span>.bias <span class="hljs-keyword">is</span> <span class="hljs-keyword">not</span> <span class="hljs-literal">None</span>:<br>            out_nodes_features += <span class="hljs-variable language_">self</span>.bias<br><br>        <span class="hljs-keyword">return</span> out_nodes_features <span class="hljs-keyword">if</span> <span class="hljs-variable language_">self</span>.activation <span class="hljs-keyword">is</span> <span class="hljs-literal">None</span> <span class="hljs-keyword">else</span> <span class="hljs-variable language_">self</span>.activation(out_nodes_features)<br></code></pre></td></tr></table></figure>

<p>å·¨å¤§èŠ‚çœçš„æ€æƒ³æ˜¯ä»…è®¡ç®—å®é™…ä½¿ç”¨çš„èŠ‚ç‚¹çš„åˆ†æ•°ï¼Œè€Œä¸æ˜¯è®¡ç®—æ¯ä¸ªå¯æƒ³è±¡çš„ç»„åˆçš„åˆ†æ•°ï¼ˆè¿™ä»…åœ¨å®Œå…¨è¿æ¥çš„å›¾ä¸­æœ‰æ•ˆï¼‰ã€‚</p>
<p>ä¸€æ—¦æˆ‘ä»¬è®¡ç®—å‡ºâ€leftâ€åˆ†æ•°å’Œâ€rightâ€åˆ†æ•°ï¼Œæˆ‘ä»¬å°±ä½¿ç”¨è¾¹ç´¢å¼•â€œliftâ€å®ƒä»¬ã€‚è¿™æ ·ï¼Œå¦‚æœ1-&gt;2å›¾ä¸­ä¸å­˜åœ¨è¾¹ï¼Œæˆ‘ä»¬çš„æ•°æ®ç»“æ„ä¸­å°±ä¸ä¼šæœ‰è¿™äº›åˆ†æ•°å¯¹ã€‚</p>
<p>åœ¨æ·»åŠ æå‡çš„â€œå·¦â€å’Œâ€œå³â€ï¼ˆæˆ–è€…æ›´å¥½çš„å‘½åæ–¹å¼æ˜¯æºå’Œç›®æ ‡ï¼‰åˆ†æ•°åï¼Œæˆ‘ä»¬å¾ˆèªæ˜çš„ç”¨neighborhood-aware softmax-è¿™æ · GATçš„è¯­ä¹‰å°±å¾—åˆ°äº†è¡¨è¾¾ã€‚å®Œæˆåscatter addï¼ˆæ‚¨åº”è¯¥èŠ±æ—¶é—´ç†è§£å¹¶é˜…è¯»æ–‡æ¡£ï¼‰ï¼Œæˆ‘ä»¬å¯ä»¥ç»„åˆæŠ•å½±çš„ç‰¹å¾å‘é‡ï¼Œç§ï¼Œæˆ‘ä»¬å¾—åˆ°äº†ä¸€ä¸ªæˆç†Ÿçš„ GAT å±‚ã€‚</p>
<hr>
<p>æ…¢æ…¢æ¥ï¼Œè¦æœ‰è€å¿ƒï¼ç‰¹åˆ«æ˜¯å¦‚æœæ‚¨æ˜¯ GNN æ–°æ‰‹ã€‚</p>
<p>æˆ‘ä¸æ˜¯ä¸€å¤©å°±èƒ½å­¦ä¼šæ‰€æœ‰è¿™äº›çš„ï¼Œéœ€è¦æ—¶é—´æ¥æ¶ˆåŒ–çŸ¥è¯†ã€‚</p>
<p>è¯è™½å¦‚æ­¤ï¼Œæˆ‘ä»¬å·²ç»è§£é”äº†ç¬¬ 3 çº§ï¼ˆæ¨¡å‹è®­ç»ƒ ğŸ’ªï¼‰ã€‚ğŸ˜<br>æˆ‘ä»¬å·²ç»å‡†å¤‡å¥½äº†æ•°æ®ğŸ“œï¼Œæˆ‘ä»¬å·²ç»å‡†å¤‡å¥½äº†GATæ¨¡å‹ğŸ¦„ï¼Œè®©æˆ‘ä»¬å¼€å§‹è®­ç»ƒè¿™å¤´é‡å…½å§ï¼ğŸ’ª</p>
<h1 id="ç¬¬-3-éƒ¨åˆ†ï¼šè®­ç»ƒ-GAT-ğŸ’ªï¼ˆCora-ä¸Šçš„åˆ†ç±»ï¼ï¼‰"><a href="#ç¬¬-3-éƒ¨åˆ†ï¼šè®­ç»ƒ-GAT-ğŸ’ªï¼ˆCora-ä¸Šçš„åˆ†ç±»ï¼ï¼‰" class="headerlink" title="ç¬¬ 3 éƒ¨åˆ†ï¼šè®­ç»ƒ GAT ğŸ’ªï¼ˆCora ä¸Šçš„åˆ†ç±»ï¼ï¼‰"></a>ç¬¬ 3 éƒ¨åˆ†ï¼šè®­ç»ƒ GAT ğŸ’ªï¼ˆCora ä¸Šçš„åˆ†ç±»ï¼ï¼‰</h1><p>å”·ï¼Œå¥½å§ï¼Œæœ€å›°éš¾çš„éƒ¨åˆ†å·²ç»è¿‡å»äº†ã€‚è®©æˆ‘ä»¬åˆ›å»ºä¸€ä¸ªç®€å•çš„è®­ç»ƒå¾ªç¯ï¼Œå…¶ç›®æ ‡æ˜¯å­¦ä¹ å¯¹ Cora èŠ‚ç‚¹è¿›è¡Œåˆ†ç±»ã€‚</p>
<p>ä½†é¦–å…ˆè®©æˆ‘ä»¬å®šä¹‰ä¸€äº›ç›¸å…³çš„å¸¸é‡ã€‚</p>
<figure class="highlight python"><table><tr><td class="code"><pre><code class="hljs python"><span class="hljs-keyword">from</span> torch.utils.tensorboard <span class="hljs-keyword">import</span> SummaryWriter<br><br><span class="hljs-comment"># train.py ä¸­ä½¿ç”¨çš„ 3 ä¸ªä¸åŒçš„æ¨¡å‹è®­ç»ƒ/è¯„ä¼°é˜¶æ®µ</span><br><span class="hljs-keyword">class</span> <span class="hljs-title class_">LoopPhase</span>(enum.Enum):<br>    TRAIN = <span class="hljs-number">0</span>,  <span class="hljs-comment"># è®­ç»ƒé˜¶æ®µ</span><br>    VAL = <span class="hljs-number">1</span>,    <span class="hljs-comment"># éªŒè¯é˜¶æ®µ</span><br>    TEST = <span class="hljs-number">2</span>    <span class="hljs-comment"># æµ‹è¯•é˜¶æ®µ</span><br><br>writer = SummaryWriter()  <span class="hljs-comment"># ï¼ˆtensorboardï¼‰writer é»˜è®¤å°†è¾“å‡ºåˆ° ./runs/ ç›®å½•</span><br><br><span class="hljs-comment"># ç”¨äºæå‰åœæ­¢çš„å…¨å±€å˜é‡ã€‚åœ¨æ²¡æœ‰åœ¨éªŒè¯æ•°æ®é›†ä¸Šæœ‰ä»»ä½•æ”¹è¿›ï¼ˆé€šè¿‡å‡†ç¡®æ€§åº¦é‡ï¼‰çš„æƒ…å†µä¸‹ï¼Œ</span><br><span class="hljs-comment"># ç»è¿‡ä¸€å®šæ•°é‡çš„ epochsï¼ˆç”± patience_period å˜é‡å®šä¹‰ï¼‰ï¼Œæˆ‘ä»¬å°†é€€å‡ºè®­ç»ƒå¾ªç¯ã€‚</span><br>BEST_VAL_ACC = <span class="hljs-number">0</span>      <span class="hljs-comment"># æœ€ä½³éªŒè¯å‡†ç¡®æ€§</span><br>BEST_VAL_LOSS = <span class="hljs-number">0</span>     <span class="hljs-comment"># æœ€ä½³éªŒè¯æŸå¤±</span><br>PATIENCE_CNT = <span class="hljs-number">0</span>      <span class="hljs-comment"># å¿è€è®¡æ•°</span><br><br>BINARIES_PATH = os.path.join(os.getcwd(), <span class="hljs-string">&#x27;models&#x27;</span>, <span class="hljs-string">&#x27;binaries&#x27;</span>)  <span class="hljs-comment"># å­˜å‚¨äºŒè¿›åˆ¶æ–‡ä»¶çš„è·¯å¾„</span><br>CHECKPOINTS_PATH = os.path.join(os.getcwd(), <span class="hljs-string">&#x27;models&#x27;</span>, <span class="hljs-string">&#x27;checkpoints&#x27;</span>)  <span class="hljs-comment"># å­˜å‚¨æ£€æŸ¥ç‚¹çš„è·¯å¾„</span><br><br><span class="hljs-comment"># ç¡®ä¿è¿™äº›è·¯å¾„å­˜åœ¨ï¼Œå› ä¸ºä»£ç çš„å…¶ä½™éƒ¨åˆ†å‡å®šå­˜åœ¨å®ƒä»¬</span><br>os.makedirs(BINARIES_PATH, exist_ok=<span class="hljs-literal">True</span>)<br>os.makedirs(CHECKPOINTS_PATH, exist_ok=<span class="hljs-literal">True</span>)<br><br></code></pre></td></tr></table></figure>

<p>å¦å¤–ï¼Œæˆ‘ä»¬å®šä¹‰å‡ ä¸ªåœ¨è®­ç»ƒæ¨¡å‹æ—¶æœ‰ç”¨çš„å‡½æ•°ã€‚</p>
<p>è®­ç»ƒçŠ¶æ€åŒ…å«å¾ˆå¤šæœ‰ç”¨çš„å†…å®¹metadataï¼Œæˆ‘ä»¬å¯ä»¥åœ¨ä»¥åä½¿ç”¨ã€‚æ‚¨å¯ä»¥æƒ³è±¡ï¼Œä¿å­˜æ¨¡å‹çš„æµ‹è¯•å‡†ç¡®æ€§éå¸¸é‡è¦ï¼Œå°¤å…¶æ˜¯å½“æ‚¨åœ¨äº‘ä¸Šè®­ç»ƒæ¨¡å‹æ—¶ - å®ƒä½¿ç»„ç»‡å˜å¾—æ›´å¥½ã€‚</p>
<figure class="highlight python"><table><tr><td class="code"><pre><code class="hljs python"><span class="hljs-keyword">import</span> git<br><span class="hljs-keyword">import</span> re  <span class="hljs-comment"># æ­£åˆ™è¡¨è¾¾å¼</span><br><br><br><span class="hljs-keyword">def</span> <span class="hljs-title function_">get_training_state</span>(<span class="hljs-params">training_config, model</span>):<br>    training_state = &#123;<br>        <span class="hljs-string">&quot;commit_hash&quot;</span>: git.Repo(search_parent_directories=<span class="hljs-literal">True</span>).head.<span class="hljs-built_in">object</span>.hexsha,<br><br>        <span class="hljs-comment"># è®­ç»ƒè¯¦ç»†ä¿¡æ¯</span><br>        <span class="hljs-string">&quot;dataset_name&quot;</span>: training_config[<span class="hljs-string">&#x27;dataset_name&#x27;</span>],  <span class="hljs-comment"># æ•°æ®é›†åç§°</span><br>        <span class="hljs-string">&quot;num_of_epochs&quot;</span>: training_config[<span class="hljs-string">&#x27;num_of_epochs&#x27;</span>],  <span class="hljs-comment"># è®­ç»ƒçš„ epochs æ•°é‡</span><br>        <span class="hljs-string">&quot;test_acc&quot;</span>: training_config[<span class="hljs-string">&#x27;test_acc&#x27;</span>],  <span class="hljs-comment"># æµ‹è¯•å‡†ç¡®åº¦</span><br><br>        <span class="hljs-comment"># æ¨¡å‹ç»“æ„</span><br>        <span class="hljs-string">&quot;num_of_layers&quot;</span>: training_config[<span class="hljs-string">&#x27;num_of_layers&#x27;</span>],  <span class="hljs-comment"># å±‚çš„æ•°é‡</span><br>        <span class="hljs-string">&quot;num_heads_per_layer&quot;</span>: training_config[<span class="hljs-string">&#x27;num_heads_per_layer&#x27;</span>],  <span class="hljs-comment"># æ¯å±‚çš„æ³¨æ„åŠ›å¤´æ•°</span><br>        <span class="hljs-string">&quot;num_features_per_layer&quot;</span>: training_config[<span class="hljs-string">&#x27;num_features_per_layer&#x27;</span>],  <span class="hljs-comment"># æ¯å±‚çš„ç‰¹å¾æ•°</span><br>        <span class="hljs-string">&quot;add_skip_connection&quot;</span>: training_config[<span class="hljs-string">&#x27;add_skip_connection&#x27;</span>],  <span class="hljs-comment"># æ˜¯å¦æ·»åŠ è·³è·ƒè¿æ¥</span><br>        <span class="hljs-string">&quot;bias&quot;</span>: training_config[<span class="hljs-string">&#x27;bias&#x27;</span>],  <span class="hljs-comment"># æ˜¯å¦ä½¿ç”¨åç½®</span><br>        <span class="hljs-string">&quot;dropout&quot;</span>: training_config[<span class="hljs-string">&#x27;dropout&#x27;</span>],  <span class="hljs-comment"># ä¸¢å¼ƒç‡</span><br><br>        <span class="hljs-comment"># æ¨¡å‹çŠ¶æ€</span><br>        <span class="hljs-string">&quot;state_dict&quot;</span>: model.state_dict()  <span class="hljs-comment"># æ¨¡å‹çš„çŠ¶æ€å­—å…¸</span><br>    &#125;<br><br>    <span class="hljs-keyword">return</span> training_state<br><br><br><span class="hljs-keyword">def</span> <span class="hljs-title function_">print_model_metadata</span>(<span class="hljs-params">training_state</span>):<br>    header = <span class="hljs-string">f&#x27;\n<span class="hljs-subst">&#123;<span class="hljs-string">&quot;*&quot;</span>*<span class="hljs-number">5</span>&#125;</span> æ¨¡å‹è®­ç»ƒå…ƒæ•°æ®: <span class="hljs-subst">&#123;<span class="hljs-string">&quot;*&quot;</span>*<span class="hljs-number">5</span>&#125;</span>&#x27;</span><br>    <span class="hljs-built_in">print</span>(header)<br><br>    <span class="hljs-keyword">for</span> key, value <span class="hljs-keyword">in</span> training_state.items():<br>        <span class="hljs-keyword">if</span> key != <span class="hljs-string">&#x27;state_dict&#x27;</span>:  <span class="hljs-comment"># ä¸æ‰“å° state_dictï¼Œå› ä¸ºå®ƒåªæ˜¯ä¸€å †æ•°å­—...</span><br>            <span class="hljs-built_in">print</span>(<span class="hljs-string">f&#x27;<span class="hljs-subst">&#123;key&#125;</span>: <span class="hljs-subst">&#123;value&#125;</span>&#x27;</span>)<br>    <span class="hljs-built_in">print</span>(<span class="hljs-string">f&#x27;<span class="hljs-subst">&#123;<span class="hljs-string">&quot;*&quot;</span> * <span class="hljs-built_in">len</span>(header)&#125;</span>\n&#x27;</span>)<br><br><br><span class="hljs-comment"># ç¡®ä¿æˆ‘ä»¬ä¸è¦†ç›–æœ‰ä»·å€¼çš„æ¨¡å‹äºŒè¿›åˆ¶æ–‡ä»¶ï¼ˆå¯ä»¥å¿½ç•¥ - å¯¹ GAT æ–¹æ³•ä¸æ˜¯å…³é”®çš„ï¼‰</span><br><span class="hljs-keyword">def</span> <span class="hljs-title function_">get_available_binary_name</span>():<br>    prefix = <span class="hljs-string">&#x27;gat&#x27;</span><br><br>    <span class="hljs-keyword">def</span> <span class="hljs-title function_">valid_binary_name</span>(<span class="hljs-params">binary_name</span>):<br>        <span class="hljs-comment"># ç¬¬ä¸€æ¬¡çœ‹åˆ°åŸå§‹ f-å­—ç¬¦ä¸²ï¼Ÿä¸ç”¨æ‹…å¿ƒï¼Œå”¯ä¸€çš„æŠ€å·§æ˜¯è¦åŠ å€å¤§æ‹¬å·ã€‚</span><br>        pattern = re.<span class="hljs-built_in">compile</span>(<span class="hljs-string">rf&#x27;<span class="hljs-subst">&#123;prefix&#125;</span>_[0-9]&#123;&#123;6&#125;&#125;\.pth&#x27;</span>)<br>        <span class="hljs-keyword">return</span> re.fullmatch(pattern, binary_name) <span class="hljs-keyword">is</span> <span class="hljs-keyword">not</span> <span class="hljs-literal">None</span><br><br>    <span class="hljs-comment"># åªéœ€åˆ—å‡ºç°æœ‰çš„äºŒè¿›åˆ¶æ–‡ä»¶ï¼Œä»¥ä¾¿æˆ‘ä»¬ä¸ä¼šè¦†ç›–å®ƒä»¬ï¼Œè€Œæ˜¯å†™å…¥æ–°çš„äºŒè¿›åˆ¶æ–‡ä»¶</span><br>    valid_binary_names = <span class="hljs-built_in">list</span>(<span class="hljs-built_in">filter</span>(valid_binary_name, os.listdir(BINARIES_PATH)))<br>    <span class="hljs-keyword">if</span> <span class="hljs-built_in">len</span>(valid_binary_names) &gt; <span class="hljs-number">0</span>:<br>        last_binary_name = <span class="hljs-built_in">sorted</span>(valid_binary_names)[-<span class="hljs-number">1</span>]<br>        new_suffix = <span class="hljs-built_in">int</span>(last_binary_name.split(<span class="hljs-string">&#x27;.&#x27;</span>)[<span class="hljs-number">0</span>][-<span class="hljs-number">6</span>:]) + <span class="hljs-number">1</span>  <span class="hljs-comment"># é€’å¢ 1</span><br>        <span class="hljs-keyword">return</span> <span class="hljs-string">f&#x27;<span class="hljs-subst">&#123;prefix&#125;</span>_<span class="hljs-subst">&#123;<span class="hljs-built_in">str</span>(new_suffix).zfill(<span class="hljs-number">6</span>)&#125;</span>.pth&#x27;</span><br>    <span class="hljs-keyword">else</span>:<br>        <span class="hljs-keyword">return</span> <span class="hljs-string">f&#x27;<span class="hljs-subst">&#123;prefix&#125;</span>_000000.pth&#x27;</span><br><br></code></pre></td></tr></table></figure>

<p>å¾ˆå¥½ï¼Œç°åœ¨æ˜¯ç»„ç»‡ç¨‹åºè®¾ç½®çš„argparseå¥½æ–¹æ³•ï¼š</p>
<figure class="highlight python"><table><tr><td class="code"><pre><code class="hljs python"><span class="hljs-keyword">import</span> argparse<br><br><span class="hljs-keyword">def</span> <span class="hljs-title function_">get_training_args</span>():<br>    parser = argparse.ArgumentParser()<br><br>    <span class="hljs-comment"># ä¸è®­ç»ƒç›¸å…³</span><br>    parser.add_argument(<span class="hljs-string">&quot;--num_of_epochs&quot;</span>, <span class="hljs-built_in">type</span>=<span class="hljs-built_in">int</span>, <span class="hljs-built_in">help</span>=<span class="hljs-string">&quot;è®­ç»ƒè½®æ•°&quot;</span>, default=<span class="hljs-number">10000</span>)<br>    parser.add_argument(<span class="hljs-string">&quot;--patience_period&quot;</span>, <span class="hljs-built_in">type</span>=<span class="hljs-built_in">int</span>, <span class="hljs-built_in">help</span>=<span class="hljs-string">&quot;åœ¨ç»ˆæ­¢ä¹‹å‰åœ¨éªŒè¯é›†ä¸Šæ²¡æœ‰æ”¹è¿›çš„è½®æ•°&quot;</span>, default=<span class="hljs-number">1000</span>)<br>    parser.add_argument(<span class="hljs-string">&quot;--lr&quot;</span>, <span class="hljs-built_in">type</span>=<span class="hljs-built_in">float</span>, <span class="hljs-built_in">help</span>=<span class="hljs-string">&quot;æ¨¡å‹å­¦ä¹ ç‡&quot;</span>, default=<span class="hljs-number">5e-3</span>)<br>    parser.add_argument(<span class="hljs-string">&quot;--weight_decay&quot;</span>, <span class="hljs-built_in">type</span>=<span class="hljs-built_in">float</span>, <span class="hljs-built_in">help</span>=<span class="hljs-string">&quot;æ¨¡å‹æƒé‡çš„L2æ­£åˆ™åŒ–&quot;</span>, default=<span class="hljs-number">5e-4</span>)<br>    parser.add_argument(<span class="hljs-string">&quot;--should_test&quot;</span>, <span class="hljs-built_in">type</span>=<span class="hljs-built_in">bool</span>, <span class="hljs-built_in">help</span>=<span class="hljs-string">&#x27;æ˜¯å¦åœ¨æµ‹è¯•é›†ä¸Šæµ‹è¯•æ¨¡å‹ï¼Ÿ&#x27;</span>, default=<span class="hljs-literal">True</span>)<br><br>    <span class="hljs-comment"># æ•°æ®é›†ç›¸å…³</span><br>    parser.add_argument(<span class="hljs-string">&quot;--dataset_name&quot;</span>, choices=[el.name <span class="hljs-keyword">for</span> el <span class="hljs-keyword">in</span> DatasetType], <span class="hljs-built_in">help</span>=<span class="hljs-string">&#x27;ç”¨äºè®­ç»ƒçš„æ•°æ®é›†&#x27;</span>, default=DatasetType.CORA.name)<br>    parser.add_argument(<span class="hljs-string">&quot;--should_visualize&quot;</span>, <span class="hljs-built_in">type</span>=<span class="hljs-built_in">bool</span>, <span class="hljs-built_in">help</span>=<span class="hljs-string">&#x27;æ˜¯å¦å¯è§†åŒ–æ•°æ®é›†ï¼Ÿ&#x27;</span>, default=<span class="hljs-literal">False</span>)<br><br>    <span class="hljs-comment"># æ—¥å¿—/è°ƒè¯•/æ£€æŸ¥ç‚¹ç›¸å…³ï¼ˆå¯¹å®éªŒéå¸¸æœ‰å¸®åŠ©ï¼‰</span><br>    parser.add_argument(<span class="hljs-string">&quot;--enable_tensorboard&quot;</span>, <span class="hljs-built_in">type</span>=<span class="hljs-built_in">bool</span>, <span class="hljs-built_in">help</span>=<span class="hljs-string">&quot;å¯ç”¨TensorBoardæ—¥å¿—&quot;</span>, default=<span class="hljs-literal">False</span>)<br>    parser.add_argument(<span class="hljs-string">&quot;--console_log_freq&quot;</span>, <span class="hljs-built_in">type</span>=<span class="hljs-built_in">int</span>, <span class="hljs-built_in">help</span>=<span class="hljs-string">&quot;è¾“å‡ºåˆ°æ§åˆ¶å°çš„æ—¥å¿—ï¼ˆæ¯è½®ï¼‰é¢‘ç‡ï¼ˆæ— æ—¥å¿—åˆ™ä¸ºNoneï¼‰&quot;</span>, default=<span class="hljs-number">100</span>)<br>    parser.add_argument(<span class="hljs-string">&quot;--checkpoint_freq&quot;</span>, <span class="hljs-built_in">type</span>=<span class="hljs-built_in">int</span>, <span class="hljs-built_in">help</span>=<span class="hljs-string">&quot;æ£€æŸ¥ç‚¹æ¨¡å‹ä¿å­˜ï¼ˆæ¯è½®ï¼‰é¢‘ç‡ï¼ˆæ— æ—¥å¿—åˆ™ä¸ºNoneï¼‰&quot;</span>, default=<span class="hljs-number">1000</span>)<br>    args = parser.parse_args(<span class="hljs-string">&quot;&quot;</span>)<br><br>    <span class="hljs-comment"># æ¨¡å‹æ¶æ„ç›¸å…³ - è¿™æ˜¯åœ¨å®˜æ–¹è®ºæ–‡ä¸­å®šä¹‰çš„ç”¨äºCoraåˆ†ç±»çš„æ¶æ„</span><br>    gat_config = &#123;<br>        <span class="hljs-string">&quot;num_of_layers&quot;</span>: <span class="hljs-number">2</span>,  <span class="hljs-comment"># GNNsä¸CNNsç›¸åï¼Œé€šå¸¸æ˜¯æµ…å±‚çš„ï¼ˆæœ€ç»ˆå–å†³äºå›¾çš„å±æ€§ï¼‰</span><br>        <span class="hljs-string">&quot;num_heads_per_layer&quot;</span>: [<span class="hljs-number">8</span>, <span class="hljs-number">1</span>],<br>        <span class="hljs-string">&quot;num_features_per_layer&quot;</span>: [CORA_NUM_INPUT_FEATURES, <span class="hljs-number">8</span>, CORA_NUM_CLASSES],<br>        <span class="hljs-string">&quot;add_skip_connection&quot;</span>: <span class="hljs-literal">False</span>,  <span class="hljs-comment"># åœ¨Coraä¸Šå½±å“æ€§èƒ½</span><br>        <span class="hljs-string">&quot;bias&quot;</span>: <span class="hljs-literal">True</span>,  <span class="hljs-comment"># ç»“æœå¯¹åç½®ä¸å¤ªæ•æ„Ÿ</span><br>        <span class="hljs-string">&quot;dropout&quot;</span>: <span class="hljs-number">0.6</span>,  <span class="hljs-comment"># å¯¹ä¸¢å¤±çµæ•</span><br>    &#125;<br><br>    <span class="hljs-comment"># å°†è®­ç»ƒé…ç½®å°è£…åˆ°å­—å…¸ä¸­</span><br>    training_config = <span class="hljs-built_in">dict</span>()<br>    <span class="hljs-keyword">for</span> arg <span class="hljs-keyword">in</span> <span class="hljs-built_in">vars</span>(args):<br>        training_config[arg] = <span class="hljs-built_in">getattr</span>(args, arg)<br><br>    <span class="hljs-comment"># æ·»åŠ é™„åŠ çš„é…ç½®ä¿¡æ¯</span><br>    training_config.update(gat_config)<br><br>    <span class="hljs-keyword">return</span> training_config<br><br></code></pre></td></tr></table></figure>

<p>åœ¨è¿™é‡Œï¼Œæˆ‘ä»¬ç»„ç»‡äº†é«˜çº§åˆ«çš„ GAT è®­ç»ƒæ‰€éœ€çš„ä¸€åˆ‡ã€‚åªéœ€ç»“åˆæˆ‘ä»¬å·²ç»å­¦è¿‡çš„éƒ¨åˆ†å³å¯ã€‚</p>
<figure class="highlight python"><table><tr><td class="code"><pre><code class="hljs python"><span class="hljs-keyword">import</span> time<br><br><span class="hljs-keyword">def</span> <span class="hljs-title function_">train_gat</span>(<span class="hljs-params">config</span>):<br>    <span class="hljs-keyword">global</span> BEST_VAL_ACC, BEST_VAL_LOSS<br><br>    device = torch.device(<span class="hljs-string">&quot;cuda&quot;</span> <span class="hljs-keyword">if</span> torch.cuda.is_available() <span class="hljs-keyword">else</span> <span class="hljs-string">&quot;cpu&quot;</span>)  <span class="hljs-comment"># æ£€æŸ¥æ˜¯å¦æœ‰GPUï¼Œå¸Œæœ›æœ‰ï¼</span><br><br>    <span class="hljs-comment"># æ­¥éª¤1ï¼šåŠ è½½å›¾æ•°æ®</span><br>    node_features, node_labels, edge_index, train_indices, val_indices, test_indices = load_graph_data(config, device)<br><br>    <span class="hljs-comment"># æ­¥éª¤2ï¼šå‡†å¤‡æ¨¡å‹</span><br>    gat = GAT(<br>        num_of_layers=config[<span class="hljs-string">&#x27;num_of_layers&#x27;</span>],<br>        num_heads_per_layer=config[<span class="hljs-string">&#x27;num_heads_per_layer&#x27;</span>],<br>        num_features_per_layer=config[<span class="hljs-string">&#x27;num_features_per_layer&#x27;</span>],<br>        add_skip_connection=config[<span class="hljs-string">&#x27;add_skip_connection&#x27;</span>],<br>        bias=config[<span class="hljs-string">&#x27;bias&#x27;</span>],<br>        dropout=config[<span class="hljs-string">&#x27;dropout&#x27;</span>],<br>        log_attention_weights=<span class="hljs-literal">False</span>  <span class="hljs-comment"># ä¸éœ€è¦å­˜å‚¨æ³¨æ„åŠ›ï¼Œä»…åœ¨ playground.py ä¸­ç”¨äºå¯è§†åŒ–</span><br>    ).to(device)<br><br>    <span class="hljs-comment"># æ­¥éª¤3ï¼šå‡†å¤‡å…¶ä»–ä¸è®­ç»ƒç›¸å…³çš„å·¥å…·ï¼ˆæŸå¤±å’Œä¼˜åŒ–å™¨ä»¥åŠè£…é¥°å‡½æ•°ï¼‰</span><br>    loss_fn = nn.CrossEntropyLoss(reduction=<span class="hljs-string">&#x27;mean&#x27;</span>)<br>    optimizer = Adam(gat.parameters(), lr=config[<span class="hljs-string">&#x27;lr&#x27;</span>], weight_decay=config[<span class="hljs-string">&#x27;weight_decay&#x27;</span>])<br><br>    <span class="hljs-comment"># è¿™æ˜¯è®­ç»ƒçš„æ ¸å¿ƒéƒ¨åˆ†ï¼ˆæˆ‘ä»¬ç¨åä¼šå®šä¹‰å®ƒï¼‰</span><br>    <span class="hljs-comment"># è£…é¥°å‡½æ•°ä½¿å¾—ä»£ç æ›´æ•´æ´ï¼Œå› ä¸ºåœ¨è®­ç»ƒå’ŒéªŒè¯å¾ªç¯ä¹‹é—´æœ‰å¾ˆå¤šå†—ä½™</span><br>    main_loop = get_main_loop(<br>        config,<br>        gat,<br>        loss_fn,<br>        optimizer,<br>        node_features,<br>        node_labels,<br>        edge_index,<br>        train_indices,<br>        val_indices,<br>        test_indices,<br>        config[<span class="hljs-string">&#x27;patience_period&#x27;</span>],<br>        time.time())<br><br>    BEST_VAL_ACC, BEST_VAL_LOSS, PATIENCE_CNT = [<span class="hljs-number">0</span>, <span class="hljs-number">0</span>, <span class="hljs-number">0</span>]  <span class="hljs-comment"># é‡ç½®ç”¨äºæå‰åœæ­¢çš„å˜é‡</span><br><br>    <span class="hljs-comment"># æ­¥éª¤4ï¼šå¼€å§‹è®­ç»ƒè¿‡ç¨‹</span><br>    <span class="hljs-keyword">for</span> epoch <span class="hljs-keyword">in</span> <span class="hljs-built_in">range</span>(config[<span class="hljs-string">&#x27;num_of_epochs&#x27;</span>]):<br>        <span class="hljs-comment"># è®­ç»ƒå¾ªç¯</span><br>        main_loop(phase=LoopPhase.TRAIN, epoch=epoch)<br><br>        <span class="hljs-comment"># éªŒè¯å¾ªç¯</span><br>        <span class="hljs-keyword">with</span> torch.no_grad():<br>            <span class="hljs-keyword">try</span>:<br>                main_loop(phase=LoopPhase.VAL, epoch=epoch)<br>            <span class="hljs-keyword">except</span> Exception <span class="hljs-keyword">as</span> e:  <span class="hljs-comment"># &quot;å¿è€å·²ç»ç”¨å®Œ&quot; çš„å¼‚å¸¸ :O</span><br>                <span class="hljs-built_in">print</span>(<span class="hljs-built_in">str</span>(e))<br>                <span class="hljs-keyword">break</span>  <span class="hljs-comment"># é€€å‡ºè®­ç»ƒå¾ªç¯</span><br><br>    <span class="hljs-comment"># æ­¥éª¤5ï¼šå¯èƒ½æµ‹è¯•æ‚¨çš„æ¨¡å‹</span><br>    <span class="hljs-comment"># ä¸è¦è¿‡åº¦æ‹Ÿåˆæµ‹è¯•æ•°æ®é›† - ä»…å½“æ‚¨åœ¨éªŒè¯æ•°æ®é›†ä¸Šå¾®è°ƒäº†æ¨¡å‹æ—¶ï¼Œæ‰åº”è¯¥æŠ¥å‘Šæµ‹è¯•æ•°æ®é›†ä¸Šçš„æœ€ç»ˆæŸå¤±å’Œå‡†ç¡®æ€§ã€‚</span><br>    <span class="hljs-keyword">if</span> config[<span class="hljs-string">&#x27;should_test&#x27;</span>]:<br>        test_acc = main_loop(phase=LoopPhase.TEST)<br>        config[<span class="hljs-string">&#x27;test_acc&#x27;</span>] = test_acc<br>        <span class="hljs-built_in">print</span>(<span class="hljs-string">f&#x27;Test accuracy = <span class="hljs-subst">&#123;test_acc&#125;</span>&#x27;</span>)<br>    <span class="hljs-keyword">else</span>:<br>        config[<span class="hljs-string">&#x27;test_acc&#x27;</span>] = -<span class="hljs-number">1</span><br><br>    <span class="hljs-comment"># å°†æœ€æ–°çš„GATä¿å­˜åœ¨äºŒè¿›åˆ¶ç›®å½•ä¸­</span><br>    torch.save(get_training_state(config, gat), os.path.join(BINARIES_PATH, get_available_binary_name()))<br><br></code></pre></td></tr></table></figure>

<p>ğŸ‰ğŸ‰ğŸ‰</p>
<p>ç°åœ¨æ˜¯è®­ç»ƒçš„æ ¸å¿ƒéƒ¨åˆ† - ä¸»å¾ªç¯ï¼Œæ­£å¦‚æˆ‘æ‰€è¯´çš„é‚£æ ·ã€‚</p>
<p>æˆ‘è¿™æ ·ç»„ç»‡å®ƒï¼Œè¿™æ ·æˆ‘å°±ä¸å¿…ä¸ºè®­ç»ƒ&#x2F;éªŒè¯&#x2F;æµ‹è¯•å¾ªç¯å¤åˆ¶&#x2F;ç²˜è´´ä¸€å †ç›¸åŒçš„ä»£ç ã€‚</p>
<figure class="highlight python"><table><tr><td class="code"><pre><code class="hljs python"><span class="hljs-comment"># ç®€å•çš„è£…é¥°å‡½æ•°ï¼Œè¿™æ ·æˆ‘å°±ä¸å¿…ä¼ é€’ä»ä¸€ä¸ªæ—¶æœŸåˆ°å¦ä¸€ä¸ªæ—¶æœŸéƒ½ä¸å˜çš„å‚æ•°</span><br><span class="hljs-keyword">def</span> <span class="hljs-title function_">get_main_loop</span>(<span class="hljs-params">config, gat, cross_entropy_loss, optimizer, node_features, node_labels, edge_index, train_indices, val_indices, test_indices, patience_period, time_start</span>):<br><br>    node_dim = <span class="hljs-number">0</span>  <span class="hljs-comment"># è¿™å¯èƒ½ä¼šåœ¨æˆ‘æ·»åŠ å½’çº³ç¤ºä¾‹ï¼ˆCoraæ˜¯å½’çº³çš„ï¼‰æ—¶å‘ç”Ÿå˜åŒ–</span><br><br>    train_labels = node_labels.index_select(node_dim, train_indices)<br>    val_labels = node_labels.index_select(node_dim, val_indices)<br>    test_labels = node_labels.index_select(node_dim, test_indices)<br><br>    <span class="hljs-comment"># node_features å½¢çŠ¶ = (N, FIN)ï¼Œedge_index å½¢çŠ¶ = (2, E)</span><br>    graph_data = (node_features, edge_index)  <span class="hljs-comment"># æˆ‘å°†æ•°æ®æ‰“åŒ…åˆ°å…ƒç»„ä¸­ï¼Œå› ä¸ºGATä½¿ç”¨nn.Sequentialï¼Œå®ƒè¦æ±‚è¿™æ ·åš</span><br><br>    <span class="hljs-keyword">def</span> <span class="hljs-title function_">get_node_indices</span>(<span class="hljs-params">phase</span>):<br>        <span class="hljs-keyword">if</span> phase == LoopPhase.TRAIN:<br>            <span class="hljs-keyword">return</span> train_indices<br>        <span class="hljs-keyword">elif</span> phase == LoopPhase.VAL:<br>            <span class="hljs-keyword">return</span> val_indices<br>        <span class="hljs-keyword">else</span>:<br>            <span class="hljs-keyword">return</span> test_indices<br><br>    <span class="hljs-keyword">def</span> <span class="hljs-title function_">get_node_labels</span>(<span class="hljs-params">phase</span>):<br>        <span class="hljs-keyword">if</span> phase == LoopPhase.TRAIN:<br>            <span class="hljs-keyword">return</span> train_labels<br>        <span class="hljs-keyword">elif</span> phase == LoopPhase.VAL:<br>            <span class="hljs-keyword">return</span> val_labels<br>        <span class="hljs-keyword">else</span>:<br>            <span class="hljs-keyword">return</span> test_labels<br><br>    <span class="hljs-keyword">def</span> <span class="hljs-title function_">main_loop</span>(<span class="hljs-params">phase, epoch=<span class="hljs-number">0</span></span>):<br>        <span class="hljs-keyword">global</span> BEST_VAL_ACC, BEST_VAL_LOSS, PATIENCE_CNT, writer<br><br>        <span class="hljs-comment"># æŸäº›æ¨¡å—çš„è¡Œä¸ºå–å†³äºæˆ‘ä»¬æ˜¯å¦æ­£åœ¨è®­ç»ƒæ¨¡å‹ã€‚</span><br>        <span class="hljs-comment"># ä¾‹å¦‚ nn.Dropout - æˆ‘ä»¬åªæƒ³åœ¨è®­ç»ƒæœŸé—´ä¸¢å¼ƒæ¨¡å‹æƒé‡ã€‚</span><br>        <span class="hljs-keyword">if</span> phase == LoopPhase.TRAIN:<br>            gat.train()<br>        <span class="hljs-keyword">else</span>:<br>            gat.<span class="hljs-built_in">eval</span>()<br><br>        node_indices = get_node_indices(phase)<br>        gt_node_labels = get_node_labels(phase)  <span class="hljs-comment"># gt ä»£è¡¨ ground truthï¼ˆå®é™…æ ‡ç­¾ï¼‰</span><br><br>        <span class="hljs-comment"># è¿›è¡Œå‰å‘ä¼ æ’­å¹¶ä»…æå–ç›¸å…³èŠ‚ç‚¹å¾—åˆ†ï¼ˆtrain/valæˆ–testï¼‰</span><br>        <span class="hljs-comment"># æ³¨æ„ï¼š[0] åªæ˜¯æå–æ•°æ®çš„ node_features éƒ¨åˆ†ï¼ˆç´¢å¼• 1 åŒ…å« edge_indexï¼‰</span><br>        <span class="hljs-comment"># å½¢çŠ¶ = (N, C)ï¼Œå…¶ä¸­ N æ˜¯åˆ†å‰²ä¸­èŠ‚ç‚¹çš„æ•°é‡ï¼ˆtrain/val/testï¼‰ï¼ŒC æ˜¯ç±»çš„æ•°é‡</span><br>        nodes_unnormalized_scores = gat(graph_data)[<span class="hljs-number">0</span>].index_select(node_dim, node_indices)<br><br>        <span class="hljs-comment"># ä¾‹å¦‚ï¼šè®©æˆ‘ä»¬å– Cora ä¸Šå•ä¸ªèŠ‚ç‚¹çš„è¾“å‡º - å®ƒæ˜¯ä¸€ä¸ªå¤§å°ä¸º 7 çš„å‘é‡ï¼ŒåŒ…å«æœªè§„èŒƒåŒ–çš„åˆ†æ•°ï¼Œå¦‚ä¸‹æ‰€ç¤ºï¼š</span><br>        <span class="hljs-comment"># V = [-1.393,  3.0765, -2.4445,  9.6219,  2.1658, -5.5243, -4.6247]</span><br>        <span class="hljs-comment"># PyTorchçš„äº¤å‰ç†µæŸå¤±æ‰€åšçš„æ˜¯ï¼Œå¯¹äºæ¯ä¸ªè¿™æ ·çš„å‘é‡ï¼Œé¦–å…ˆåº”ç”¨ softmaxï¼Œæ‰€ä»¥æˆ‘ä»¬å°† V è½¬æ¢ä¸ºï¼š</span><br>        <span class="hljs-comment"># [1.6421e-05, 1.4338e-03, 5.7378e-06, 0.99797, 5.7673e-04, 2.6376e-07, 6.4848e-07]</span><br>        <span class="hljs-comment"># å…¶æ¬¡ï¼Œæ— è®ºæ­£ç¡®ç±»åˆ«æ˜¯ä»€ä¹ˆï¼ˆå‡è®¾æ˜¯ 3ï¼‰ï¼Œå®ƒéƒ½å°†åœ¨ä½ç½® 3 å¤„å–å…ƒç´ ï¼Œ0.99797 åœ¨è¿™ç§æƒ…å†µä¸‹ï¼Œ</span><br>        <span class="hljs-comment"># æŸå¤±å°†ä¸º -log(0.99797)ã€‚å¯¹äºæ¯ä¸ªèŠ‚ç‚¹ï¼Œå®ƒéƒ½ä¼šè¿™æ ·åšå¹¶åº”ç”¨å‡å€¼ã€‚</span><br>        <span class="hljs-comment"># å¯ä»¥çœ‹åˆ°ï¼Œéšç€å¤§å¤šæ•°èŠ‚ç‚¹çš„æ­£ç¡®ç±»åˆ«çš„æ¦‚ç‡æ¥è¿‘ 1ï¼ŒæŸå¤±è¶‹è¿‘äº 0ï¼ &lt;3</span><br>        loss = cross_entropy_loss(nodes_unnormalized_scores, gt_node_labels)<br><br>        <span class="hljs-keyword">if</span> phase == LoopPhase.TRAIN:<br>            optimizer.zero_grad()  <span class="hljs-comment"># æ¸…ç†è®¡ç®—å›¾ä¸­å¯è®­ç»ƒæƒé‡çš„æ¢¯åº¦ï¼ˆ.grad å­—æ®µï¼‰</span><br>            loss.backward()  <span class="hljs-comment"># ä¸ºè®¡ç®—å›¾ä¸­çš„æ¯ä¸ªå¯è®­ç»ƒæƒé‡è®¡ç®—æ¢¯åº¦</span><br>            optimizer.step()  <span class="hljs-comment"># å°†æ¢¯åº¦åº”ç”¨åˆ°æƒé‡ä¸Š</span><br><br>        <span class="hljs-comment"># æ‰¾åˆ°æ¯ä¸ªèŠ‚ç‚¹æœ€å¤§ï¼ˆæœªè§„èŒƒåŒ–ï¼‰å¾—åˆ†çš„ç´¢å¼•ï¼Œè¿™æ˜¯è¯¥èŠ‚ç‚¹çš„ç±»åˆ«é¢„æµ‹ã€‚</span><br>        <span class="hljs-comment"># å°†è¿™äº›ä¸çœŸå®ï¼ˆå®é™…æ ‡ç­¾ï¼‰æ ‡ç­¾è¿›è¡Œæ¯”è¾ƒï¼Œå¹¶æ‰¾åˆ°æ­£ç¡®é¢„æµ‹çš„æ¯”ä¾‹ -&gt; å‡†ç¡®æ€§æŒ‡æ ‡ã€‚</span><br>        class_predictions = torch.argmax(nodes_unnormalized_scores, dim=-<span class="hljs-number">1</span>)<br>        accuracy = torch.<span class="hljs-built_in">sum</span>(torch.eq(class_predictions, gt_node_labels).long()).item() / <span class="hljs-built_in">len</span>(gt_node_labels)<br><br>        <span class="hljs-keyword">if</span> phase == LoopPhase.TRAIN:<br>            <span class="hljs-comment"># è®°å½•æŒ‡æ ‡</span><br>            <span class="hljs-keyword">if</span> config[<span class="hljs-string">&#x27;enable_tensorboard&#x27;</span>]:<br>                writer.add_scalar(<span class="hljs-string">&#x27;training_loss&#x27;</span>, loss.item(), epoch)<br>                writer.add_scalar(<span class="hljs-string">&#x27;training_acc&#x27;</span>, accuracy, epoch)<br><br>            <span class="hljs-comment"># ä¿å­˜æ¨¡å‹æ£€æŸ¥ç‚¹</span><br>            <span class="hljs-keyword">if</span> config[<span class="hljs-string">&#x27;checkpoint_freq&#x27;</span>] <span class="hljs-keyword">is</span> <span class="hljs-keyword">not</span> <span class="hljs-literal">None</span> <span class="hljs-keyword">and</span> (epoch + <span class="hljs-number">1</span>) % config[<span class="hljs-string">&#x27;checkpoint_freq&#x27;</span>] == <span class="hljs-number">0</span>:<br>                ckpt_model_name = <span class="hljs-string">f&quot;gat_ckpt_epoch_<span class="hljs-subst">&#123;epoch + <span class="hljs-number">1</span>&#125;</span>.pth&quot;</span><br>                config[<span class="hljs-string">&#x27;test_acc&#x27;</span>] = -<span class="hljs-number">1</span><br>                torch.save(get_training_state(config, gat), os.path.join(CHECKPOINTS_PATH, ckpt_model_name))<br><br>        <span class="hljs-keyword">elif</span> phase == LoopPhase.VAL:<br>            <span class="hljs-comment"># è®°å½•æŒ‡æ ‡</span><br>            <span class="hljs-keyword">if</span> config[<span class="hljs-string">&#x27;enable_tensorboard&#x27;</span>]:<br>                writer.add_scalar(<span class="hljs-string">&#x27;val_loss&#x27;</span>, loss.item(), epoch)<br>                writer.add_scalar(<span class="hljs-string">&#x27;val_acc&#x27;</span>, accuracy, epoch)<br><br>            <span class="hljs-comment"># è®°å½•åˆ°æ§åˆ¶å°</span><br>            <span class="hljs-keyword">if</span> config[<span class="hljs-string">&#x27;console_log_freq&#x27;</span>] <span class="hljs-keyword">is</span> <span class="hljs-keyword">not</span> <span class="hljs-literal">None</span> <span class="hljs-keyword">and</span> epoch % config[<span class="hljs-string">&#x27;console_log_freq&#x27;</span>] == <span class="hljs-number">0</span>:<br>                <span class="hljs-built_in">print</span>(<span class="hljs-string">f&#x27;GAT training: time elapsed= <span class="hljs-subst">&#123;(time.time() - time_start):<span class="hljs-number">.2</span>f&#125;</span> [s] | epoch=<span class="hljs-subst">&#123;epoch + <span class="hljs-number">1</span>&#125;</span> | val acc=<span class="hljs-subst">&#123;accuracy&#125;</span>&#x27;</span>)<br><br>            <span class="hljs-comment"># â€œè€å¿ƒâ€é€»è¾‘ - æˆ‘ä»¬æ˜¯å¦åº”è¯¥ä»è®­ç»ƒå¾ªç¯ä¸­é€€å‡ºï¼Ÿå¦‚æœéªŒè¯å‡†ç¡®æ€§ä¸æ–­æé«˜</span><br>            <span class="hljs-comment"># æˆ–éªŒè¯æŸå¤±ä¸æ–­ä¸‹é™ï¼Œæˆ‘ä»¬å°±ä¸ä¼šåœæ­¢</span><br>            <span class="hljs-keyword">if</span> accuracy &gt; BEST_VAL_ACC <span class="hljs-keyword">or</span> loss.item() &lt; BEST_VAL_LOSS:<br>                BEST_VAL_ACC = <span class="hljs-built_in">max</span>(accuracy, BEST_VAL_ACC)  <span class="hljs-comment"># è·Ÿè¸ªåˆ°ç›®å‰ä¸ºæ­¢çš„æœ€ä½³éªŒè¯å‡†ç¡®æ€§</span><br>                BEST_VAL_LOSS = <span class="hljs-built_in">min</span>(loss.item(), BEST_VAL_LOSS)<br>                PATIENCE_CNT = <span class="hljs-number">0</span>  <span class="hljs-comment"># æ¯æ¬¡é‡åˆ°æ–°çš„æœ€ä½³å‡†ç¡®æ€§æ—¶é‡ç½®è®¡æ•°å™¨</span><br>            <span class="hljs-keyword">else</span>:<br>                PATIENCE_CNT += <span class="hljs-number">1</span>  <span class="hljs-comment"># å¦åˆ™ç»§ç»­è®¡æ•°</span><br><br>            <span class="hljs-keyword">if</span> PATIENCE_CNT &gt;= patience_period:<br>                <span class="hljs-keyword">raise</span> Exception(<span class="hljs-string">&#x27;åœæ­¢è®­ç»ƒï¼Œå®‡å®™å¯¹è¿™æ¬¡è®­ç»ƒæ²¡æœ‰æ›´å¤šçš„è€å¿ƒäº†ã€‚&#x27;</span>)<br><br>        <span class="hljs-keyword">else</span>:<br>            <span class="hljs-keyword">return</span> accuracy  <span class="hljs-comment"># åœ¨æµ‹è¯•é˜¶æ®µï¼Œæˆ‘ä»¬åªè¿”å›æµ‹è¯•å‡†ç¡®æ€§</span><br><br>    <span class="hljs-keyword">return</span> main_loop  <span class="hljs-comment"># è¿”å›è£…é¥°å‡½æ•°</span><br><br></code></pre></td></tr></table></figure>

<p>å¼€å§‹è®­ç»ƒå§</p>
<figure class="highlight python"><table><tr><td class="code"><pre><code class="hljs python"><span class="hljs-comment"># Train the graph attention network (GAT)</span><br>train_gat(get_training_args())<br></code></pre></td></tr></table></figure>

<pre><code class="hljs">/var/folders/f0/812mfv7x63vbytjs3yf4gxtc0000gn/T/ipykernel_16269/2448994618.py:6: DeprecationWarning: Please use `csr_matrix` from the `scipy.sparse` namespace, the `scipy.sparse.csr` namespace is deprecated.
  data = pickle.load(file)


GAT training: time elapsed= 0.22 [s] | epoch=1 | val acc=0.124
GAT training: time elapsed= 5.56 [s] | epoch=101 | val acc=0.79
GAT training: time elapsed= 10.72 [s] | epoch=201 | val acc=0.8
GAT training: time elapsed= 15.92 [s] | epoch=301 | val acc=0.8
GAT training: time elapsed= 21.13 [s] | epoch=401 | val acc=0.782
GAT training: time elapsed= 26.34 [s] | epoch=501 | val acc=0.784
GAT training: time elapsed= 31.68 [s] | epoch=601 | val acc=0.816
GAT training: time elapsed= 36.79 [s] | epoch=701 | val acc=0.804
GAT training: time elapsed= 41.91 [s] | epoch=801 | val acc=0.806
GAT training: time elapsed= 47.01 [s] | epoch=901 | val acc=0.814
GAT training: time elapsed= 52.20 [s] | epoch=1001 | val acc=0.81
GAT training: time elapsed= 57.41 [s] | epoch=1101 | val acc=0.798
GAT training: time elapsed= 62.52 [s] | epoch=1201 | val acc=0.816
GAT training: time elapsed= 67.61 [s] | epoch=1301 | val acc=0.796
GAT training: time elapsed= 72.71 [s] | epoch=1401 | val acc=0.79
GAT training: time elapsed= 77.82 [s] | epoch=1501 | val acc=0.812
GAT training: time elapsed= 82.94 [s] | epoch=1601 | val acc=0.796
GAT training: time elapsed= 88.08 [s] | epoch=1701 | val acc=0.798
GAT training: time elapsed= 93.26 [s] | epoch=1801 | val acc=0.794
GAT training: time elapsed= 98.39 [s] | epoch=1901 | val acc=0.8
GAT training: time elapsed= 103.64 [s] | epoch=2001 | val acc=0.806
åœæ­¢è®­ç»ƒï¼Œå®‡å®™å¯¹è¿™æ¬¡è®­ç»ƒæ²¡æœ‰æ›´å¤šçš„è€å¿ƒäº†ã€‚
Test accuracy = 0.817
</code></pre>
<p>å¥½çš„ï¼ï¼ï¼ğŸ‰ğŸ‰ğŸ‰ 4 çº§è§£é”ï¼ˆGAT å¯è§†åŒ–ğŸ”®ï¼‰ã€‚</p>
<p>æˆ‘ä»¬åˆšåˆš82.9 %åœ¨ Cora çš„æµ‹è¯•èŠ‚ç‚¹ä¸Šå®ç°äº†ï¼ä¸åŸå§‹ GAT è®ºæ–‡ä¸­æŠ¥å‘Šçš„æ•°å­—ç›¸åŒï¼</p>
<p>ç°åœ¨æˆ‘ä»¬å·²ç»ä¸€åˆ‡å°±ç»ªï¼š</p>
<ol>
<li>æ•°æ®åŠ è½½å’Œå¯è§†åŒ–ğŸ“œ -&gt; ç¡®è®¤</li>
<li>GAT æ¨¡å‹å®šä¹‰ ğŸ¦„ -&gt; ç¡®è®¤</li>
<li>è®­ç»ƒå¾ªç¯è®¾ç½®å’Œè®­ç»ƒåçš„æ¨¡å‹äºŒè¿›åˆ¶æ–‡ä»¶ ğŸ’ª -&gt; ç¡®è®¤</li>
</ol>
<p>ç°åœ¨è®©æˆ‘ä»¬åœ¨æ˜¾å¾®é•œğŸ”¬ä¸‹è§‚å¯Ÿ GAT æ¨¡å‹å¹¶äº†è§£æˆ‘ä»¬å¾—åˆ°çš„æƒé‡ - æˆ‘ä»¬å¯ä»¥é€šè¿‡å¤šç§æ–¹å¼åšåˆ°è¿™ç‚¹ã€‚</p>
<h1 id="ç¬¬-4-éƒ¨åˆ†ï¼šå¯è§†åŒ–-GAT-ğŸ”®"><a href="#ç¬¬-4-éƒ¨åˆ†ï¼šå¯è§†åŒ–-GAT-ğŸ”®" class="headerlink" title="ç¬¬ 4 éƒ¨åˆ†ï¼šå¯è§†åŒ– GAT ğŸ”®"></a>ç¬¬ 4 éƒ¨åˆ†ï¼šå¯è§†åŒ– GAT ğŸ”®</h1><p>è®©æˆ‘ä»¬é¦–å…ˆå®šä¹‰ä¸€äº›æˆ‘ä»¬éœ€è¦çš„å‡½æ•°ã€‚</p>
<p>ä»¥ä¸‹å•å…ƒæ ¼çš„ä»£ç ç‰‡æ®µå°†è¢«å¤šæ¬¡è°ƒç”¨ï¼Œå› æ­¤æˆ‘ä»¬å°†å…¶æå–åˆ°ä¸€ä¸ªå‡½æ•°ä¸­ - ä¸€ä¸ªå¾ˆå¥½çš„æ¨¡å—åŒ–è®¾è®¡ã€‚</p>
<p>æ³¨æ„ï¼šä¸»è¦åŸå› å®é™…ä¸Šæ˜¯ igraph åœ¨ Jupyter ä¸Šå‡ºç°é—®é¢˜ï¼Œæ‰€ä»¥æˆ‘æ­£åœ¨è§£å†³è¿™ä¸ªé—®é¢˜ï¼Œå¦‚æœä½ å¥½å¥‡çš„è¯ï¼Œè¯·æŸ¥çœ‹<a href="https://github.com/gordicaleksa/pytorch-GAT/blob/main/playground.py#L147">åŸå§‹ä»£ç </a> ğŸ˜‚</p>
<figure class="highlight python"><table><tr><td class="code"><pre><code class="hljs python"><span class="hljs-keyword">def</span> <span class="hljs-title function_">gat_forward_pass</span>(<span class="hljs-params">model_name, dataset_name</span>):<br>    device = torch.device(<span class="hljs-string">&quot;cuda&quot;</span> <span class="hljs-keyword">if</span> torch.cuda.is_available() <span class="hljs-keyword">else</span> <span class="hljs-string">&quot;cpu&quot;</span>)  <span class="hljs-comment"># æ£€æŸ¥æ˜¯å¦æœ‰ GPUï¼Œå¸Œæœ›æœ‰ï¼</span><br><br>    config = &#123;<br>        <span class="hljs-string">&#x27;dataset_name&#x27;</span>: dataset_name,<br>        <span class="hljs-string">&#x27;should_visualize&#x27;</span>: <span class="hljs-literal">False</span>  <span class="hljs-comment"># ä¸å¯è§†åŒ–æ•°æ®é›†</span><br>    &#125;<br><br>    <span class="hljs-comment"># æ­¥éª¤ 1ï¼šå‡†å¤‡æ•°æ®</span><br>    node_features, node_labels, edge_index, _, _, _ = load_graph_data(config, device)<br><br>    <span class="hljs-comment"># æ­¥éª¤ 2ï¼šå‡†å¤‡æ¨¡å‹</span><br>    model_path = os.path.join(BINARIES_PATH, model_name)<br>    model_state = torch.load(model_path, map_location=torch.device(<span class="hljs-string">&#x27;cpu&#x27;</span>))<br><br>    gat = GAT(<br>        num_of_layers=model_state[<span class="hljs-string">&#x27;num_of_layers&#x27;</span>],<br>        num_heads_per_layer=model_state[<span class="hljs-string">&#x27;num_heads_per_layer&#x27;</span>],<br>        num_features_per_layer=model_state[<span class="hljs-string">&#x27;num_features_per_layer&#x27;</span>],<br>        add_skip_connection=model_state[<span class="hljs-string">&#x27;add_skip_connection&#x27;</span>],<br>        bias=model_state[<span class="hljs-string">&#x27;bias&#x27;</span>],<br>        dropout=model_state[<span class="hljs-string">&#x27;dropout&#x27;</span>],<br>        log_attention_weights=<span class="hljs-literal">True</span><br>    ).to(device)<br><br>    print_model_metadata(model_state)<br>    gat.load_state_dict(model_state[<span class="hljs-string">&quot;state_dict&quot;</span>], strict=<span class="hljs-literal">True</span>)<br>    gat.<span class="hljs-built_in">eval</span>()  <span class="hljs-comment"># ä¸€äº›å±‚ï¼Œæ¯”å¦‚ nn.Dropoutï¼Œåœ¨è®­ç»ƒæ¨¡å¼å’Œè¯„ä¼°æ¨¡å¼ä¸‹çš„è¡Œä¸ºæ˜¯ä¸åŒçš„ï¼Œå› æ­¤è¿™ä¸€éƒ¨åˆ†å¾ˆé‡è¦</span><br><br>    <span class="hljs-comment"># æ­¥éª¤ 3ï¼šè®¡ç®—æˆ‘ä»¬å°†éœ€è¦ä¸åŒå¯è§†åŒ–ç±»å‹çš„æ‰€æœ‰ä¸œè¥¿ï¼ˆæ³¨æ„åŠ›ã€åˆ†æ•°ã€edge_indexï¼‰</span><br><br>    <span class="hljs-comment"># è¿™ä¸ªä¸Šä¸‹æ–‡ç®¡ç†å™¨å¾ˆé‡è¦ï¼ˆä½ ç»å¸¸ä¼šçœ‹åˆ°å®ƒï¼‰ï¼Œå¦åˆ™ PyTorch ä¼šå ç”¨æ›´å¤šå†…å­˜ã€‚</span><br>    <span class="hljs-comment"># å®ƒä¼šä¿å­˜åå‘ä¼ æ’­çš„æ¿€æ´»ï¼Œä½†æˆ‘ä»¬ä¸ä¼šè¿›è¡Œä»»ä½•æ¨¡å‹è®­ç»ƒï¼Œåªæ˜¯é¢„æµ‹ã€‚</span><br>    <span class="hljs-keyword">with</span> torch.no_grad():<br>        <span class="hljs-comment"># æ­¥éª¤ 3ï¼šè¿è¡Œé¢„æµ‹å¹¶æ”¶é›†é«˜ç»´æ•°æ®</span><br>        all_nodes_unnormalized_scores, _ = gat((node_features, edge_index))  <span class="hljs-comment"># å½¢çŠ¶ = (N, ç±»åˆ«æ•°)</span><br>        all_nodes_unnormalized_scores = all_nodes_unnormalized_scores.cpu().numpy()<br><br>    <span class="hljs-keyword">return</span> all_nodes_unnormalized_scores, edge_index, node_labels, gat<br><br></code></pre></td></tr></table></figure>

<p>å¾ˆé«˜å…´åªç”Ÿæˆå°†åœ¨ä¸‹æ¸¸å¯è§†åŒ–ä¸­ä½¿ç”¨çš„æ•°æ®ï¼Œæ‚¨å°†åœ¨ä»¥ä¸‹å•å…ƒæ ¼ä¸­çœ‹åˆ°å®šä¹‰çš„æ•°æ®ã€‚</p>
<p>æˆ‘ä»¬è¿˜éœ€è¦ä¸€ä¸ªè¾…åŠ©å‡½æ•°ï¼Œå·²ç»å‡†å¤‡å¥½äº†ï¼</p>
<figure class="highlight python"><table><tr><td class="code"><pre><code class="hljs python"><span class="hljs-comment"># ç»˜åˆ¶ï¼ˆä½†å°šæœªç»˜åˆ¶ï¼‰ç†µç›´æ–¹å›¾ã€‚å¦‚æœä½ å¯¹ä¸ºä»€ä¹ˆçªç„¶å‡ºç°ç†µæ„Ÿåˆ°å›°æƒ‘ï¼Œè¯·è·Ÿæˆ‘èµ°ï¼Œä½ å¾ˆå¿«å°±ä¼šæ˜ç™½çš„ã€‚</span><br><span class="hljs-comment"># åŸºæœ¬ä¸Šï¼Œå®ƒå¸®åŠ©æˆ‘ä»¬é‡åŒ– GAT å­¦åˆ°çš„æ³¨æ„åŠ›æ¨¡å¼çš„æœ‰ç”¨æ€§ã€‚</span><br><span class="hljs-keyword">def</span> <span class="hljs-title function_">draw_entropy_histogram</span>(<span class="hljs-params">entropy_array, title, color=<span class="hljs-string">&#x27;blue&#x27;</span>, uniform_distribution=<span class="hljs-literal">False</span>, num_bins=<span class="hljs-number">30</span></span>):<br>    max_value = np.<span class="hljs-built_in">max</span>(entropy_array)<br>    bar_width = (max_value / num_bins) * (<span class="hljs-number">1.0</span> <span class="hljs-keyword">if</span> uniform_distribution <span class="hljs-keyword">else</span> <span class="hljs-number">0.75</span>)<br>    histogram_values, histogram_bins = np.histogram(entropy_array, bins=num_bins, <span class="hljs-built_in">range</span>=(<span class="hljs-number">0.0</span>, max_value))<br><br>    plt.bar(histogram_bins[:num_bins], histogram_values[:num_bins], width=bar_width, color=color)<br>    plt.xlabel(<span class="hljs-string">f&#x27;ç†µåŒºé—´&#x27;</span>)<br>    plt.ylabel(<span class="hljs-string">f&#x27;èŠ‚ç‚¹é‚»å±…æ•°é‡&#x27;</span>)<br>    plt.title(title)<br><br></code></pre></td></tr></table></figure>

<p>å¾ˆå¥½ï¼Œæ¥ä¸‹æ¥æ˜¯æˆ‘ä»¬å°†ç”¨æ¥å¯è§†åŒ– GAT åµŒå…¥ï¼ˆé€šè¿‡ t-SNEï¼‰å’Œç†µç›´æ–¹å›¾çš„ä¸»è¦å‡½æ•°ï¼š</p>
<figure class="highlight python"><table><tr><td class="code"><pre><code class="hljs python"><span class="hljs-keyword">from</span> sklearn.manifold <span class="hljs-keyword">import</span> TSNE<br><span class="hljs-keyword">from</span> scipy.stats <span class="hljs-keyword">import</span> entropy<br><br><br><span class="hljs-comment"># è®©æˆ‘ä»¬å®šä¹‰ä¸€ä¸ªæšä¸¾ä½œä¸ºé€‰æ‹©ä¸åŒå¯è§†åŒ–é€‰é¡¹çš„æ¸…æ™°æ–¹å¼</span><br><span class="hljs-keyword">class</span> <span class="hljs-title class_">VisualizationType</span>(enum.Enum):<br>    ATTENTION = <span class="hljs-number">0</span>,<br>    EMBEDDINGS = <span class="hljs-number">1</span>,<br>    ENTROPY = <span class="hljs-number">2</span>,<br><br><br><span class="hljs-keyword">def</span> <span class="hljs-title function_">visualize_gat_properties</span>(<span class="hljs-params">model_name=<span class="hljs-string">r&#x27;gat_000000.pth&#x27;</span>, dataset_name=DatasetType.CORA.name, visualization_type=VisualizationType.ATTENTION</span>):<br>    <span class="hljs-string">&quot;&quot;&quot;</span><br><span class="hljs-string">    åœ¨å¯è§†åŒ–é€‰é¡¹ä¹‹é—´é€‰æ‹© t-SNE æˆ–ç†µç›´æ–¹å›¾ã€‚</span><br><span class="hljs-string">    </span><br><span class="hljs-string">    t-SNE çš„æ³¨æ„äº‹é¡¹ï¼š</span><br><span class="hljs-string">    æŸ¥çœ‹æ­¤é“¾æ¥ä»¥è·å–æœ‰å…³å¦‚ä½•è°ƒæ•´ t-SNE çš„æ›´å¤šç›´è§‚ä¿¡æ¯ï¼šhttps://distill.pub/2016/misread-tsne/</span><br><span class="hljs-string"></span><br><span class="hljs-string">    å¦‚æœæ‚¨è®¤ä¸ºå®ç° t-SNE å¹¶è§£é‡Šæ¯ä¸ªç»†èŠ‚çš„æœ‰ç”¨æ€§ï¼Œå¹¶ä¸”æ„¿æ„è®©æˆ‘çŸ¥é“ï¼Œå¯ä»¥æ‰“å¼€ä¸€ä¸ªé—®é¢˜æˆ–åœ¨ç¤¾äº¤åª’ä½“ä¸Šç§ä¿¡æˆ‘ï¼&lt;3</span><br><span class="hljs-string"></span><br><span class="hljs-string">    æ³¨æ„ï¼šæˆ‘è¿˜å°è¯•è¿‡ä½¿ç”¨ UMAPï¼Œä½†å®ƒå¹¶æ²¡æœ‰æä¾›æ¯” t-SNE æ›´å¤šçš„è§è§£ã€‚</span><br><span class="hljs-string">    ï¼ˆç¼ºç‚¹ï¼šå¦‚æœè¦ä½¿ç”¨å…¶ç»˜å›¾åŠŸèƒ½ï¼Œå®ƒæœ‰å¾ˆå¤šä¾èµ–é¡¹ï¼‰</span><br><span class="hljs-string">    </span><br><span class="hljs-string">    &quot;&quot;&quot;</span><br>    <br>    <span class="hljs-comment"># è·å–åˆ›å»ºå¯è§†åŒ–æ‰€éœ€çš„æ•°æ®</span><br>    all_nodes_unnormalized_scores, edge_index, node_labels, gat = gat_forward_pass(model_name, dataset_name)<br>    <br>    <span class="hljs-comment"># æ‰§è¡Œç‰¹å®šçš„å¯è§†åŒ–ï¼ˆt-SNE æˆ–ç†µç›´æ–¹å›¾ï¼‰</span><br>    <span class="hljs-keyword">if</span> visualization_type == VisualizationType.EMBEDDINGS:  <span class="hljs-comment"># å¯è§†åŒ–åµŒå…¥ï¼ˆä½¿ç”¨ t-SNEï¼‰</span><br>        node_labels = node_labels.cpu().numpy()<br>        num_classes = <span class="hljs-built_in">len</span>(<span class="hljs-built_in">set</span>(node_labels))<br><br>        <span class="hljs-comment"># å¤šå°è¯• perplexityï¼Œè¿™å¯èƒ½æ˜¯ t-SNE ä¸­æœ€é‡è¦çš„å‚æ•°ä¹‹ä¸€ï¼Œå®ƒåŸºæœ¬ä¸Šæ§åˆ¶äº†é«˜ç»´ï¼ˆåŸå§‹ï¼‰ç©ºé—´ä¸­ Gaussians çš„æ ‡å‡†å·®ï¼Œå³é«˜ç»´ç©ºé—´ä¸­é‚»å±…çš„å¤§å°ã€‚</span><br>        <span class="hljs-comment"># ç®€è€Œè¨€ä¹‹ï¼Œt-SNE çš„ç›®æ ‡æ˜¯æœ€å°åŒ–é«˜ç»´ç‚¹ä¸Šæ‹Ÿåˆçš„è”åˆé«˜æ–¯åˆ†å¸ƒä¸ä½ç»´ç‚¹ä¸Šæ‹Ÿåˆçš„ t-Student åˆ†å¸ƒä¹‹é—´çš„ KL æ•£åº¦</span><br>        <span class="hljs-comment"># ç›´è§‚åœ°è¯´ï¼Œé€šè¿‡è¿™æ ·åšï¼Œæˆ‘ä»¬ä¿ç•™äº†é«˜ç»´å’Œä½ç»´ç‚¹ä¹‹é—´çš„ç›¸ä¼¼æ€§ï¼ˆå…³ç³»ï¼‰ã€‚</span><br>        <span class="hljs-comment"># å¦‚æœæ‚¨å¯¹ t-SNEå°šä¸ç†Ÿæ‚‰ï¼Œè¿™å¯èƒ½ä¸ä¼šæœ‰å¤ªå¤šæ„ä¹‰ï¼Œæˆ‘å·²ç»å°è¯•è¿‡äº†ã€‚:P</span><br>        t_sne_embeddings = TSNE(n_components=<span class="hljs-number">2</span>, perplexity=<span class="hljs-number">30</span>, method=<span class="hljs-string">&#x27;barnes_hut&#x27;</span>).fit_transform(all_nodes_unnormalized_scores)<br><br>        fig = plt.figure(figsize=(<span class="hljs-number">12</span>,<span class="hljs-number">8</span>), dpi=<span class="hljs-number">80</span>)  <span class="hljs-comment"># å¦åˆ™åœ¨ Jupyter Notebook ä¸­ï¼Œç»˜å›¾ä¼šå¾ˆå°</span><br>        <span class="hljs-keyword">for</span> class_id <span class="hljs-keyword">in</span> <span class="hljs-built_in">range</span>(num_classes):<br>            <span class="hljs-comment"># æˆ‘ä»¬æå–çœŸå®æ ‡ç­¾ç­‰äº class_id çš„ç‚¹ï¼Œå¹¶ä»¥ç›¸åŒçš„æ–¹å¼å¯¹å®ƒä»¬è¿›è¡Œç€è‰²ï¼Œå¸Œæœ›å®ƒä»¬åœ¨ 2D å›¾ä¸Šèšé›†åœ¨ä¸€èµ· -</span><br>            <span class="hljs-comment"># è¿™æ„å‘³ç€ GAT å·²ç»å­¦åˆ°äº†å¾ˆå¥½çš„è¡¨ç¤ºï¼</span><br>            plt.scatter(t_sne_embeddings[node_labels == class_id, <span class="hljs-number">0</span>], t_sne_embeddings[node_labels == class_id, <span class="hljs-number">1</span>], s=<span class="hljs-number">20</span>, color=cora_label_to_color_map[class_id], edgecolors=<span class="hljs-string">&#x27;black&#x27;</span>, linewidths=<span class="hljs-number">0.2</span>)<br>        plt.show()<br><br>    <span class="hljs-comment"># æˆ‘ä»¬å¸Œæœ›æˆ‘ä»¬çš„å±€éƒ¨æ¦‚ç‡åˆ†å¸ƒï¼ˆå¯¹é‚»å±…çš„æ³¨æ„åŠ›æƒé‡ï¼‰æ˜¯éå‡åŒ€çš„ï¼Œå› ä¸ºè¿™æ„å‘³ç€ GAT å­¦åˆ°äº†æœ‰ç”¨çš„æ¨¡å¼ã€‚ç†µç›´æ–¹å›¾å¸®åŠ©æˆ‘ä»¬å¯è§†åŒ–</span><br>    <span class="hljs-comment"># è¿™äº›é‚»å±…åˆ†å¸ƒä¸å‡åŒ€åˆ†å¸ƒï¼ˆå¸¸æ•°å…³æ³¨ï¼‰æœ‰å¤šä¹ˆä¸åŒã€‚å¦‚æœ GAT å­¦åˆ°äº†å¸¸é‡æ³¨æ„åŠ›ï¼Œæˆ‘ä»¬å¯èƒ½å¾ˆå¥½åœ°ä½¿ç”¨ GCN æˆ–ä¸€äº›æ›´ç®€å•çš„æ¨¡å‹ã€‚</span><br>    <span class="hljs-keyword">elif</span> visualization_type == VisualizationType.ENTROPY:<br>        num_heads_per_layer = [layer.num_of_heads <span class="hljs-keyword">for</span> layer <span class="hljs-keyword">in</span> gat.gat_net]<br>        num_layers = <span class="hljs-built_in">len</span>(num_heads_per_layer)<br><br>        num_of_nodes = <span class="hljs-built_in">len</span>(node_features)<br>        target_node_ids = edge_index[<span class="hljs-number">1</span>].cpu().numpy()<br><br>        <span class="hljs-comment"># å¯¹äºæ¯ä¸ª GAT å±‚å’Œæ¯ä¸ª GAT æ³¨æ„åŠ›å¤´ï¼Œç»˜åˆ¶ç†µç›´æ–¹å›¾</span><br>        <span class="hljs-keyword">for</span> layer_id <span class="hljs-keyword">in</span> <span class="hljs-built_in">range</span>(num_layers):<br>            <span class="hljs-comment"># è·å–è¾¹ç¼˜çš„æ³¨æ„åŠ›æƒé‡ï¼ˆåœ¨ä¸Šé¢çš„ GAT æ­£å‘ä¼ é€’æœŸé—´è®°å½•äº†æ³¨æ„åŠ›ï¼‰</span><br>            <span class="hljs-comment"># æ³¨æ„åŠ›å½¢çŠ¶ = (N, NH, 1) -&gt; (N, NH) - æˆ‘ä»¬åªæŒ¤å‹äº†æœ€åä¸€ä¸ªç»´åº¦ï¼Œå®ƒæ˜¯å¤šä½™çš„</span><br>            all_attention_weights = gat.gat_net[layer_id].attention_weights.squeeze(dim=-<span class="hljs-number">1</span>).cpu().numpy()<br><br>            <span class="hljs-keyword">for</span> head_id <span class="hljs-keyword">in</span> <span class="hljs-built_in">range</span>(num_heads_per_layer[layer_id]):<br>                uniform_dist_entropy_list = []  <span class="hljs-comment"># å°†ç†æƒ³çš„å‡åŒ€ç›´æ–¹å›¾ä¿å­˜ä¸ºå‚è€ƒ</span><br>                neighborhood_entropy_list = []<br><br>                <span class="hljs-comment"># è¿™ä¹Ÿå¯ä»¥é€šè¿‡ scatter_add_ï¼ˆæ²¡æœ‰ for å¾ªç¯ï¼‰æ›´æœ‰æ•ˆåœ°å®Œæˆ</span><br>                <span class="hljs-comment"># ä¼ªï¼šout.scatter_add_(node_dim, -all_attention_weights * log(all_attention_weights), target_index)</span><br>                <span class="hljs-keyword">for</span> target_node_id <span class="hljs-keyword">in</span> <span class="hljs-built_in">range</span>(num_of_nodes):  <span class="hljs-comment"># æ‰¾åˆ°å›¾ä¸­æ¯ä¸ªèŠ‚ç‚¹çš„é‚»å±…</span><br>                    <span class="hljs-comment"># è¿™äº›æ³¨æ„åŠ›æƒé‡æ€»å’Œä¸º 1ï¼Œå› ä¸º GAT çš„è®¾è®¡ï¼Œæ‰€ä»¥æˆ‘ä»¬å¯ä»¥å°†å…¶è§†ä¸ºæ¦‚ç‡åˆ†å¸ƒ</span><br>                    neigborhood_attention = all_attention_weights[target_node_ids == target_node_id].flatten()<br>                    <span class="hljs-comment"># åŒæ ·é•¿åº¦çš„å‚è€ƒå‡åŒ€åˆ†å¸ƒ</span><br>                    ideal_uniform_attention = np.ones(<span class="hljs-built_in">len</span>(neigborhood_attention))/<span class="hljs-built_in">len</span>(neigborhood_attention)<br><br>                    <span class="hljs-comment"># è®¡ç®—ç†µï¼Œå¦‚æœæ‚¨å¯¹è¯¥æ¦‚å¿µä¸ç†Ÿæ‚‰ï¼Œè¯·æŸ¥çœ‹æ­¤è§†é¢‘ï¼š</span><br>                    <span class="hljs-comment"># https://www.youtube.com/watch?v=ErfnhcEV1O8ï¼ˆAurÃ©lien GÃ©ronï¼‰</span><br>                    neighborhood_entropy_list.append(entropy(neigborhood_attention, base=<span class="hljs-number">2</span>))<br>                    uniform_dist_entropy_list.append(entropy(ideal_uniform_attention, base=<span class="hljs-number">2</span>))<br><br>                title = <span class="hljs-string">f&#x27;Cora ç†µç›´æ–¹å›¾ å±‚=<span class="hljs-subst">&#123;layer_id&#125;</span>ï¼Œæ³¨æ„åŠ›å¤´=<span class="hljs-subst">&#123;head_id&#125;</span>&#x27;</span><br>                draw_entropy_histogram(uniform_dist_entropy_list, title, color=<span class="hljs-string">&#x27;orange&#x27;</span>, uniform_distribution=<span class="hljs-literal">True</span>)<br>                draw_entropy_histogram(neighborhood_entropy_list, title, color=<span class="hljs-string">&#x27;dodgerblue&#x27;</span>)<br><br>                fig = plt.gcf()  <span class="hljs-comment"># è·å–å½“å‰å›¾å½¢</span><br>                plt.show()<br>                fig.savefig(os.path.join(DATA_DIR_PATH, <span class="hljs-string">f&#x27;layer_<span class="hljs-subst">&#123;layer_id&#125;</span>_head_<span class="hljs-subst">&#123;head_id&#125;</span>.jpg&#x27;</span>))<br>                plt.close()<br>    <span class="hljs-keyword">else</span>:<br>        <span class="hljs-keyword">raise</span> Exception(<span class="hljs-string">f&#x27;ä¸æ”¯æŒçš„å¯è§†åŒ–ç±»å‹ <span class="hljs-subst">&#123;visualization_type&#125;</span>ã€‚&#x27;</span>)<br><br></code></pre></td></tr></table></figure>

<p>å¥½çš„ï¼æœ€åè®©æˆ‘ä»¬ç”¨ç”¨å§ï¼é¦–å…ˆæ˜¯-t-SNEã€‚</p>
<h1 id="ä½¿ç”¨-t-SNE-å¯è§†åŒ–-GAT-çš„åµŒå…¥-ğŸ“ˆ"><a href="#ä½¿ç”¨-t-SNE-å¯è§†åŒ–-GAT-çš„åµŒå…¥-ğŸ“ˆ" class="headerlink" title="ä½¿ç”¨ t-SNE å¯è§†åŒ– GAT çš„åµŒå…¥ ğŸ“ˆ"></a>ä½¿ç”¨ t-SNE å¯è§†åŒ– GAT çš„åµŒå…¥ ğŸ“ˆ</h1><p>t-SNE å±äºä¸€å¤§ç±»é™ç»´æ–¹æ³•ã€‚</p>
<p>å®ƒåœ¨ç¤¾åŒºä¸­è·å¾—äº†å·¨å¤§çš„å…³æ³¨ï¼Œå› ä¸ºå®ƒä½¿ç”¨ç®€å•å¹¶ä¸”æ•ˆæœè‰¯å¥½ï¼ˆå¯èƒ½æ˜¯å› ä¸ºå®ƒæ˜¯ç”± Geoffrey Hinton khmå…±åŒåˆ›ä½œçš„ï¼‰</p>
<p>è¿˜æœ‰å…¶ä»–è¾ƒæ–°çš„æ–¹æ³•æ¯”å¦‚UMAPï¼Œä½†å°šæœªè·å¾—è¶³å¤Ÿçš„å…³æ³¨ï¼ˆæ®æˆ‘æ‰€çŸ¥ï¼‰ã€‚</p>
<p>ä½†ç†è®ºå·²ç»è¶³å¤Ÿäº†ï¼Œè®©æˆ‘ä»¬çœ‹ä¸€äº›å›¾è¡¨ï¼</p>
<figure class="highlight python"><table><tr><td class="code"><pre><code class="hljs python">model_name=<span class="hljs-string">r&#x27;gat_000000.pth&#x27;</span>  <span class="hljs-comment"># This model is checked-in, feel free to use the one you trained</span><br>dataset_name=DatasetType.CORA.name<br><br><br>visualize_gat_properties(<br>        model_name,<br>        dataset_name,<br>        visualization_type=VisualizationType.EMBEDDINGS  <span class="hljs-comment"># pick between attention, t-SNE embeddings and entropy</span><br>)<br></code></pre></td></tr></table></figure>

<pre><code class="hljs">/var/folders/f0/812mfv7x63vbytjs3yf4gxtc0000gn/T/ipykernel_16269/2448994618.py:6: DeprecationWarning: Please use `csr_matrix` from the `scipy.sparse` namespace, the `scipy.sparse.csr` namespace is deprecated.
  data = pickle.load(file)



***** æ¨¡å‹è®­ç»ƒå…ƒæ•°æ®: *****
commit_hash: 91fb864b8f9ddefd401bf5399cea779bd3c0a63b
dataset_name: CORA
num_of_epochs: 10000
test_acc: 0.822
num_of_layers: 2
num_heads_per_layer: [8, 1]
num_features_per_layer: [1433, 8, 7]
add_skip_connection: False
bias: True
dropout: 0.6
layer_type: IMP3
*********************



/Users/gawaintan/miniforge3/envs/torch/lib/python3.9/site-packages/IPython/core/pylabtools.py:152: UserWarning: Glyph 8722 (\N&#123;MINUS SIGN&#125;) missing from current font.
  fig.canvas.print_figure(bytes_io, **kw)
</code></pre>
<p><img src="https://ptpimg.me/yt72e1.png" alt="è¯·æ·»åŠ å›¾ç‰‡æè¿°"></p>
<p>æ¼‚äº®ï¼</p>
<p>æˆ‘ä»¬å¯ä»¥çœ‹åˆ°ä»¥ä¸‹å†…å®¹ - ä¸€æ—¦æˆ‘ä»¬é€šè¿‡ GAT è¿›è¡Œå‰å‘ä¼ é€’ï¼Œå®ƒå°±ä¼šå°†ç»´åº¦ï¼ˆèŠ‚ç‚¹æ•°ã€æ¯ä¸ªç‰¹å¾å‘é‡çš„ç‰¹å¾æ•°ï¼‰&#x3D; çš„è¾“å…¥ç‰¹å¾å‘é‡è½¬æ¢ä¸º å› ä¸º Cora æœ‰ 7 ä¸ª(2708, 1433)ç±»(2708, 7)ã€‚</p>
<p>è¿™äº›ç±»æ˜¯ï¼šGenetic Algorithmsã€Reinforcement Learningç­‰ï¼Œä½¿å…¶ä¸é‚£ä¹ˆæŠ½è±¡ï¼Œä½†æœ€ç»ˆå®ƒé€‚ç”¨äºä»»ä½• 7 ä¸ªç±»çš„é›†åˆå¹¶ä¸é‡è¦ã€‚</p>
<p>ç°åœ¨ï¼Œä¸€æ—¦æˆ‘ä»¬è·å¾—äº† 7 ç»´å‘é‡ï¼Œæˆ‘ä»¬å°±ä½¿ç”¨ t-SNE å°†å®ƒä»¬æ˜ å°„åˆ° 2D å‘é‡ï¼ˆå› ä¸ºä½ çŸ¥é“å¾ˆéš¾ç»˜åˆ¶ 7D å‘é‡ï¼‰ã€‚t-SNE çš„æŠ€å·§åœ¨äºï¼Œå®ƒä¿ç•™äº†å‘é‡ä¹‹é—´çš„å…³ç³»ï¼Œå› æ­¤ï¼Œç²—ç•¥åœ°è¯´ï¼Œå¦‚æœå®ƒä»¬åœ¨ 7D ç©ºé—´ä¸­æ¥è¿‘ï¼ˆä½†æ˜¯æˆ‘ä»¬å®šä¹‰â€œæ¥è¿‘åº¦â€ï¼‰ï¼Œé‚£ä¹ˆå®ƒä»¬åœ¨ 2D ç©ºé—´ä¸­ä¹Ÿä¼šæ¥è¿‘ã€‚</p>
<p>ç°åœ¨æ‚¨å¯ä»¥çœ‹åˆ°åŒä¸€ç±»çš„ç‚¹ï¼ˆå®ƒä»¬å…·æœ‰ç›¸åŒçš„é¢œè‰²ï¼‰èšé›†åœ¨ä¸€èµ·ï¼è¿™æ˜¯ä¸€ä¸ªç†æƒ³çš„ç‰¹æ€§ï¼Œå› ä¸ºç°åœ¨è®­ç»ƒä¸€ä¸ªèƒ½å¤Ÿæ­£ç¡®é¢„æµ‹ç±»åˆ«çš„åˆ†ç±»å™¨è¦å®¹æ˜“å¾—å¤šã€‚</p>
<hr>
<p>å¤ªæ£’äº†ï¼Œç°åœ¨è®©æˆ‘ä»¬å°†æ³¨æ„åŠ›è½¬ç§»åˆ°æ³¨æ„åŠ›ä¸Šï¼Œå› ä¸ºæˆ‘ä»¬æ¯•ç«Ÿæ­£åœ¨å¤„ç†å›¾æ³¨æ„åŠ›ç½‘ç»œã€‚</p>
<h1 id="å¯è§†åŒ–é‚»å±…çš„æ³¨æ„åŠ›ğŸ“£"><a href="#å¯è§†åŒ–é‚»å±…çš„æ³¨æ„åŠ›ğŸ“£" class="headerlink" title="å¯è§†åŒ–é‚»å±…çš„æ³¨æ„åŠ›ğŸ“£"></a>å¯è§†åŒ–é‚»å±…çš„æ³¨æ„åŠ›ğŸ“£</h1><p>æ‰€ä»¥ï¼Œä½ ç°åœ¨å¸Œæœ›äº†è§£ GAT çš„å¤§è‡´å·¥ä½œåŸç†ï¼Œå¹¶ä¸”çŸ¥é“åœ¨èšåˆé˜¶æ®µï¼Œæ¯ä¸ªèŠ‚ç‚¹éƒ½ä¼šä¸ºå…¶æ¯ä¸ªé‚»å±…åˆ†é…ä¸€ä¸ªæ³¨æ„åŠ›ç³»æ•°ï¼ˆåŒ…æ‹¬å®ƒè‡ªå·±ï¼Œå› ä¸ºæˆ‘ä»¬æ·»åŠ äº†è‡ªè¾¹ï¼‰ã€‚</p>
<p>å…³äºæˆ‘ä»¬å¯ä»¥æƒ³è±¡ä»€ä¹ˆæœ‰ä»€ä¹ˆæƒ³æ³•å—ï¼Ÿå¥½å§ï¼Œè®©æˆ‘ä»¬é€‰æ‹©ä¸€äº›èŠ‚ç‚¹ï¼Œçœ‹çœ‹ä»–ä»¬å­¦åˆ°äº†å“ªäº›æ³¨æ„åŠ›æ¨¡å¼ï¼</p>
<p>æ‚¨å¯èƒ½æƒ³åˆ°çš„ç¬¬ä¸€ä¸ªæƒ³æ³•æ˜¯ï¼Œå¦‚æœæ³¨æ„åŠ›è¾ƒå¤§ï¼Œåˆ™å°†è¾¹ç”»å¾—æ›´åšï¼Œåä¹‹äº¦ç„¶ï¼ˆè¿™ä¹Ÿæ˜¯æˆ‘æƒ³åˆ°çš„æœ€åä¸€ä¸ªæƒ³æ³•ï¼‰ã€‚</p>
<p>æˆ‘ä»¬å¼€å§‹å§ï¼</p>
<figure class="highlight python"><table><tr><td class="code"><pre><code class="hljs python"><span class="hljs-comment"># è·å–åˆ›å»ºå¯è§†åŒ–æ‰€éœ€çš„æ•°æ®</span><br>all_nodes_unnormalized_scores, edge_index, node_labels, gat = gat_forward_pass(model_name, dataset_name)<br><br><span class="hljs-comment"># æˆ‘ä»¬è¦å¯è§†åŒ–å…¶é‚»è¿‘èŠ‚ç‚¹çš„å…³æ³¨åº¦çš„èŠ‚ç‚¹æ•°é‡</span><br>num_nodes_of_interest = <span class="hljs-number">4</span>  <span class="hljs-comment"># 4 æ˜¯ä¸€ä¸ªæ‚¨å¯ä»¥å°è¯•ä¸åŒå€¼çš„ä»»æ„æ•°å­—</span><br>head_to_visualize = <span class="hljs-number">0</span>  <span class="hljs-comment"># ç»˜åˆ¶æ¥è‡ªè¯¥å¤šå¤´æ³¨æ„åŠ›å¤´çš„æ³¨æ„åŠ›ï¼ˆä»…æœ€åä¸€å±‚æœ‰ä¸€ä¸ªå¤šå¤´ï¼‰</span><br>gat_layer_id = <span class="hljs-number">1</span>  <span class="hljs-comment"># ç»˜åˆ¶æ¥è‡ªè¯¥ GAT å±‚çš„æ³¨æ„åŠ›ï¼ˆç”±äºæˆ‘ä»¬çš„ GAT åªæœ‰ 2 å±‚ï¼Œè¿™æ˜¯æœ€åä¸€å±‚ï¼‰</span><br><br><span class="hljs-comment"># æ„å»ºå®Œæ•´å›¾</span><br><span class="hljs-comment"># node_features å½¢çŠ¶ =ï¼ˆNï¼ŒFINï¼‰ï¼Œå…¶ä¸­ N æ˜¯èŠ‚ç‚¹æ•°ï¼ŒFIN æ˜¯è¾“å…¥ç‰¹å¾æ•°</span><br>total_num_of_nodes = <span class="hljs-built_in">len</span>(node_features)<br>complete_graph = ig.Graph()<br>complete_graph.add_vertices(total_num_of_nodes)  <span class="hljs-comment"># igraph ä½¿ç”¨è¿™ç§æ ¼å¼åˆ›å»ºå¸¦æœ‰ [0ï¼Œtotal_num_of_nodes - 1] ID çš„èŠ‚ç‚¹</span><br>edge_index_tuples = <span class="hljs-built_in">list</span>(<span class="hljs-built_in">zip</span>(edge_index[<span class="hljs-number">0</span>, :], edge_index[<span class="hljs-number">1</span>, :]))  <span class="hljs-comment"># igraph éœ€è¦è¿™ç§æ ¼å¼</span><br>complete_graph.add_edges(edge_index_tuples)<br><br><span class="hljs-comment"># é€‰æ‹©è¦ç»˜åˆ¶çš„ç›®æ ‡èŠ‚ç‚¹ï¼ˆå…·æœ‰æœ€é«˜åº¦æ•°çš„èŠ‚ç‚¹ + éšæœºèŠ‚ç‚¹ï¼‰</span><br><span class="hljs-comment"># æ³¨æ„ï¼šéšæœºèŠ‚ç‚¹å’Œå…·æœ‰æœ€é«˜åº¦æ•°çš„èŠ‚ç‚¹ä¹‹é—´å¯èƒ½å­˜åœ¨é‡å  - ä½†è¿™æ˜¯éå¸¸ä¸å¯èƒ½çš„</span><br>highest_degree_node_ids = np.argpartition(complete_graph.degree(), -num_nodes_of_interest)[-num_nodes_of_interest:]<br>random_node_ids = np.random.randint(low=<span class="hljs-number">0</span>, high=total_num_of_nodes, size=num_nodes_of_interest)<br><br><span class="hljs-built_in">print</span>(<span class="hljs-string">f&#x27;Highest degree nodes = <span class="hljs-subst">&#123;highest_degree_node_ids&#125;</span>&#x27;</span>)<br><br>target_node_ids = edge_index[<span class="hljs-number">1</span>]<br>source_nodes = edge_index[<span class="hljs-number">0</span>]<br><br><span class="hljs-comment">#</span><br><span class="hljs-comment"># é€‰æ‹©è¦ä¸ºå…¶å¯è§†åŒ–å…³æ³¨åº¦çš„èŠ‚ç‚¹ IDï¼</span><br><span class="hljs-comment">#</span><br><br><span class="hljs-comment"># ç”±äºåœ¨ Jupyter ä¸­æ— æ³•ä½¿ç”¨ for å¾ªç¯ï¼Œåªéœ€è®¾ç½®ä¸€äº›æ•°å­—</span><br>target_node_id = <span class="hljs-number">306</span>  <span class="hljs-comment"># 306 æ˜¯ç¬¬äºŒåº¦æ•°æœ€é«˜çš„èŠ‚ç‚¹</span><br><br><span class="hljs-comment"># æ­¥éª¤ 1ï¼šæŸ¥æ‰¾ç›®æ ‡èŠ‚ç‚¹çš„é‚»è¿‘èŠ‚ç‚¹</span><br><span class="hljs-comment"># æ³¨æ„ï¼šå¯¹äº CORAï¼ŒåŒ…æ‹¬è‡ªç¯ï¼Œå› æ­¤ç›®æ ‡èŠ‚ç‚¹æ˜¯å…¶è‡ªèº«çš„é‚»å±…ï¼ˆAlexandroï¼Œyo soy tu madreï¼‰</span><br>src_nodes_indices = torch.eq(target_node_ids, target_node_id)<br>source_node_ids = source_nodes[src_nodes_indices].cpu().numpy()<br>size_of_neighborhood = <span class="hljs-built_in">len</span>(source_node_ids)<br><br><span class="hljs-comment"># æ­¥éª¤ 2ï¼šè·å–å®ƒä»¬çš„æ ‡ç­¾</span><br>labels = node_labels[source_node_ids].cpu().numpy()<br><br><span class="hljs-comment"># æ­¥éª¤ 3ï¼šè·å–è¾¹ç¼˜çš„æ³¨æ„åŠ›æƒé‡ï¼ˆåœ¨ä¸Šé¢çš„ GAT æ­£å‘ä¼ é€’æœŸé—´è®°å½•äº†æ³¨æ„åŠ›ï¼‰</span><br><span class="hljs-comment"># attention å½¢çŠ¶ =ï¼ˆNï¼ŒNHï¼Œ1ï¼‰-&gt;ï¼ˆNï¼ŒNHï¼‰ - æˆ‘ä»¬åªæŒ¤å‹äº†æœ€åä¸€ä¸ªç»´åº¦ï¼Œå®ƒæ˜¯å¤šä½™çš„</span><br>all_attention_weights = gat.gat_net[gat_layer_id].attention_weights.squeeze(dim=-<span class="hljs-number">1</span>)<br>attention_weights = all_attention_weights[src_nodes_indices, head_to_visualize].cpu().numpy()<br><span class="hljs-comment"># æ­¤éƒ¨åˆ†æ˜¾ç¤ºäº†å¯¹äº CORAï¼ŒGAT å­¦åˆ°çš„æ³¨æ„åŠ›æƒé‡å‡ ä¹æ˜¯å¸¸é‡ï¼ å°±åƒåœ¨ GCN ä¸­ä¸€æ ·ï¼</span><br><span class="hljs-built_in">print</span>(<span class="hljs-string">f&#x27;Max attention weight = <span class="hljs-subst">&#123;np.<span class="hljs-built_in">max</span>(attention_weights)&#125;</span> and min = <span class="hljs-subst">&#123;np.<span class="hljs-built_in">min</span>(attention_weights)&#125;</span>&#x27;</span>)<br>attention_weights /= np.<span class="hljs-built_in">max</span>(attention_weights)  <span class="hljs-comment"># é‡æ–°ç¼©æ”¾æœ€å¤§æƒé‡ä¸º 1ï¼Œä»¥ä¾¿æ›´å¥½åœ°ç»˜åˆ¶</span><br><br><span class="hljs-comment"># æ„å»ºæˆ‘ä»¬æƒ³è¦å¯è§†åŒ–æ³¨æ„åŠ›çš„é‚»å±…å›¾</span><br><span class="hljs-comment"># igraph çº¦æŸ - å®ƒä¸è¿ç»­èŒƒå›´çš„ ID ä¸€èµ·ä½¿ç”¨ï¼Œå› æ­¤æˆ‘ä»¬å°†ä¾‹å¦‚èŠ‚ç‚¹ 497 æ˜ å°„åˆ° 0ï¼Œ12 åˆ° 1ï¼Œç­‰ç­‰ã€‚</span><br>id_to_igraph_id = <span class="hljs-built_in">dict</span>(<span class="hljs-built_in">zip</span>(source_node_ids, <span class="hljs-built_in">range</span>(<span class="hljs-built_in">len</span>(source_node_ids))))<br>ig_graph = ig.Graph()<br>ig_graph.add_vertices(size_of_neighborhood)<br>ig_graph.add_edges([(id_to_igraph_id[neighbor], id_to_igraph_id[target_node_id]) <span class="hljs-keyword">for</span> neighbor <span class="hljs-keyword">in</span> source_node_ids])<br><br><span class="hljs-comment"># å‡†å¤‡å¯è§†åŒ–è®¾ç½®å­—å…¸å¹¶ç»˜å›¾</span><br>visual_style = &#123;<br>    <span class="hljs-string">&quot;edge_width&quot;</span>: attention_weights,  <span class="hljs-comment"># ä½¿è¾¹ç¼˜å°½å¯èƒ½ç²—</span><br>    <span class="hljs-string">&quot;layout&quot;</span>: ig_graph.layout_reingold_tilford_circular()  <span class="hljs-comment"># æ ‘çŠ¶å›¾çš„å¸ƒå±€</span><br>&#125;<br><span class="hljs-comment"># è¿™æ˜¯å”¯ä¸€é’ˆå¯¹ Cora çš„éƒ¨åˆ†ï¼Œå› ä¸º Cora æœ‰ 7 ä¸ªæ ‡ç­¾</span><br><span class="hljs-keyword">if</span> dataset_name.lower() == DatasetType.CORA.name.lower():<br>    visual_style[<span class="hljs-string">&quot;vertex_color&quot;</span>] = [cora_label_to_color_map[label] <span class="hljs-keyword">for</span> label <span class="hljs-keyword">in</span> labels]<br><span class="hljs-keyword">else</span>:<br>    <span class="hljs-built_in">print</span>(<span class="hljs-string">&#x27;ä¸ºæ‚¨ç‰¹å®šçš„æ•°æ®é›†æ·»åŠ è‡ªå®šä¹‰é¢œè‰²æ–¹æ¡ˆã€‚ ä½¿ç”¨ igraph é»˜è®¤ç€è‰²ã€‚&#x27;</span>)<br><br>ig.plot(ig_graph, **visual_style)<br><br></code></pre></td></tr></table></figure>

<pre><code class="hljs">***** æ¨¡å‹è®­ç»ƒå…ƒæ•°æ®: *****
commit_hash: 91fb864b8f9ddefd401bf5399cea779bd3c0a63b
dataset_name: CORA
num_of_epochs: 10000
test_acc: 0.822
num_of_layers: 2
num_heads_per_layer: [8, 1]
num_features_per_layer: [1433, 8, 7]
add_skip_connection: False
bias: True
dropout: 0.6
layer_type: IMP3
*********************

Highest degree nodes = [1986 1701  306 1358]
Max attention weight = 0.012915871106088161 and min = 0.012394174002110958


/var/folders/f0/812mfv7x63vbytjs3yf4gxtc0000gn/T/ipykernel_16269/2448994618.py:6: DeprecationWarning: Please use `csr_matrix` from the `scipy.sparse` namespace, the `scipy.sparse.csr` namespace is deprecated.
  data = pickle.load(file)
</code></pre>
<p><img src="https://ptpimg.me/mv5zat.png" alt="è¯·æ·»åŠ å›¾ç‰‡æè¿°"><br><img src="https://ptpimg.me/855sl2.png" alt="è¯·æ·»åŠ å›¾ç‰‡æè¿°"><br><img src="https://ptpimg.me/kk5k1q.png" alt="è¯·æ·»åŠ å›¾ç‰‡æè¿°"><br><img src="https://ptpimg.me/02bw9r.png" alt="è¯·æ·»åŠ å›¾ç‰‡æè¿°"><br><img src="https://ptpimg.me/8c77s3.png" alt="è¯·æ·»åŠ å›¾ç‰‡æè¿°"><br><img src="https://ptpimg.me/6pt7d4.png" alt="è¯·æ·»åŠ å›¾ç‰‡æè¿°"><br><img src="https://ptpimg.me/6q14cf.png" alt="è¯·æ·»åŠ å›¾ç‰‡æè¿°"><br><img src="https://ptpimg.me/vdku0v.png" alt="è¯·æ·»åŠ å›¾ç‰‡æè¿°"></p>
<p>ç§ï¼Œæµ…è“è‰²ç›´æ–¹å›¾ï¼ˆç»è¿‡è®­ç»ƒçš„ GATï¼‰ä¸æ©™è‰²ç›´æ–¹å›¾ï¼ˆç»Ÿä¸€æ³¨æ„åŠ› GATï¼‰å®Œå…¨åŒ¹é…ã€‚</p>
<p>å¦‚æœä¹‹å‰ç»˜åˆ¶çš„è¾¹çš„åšåº¦å¯è§†åŒ–ä¸èƒ½è®©æ‚¨ä¿¡æœï¼Œæˆ‘ç›¸ä¿¡ç†µå¯ä»¥ï¼</p>
<p>è¿™ç§å¯è§†åŒ–çš„æƒ³æ³•æ¥è‡ªPetar VeliÄkoviÄ‡ å‘æˆ‘æ¨èçš„<a href="https://www.dgl.ai/blog/2019/02/17/gat.html">è¿™ç¯‡åšå®¢æ–‡ç« </a>ã€‚</p>
<hr>
<p>å”·ï¼ï¼ï¼å®Œæˆäº†ï¼å¦‚æœä½ ä¸€ç›´é™ªæˆ‘åˆ°è¿™é‡Œï¼Œæ­å–œä½ ï¼ï¼ˆæˆå°±å·²è§£é” - GATå¤§å¸ˆğŸ˜ï¼‰</p>
<p>å»ºè®®èŠ±ç‚¹æ—¶é—´åˆ†æä¸€ä¸‹è¿™ç¯‡åšå®¢ã€‚è¿™ä¸æ˜¯ä¸€ä¸ªç©å…·é¡¹ç›®ï¼Œä½œè€…èŠ±äº†å¤§çº¦ 3 å‘¨çš„æ—¶é—´æ‰å®Œæˆï¼Œæ‰€ä»¥ä¸è¦æŒ‡æœ›åœ¨ 30 åˆ†é’Ÿå†…ç†è§£æ‰€æœ‰å†…å®¹ï¼Œé™¤éæ‚¨çœŸçš„ç†Ÿæ‚‰è¿™é‡Œæåˆ°çš„å¤§å¤šæ•°æ¦‚å¿µã€‚</p>
]]></content>
  </entry>
  <entry>
    <title></title>
    <url>/2024/11/20/PT%E6%9C%8D%E5%8A%A1%E5%99%A8%E5%B7%A5%E5%85%B7%E6%80%BB%E7%BB%93/</url>
    <content><![CDATA[<p>æœ¬æ–‡ä¸»è¦åŒ…æ‹¬PTçš„å„ç±»è¾…ç§å‘ç§çš„shellå‘½ä»¤ï¼Œç”µå½±ç§çš„æˆªå›¾åˆ¶ç§ï¼ŒéŸ³ä¹ç§çš„æŠ“æµã€è½¬ç ã€å‘ç§é¢‘è°±å›¾ç­‰ç­‰ã€‚</p>
<h3 id="æœåŠ¡å™¨æ€§èƒ½æµ‹è¯•è„šæœ¬"><a href="#æœåŠ¡å™¨æ€§èƒ½æµ‹è¯•è„šæœ¬" class="headerlink" title="æœåŠ¡å™¨æ€§èƒ½æµ‹è¯•è„šæœ¬"></a>æœåŠ¡å™¨æ€§èƒ½æµ‹è¯•è„šæœ¬</h3><p><a href="https://zhuanlan.zhihu.com/p/117547388">å…¶ä»–è„šæœ¬å‚è€ƒ</a></p>
<figure class="highlight shell"><table><tr><td class="code"><pre><code class="hljs shell">wget -qO- --no-check-certificate https://raw.githubusercontent.com/oooldking/script/master/superbench.sh | bash<br></code></pre></td></tr></table></figure>

<p>ä¸¤ä¸ªå¤§å®¶å¸¸ç”¨çš„è„šæœ¬ï¼ŒåŸºæœ¬é›†æˆäº†å¤šæ•°éœ€è¦çš„å‘ç§å·¥å…·ï¼Œ(æœ‰æ¦‚ç‡è£…ä¸ä¸Šå…¶ä»–è½¯ä»¶æ¯”å¦‚wine)<br><a href="https://github.com/Aniverse/inexistence">æ˜Ÿå¤§Inexistence</a></p>
<figure class="highlight shell"><table><tr><td class="code"><pre><code class="hljs shell">bash &lt;(wget --no-check-certificate -qO- https://github.com/Aniverse/inexistence/raw/master/inexistence.sh)<br></code></pre></td></tr></table></figure>
<p><a href="https://github.com/jerry048/Dedicated-Seedbox">Jerry048</a></p>
<figure class="highlight vim"><table><tr><td class="code"><pre><code class="hljs vim">bash &lt;(wget -qO- https://raw.githubusercontent.<span class="hljs-keyword">com</span>/jerry048/Dedicated-Seedbox/main/Install.<span class="hljs-keyword">sh</span>) <span class="hljs-symbol">&lt;username&gt;</span> <span class="hljs-symbol">&lt;password&gt;</span> &lt;Cache Size(uni<span class="hljs-variable">t:GiB</span>)&gt;<br># æ ¼å¼ç±»ä¼¼ï¼Œæ³¨æ„ç©ºæ ¼ name password <span class="hljs-number">16</span> GB<br></code></pre></td></tr></table></figure>


<h1 id="è™šæ‹Ÿç¯å¢ƒæ­å»º"><a href="#è™šæ‹Ÿç¯å¢ƒæ­å»º" class="headerlink" title="è™šæ‹Ÿç¯å¢ƒæ­å»º"></a>è™šæ‹Ÿç¯å¢ƒæ­å»º</h1><h4 id="Dockerä¸€é”®å®‰è£…"><a href="#Dockerä¸€é”®å®‰è£…" class="headerlink" title="Dockerä¸€é”®å®‰è£…"></a>Dockerä¸€é”®å®‰è£…</h4><figure class="highlight shell"><table><tr><td class="code"><pre><code class="hljs shell">curl -fsSL https://get.docker.com -o get-docker.sh<br>sh get-docker.sh<br></code></pre></td></tr></table></figure>
<h4 id="condaå®‰è£…ä½¿ç”¨"><a href="#condaå®‰è£…ä½¿ç”¨" class="headerlink" title="condaå®‰è£…ä½¿ç”¨"></a>condaå®‰è£…ä½¿ç”¨</h4><p>ä¸»è¦ç”¨äºpythonçš„è¿è¡Œï¼Œæ¯”èµ·virtualenvï¼Œcondaæœ€å¤§ä¼˜ç‚¹æ˜¯å¯ä»¥è‡ªåŠ¨å®‰è£…æŒ‡å®šæ–°ç‰ˆæœ¬pythonï¼Œä¸ç”¨æœ¬åœ°ç¯å¢ƒ</p>
<figure class="highlight shell"><table><tr><td class="code"><pre><code class="hljs shell">wget -4 -c https://mirrors.tuna.tsinghua.edu.cn/anaconda/miniconda/Miniconda3-py39_4.9.2-Linux-x86_64.sh<br><span class="hljs-meta prompt_">#</span><span class="language-bash">ç¬¬äºŒæ­¥å®‰è£…</span><br>sh Miniconda3-py39_4.9.2-Linux-x86_64.sh<br><span class="hljs-meta prompt_">#</span><span class="language-bash">ç¬¬ä¸‰æ­¥é…ç½®condaé•œåƒ</span><br><br>export PATH=/root/miniconda3/bin:$PATH<br><span class="hljs-meta prompt_"># </span><span class="language-bash"><span class="hljs-built_in">alias</span> ohmyzsh=<span class="hljs-string">&quot;mate ~/.oh-my-zsh&quot;</span></span><br><br>vim ~/.zshrc<br><span class="hljs-meta prompt_">#</span><span class="language-bash"><span class="hljs-comment"># æ·»åŠ ä¸‹é¢çš„å†…å®¹</span></span><br><span class="hljs-meta prompt_"># </span><span class="language-bash">&gt;&gt;&gt; conda initialize &gt;&gt;&gt;</span><br><span class="hljs-meta prompt_"># </span><span class="language-bash">!! Contents within this block are managed by <span class="hljs-string">&#x27;conda init&#x27;</span> !!</span><br>__conda_setup=&quot;$(&#x27;/root/miniconda3/bin/conda&#x27; &#x27;shell.zsh&#x27; &#x27;hook&#x27; 2&gt; /dev/null)&quot;<br>if [ $? -eq 0 ]; then<br>    eval &quot;$__conda_setup&quot;<br>else<br>    if [ -f &quot;/root/miniconda3/etc/profile.d/conda.sh&quot; ]; then<br>        . &quot;/root/miniconda3/etc/profile.d/conda.sh&quot;<br>    else<br>        export PATH=&quot;/root/miniconda3/bin:$PATH&quot;<br>    fi<br>fi<br>unset __conda_setup<br><span class="hljs-meta prompt_"># </span><span class="language-bash">&lt;&lt;&lt; <span class="hljs-string">conda initialize &lt;&lt;&lt;</span></span><br><span class="hljs-meta prompt_"></span><br><span class="hljs-meta prompt_">#</span><span class="language-bash"><span class="hljs-string">æ·»åŠ å®Œåæ¿€æ´»</span></span><br>source ~/.zshrc<br><span class="hljs-meta prompt_"></span><br><span class="hljs-meta prompt_">#</span><span class="language-bash"><span class="hljs-string">ä½¿ç”¨</span></span><br>conda create -n py39 python=3.9<br>conda activate py39<br></code></pre></td></tr></table></figure>

<h1 id="ä¸‹è½½å™¨å·¥å…·"><a href="#ä¸‹è½½å™¨å·¥å…·" class="headerlink" title="ä¸‹è½½å™¨å·¥å…·"></a>ä¸‹è½½å™¨å·¥å…·</h1><h2 id="transmission"><a href="#transmission" class="headerlink" title="transmission"></a>transmission</h2><figure class="highlight shell"><table><tr><td class="code"><pre><code class="hljs shell">version: &quot;3.2&quot;<br><br>services:<br>  transmission:<br>    image: chisbread/transmission<br>    container_name: transmission<br>    environment:<br>      - PUID=0<br>      - PGID=0<br>      - TZ=Asia/Shanghai<br>      - USER= <br>      - PASS=<br>      - PEERPORT=10413<br>    volumes:<br>      - /tr/config:/config<br>      - /tr/downloads:/downloads<br>      - /tr/watch:/watch<br>      <br>    ports:<br>      - 9091:9091<br>      - 10413:10413<br>      - 10413:10413/udp<br>    restart: unless-stopped<br></code></pre></td></tr></table></figure>

<p>é…ç½®å¥½ymlæ–‡ä»¶åéœ€è¦ä¸‹è½½docker-composeå‘½ä»¤<br>åœ¨å¯¹åº”çš„ç›®å½•è¾“å…¥docker-compose up<br><a href="https://blog.csdn.net/shangyexin/article/details/122085552?spm=1001.2101.3001.6650.2&utm_medium=distribute.pc_relevant.none-task-blog-2~default~CTRLIST~Rate-2.pc_relevant_paycolumn_v3&depth_1-utm_source=distribute.pc_relevant.none-task-blog-2~default~CTRLIST~Rate-2.pc_relevant_paycolumn_v3&utm_relevant_index=5">å…·ä½“å‚è€ƒè¿™ç¯‡æ–‡ç« </a></p>
<h2 id="Usenetä¸‹è½½å™¨sabnzbd"><a href="#Usenetä¸‹è½½å™¨sabnzbd" class="headerlink" title="Usenetä¸‹è½½å™¨sabnzbd"></a>Usenetä¸‹è½½å™¨sabnzbd</h2><figure class="highlight shell"><table><tr><td class="code"><pre><code class="hljs shell">docker run -d \<br>  --name=sabnzbd \<br>  -p 8384:8080 \<br>  -e PUID=1000 \<br>  -e PGID=1000 \<br>  -v /home/ä½ çš„ç”¨æˆ·å/sabnzbd/config:/config \<br>  -v /home/ä½ çš„ç”¨æˆ·å/sabnzbd/downloads:/downloads \<br>  -v /home/ä½ çš„ç”¨æˆ·å/sabnzbd/incomplete:/incomplete-downloads \<br>  --restart unless-stopped \<br>  linuxserver/sabnzbd<br></code></pre></td></tr></table></figure>
<p>vim &#x2F;home&#x2F;ä½ çš„ç”¨æˆ·å&#x2F;sabnzbd&#x2F;config&#x2F;sabnzbd.ini<br>æŠŠâ€“inet_exposureä»0ä¿®æ”¹åˆ°5æ‰èƒ½æ­£å¸¸è®¿é—®</p>
<ul>
<li>è®°å¾—æ›¿æ¢è·¯å¾„ï¼</li>
</ul>
<h1 id="åŠ©æ‰‹å·¥å…·"><a href="#åŠ©æ‰‹å·¥å…·" class="headerlink" title="åŠ©æ‰‹å·¥å…·"></a>åŠ©æ‰‹å·¥å…·</h1><h2 id="PPTP"><a href="#PPTP" class="headerlink" title="PPTP"></a>PPTP</h2><p>Chrome<br>Edge</p>
<h2 id="Jackett"><a href="#Jackett" class="headerlink" title="Jackett"></a>Jackett</h2><figure class="highlight shell"><table><tr><td class="code"><pre><code class="hljs shell">docker create --name=jackett \<br>--restart=always \<br>-v /root/jackett/config:/config \<br>-v /root/jackett/downloads:/downloads \<br>-e PGID=0 -e PUID=0 \<br>-p 9117:9117 \<br>linuxserver/jackett<br><br>docker start<br></code></pre></td></tr></table></figure>
<h2 id="Prowlarr"><a href="#Prowlarr" class="headerlink" title="Prowlarr"></a>Prowlarr</h2><p>æ›´æ¨èè¿™ä¸ªå·¥å…·ï¼Œè¿˜èƒ½æ”¯æŒUsenetçš„indexerï¼Œæ¯”ä¸Šè€…ç»´æŠ¤æ›´å‹¤</p>
<figure class="highlight shell"><table><tr><td class="code"><pre><code class="hljs shell">docker run -d \<br>--name=prowlarr \<br>-e PUID=1000 \<br>-e PGID=1000 \<br>-e TZ=Asia/Shanghai \<br>-p 9696:9696 \<br>-v /prowlarr/config:/config \<br>-v /æœ¬åœ°ä¸‹è½½ç›®å½•:/downloads \<br>--restart unless-stopped \<br>linuxserver/prowlarr<br></code></pre></td></tr></table></figure>

<h2 id="IYUU-plus"><a href="#IYUU-plus" class="headerlink" title="IYUU plus"></a>IYUU plus</h2><figure class="highlight shell"><table><tr><td class="code"><pre><code class="hljs shell">mkdir /root/plus -p<br>docker run -d  --name IYUUPlus  -v /root/plus:/IYUU/db -v /etc/qbit/config/qBittorrent/BT_backup:/qb -v /etc/transmission/config/torrents:/tr -p 8787:8787  --restart=always iyuucn/iyuuplus:latest<br></code></pre></td></tr></table></figure>
<h2 id="seedcross"><a href="#seedcross" class="headerlink" title="seedcross"></a>seedcross</h2><p>è¾…ç§å¤–ç«™ç¥å™¨ï¼Œä¸è¿‡è¿˜æ²¡æˆç†Ÿæœ‰è¾…é”™çš„å¯èƒ½ï¼Œå®ƒçš„åŸç†æ˜¯ç”¨ä½ ä¸‹è½½å™¨çš„ç§å­é€šè¿‡jackettæœç´¢åŒ¹é…ã€‚<br><a href="https://github.com/ccf-2012/seedcross">githubé“¾æ¥</a></p>
<figure class="highlight shell"><table><tr><td class="code"><pre><code class="hljs shell">docker run -d --name seedcross -v /somedir/in/host:/code/seedcross/db -p 8019:8019 ccf2012/seedcross:latest<br></code></pre></td></tr></table></figure>
<p>æ‰“å¼€8787ç«¯å£<br>å¯†ç ä¸ºç©ºï¼Œç¬¬ä¸€æ¬¡è¾“å…¥æ—¶ä½ å¯ä»¥è‡ªç”±è®¾ç½®ä½ çš„å¯†ç ï¼›ä»¥åå¯†ç ä¸ç¬¬ä¸€æ¬¡ç›¸åŒæ‰èƒ½ç™»å½•</p>
<h1 id="FileBrower"><a href="#FileBrower" class="headerlink" title="FileBrower"></a>FileBrower</h1><p>è’é‡æ— ç¯FBEçš„å®‰è£…è„šï¼Œä½œä¸ºç½‘ç›˜å¯ç›´æ¥åšç§æˆªå›¾ï¼Œéå¸¸æ–¹ä¾¿</p>
<figure class="highlight shell"><table><tr><td class="code"><pre><code class="hljs shell">mkdir -p ~/docker/fb/config ~/docker/fb/myfiles<br>docker run -d --name fb \<br>  --restart=unless-stopped \<br>  -e PUID=$UID \<br>  -e PGID=$GID \<br>  -e WEB_PORT=8082 \<br>  -e FB_AUTH_SERVER_ADDR=&quot;127.0.0.1&quot; \<br>  -p 8082:8082 \<br>  -v ~/docker/fb/config:/config \<br>  -v /:/myfiles \<br>  --mount type=tmpfs,destination=/tmp \<br>  80x86/filebrowser:2.9.4-amd64<br></code></pre></td></tr></table></figure>


<h1 id="åšæˆªå›¾"><a href="#åšæˆªå›¾" class="headerlink" title="åšæˆªå›¾"></a>åšæˆªå›¾</h1><figure class="highlight shell"><table><tr><td class="code"><pre><code class="hljs shell">ffmpeg -i [è§†é¢‘è·¯å¾„] -r 1 -vframes 4 -q:v 2 -f image2 image-%d.jpeg<br></code></pre></td></tr></table></figure>
<h1 id="Rclone"><a href="#Rclone" class="headerlink" title="Rclone"></a>Rclone</h1><figure class="highlight shell"><table><tr><td class="code"><pre><code class="hljs shell"><span class="hljs-meta prompt_">#</span><span class="language-bash">å®‰è£…æœ€æ–°ç‰ˆæœ¬rclone</span> <br>apt-get install p7zip-full<br>curl https://rclone.org/install.sh | sudo bash<br></code></pre></td></tr></table></figure>
<p>ç›’å­æ–‡ä»¶åŒæ­¥åˆ°äº‘ç›˜ï¼Œä¸»è¦æ˜¯æˆ‘ç›’å­æ‹‰æœ¬åœ°éå¸¸æ…¢ï¼Œæ‰€ä»¥ç”¨äº‘ç›˜åšä¸­è½¬ã€‚<br>å¯ä»¥æ˜¯Onedriveã€Google drive<br>æˆ‘è¿™é‡Œè¯´é˜¿é‡Œäº‘ç›˜</p>
<figure class="highlight shell"><table><tr><td class="code"><pre><code class="hljs shell">docker run -d \<br>--name=aliyundrive-webdav \<br>--restart=always \<br>-p 8080:8080 \<br>-v $PWD/docker/aliyundrive-webdav/:/etc/aliyundrive-webdav/ \<br> -e REFRESH_TOKEN=&#x27;your refreshToken&#x27; \<br> -e WEBDAV_AUTH_USER=admin \<br> -e WEBDAV_AUTH_PASSWORD=admin \<br> messense/aliyundrive-webdav<br>â€‹<br></code></pre></td></tr></table></figure>
<p>å¯ä»¥ç‚¹å¼€ip:8080è®¿é—®ï¼Œå¯†ç è´¦å·å¦‚ä¸Šï¼Œéœ€è¦æ³¨æ„çš„æ˜¯ï¼Œæ¢æˆå…¶ä»–ç«¯å£å¯èƒ½ä¼šæœåŠ¡ä¸äº†ï¼Œå¦‚æœå†²çªçš„è¯å…ˆæŠŠå¦ä¸€ä¸ªå…³äº†ã€‚</p>
<h1 id="Clouddrive2çš„æœåŠ¡æ­å»º"><a href="#Clouddrive2çš„æœåŠ¡æ­å»º" class="headerlink" title="Clouddrive2çš„æœåŠ¡æ­å»º"></a>Clouddrive2çš„æœåŠ¡æ­å»º</h1><p>è¿™ä¸ªæ¯”rloneæ›´æ–¹ä¾¿ï¼Œä¸»è¦æ˜¯ç”¨æ¥æŒ‚è½½115çš„</p>
<figure class="highlight shell"><table><tr><td class="code"><pre><code class="hljs shell">wget https://github.com/cloud-fs/cloud-fs.github.io/releases/download/v0.8.1/clouddrive-2-linux-x86_64-0.8.1.tgz<br>md /opt/clouddrive<br>tar zxvf clouddrive-2-linux-x86_64-0.8.1.tgz -C /opt/clouddrive<br><br>vim /etc/systemd/system/clouddrive.service<br><span class="hljs-meta prompt_">#</span><span class="language-bash">å†™å…¥ä¸‹é¢çš„å†…å®¹ï¼Œdaemon reload</span><br><br></code></pre></td></tr></table></figure>
<figure class="highlight shell"><table><tr><td class="code"><pre><code class="hljs shell">Description=clouddrive2<br>After=network.target<br><br>[Service]<br>Type=exec<br>Restart=on-failure<br>ExecStart=/opt/clouddrive/clouddrive<br><br>[Install]<br>WantedBy=multi-user.target<br></code></pre></td></tr></table></figure>
<h4 id="Onedrive"><a href="#Onedrive" class="headerlink" title="Onedrive"></a>Onedrive</h4><figure class="highlight shell"><table><tr><td class="code"><pre><code class="hljs shell">è¦åœ¨mac/winä¸Šå…ˆç”¨rclone authorize &quot;onedrive&quot;è·³è½¬ç½‘é¡µæˆæƒï¼Œè¿”å›tokenï¼ˆæ³¨æ„è¦æŠŠæ•´ä¸ªjsonå…¨å¤åˆ¶ä¸‹æ¥ï¼‰<br></code></pre></td></tr></table></figure>
<p>åŒæ—¶æŒ‚è½½å¤šä¸ªrcloneçš„ç½‘ç›˜</p>
<figure class="highlight shell"><table><tr><td class="code"><pre><code class="hljs shell">curl https://rclone.org/install.sh | sudo bash<br><span class="hljs-meta prompt_">#</span><span class="language-bash">å®‰è£…å®Œæˆåï¼Œè¿è¡Œrcloneè¿æ¥webdavå®Œæˆé…ç½®</span><br>rclone config<br><span class="hljs-meta prompt_"></span><br><span class="hljs-meta prompt_">#</span><span class="language-bash">é…ç½®ç©rcloneå</span><br><span class="hljs-meta prompt_"></span><br><span class="hljs-meta prompt_">#</span><span class="language-bash">å‰è€…ä¸Š<span class="hljs-built_in">od</span>åœ°å€åè€…ä¸Šæœ¬åœ°åœ°å€ï¼Œå¤åˆ¶ä»¥ä¸‹å†…å®¹åˆ›å»ºservice</span><br>vim /etc/systemd/system/rclone@.service<br><span class="hljs-meta prompt_">#</span><span class="language-bash">ç²˜è´´ä»¥ä¸‹å†…å®¹</span><br>[Unit]<br>Description=Rclone mount %I drive<br>AssertPathIsDirectory=LocalFolder<br>After=network-online.target<br><br>[Service]<br>Type=simple<br>ExecStart=/usr/bin/rclone mount %i: /mnt/%i \<br>--config /root/.config/rclone/rclone.conf \<br>--copy-links \<br>--no-gzip-encoding \<br>--no-check-certificate \<br>--vfs-cache-mode full \<br>--umask 0000 \<br>--default-permissions \<br>--allow-non-empty \<br>--allow-other \<br>--attr-timeout 5m \<br>--vfs-cache-max-size 1G \<br>--buffer-size 500M \<br>--vfs-read-chunk-size 64M \<br>--vfs-read-chunk-size-limit 1G<br>ExecStop=/bin/fusermount -u LocalFolder<br>Restart=on-abort<br>User=root<br><br>[Install]<br>WantedBy=default.target<br></code></pre></td></tr></table></figure>
<p>&#x2F;mntæ”¹ä¸ºæƒ³æŒ‚è½½çš„ç›®æ ‡ç›®å½•æ ¹ç›®å½•ã€‚é…ç½®å¥½ååˆ›å»ºæŒ‚è½½ç›®æ ‡å­ç›®å½•åå¯ä»¥è‡ªåŠ¨æŒ‚è½½ï¼Œæ³¨æ„åå­—è¦å’Œrcloneçš„remotesä¸€è‡´ã€‚</p>
<figure class="highlight shell"><table><tr><td class="code"><pre><code class="hljs shell">mkdir /mnt/od1<br>systemctl enable rclone@od1<br>systemctl start rclone@od1<br></code></pre></td></tr></table></figure>
<p>æœ€ç®€å•çš„æ–¹æ³• rclone config file ç›´æ¥å¤åˆ¶confæ–‡ä»¶å¤¹å†…çš„é…ç½®ä¿¡æ¯ï¼Œç²˜è´´åˆ°å¯¹åº”çš„æœåŠ¡å™¨</p>
<p><a href="http://bbs.chinauos.com/zh/post/9207">é…ç½®æ•™ç¨‹å‚è€ƒ</a>ï¼Œéœ€è¦æ³¨æ„æœ€æ–°ç‰ˆå¯èƒ½ç¼–å·ä¸ä¸€æ ·ï¼Œè¦è‡ªå·±é€‰æ‹©webdav</p>
<h1 id="IRC"><a href="#IRC" class="headerlink" title="IRC"></a>IRC</h1><p>æŒ‚åœ¨åˆ°nasä¸Šçš„theloungeå®¢æˆ·ç«¯</p>
<figure class="highlight bash"><table><tr><td class="code"><pre><code class="hljs bash">wget -P /root https://github.com/thelounge/thelounge/releases/download/v4.2.0/thelounge_4.2.0_all.deb<br>dpkg -i /root/thelounge_4.2.0_all.deb<br><span class="hljs-comment">#systemctl stop thelounge.service</span><br><span class="hljs-comment">#sed -i &#x27;s/9000,/11111,/g&#x27; /etc/thelounge/config.js</span><br><span class="hljs-comment"># ä»¥ä¸Šå‘½ä»¤æ›¿æ¢ç«¯å£å·ï¼Œ9000ç«¯å£å·æŒºå¸¸è§å®¹æ˜“äº§ç”Ÿå†²çª</span><br><span class="hljs-comment"># æ¯”å¦‚ docker çš„ portainer é•œåƒé»˜è®¤æ˜ å°„ç«¯å£å·å°±ç”¨çš„æ˜¯ 9000</span><br><span class="hljs-comment"># è¯¥å‘½ä»¤å°† 9000 ç«¯å£å·æ›¿æ¢æˆ 11111ï¼Œè¿™ä¸ªå¯ä»¥è‡ªå®šä¹‰ï¼ˆ1-65535 ä»»é€‰ä¸€ä¸ªæ²¡é‡å¤çš„å½“ç«¯å£å·ï¼‰</span><br><br>systemctl start thelounge.service<br>systemctl <span class="hljs-built_in">enable</span> thelounge.service<br>thelounge add ç”¨æˆ·å#æ‰‹åŠ¨æ·»åŠ ç™»é™†çš„ç”¨æˆ·å<br><span class="hljs-comment">#é…ç½®çš„æ—¶å€™è®°å¾—åœ¨å‘½ä»¤é‡Œé¢åŠ ä¸Šä»¥ä¸‹ä¸‰å¥å‘½ä»¤</span><br>/msg NickServ RECOVER æ˜µç§°<br>/msg NickServ IDENTIFY æ˜µç§° å¯†ç #é¿å…è¢«æŒ¤æ‰<br>/msg Vertigo ENTER æ˜µç§° ircå¯†ç <br></code></pre></td></tr></table></figure>
<p>å¦‚æœæç¤ºnodeç‰ˆæœ¬é—®é¢˜å¯èƒ½éœ€è¦æ›´æ–°ï¼Œnvmæ˜¯ä¸ªç®¡ç†nodeçš„å·¥å…·</p>
<figure class="highlight shell"><table><tr><td class="code"><pre><code class="hljs shell">curl -o- https://raw.githubusercontent.com/nvm-sh/nvm/v0.35.3/install.sh | bash<br>export NVM_DIR=&quot;$HOME/.nvm&quot;<br>[ -s &quot;$NVM_DIR/nvm.sh&quot; ] &amp;&amp; \. &quot;$NVM_DIR/nvm.sh&quot;  # This loads nvm<br>[ -s &quot;$NVM_DIR/bash_completion&quot; ] &amp;&amp; \. &quot;$NVM_DIR/bash_completion&quot;  # This loads nvm bash_completion<br></code></pre></td></tr></table></figure>
<h1 id="éŸ³ä¹ç›¸å…³"><a href="#éŸ³ä¹ç›¸å…³" class="headerlink" title="éŸ³ä¹ç›¸å…³"></a>éŸ³ä¹ç›¸å…³</h1><h3 id="Flac-to-mp3"><a href="#Flac-to-mp3" class="headerlink" title="Flac to mp3"></a>Flac to mp3</h3><p><a href="http://robinbowes.github.io/flac2mp3/">Flac2Mp3</a>è¯¥å·¥å…·ä¼šå°†ä½ æ‰€æœ‰flacæ–‡ä»¶è½¬ä¸ºmp3ï¼Œä¸”æŒ‰ç›¸åŒçš„åå­—æ–‡ä»¶ç»“æ„ä¿å­˜ã€‚</p>
<p><a href="https://github.com/robinbowes/flac2mp3/tarball/master">ä¸‹è½½é“¾æ¥download.tar.gz</a></p>
<figure class="highlight shell"><table><tr><td class="code"><pre><code class="hljs shell">tar zxvf flac2mp3-0.3.0.tar.gz<br>apt install flac<br>apt install lame<br><span class="hljs-meta prompt_">#</span><span class="language-bash">æ‰¾åˆ°è§£å‹æ–‡ä»¶å†…çš„flac2mp3.plæ–‡ä»¶ï¼Œå–„ç”¨è½¯è¿æ¥,é»˜è®¤v2ï¼Œè‡ªå·±ä¿®æ”¹ä¸ºv0æˆ–320</span><br><br>ln -s æ–‡ä»¶æ‰€åœ¨è·¯å¾„  f2m<br>./f2m --preset=V0 /path/to/lossless /path/to/lossy<br></code></pre></td></tr></table></figure>

<h3 id="Flac-24bit-16bit"><a href="#Flac-24bit-16bit" class="headerlink" title="Flac 24bit-&gt;16bit"></a>Flac 24bit-&gt;16bit</h3><figure class="highlight shell"><table><tr><td class="code"><pre><code class="hljs shell">sox input.flac -G -b 16 output.flac rate -v -L 48000 dither<br><br>for flac in *.flac; do sox -S &quot;$&#123;flac&#125;&quot; -r 44100 -b 16 new/&quot;$&#123;flac&#125;&quot;; done<br></code></pre></td></tr></table></figure>
<h3 id="ä¸€é”®ä¸Šä¼ å›¾åºŠè„šæœ¬"><a href="#ä¸€é”®ä¸Šä¼ å›¾åºŠè„šæœ¬" class="headerlink" title="ä¸€é”®ä¸Šä¼ å›¾åºŠè„šæœ¬"></a>ä¸€é”®ä¸Šä¼ å›¾åºŠè„šæœ¬</h3><p><a href="https://github.com/theirix/ptpimg-uploader">https://github.com/theirix/ptpimg-uploader</a></p>
<figure class="highlight shell"><table><tr><td class="code"><pre><code class="hljs shell">pip install ptpimg_uploader<br><br>export PTPIMG_API_KEY=&lt;your hex key&gt;<br><br>ptpimg_uploader ~/seed/mytorrent/folder.jpg<br></code></pre></td></tr></table></figure>

<h3 id="é¢‘è°±å›¾"><a href="#é¢‘è°±å›¾" class="headerlink" title="é¢‘è°±å›¾"></a>é¢‘è°±å›¾</h3><ol>
<li>sox ä¸“è¾‘è·¯å¾„åå­—&#x2F;*.flac -n spectrogram -o ä¸“è¾‘.png</li>
<li>è¦æ˜¯äºŒçº§ç›®å½•<figure class="highlight shell"><table><tr><td class="code"><pre><code class="hljs shell"><span class="hljs-meta prompt_">#</span><span class="language-bash">!/zsh/bin</span><br>dir=/home/download/<br>filename=$1<br>cd &quot;$filename&quot;<br>ls -d */ | grep -o &#x27;[a-Z]*\ *[0-9]/&#x27; &gt;temp.log<br>sed -i &#x27;s/$/*flac/&#x27; temp.log<br>mapfile acmd &lt;temp.log<br>echo $&#123;acmd[@]&#125;<br>fdir=&#x27;&#x27;<br>if test -z &quot;$acmd&quot;<br>then<br>  echo &quot;No subfolder~&quot;<br>  sox *flac -n spectrogram -o $dir/spectrograms/&quot;$filename&quot;.png<br>else<br>  l=$&#123;#acmd[@]&#125;<br>  case &quot;$l&quot; in<br>          2)<br>             echo &quot;There 2 discs&quot;<br>             a1=`cat temp.log | sed -n &#x27;1p&#x27;`<br>             a2=`cat temp.log | sed -n &#x27;2p&#x27;`<br>             sox &quot;$a1&quot; &quot;$a2&quot; -n spectrogram -o $dir/spectrograms/&quot;$filename&quot;.png<br>            <br>             ;;<br>          *)<br>             echo &quot;There more than 3 discs, only take first 3&quot;<br>             a1=`cat temp.log | sed -n &#x27;1p&#x27;`<br>             a2=`cat temp.log | sed -n &#x27;2p&#x27;`<br>             a3=`cat temp.log | sed -n &#x27;3p&#x27;`<br>             sox &quot;$a1&quot; &quot;$a2&quot; &quot;$a3&quot; -n spectrogram -o $dir/spectrograms/&quot;$filename&quot;.png<br>             ;;<br>  esac<br></code></pre></td></tr></table></figure></li>
<li>å•ç¢Ÿç‰ˆä¸€é”®åˆ¶è°±å¹¶ä¸Šä¼ å›¾åºŠè¿”å›é“¾æ¥</li>
</ol>
<figure class="highlight shell"><table><tr><td class="code"><pre><code class="hljs shell">vim sp-up.sh<br><span class="hljs-meta prompt_">#</span><span class="language-bash">å¤åˆ¶ä»¥ä¸‹å†…å®¹</span><br>n=$1<br>cd &quot;$n&quot;<br><br>sox *flac -n spectrogram -o ../spectrograms/&quot;$n&quot;.png<br>sp=$(ptpimg_uploader -k your-ptpimg-key --bbcode <br>spec=[hide=spectrogram]$sp[/hide]<br>echo &quot;PTPIMGurl: $spec&quot;<br><span class="hljs-meta prompt_"></span><br><span class="hljs-meta prompt_">#</span><span class="language-bash">å…·ä½“ä½¿ç”¨</span><br>sh sp-up.sh ä¸“è¾‘ç›®å½•<br><br></code></pre></td></tr></table></figure>
<figure class="highlight shell"><table><tr><td class="code"><pre><code class="hljs shell">git clone https://github.com/EwolBash/spsox.git<br>cd spsox<br>chmod +x spsox<br>cp spsox /usr/local/bin/<br>spsox<br>spsox -r /home/ewol/Music/music/&#x27;Chuck Prophet - Bobby Fuller Died For Your Sins (2017) [FLAC]&#x27;/<br>spsox -r /home/ewol/Music/music<br></code></pre></td></tr></table></figure>
<h3 id="webæŠ“æµ"><a href="#webæŠ“æµ" class="headerlink" title="webæŠ“æµ"></a>webæŠ“æµ</h3><p><a href="https://github.com/nathom/streamrip">https://github.com/nathom/streamrip</a></p>
<figure class="highlight shell"><table><tr><td class="code"><pre><code class="hljs shell"><span class="hljs-meta prompt_">#</span><span class="language-bash">éœ€è¦python&gt;3.8</span><br>pip3 install streamrip --upgrade<br><br>rip config --open<br><span class="hljs-meta prompt_">#</span><span class="language-bash">å¡«ä¸Šarlä¹‹ç±»çš„ä¿¡æ¯</span><br><br>rip ä¸“è¾‘url<br></code></pre></td></tr></table></figure>
<h3 id="å‹ç¼©flacä¸“è¾‘åˆ°lv8"><a href="#å‹ç¼©flacä¸“è¾‘åˆ°lv8" class="headerlink" title="å‹ç¼©flacä¸“è¾‘åˆ°lv8"></a>å‹ç¼©flacä¸“è¾‘åˆ°lv8</h3><p><a href="https://xiph.org/flac/documentation_tools_flac.html">flacå‘½ä»¤è¡Œæ–‡æ¡£</a></p>
<figure class="highlight shell"><table><tr><td class="code"><pre><code class="hljs shell">flac -8 ä¸“è¾‘åå­—/* -f<br></code></pre></td></tr></table></figure>

<h1 id="æŠ“æµåˆ¶ç§é¢‘è°±å›¾é›†åˆ"><a href="#æŠ“æµåˆ¶ç§é¢‘è°±å›¾é›†åˆ" class="headerlink" title="æŠ“æµåˆ¶ç§é¢‘è°±å›¾é›†åˆ"></a>æŠ“æµåˆ¶ç§é¢‘è°±å›¾é›†åˆ</h1><figure class="highlight shell"><table><tr><td class="code"><pre><code class="hljs shell"><span class="hljs-meta prompt_">#</span><span class="language-bash">!/bin/zsh</span><br>l=($*)<br><span class="hljs-meta prompt_">#</span><span class="language-bash">num=<span class="hljs-variable">$1</span></span><br>for num in $&#123;l[*]&#125;;do<br>        echo https://www.xxx.com/album/$num<br>        ripb=`rip url line https://www.deezer.com/album/$num`<br>        echo &quot;$ripb&quot;<br>        fullname=/home/download<br><br>        if [[ $ripb =~ &quot;Unable to stream&quot; ]] || [[ $ripb =~ &quot;already downloaded&quot; ]]<br>        then<br>                echo $num &quot;$ripb&quot;&gt;&gt;$fullname/fail.log#æŠ“æµå¤±è´¥æˆ–è€…é‡å¤è·³è¿‡å¾ªç¯<br>                continue<br>        fi<br>        dirname=$(ls -At $fullname | sed -n &quot;1p&quot;)<br>        mktorrent -v -p -l 22 -o $fullname/torrents/&quot;$dirname&quot;.torrent $fullname/&quot;$dirname&quot;<br>        cd $fullname/&quot;$dirname&quot;<br><br>        ls -d */ | grep -o &#x27;[a-Z]*\ *[0-9]/&#x27; &gt;temp.log<br>        sed -i &#x27;s/$/*flac/&#x27; temp.log<br>        mapfile acmd &lt;temp.log<br><br>        fdir=&#x27;&#x27;<br>        if test -z &quot;$acmd&quot;<br>        then<br>        echo &quot;No subfolder~&quot;<br>         sox *flac -n spectrogram -o $fullname/spectrograms/&quot;$dirname&quot;.png<br>        else<br>         l=$&#123;#acmd[@]&#125;<br>         case &quot;$l&quot; in<br>          2)<br>             echo &quot;There 2 discs&quot;<br>             a1=`cat temp.log | sed -n &#x27;1p&#x27;`<br>             a2=`cat temp.log | sed -n &#x27;2p&#x27;`<br>             sox &quot;$a1&quot; &quot;$a2&quot; -n spectrogram -o $fullname/spectrograms/&quot;$dirname&quot;.png<br>             ;;<br>          3)<br>             echo &quot;There 3 discs&quot;<br>             a1=`cat temp.log | sed -n &#x27;1p&#x27;`<br>             a2=`cat temp.log | sed -n &#x27;2p&#x27;`<br>             a3=`cat temp.log | sed -n &#x27;3p&#x27;`<br>             sox &quot;$a1&quot; &quot;$a2&quot; &quot;$a3&quot; -n spectrogram -o $fullname/spectrograms/&quot;$dirname&quot;.png<br>             ;;<br>          4)<br>             echo &quot;There 4 discs&quot;<br>             a1=`cat temp.log | sed -n &#x27;1p&#x27;`<br>             a2=`cat temp.log | sed -n &#x27;2p&#x27;`<br>             a3=`cat temp.log | sed -n &#x27;3p&#x27;`<br>             a4=`cat temp.log | sed -n &#x27;4p&#x27;`<br>             sox &quot;$a1&quot; &quot;$a2&quot; &quot;$a3&quot; &quot;$a4&quot; -n spectrogram -o $fullname/spectrograms/&quot;$dirname&quot;.png<br>             ;;<br>          *)<br>             echo &quot;There more than 5 discs, only take first 6&quot;<br>             a1=`cat temp.log | sed -n &#x27;1p&#x27;`<br>             a2=`cat temp.log | sed -n &#x27;2p&#x27;`<br>             a3=`cat temp.log | sed -n &#x27;3p&#x27;`<br>             a4=`cat temp.log | sed -n &#x27;4p&#x27;`<br>             a5=`cat temp.log | sed -n &#x27;5p&#x27;`<br>             a6=`cat temp.log | sed -n &#x27;6p&#x27;`<br>             sox &quot;$a1&quot; &quot;$a2&quot; &quot;$a3&quot; &quot;$a4&quot; &quot;$a5&quot; &quot;$a6&quot; -n spectrogram -o $fullname/spectrograms/&quot;$dirname&quot;.png<br>             ;;<br>         esac<br>        fi<br>        #sox $fullname/&quot;$dirname&quot;/*flac -n spectrogram -o $fullname/spectrograms/&quot;$dirname&quot;.png<br>        sp=$(ptpimg_uploader --bbcode $fullname/spectrograms/&quot;$dirname&quot;.png)<br>        spec=[hide=spectrogram]$sp[/hide]<br>        echo &quot;$spec $dirname $num&quot; &gt;&gt;&quot;$fullname&quot;/torrents/PtpimgUrl.txt<br>        echo &quot;PTPIMGurl: $spec&quot;<br>        sleep $[($RANDOM % 10)+3]<br></code></pre></td></tr></table></figure>

<h2 id="æˆªå›¾å·¥å…·convert"><a href="#æˆªå›¾å·¥å…·convert" class="headerlink" title="æˆªå›¾å·¥å…·convert"></a>æˆªå›¾å·¥å…·convert</h2><p>è¦apt install imagemagick</p>
<h2 id="AutoBrr"><a href="#AutoBrr" class="headerlink" title="AutoBrr"></a>AutoBrr</h2><p><a href="https://autobrr.com/configuration/irc">https://autobrr.com/configuration/irc</a><br>åˆ·å¤–ç«™ç¥å™¨ï¼Œä¸»è¦æ˜¯æ”¯æŒæ²¡æœ‰rssç”¨ircæ¨é€çš„ç«™ï¼Œä¸Šé¢çš„å®˜æ–¹æ–‡æ¡£å·²ç»ç›¸å½“è¯¦ç»†ï¼Œæˆ‘è¿™ä¸ªæ˜¯ä»‹ç»ä¸‹dockerå®‰è£…</p>
<figure class="highlight shell"><table><tr><td class="code"><pre><code class="hljs shell">vim docker-compose.yml<br><span class="hljs-meta prompt_">#</span><span class="language-bash">å†™å…¥ä»¥ä¸‹å†…å®¹ï¼Œæ›¿æ¢æ˜ å°„åœ°å€</span><br>version: &quot;3.7&quot;<br><br>services:<br>  autobrr:<br>    container_name: autobrr<br>    image: ghcr.io/autobrr/autobrr:latest<br>    restart: unless-stopped<br>    #logging:<br>    #  driver: json-file<br>    #  options:<br>    #    max-file: $&#123;DOCKERLOGGING_MAXFILE&#125;<br>    #    max-size: $&#123;DOCKERLOGGING_MAXSIZE&#125;<br>    user: 1000:1000<br>    environment:<br>      - TZ=$&#123;TZ&#125;<br>    volumes:<br>      - $&#123;BASE_DOCKER_DATA_PATH&#125;/autobrr/config:/config<br>    ports:<br>      - 7474:7474<br></code></pre></td></tr></table></figure>
<figure class="highlight shell"><table><tr><td class="code"><pre><code class="hljs shell">docker compose up -d<br></code></pre></td></tr></table></figure>
<p>æ³¨æ„ç›’å­ä¸Šä½¿ç”¨è¦æ‰¾åˆ°config.tomlæ–‡ä»¶ï¼ŒæŠŠ127.0.0.1æ”¹æˆ0.0.0.0</p>
<p>é€šçŸ¥å¯ç”¨tgçš„botï¼Œæ€ä¹ˆæè¯¦ç»†æ•™ç¨‹å‚è€ƒ<a href="https://blog.csdn.net/whatday/article/details/113748634?ops_request_misc=%257B%2522request%255Fid%2522%253A%2522167496205316800192275150%2522%252C%2522scm%2522%253A%252220140713.130102334..%2522%257D&request_id=167496205316800192275150&biz_id=0&utm_medium=distribute.pc_search_result.none-task-blog-2~all~sobaiduend~default-1-113748634-null-null.142%5Ev71%5Einsert_chatgpt,201%5Ev4%5Eadd_ask&utm_term=telegram%20bot&spm=1018.2226.3001.4187">è¿™ä¸ªæ•™ç¨‹</a>ï¼Œç®€å•ä¸€ç‚¹å°±æ˜¯å…ˆå»æœç´¢botFatheråˆ›å»ºä¸€ä¸ªbotï¼Œæå·å‘½åæè¿°è·å–tokenï¼Œå†å»getuseridbotæŸ¥è‡ªå·±id(æœ‰æ¦‚ç‡æœä¸åˆ°)ã€‚ç‚¹å‡»é“¾æ¥æµ‹è¯•è¿”å›å€¼<a href="https://api.telegram.org/bot%3Ctoken%3E/getUpdates">https://api.telegram.org/bot&lt;æ¢è‡ªå·±token&gt;&#x2F;getUpdates</a><br>å¡«çš„æ—¶å€™æ³¨æ„tokenç›´æ¥å¤åˆ¶æ•´ä¸ªâ€˜æ•°å­—:å­—ç¬¦ä¸²â€™ï¼Œchat_idæ˜¯è‡ªå·±çš„idã€‚</p>
<ul>
<li>æ³¨æ„ï¼š<br>æ·»åŠ å®¢æˆ·ç«¯çš„æ—¶å€™delugeä¸€ä¸ªå‘ï¼Œä»–çš„åå­—å¯†ç è¦å»&#x2F;docker&#x2F;appdata&#x2F;deluge&#x2F;authæ‰¾ï¼Œusername:password:levelçš„å½¢å¼ï¼Œåœ°å€å¿…é¡»æ˜¯çº¯æ•°å­—ipï¼Œä¸æ˜¯å®˜æ–¹æ¨èçš„127.0.0.1æˆ–è€…localhostã€‚qbåœ°å€æ˜¯<a href="http://ip:ç«¯å£">http://ip:ç«¯å£</a></li>
</ul>
<h2 id="flexget"><a href="#flexget" class="headerlink" title="flexget"></a>flexget</h2><p>è‡ªåŠ¨rssæ–°ç§ï¼Œå¯è‡ªå®šä¹‰è§„åˆ™ï¼Œæ˜Ÿå¤§è„šæœ¬ç›´æ¥è£…æˆ–è€…ç›´æ¥ï¼špip install flexget</p>
<p>é…ç½®æ–‡ä»¶config.yml</p>
<figure class="highlight shell"><table><tr><td class="code"><pre><code class="hljs shell">templates:<br><span class="hljs-meta prompt_"># </span><span class="language-bash">å‰©ä½™ç©ºé—´æ¨¡æ¿ï¼Œå½“ path å¯¹åº”çš„è·¯å¾„çš„å‰©ä½™ç©ºé—´å°äº space è§„å®šçš„æ•°å€¼çš„æ—¶å€™åœæ­¢ RSS ä¸‹è½½</span><br>  freespace:<br>    free_space:<br>      path: /home/gawain/deluge/download/<br>      space: 20240<br><span class="hljs-meta prompt_"># </span><span class="language-bash">qb çš„æ¨¡æ¿ï¼Œä¹‹åå†™ qb å°±æ˜¯æŒ‡æŠŠç§å­æ¨é€åˆ° qb è¿›è¡Œä¸‹è½½ï¼›ä¸‹é¢ <span class="hljs-built_in">tr</span> de rt ä¹Ÿæ˜¯å¦‚æ­¤</span><br>  qb:<br>    qbittorrent:<br>      path: /home/gawain/deluge/download/<br>      host: localhost<br>      port: 2017<br>      username: **** <br>      password: ****<br>  de:<br>    deluge:<br>      path: /home/gawain/deluge/TSBluray/rar<br>      host: localhost<br>      port: 58846<br>      username: ...<br>      password: ...<br>  size:<br>    content_size:<br>      min: 13000<br>      max: 46666<br>      strict: yes<br><br>tasks:<br>  Ts-Bluray:<br>    rss: https://www.torrentseeds.org/rss/****<br>    if:<br>      - &quot;&#x27;BLURAY&#x27; in title&quot;: accept<br>      #- &quot;&#x27;subs&#x27; in title&quot;: reject<br>    temperate: <br>      - de<br>      - freespace<br>      - size<br>    deluge:<br>      label: TSBluray<br><br>web_server:<br>  port: 6566<br>  web_ui: yes<br><br>schedules: no<br></code></pre></td></tr></table></figure>
<p>ç„¶åæµ‹è¯•ï¼š</p>
<figure class="highlight shell"><table><tr><td class="code"><pre><code class="hljs shell"><span class="hljs-meta prompt_">#</span><span class="language-bash">ä¸ä¸‹è½½åªæµ‹è¯•è·å–æƒ…å†µ</span><br>flexget --test <br><span class="hljs-meta prompt_">#</span><span class="language-bash">æ ‡è®°è€çš„ç§å­</span><br>flexget --learn<br><span class="hljs-meta prompt_">#</span><span class="language-bash">ç¡®å®šflexgetå®‰è£…ç›®å½•</span><br>which flexget<br><span class="hljs-meta prompt_">#</span><span class="language-bash">æ·»åŠ cron</span><br>crontab -e<br><span class="hljs-meta prompt_">#</span><span class="language-bash">æ·»åŠ è¯­å¥ï¼Œåé¢æ›¿æ¢ä¸Šé¢è·å–çš„è·¯å¾„</span><br>*/3 * * * * /usr/local/bin/flexget execute<br></code></pre></td></tr></table></figure>
<h1 id="å·®é€Ÿå™¨"><a href="#å·®é€Ÿå™¨" class="headerlink" title="å·®é€Ÿå™¨"></a>å·®é€Ÿå™¨</h1><p><a href="https://leishi.io/blog/posts/2021-12/Differential/">å¤§ä½¬åšå®¢</a><br>åªè¦æä¾›ç»™å·®é€Ÿå™¨ä¸€ä¸ªéœ€è¦å‘å¸ƒçš„æ–‡ä»¶å¤¹å’Œè±†ç“£ä¿¡æ¯é¡µé¢ï¼Œå·®é€Ÿå™¨ä¼šè‡ªåŠ¨å¸®ä½ </p>
<ol>
<li>æ ¹æ®è±†ç“£é“¾æ¥è·å–PTGenä¿¡æ¯</li>
<li>æ ¹æ®èµ„æºè½½ä½“è·å–MediaInfo&#x2F;BDInfoä¿¡æ¯</li>
<li>æˆªå–è‡ªå®šæ•°é‡çš„æ— æŸæˆªå›¾ï¼Œä¸Šä¼ åˆ°æŒ‡å®šçš„å›¾åºŠ</li>
<li>åˆ¶ä½œç§å­</li>
<li>å¦‚æœæ˜¯æœ¬åœ°ç¯å¢ƒï¼Œè‡ªåŠ¨æ‰“å¼€æµè§ˆå™¨ï¼Œç„¶åè‡ªåŠ¨å¡«å……æ‰€æœ‰çš„ä¿¡æ¯<figure class="highlight shell"><table><tr><td class="code"><pre><code class="hljs shell"><span class="hljs-meta prompt_">#</span><span class="language-bash">Linuxä¸€é”®å®‰è£…ï¼Œå…¶ä»–å¹³å°å’Œdockerå‚è€ƒä»¥ä¸Šæ–‡ç« </span><br>curl -Lso- https://raw.githubusercontent.com/LeiShi1313/Differential/main/install.sh | bash<br><br>vim config.ini<br><span class="hljs-meta prompt_">#</span><span class="language-bash">å†™å…¥ä»¥ä¸‹å†…å®¹</span><br>[DEFAULT]<br>; æ˜¯å¦åˆ¶ç§<br>make_torrent = true<br><br>; ç”Ÿæˆæˆªå›¾çš„æ•°é‡<br>screenshot_count = 6<br>; å›¾åºŠï¼Œå·®é€Ÿå™¨æ”¯æŒPTPIMGã€è‡ªå»ºimgurlã€è‡ªå»ºCheveretoï¼ˆz4aã€imgbbã€çŒ«æŸ çš„å›¾åºŠç­‰ï¼‰ã€SM.MSå’ŒBYRä½œä¸ºå›¾åºŠ<br>image_hosting = CHEVERETO<br>; è‡ªå»ºCheveretoçš„åœ°å€<br>chevereto_hosting_url = https://XXX.com<br>; è‡ªå»ºCheveretoçš„ç”¨æˆ·å<br>chevereto_username = XXXX<br>; è‡ªå»ºCheveretoçš„å¯†ç <br>chevereto_password = YYYY<br><br>; è‡ªåŠ¨å¡«å……ä½¿ç”¨çš„è„šæœ¬ï¼Œè¿™é‡Œä½¿ç”¨æ ‘å¤§çš„è„šæœ¬<br>easy_upload = true<br>; ä¹Ÿå¯ä»¥ä½¿ç”¨æ˜æ—¥å¤§çš„è„šæœ¬æ¥è¿›è¡Œè‡ªåŠ¨å¡«å……<br>; auto_feed = true<br><br>; ä½¿ç”¨å·®é€Ÿå™¨è‡ªå¸¦çš„çŸ­ç½‘å€æœåŠ¡<br>use_short_url = true<br><br>; å·®é€Ÿå™¨è‡ªå¸¦ä¸€ä¸ªè‡ªå»ºçš„PTGenï¼Œå¦‚æœæ— æ³•è®¿é—®ï¼Œå¯ä»¥æä¾›è‡ªå®šä¹‰PTGenåœ°å€<br>;ptgen_url = https://XXXXX.com<br><br>[NexusPHP]<br>; å‘ç§é¡µé¢çš„é“¾æ¥<br>upload_url = https://XXXXX.com/upload.php<br><span class="hljs-meta prompt_"></span><br><span class="hljs-meta prompt_">#</span><span class="language-bash">å‘å¸ƒæ ¼å¼</span><br>dft ne -f [ç§å­æ–‡ä»¶å¤¹] -u [è±†ç“£é“¾æ¥]<br></code></pre></td></tr></table></figure>
éœ€è¦æ³¨æ„çš„æ˜¯éœ€è¦è‡ªå·±é…ç½®configï¼Œå’Œè§†é¢‘æ–‡ä»¶åŒä¸€æ–‡ä»¶å¤¹ï¼Œå¯èƒ½éœ€è¦ç§‘å­¦ä½¿ç”¨é»˜è®¤ptgenã€‚</li>
</ol>
<h1 id="è§£å‹rar"><a href="#è§£å‹rar" class="headerlink" title="è§£å‹rar"></a>è§£å‹rar</h1><p>ä¸»è¦ä¸ºäº†è§£å‹0dayèµ„æºï¼Œåªèƒ½æ‰‹åŠ¨å®‰è£…</p>
<figure class="highlight shell"><table><tr><td class="code"><pre><code class="hljs shell">wget http://www.rarlab.com/rar/rarlinux-x64-5.0.0.tar.gz --no-check-certificate<br>tar xvf rarlinux-x64-5.0.0.tar.gz<br>cd rar<br>make install<br>ln -n unrar /usr/bin/unrar<br><span class="hljs-meta prompt_">#</span><span class="language-bash">ä½¿ç”¨æ–¹æ³•</span><br>unrar e  ***.rar(or folder) target-path<br></code></pre></td></tr></table></figure>
<h1 id="Remux"><a href="#Remux" class="headerlink" title="Remux"></a>Remux</h1><p>Remuxå¿…é¡»æœ‰eac3toçš„è§£ç æ—¥å¿—ï¼Œè€Œeac3toåˆåªæ”¯æŒwindowsï¼Œæ‰€ä»¥éœ€è¦wine32</p>
<h2 id="Wine"><a href="#Wine" class="headerlink" title="Wine"></a>Wine</h2><p> å¯ä»¥æ˜Ÿå¤§è„šæœ¬ç›´æ¥æ‰‹åŠ¨åŠ å‚æ•°è£…<br> Debian10å®‰è£…Wine32æœ‰å¾ˆå¤šå‘ï¼Œwineæ˜¯ä¸ºäº†eac3to</p>
<figure class="highlight shell"><table><tr><td class="code"><pre><code class="hljs shell">apt-get install libgnutls30:i386 libldap-2.4-2:i386 libgpg-error0:i386 libxml2:i386 libasound2-plugins:i386 libsdl2-2.0-0:i386 libfreetype6:i386 libdbus-1-3:i386 libsqlite3-0:i386<br></code></pre></td></tr></table></figure>
<h2 id="eac3to"><a href="#eac3to" class="headerlink" title="eac3to"></a>eac3to</h2><p><a href="https://unixsheikh.com/tutorials/remuxing-iso-dvd-or-bluray-using-cat-and-ffmpeg-on-linux.html">https://unixsheikh.com/tutorials/remuxing-iso-dvd-or-bluray-using-cat-and-ffmpeg-on-linux.html</a></p>
<figure class="highlight shell"><table><tr><td class="code"><pre><code class="hljs shell"><span class="hljs-meta prompt_">#</span><span class="language-bash">eac3toæ—¥å¿—ï¼š</span><br>wget -O eac3to.zip https://www.videohelp.com/download/eac3to336.zip\?r\=LRXdxQfL<br>unzip eac3to.zip<br>wine eac3to/eac3to.exe `winepath -w /home/gawain/deluge/download/Songs.From.The.Second.Floor.2000.COMPLETE.BLURAY-iFPD/BDMV` &#x27;1)&#x27; 1:chapter.txt 2:h264.mkv 3:DTSMAENG.dtsma -progressnumbers -log=eac3to.txt<br><span class="hljs-meta prompt_">#</span><span class="language-bash">æ³¨æ„ï¼Œè¿™é‡Œæœ‰ä¸ªéå¸¸è¯¡å¼‚çš„é—®é¢˜ï¼Œæ’æŸ¥äº†å¾ˆä¹…ï¼Œ1ï¼‰ä¼šé€‰è€…ä¸ä¸Šï¼Œä¸»è¦æ˜¯å› ä¸ºè·¯å¾„çš„é—®é¢˜ï¼Œè¦ç”¨winepath</span><br><span class="hljs-meta prompt_">#</span><span class="language-bash">1ï¼‰ffmpeg</span><br>ffmpeg -i 00009.m2ts -map 0:0 -vcodec copy -map 0:1 -acodec copy -map 0:7 -scodec copy W.E.2011.1080p.BluRay.Remux.mkv<br><span class="hljs-meta prompt_">#</span><span class="language-bash">2ï¼‰mkvermerge</span><br>mkvmerge -o W.E.2011.1080p.BluRay.Remux.mkv 00009.m2ts <br></code></pre></td></tr></table></figure>
<p> i is the name of the input file.<br>-map is used to map each track to a specific command option.<br>0:0 is the first track, i.e. the video, which is then mapped to the -vcodec option, i.e. video codec option, which simply copies the video track into the new mkv container.<br>0:1 is the first audio track, i.e. the English audio, which is then mapped to the -acodec option, i.e. audio codec option, which simply copies the English audio track into the new mkv container.<br>0:9 is the first subtitle track, i.e. the English subtitle, which is then mapped to the -scodec option, i.e. subtitle codec option, which simply copies the English subtitle into the new mkv container.</p>
<figure class="highlight shell"><table><tr><td class="code"><pre><code class="hljs shell">apt install mkvtoolnix<br>mkvmerge <br></code></pre></td></tr></table></figure>

<h1 id="å°å·¥å…·é›†åˆ"><a href="#å°å·¥å…·é›†åˆ" class="headerlink" title="å°å·¥å…·é›†åˆ"></a>å°å·¥å…·é›†åˆ</h1><h3 id="moshè¿æ¥"><a href="#moshè¿æ¥" class="headerlink" title="moshè¿æ¥"></a>moshè¿æ¥</h3><figure class="highlight shell"><table><tr><td class="code"><pre><code class="hljs shell">brew install mosh#mac å®¢æˆ·ç«¯<br><br>sudo apt-get install mosh<br>mosh-server new -c 256 -s -l LANG=en_US.UTF-8 -p 60000<br><br>mosh pi@pi42.local -p 6000<br></code></pre></td></tr></table></figure>


<h3 id="è¿œç¨‹åŒæ­¥æ–‡ä»¶"><a href="#è¿œç¨‹åŒæ­¥æ–‡ä»¶" class="headerlink" title="è¿œç¨‹åŒæ­¥æ–‡ä»¶"></a>è¿œç¨‹åŒæ­¥æ–‡ä»¶</h3><figure class="highlight shell"><table><tr><td class="code"><pre><code class="hljs shell">rsync -avz --progress /root/client/   root@202.112.23.12:/home/work/      <br><span class="hljs-meta prompt_">#</span><span class="language-bash">å°†æœ¬æœºçš„/root/client/æ‹·è´è‡³è¿œç¨‹çš„202.112.23.12:/home/work/ç›®å½•ï¼Œ--progresså¯ä»¥æŸ¥çœ‹æ‹·è´çš„è¿‡ç¨‹</span><br></code></pre></td></tr></table></figure>

<h4 id="dockeræŸ¥çœ‹æ˜ å°„ç›®å½•"><a href="#dockeræŸ¥çœ‹æ˜ å°„ç›®å½•" class="headerlink" title="dockeræŸ¥çœ‹æ˜ å°„ç›®å½•"></a>dockeræŸ¥çœ‹æ˜ å°„ç›®å½•</h4><figure class="highlight shell"><table><tr><td class="code"><pre><code class="hljs shell">docker inspect å®¹å™¨åç§° | grep Mounts -A 20<br><br></code></pre></td></tr></table></figure>

<h2 id="æ‰¹é‡è·å–å‰ç«¯ç§å­ä¸‹è½½é“¾æ¥"><a href="#æ‰¹é‡è·å–å‰ç«¯ç§å­ä¸‹è½½é“¾æ¥" class="headerlink" title="æ‰¹é‡è·å–å‰ç«¯ç§å­ä¸‹è½½é“¾æ¥"></a>æ‰¹é‡è·å–å‰ç«¯ç§å­ä¸‹è½½é“¾æ¥</h2><p>ä¸»è¦æ˜¯é’ˆå¯¹ptppä¸æ”¯æŒçš„ç«™ç‚¹</p>
<figure class="highlight javascript"><table><tr><td class="code"><pre><code class="hljs javascript"><span class="hljs-variable language_">console</span>.<span class="hljs-title function_">clear</span>()<br><br><span class="hljs-keyword">var</span> trs = <span class="hljs-variable language_">document</span>.<span class="hljs-title function_">querySelectorAll</span>(<span class="hljs-string">&quot;form[action]&quot;</span>)<br><span class="hljs-keyword">var</span> pk =<span class="hljs-string">&quot;passkey&quot;</span><br><span class="hljs-keyword">var</span> dl =<span class="hljs-string">&#x27;&#x27;</span><br>href=<span class="hljs-string">&#x27;&#x27;</span><br>ct=<span class="hljs-number">0</span><br><span class="hljs-keyword">for</span> (<span class="hljs-keyword">var</span> tr <span class="hljs-keyword">of</span> trs)&#123;<br>    a=tr.<span class="hljs-property">action</span><br>    <span class="hljs-keyword">if</span> (a.<span class="hljs-title function_">match</span>(<span class="hljs-regexp">/zip/</span>))<br>    &#123;<br>       <span class="hljs-keyword">continue</span><br>    &#125;<br>    tid=a.<span class="hljs-title function_">match</span>(<span class="hljs-regexp">/id=(\d+)&amp;*sign=(\d+)/</span>)<br>    <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(tr)<br>    <span class="hljs-keyword">if</span>(tid)<br>       href=<span class="hljs-string">&quot;https://***./download.php?id=&quot;</span>+tid[<span class="hljs-number">1</span>]+<span class="hljs-string">&quot;&amp;passkey=&quot;</span>+pk+<span class="hljs-string">&quot;&amp;https=1&quot;</span><br>       dl=dl+href+<span class="hljs-string">&quot;\r\n&quot;</span><br>       ct=ct+<span class="hljs-number">1</span><br>&#125;<br><span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(dl,ct)<br><span class="hljs-title function_">copy</span>(dl)<br><br></code></pre></td></tr></table></figure>

<h3 id="æ–°æœåŠ¡å™¨æ¢é’ˆServerStatus"><a href="#æ–°æœåŠ¡å™¨æ¢é’ˆServerStatus" class="headerlink" title="æ–°æœåŠ¡å™¨æ¢é’ˆServerStatus"></a>æ–°æœåŠ¡å™¨æ¢é’ˆServerStatus</h3><p><a href="https://github.com/zdz/ServerStatus-Rust">https://github.com/zdz/ServerStatus-Rust</a></p>
<figure class="highlight shell"><table><tr><td class="code"><pre><code class="hljs shell"><span class="hljs-meta prompt_">#</span><span class="language-bash">è‡ªåŠ¨å®‰è£…é…ç½®è„šæœ¬</span><br>wget --no-check-certificate -qO status.sh &#x27;https://raw.githubusercontent.com/zdz/ServerStatus-Rust/master/scripts/status.sh&#x27;<br><span class="hljs-meta prompt_">#</span><span class="language-bash">å®¢æˆ·ç«¯</span><br>./status.sh -i -c http://name:password@ip:8080<br><span class="hljs-meta prompt_">#</span><span class="language-bash">æœåŠ¡å™¨</span><br>./status.sh -i -s <br></code></pre></td></tr></table></figure>]]></content>
  </entry>
  <entry>
    <title>2021åŸºäºDebiançš„All in Oneï¼ˆNAS+è½¯è·¯ç”±ï¼‰é…ç½®æ•™ç¨‹</title>
    <url>/2020/03/07/localnas/</url>
    <content><![CDATA[<p> @<a href="%E5%9F%BA%E4%BA%8EDebian10%E7%9A%84NAS%E7%B3%BB%E7%BB%9F%E9%85%8D%E7%BD%AE">TOC</a></p>
<h1 id="ç³»ç»Ÿæ¦‚è¿°"><a href="#ç³»ç»Ÿæ¦‚è¿°" class="headerlink" title="ç³»ç»Ÿæ¦‚è¿°"></a>ç³»ç»Ÿæ¦‚è¿°</h1><h2 id="éœ€æ±‚åˆ†æ"><a href="#éœ€æ±‚åˆ†æ" class="headerlink" title="éœ€æ±‚åˆ†æ"></a>éœ€æ±‚åˆ†æ</h2><ul>
<li>ä½œä¸ºå½±è¿·ï¼Œæœ‰ä¸€å®šçš„è§‚å½±éœ€æ±‚ï¼ŒåŒæ—¶ä¹Ÿæœ‰å…¼èŒå‰ªè¾‘ã€‚è€ƒè™‘è‹¹æœæ–°M1çš„macbook airçš„å‰ªè¾‘é…ç½®ï¼Œå”¯ä¸€ç¼ºé™·å°±æ˜¯å®¹é‡å¤ªå°åˆä¸å¯æ‹“å±•ï¼Œæ‰€ä»¥æ­é…nasä½œä¸ºå­˜å‚¨å»¶ä¼¸ã€‚</li>
<li>ä¸ºä½•é€‰æ‹©Debianï¼Œå› ä¸ºä½œä¸ºè®¡ç®—æœºä¸“ä¸šï¼ŒæŠ˜è…¾çš„è¿‡ç¨‹ä¹Ÿæ˜¯å­¦ä¹ çš„è¿‡ç¨‹ï¼Œlinuxå¯ä»¥æœ‰æ›´å¤šåŠŸèƒ½é€‰æ‹©ï¼Œä¸éœ€è¦è£…è™šæ‹Ÿæœºå°±èƒ½All in One <del>(boom)</del> ï¼Œå¯ä»¥åšæœåŠ¡å™¨ï¼Œæˆ‘å†™äº†ä¸€ä¸ªç½‘ç«™å¯ä»¥æŒ‚åœ¨ä¸Šé¢è®©å¤§å®¶è®¿é—®ã€‚ä¹Ÿå¯ä»¥åšè½¯è·¯ç”±ï¼Œå®‰è£…***ç­‰è½¬å‘æµé‡å°±å¯ä»¥å…¨å±€ã€‚</li>
<li>è¯¥æ•™ç¨‹ä¸»è¦ä¸ºæä¾›æ€è·¯ï¼Œè®°å½•ä¸€äº›é…ç½®è¿‡ç¨‹ä½¿ç”¨çš„å‘½ä»¤ï¼Œä¹Ÿä½œä¸ºè‡ªå·±å¤‡å¿˜å½•ï¼Œå…·ä½“è¯¦ç»†è¿‡ç¨‹æ— æ³•ä¸€ä¸€æè¿°ï¼Œè‹¥æœ‰å»ºè®®æˆ–è€…ç–‘é—®ï¼Œæ¬¢è¿å¤§å®¶ä¸€èµ·è®¨è®º</li>
</ul>
<h2 id="åŠŸèƒ½å®ç°"><a href="#åŠŸèƒ½å®ç°" class="headerlink" title="åŠŸèƒ½å®ç°"></a>åŠŸèƒ½å®ç°</h2><ul>
<li>æŒ‚è½½ç¡¬ç›˜ä½œä¸ºnaså­˜å‚¨è§†é¢‘ç­‰æ–‡ä»¶</li>
<li>éƒ¨ç½²ç½‘ç«™ä¾›å¤§å®¶è®¿é—®</li>
<li>ä½œä¸ºè½¯è·¯ç”±è½¬å‘æµé‡</li>
</ul>
<h1 id="ç³»ç»Ÿé…ç½®ç®€ä»‹"><a href="#ç³»ç»Ÿé…ç½®ç®€ä»‹" class="headerlink" title="ç³»ç»Ÿé…ç½®ç®€ä»‹"></a>ç³»ç»Ÿé…ç½®ç®€ä»‹</h1><ol>
<li>æ¢…æ·N3150Lä¸»æ¿</li>
<li>CPUæ˜¯N3150ï¼ˆ4æ ¸6Wæ”¯æŒAES ç¨å¼±äºJ1900ä½†å¯ç¡¬è§£4kï¼‰</li>
<li>4Gå†…å­˜1600HZ</li>
<li>8+14Tæœºæ¢°ç¡¬ç›˜</li>
<li>Uç›˜16Gä½œä¸ºç³»ç»Ÿç›˜</li>
<li>TP-link WiFi6çš„è·¯ç”±å™¨è¿›è¡ŒDDNSå’Œç«¯å£è½¬å‘</li>
</ol>
<h1 id="Debian10çš„é•œåƒä¸‹è½½ä¸å®‰è£…"><a href="#Debian10çš„é•œåƒä¸‹è½½ä¸å®‰è£…" class="headerlink" title="Debian10çš„é•œåƒä¸‹è½½ä¸å®‰è£…"></a>Debian10çš„é•œåƒä¸‹è½½ä¸å®‰è£…</h1><ol>
<li>é•œåƒé“¾æ¥:<a href="https://cdimage.debian.org/debian-cd/current/amd64/iso-cd/debian-10.9.0-amd64-netinst.iso">DebianåŸç½‘ç«™é•œåƒ</a></li>
<li>Uç›˜å·¥å…·:Ventory</li>
<li>ç”¨å¦ä¸€ä¸ªUç›˜ä½œä¸ºç³»ç»Ÿç›˜ï¼ˆå¯èŠ‚çº¦ä¸€ä¸ªSATAæ¥å£</li>
</ol>
<h1 id="ç³»ç»Ÿé…ç½®å‡†å¤‡"><a href="#ç³»ç»Ÿé…ç½®å‡†å¤‡" class="headerlink" title="ç³»ç»Ÿé…ç½®å‡†å¤‡"></a>ç³»ç»Ÿé…ç½®å‡†å¤‡</h1><h2 id="oh-my-zshå®‰è£…"><a href="#oh-my-zshå®‰è£…" class="headerlink" title="oh my zshå®‰è£…"></a>oh my zshå®‰è£…</h2><p>è£…æœºç¬¬ä¸€ä»¶äº‹å°±æ˜¯è¦çœ‹å¾—èˆ’æœ</p>
<figure class="highlight shell"><table><tr><td class="code"><pre><code class="hljs shell">apt-get install zsh#å®‰è£…zshä½œä¸ºshell<br>chsh -s /bin/zsh#æ¿€æ´»ç¯å¢ƒ<br><br>sh -c &quot;$(wget https://raw.githubusercontent.com/robbyrussell/oh-my-zsh/master/tools/install.sh -O -)&quot;<br><span class="hljs-meta prompt_">#</span><span class="language-bash">ä¸ªæ€§åŒ–é…ç½®</span><br><span class="hljs-meta prompt_">#</span><span class="language-bash">å¯ä»¥è®°ä½å†å²ç›®å½•ï¼Œä¸éœ€è¦ä¸€ç›´<span class="hljs-built_in">cd</span> å¦‚æœå¡ä½å¯èƒ½æ˜¯éœ€è¦è®¤è¯rsa.pubçš„å…¬é’¥ ssh-kengenç”Ÿæˆä¸€ä¸‹ï¼Œæ·»åŠ åˆ°githubçš„è®¾ç½®-&gt;SSH and GPG keys</span><br>git clone https://github.com/joelthelion/autojump<br>cd autojump<br>./install.py<br><br>git clone https://github.com/zsh-users/zsh-autosuggestions $ZSH_CUSTOM/plugins/zsh-autosuggestions#è‡ªåŠ¨è¡¥å…¨å‘½ä»¤<br><br>git clone https://github.com/zsh-users/zsh-syntax-highlighting.git $&#123;ZSH_CUSTOM:-~/.oh-my-zsh/custom&#125;/plugins/zsh-syntax-highlighting#è¯­æ³•é«˜äº®<br><br>vim ~/.zshrc æŠŠæ’ä»¶åŠ åˆ°æ–‡ä»¶ä¸­<br></code></pre></td></tr></table></figure>
<p>vim ~&#x2F;.zshrcé…ç½®æ–‡ä»¶çš„plugins åŠ ä¸Šautojump zsh-syntax-highlighting zsh-autosuggestionsç”Ÿæ•ˆï¼Œæœ€åå†source ~&#x2F;.zshrcé‡æ–°ç¼–è¯‘zshï¼Œæ­¤æ—¶autojumpå·²ç»ç”Ÿæ•ˆã€‚å…¶ä»–åŒç†</p>
<h2 id="sshè¿œç¨‹è®¿é—®"><a href="#sshè¿œç¨‹è®¿é—®" class="headerlink" title="sshè¿œç¨‹è®¿é—®"></a>sshè¿œç¨‹è®¿é—®</h2><figure class="highlight shell"><table><tr><td class="code"><pre><code class="hljs shell">cd /etc/ssh<br>nano sshd_config<br>//æ·»åŠ ä¸€è¡Œ PermitRootLogin yes<br>//ctrl xä¿å­˜é€€å‡º<br></code></pre></td></tr></table></figure>

<p>å°†#PasswordAuthentication noçš„æ³¨é‡Šå»æ‰ï¼Œå¹¶ä¸”å°†NOä¿®æ”¹ä¸ºYES<br>å®Œæˆä¸Šè¿°æ›´æ”¹åï¼Œè¯·é‡æ–°å¯åŠ¨SSHæœåŠ¡å™¨ï¼š</p>
<figure class="highlight shell"><table><tr><td class="code"><pre><code class="hljs shell">/etc/init.d/ssh restart æˆ–è€…service ssh start<br></code></pre></td></tr></table></figure>
<p>æ·»åŠ å¼€æœºè‡ªå¯åŠ¨ </p>
<figure class="highlight shell"><table><tr><td class="code"><pre><code class="hljs shell">update-rc.d ssh enable<br></code></pre></td></tr></table></figure>
<h2 id="å…æ˜æ–‡ç™»é™†"><a href="#å…æ˜æ–‡ç™»é™†" class="headerlink" title="å…æ˜æ–‡ç™»é™†"></a>å…æ˜æ–‡ç™»é™†</h2><figure class="highlight shell"><table><tr><td class="code"><pre><code class="hljs shell">ssh-keygen -t rsa<br>ssh-copy-id -i ~/.ssh/id_rsa root@ipp<br></code></pre></td></tr></table></figure>
<h2 id="å¼€æœºè‡ªåŠ¨ç™»å½•root"><a href="#å¼€æœºè‡ªåŠ¨ç™»å½•root" class="headerlink" title="å¼€æœºè‡ªåŠ¨ç™»å½•root"></a>å¼€æœºè‡ªåŠ¨ç™»å½•root</h2><ol>
<li>è¿›å…¥rootç”¨æˆ·ï¼Œç¼–è¾‘æ–‡ä»¶&#x2F;lib&#x2F;systemd&#x2F;system&#x2F;getty@.service<figure class="highlight shell"><table><tr><td class="code"><pre><code class="hljs shell">nano /lib/systemd/system/getty@.service<br>//ctrl xä¿å­˜<br></code></pre></td></tr></table></figure></li>
<li>è®¾ç½®å­—æ®µExecStart</li>
</ol>
<figure class="highlight shell"><table><tr><td class="code"><pre><code class="hljs shell">ExecStart=-/sbin/agetty --autologin root --noclear %I $TERM//æ·»åŠ æˆ–ä¿®æ”¹è¿™è¡Œæ•°æ®<br><br>//ctrl xä¿å­˜<br></code></pre></td></tr></table></figure>

<h2 id="ç™½å«–cloudflareçš„æœåŠ¡ç©¿é€å†…ç½‘ï¼Œå‰ææ˜¯éœ€è¦åŸŸå"><a href="#ç™½å«–cloudflareçš„æœåŠ¡ç©¿é€å†…ç½‘ï¼Œå‰ææ˜¯éœ€è¦åŸŸå" class="headerlink" title="ç™½å«–cloudflareçš„æœåŠ¡ç©¿é€å†…ç½‘ï¼Œå‰ææ˜¯éœ€è¦åŸŸå"></a>ç™½å«–cloudflareçš„æœåŠ¡ç©¿é€å†…ç½‘ï¼Œå‰ææ˜¯éœ€è¦åŸŸå</h2><p><a href="https://bra.live/setup-home-server-with-cloudflare-tunnel/">å‚è€ƒé“¾æ¥</a></p>
<figure class="highlight shell"><table><tr><td class="code"><pre><code class="hljs shell">curl -L &#x27;https://github.com/cloudflare/cloudflared/releases/latest/download/cloudflared-linux-amd64&#x27; -o /usr/bin/cloudflared<br>chmod +x /usr/bin/cloudflared<br><br>cloudflared tunnel login<br><span class="hljs-meta prompt_">#</span><span class="language-bash">ç„¶åä¼šè®©æ‰“å¼€æµè§ˆå™¨ç™»é™†éªŒè¯</span><br>A browser window should have opened at the following URL:<br><br>https://dash.cloudflare.com/arg***<br><span class="hljs-meta prompt_">#</span><span class="language-bash">æ³¨æ„ï¼šæˆæƒä¸€æ¬¡åªèƒ½é€‰æ‹©ä¸€ä¸ªç½‘ç«™ã€‚å¦‚æœå­˜åœ¨å¤šä¸ªä¸åŒåŸŸåçš„ç½‘ç«™ï¼Œè¯·æˆæƒå®Œæˆåä¸è¦å…³é—­ç½‘é¡µï¼Œç‚¹å‡»ç¬¬äºŒä¸ªã€ç¬¬ä¸‰ä¸ªè¦æˆæƒçš„åŸŸåï¼Œè¿›è¡Œå¤šæ¬¡æˆæƒã€‚</span><br><br><br>cloudflared tunnel create &lt;éš§é“åå­—&gt;#æ¯”å¦‚ webserver-1<br><span class="hljs-meta prompt_">#</span><span class="language-bash">ç„¶åæœ‰uuidè¦è®°ä¸‹</span><br>Tunnel credentials written to /root/.cloudflared/12345-123-123-123-12345.json. cloudflared chose this file based on where your origin certificate was found. Keep this file secret. To revoke these credentials, delete the tunnel.<br><br>Created tunnel webserver-1 with id 12345-123-123-123-12345<br><br>......<br></code></pre></td></tr></table></figure>
<h2 id="rcloneä½¿ç”¨"><a href="#rcloneä½¿ç”¨" class="headerlink" title="rcloneä½¿ç”¨"></a>rcloneä½¿ç”¨</h2><p>rcloneä¸ä»…å¯ä»¥æŒ‚è½½ç½‘ç›˜è¿˜èƒ½æŒ‚FTPã€sftpç­‰ç­‰ï¼Œå½“ä½œåŒæ­¥çš„å·¥å…·ä¹Ÿå¾ˆä¸é”™ï¼Œè¿™é‡Œä»‹ç»ä¸‹sftpçš„æŒ‚è½½</p>
<figure class="highlight shell"><table><tr><td class="code"><pre><code class="hljs shell"><span class="hljs-meta prompt_">#</span><span class="language-bash">ä¸€é”®å®‰è£…æœ€æ–°çš„ç‰ˆæœ¬ï¼Œè‡ªå¸¦çš„æ¯”è¾ƒè€</span><br><br>sudo -v ; curl https://rclone.org/install.sh | sudo bash<br><br>ssh-keygen -q -t rsa -b 4096 -C &quot;rclone key&quot; -N &quot;&quot; -f ~/.ssh/rclone<br>cd ~/.ssh/<br>cat rclone* &gt; rclone-merged <br><span class="hljs-meta prompt_">#</span><span class="language-bash">é…ç½®é™¤äº†åœ°å€è´¦å·å¯†ç è¿™äº›ä¸€åˆ‡éƒ½é»˜è®¤ï¼Œé™¤äº†ä¸‹é¢è¿™ä¸ª</span><br><span class="hljs-meta prompt_">key_file&gt; </span><span class="language-bash">~/.ssh/rclone-merged</span><br><br></code></pre></td></tr></table></figure>

<figure class="highlight shell"><table><tr><td class="code"><pre><code class="hljs shell">apt install fuse3<br><br>rclone mount -vv alist: /alist --copy-links --no-gzip-encoding --no-check-certificate --allow-other --allow-non-empty --umask 000 --vfs-cache-mode writes  --daemon<br></code></pre></td></tr></table></figure>

<h2 id="Tailscale"><a href="#Tailscale" class="headerlink" title="Tailscale"></a>Tailscale</h2><ul>
<li>éœ€è¦å®¢æˆ·ç«¯ï¼Œä¸æ˜¯å¾ˆæ–¹ä¾¿<figure class="highlight shell"><table><tr><td class="code"><pre><code class="hljs shell">curl -fsSL https://tailscale.com/install.sh | sh<br>tailscale up<br></code></pre></td></tr></table></figure></li>
</ul>
<h2 id="å›¾å½¢åŒ–ç•Œé¢å¸è½½"><a href="#å›¾å½¢åŒ–ç•Œé¢å¸è½½" class="headerlink" title="å›¾å½¢åŒ–ç•Œé¢å¸è½½"></a>å›¾å½¢åŒ–ç•Œé¢å¸è½½</h2><p>å›¾å½¢åŒ–ç•Œé¢æ¯”è¾ƒå å†…å­˜ï¼Œè€Œæˆ‘å¤šæ•°æ—¶å€™SSHä¹Ÿç”¨ä¸ä¸Šï¼Œæ‰€ä»¥å°†å…¶å¸è½½</p>
<figure class="highlight shell"><table><tr><td class="code"><pre><code class="hljs shell">apt autoremove gdm3<br>apt autoremove --purge gnome*<br><br>//rebooté‡å¯<br></code></pre></td></tr></table></figure>

<h2 id="ç½‘è·¯é…ç½®"><a href="#ç½‘è·¯é…ç½®" class="headerlink" title="ç½‘è·¯é…ç½®"></a>ç½‘è·¯é…ç½®</h2><ol>
<li>å‘è¿è¥å•†ç”³è¯·å¤–ç½‘IPï¼Œä¸€èˆ¬æ‰“ç”µè¯å°±è¡Œ(ç°åœ¨å¯èƒ½ä¸å®¹æ˜“äº†)</li>
<li>ç”³è¯·ä¸€ä¸ªåŸŸåï¼Œæˆ‘ç”¨çš„é˜¿é‡Œçš„</li>
<li>å› ä¸ºæ‹¨å·ä¸Šç½‘IPä¸ä¼šå›ºå®šï¼Œæ‰€ä»¥éœ€è¦è·¯ç”±å™¨çš„DDNSé€šè¿‡åŸŸåç»‘å®šIPè®¿é—®</li>
<li>åœ¨è·¯ç”±å™¨çš„è™šæ‹ŸæœåŠ¡å™¨ä¸Šé¢è®¾ç½®ç«¯å£è½¬å‘ï¼Œå¯ä»¥è½¬å‘è¢«ç¦çš„80æˆ–è€…443ç«¯å£</li>
</ol>
<p>ç¼–è¾‘è®¾ç½®ï¼švim &#x2F;etc&#x2F;network&#x2F;interfaces</p>
<figure class="highlight shell"><table><tr><td class="code"><pre><code class="hljs shell">source /etc/network/interfaces.d/*<br><span class="hljs-meta prompt_">#</span><span class="language-bash"><span class="hljs-comment">#æ€»çš„æ¥è¯´æ˜¯ç”¨çš„enp2s0ç½‘å£ï¼Œä¹Ÿå°±æ˜¯å¤–æ¥çš„åƒå…†ç½‘å¡ï¼Œåˆ†é…é™æ€ip</span></span><br><span class="hljs-meta prompt_"># </span><span class="language-bash">The loopback network interface</span><br>auto lo<br>iface lo inet loopback<br><span class="hljs-meta prompt_"></span><br><span class="hljs-meta prompt_"># </span><span class="language-bash">The primary network interface</span><br>allow-hotplug enp2s0<br><span class="hljs-meta prompt_"></span><br><span class="hljs-meta prompt_">#</span><span class="language-bash"><span class="hljs-comment">#åŠ¨æ€ip</span></span><br><span class="hljs-meta prompt_">#</span><span class="language-bash">iface enp3s0 inet dhcp</span><br><span class="hljs-meta prompt_">#</span><span class="language-bash">iface enp3s0 inet loopback</span><br><span class="hljs-meta prompt_"></span><br><span class="hljs-meta prompt_">#</span><span class="language-bash"><span class="hljs-comment">#é™æ€ip</span></span><br>iface enp2s0 inet static<br>address 192.168.1.107<br><span class="hljs-meta prompt_">#</span><span class="language-bash">address 192.168.101.111</span><br>netmask 255.255.255.0<br>gateway 192.168.1.1<br>auto enp2s0<br></code></pre></td></tr></table></figure>

<h2 id="ç½‘ç»œè‡ªåŠ¨é‡è¿"><a href="#ç½‘ç»œè‡ªåŠ¨é‡è¿" class="headerlink" title="ç½‘ç»œè‡ªåŠ¨é‡è¿"></a>ç½‘ç»œè‡ªåŠ¨é‡è¿</h2><p>å†™äº†ä¸ªè„šæœ¬è‡ªåŠ¨æ£€æµ‹ç½‘ç»œï¼Œæ–­å¼€åˆ™é‡è¿ï¼Œä¸‹é¢æ˜¯ç¯å¢ƒéœ€è¦</p>
<figure class="highlight shell"><table><tr><td class="code"><pre><code class="hljs shell">pip install selenium<br>apt install chrome-driver<br>apt-get install -y libnss3-dev libgconf-2-4 xvfb<br></code></pre></td></tr></table></figure>

<h2 id="ç£ç›˜ç›¸å…³å‘½ä»¤"><a href="#ç£ç›˜ç›¸å…³å‘½ä»¤" class="headerlink" title="ç£ç›˜ç›¸å…³å‘½ä»¤"></a>ç£ç›˜ç›¸å…³å‘½ä»¤</h2><ol>
<li>ç£ç›˜åˆ†åŒº <figure class="highlight shell"><table><tr><td class="code"><pre><code class="hljs shell">fdisk -l<br>//æŸ¥çœ‹æ‰€æœ‰ç£ç›˜ä¿¡æ¯<br>fdisk  /dev/sdb<br>//å¯¹sdbç£ç›˜è¿›è¡Œåˆ†åŒº<br></code></pre></td></tr></table></figure>
 è‹¥ç£ç›˜å¤§äº2Tï¼Œéœ€è¦partedå‘½ä»¤åˆ†åŒº  <figure class="highlight shell"><table><tr><td class="code"><pre><code class="hljs shell"> parted /dev/sdb  //åˆ†åŒºç£ç›˜sdb<br> mklabel gpt  //partedå‘½ä»¤åªèƒ½é’ˆå¯¹gptæ ¼å¼çš„ç£ç›˜è¿›è¡Œæ“ä½œ <br> mkpart ext4 0% 1.5T//å°†0åˆ°1.5Tåˆ’ä¸ºä¸€ä¸ªåˆ†åŒº<br>(parted) p //æŸ¥çœ‹æ‰€æœ‰ç£ç›˜ä¿¡æ¯<br>mkfs -t ext4 /dev/sdb1   //æ ¼å¼åŒ–åˆ†åŒºsdb1<br></code></pre></td></tr></table></figure></li>
<li>æŸ¥çœ‹å½“å‰å·²æŒ‚è½½ç£ç›˜<figure class="highlight shell"><table><tr><td class="code"><pre><code class="hljs shell">df -h<br></code></pre></td></tr></table></figure></li>
<li>æŒ‚è½½ç£ç›˜<figure class="highlight shell"><table><tr><td class="code"><pre><code class="hljs shell">mount /dev/sdb1 /mnt/fodername1<br>//å°†ç£ç›˜sdb1æŒ‚è½½åˆ°ç›¸åŒçš„é€»è¾‘æ–‡ä»¶/dataä¸‹ï¼Œå¸è½½åˆ™æ¢ä¸ºumount<br></code></pre></td></tr></table></figure></li>
<li>å¼€æœºè‡ªåŠ¨æŒ‚è½½ç£ç›˜<figure class="highlight shell"><table><tr><td class="code"><pre><code class="hljs shell"> vim /etc/fstab<br> //æ‰“å¼€fstabæ–‡ä»¶å†™å…¥å‘½ä»¤<br> UUID=b394c406-5c0e-4e16-9d80-a212c34a8d32 /mnt            ext4    defaults   0<br>/dev/sdb1                               /mnt/Film             ext4              defaults 0<br>/dev/sdb2                               /mnt/Material   		ext4            defaults 0<br><br> <br></code></pre></td></tr></table></figure></li>
<li>ç£ç›˜é€šç”µæ—¶é—´ç­‰è¯¦ç»†å‚æ•°<figure class="highlight shell"><table><tr><td class="code"><pre><code class="hljs shell">apt-get install smartmontools<br>//ä¸‹è½½ç£ç›˜æµ‹è¯•å·¥å…·<br>smartctl -A /dev/sdb<br>//æµ‹è¯•sdaç£ç›˜<br></code></pre></td></tr></table></figure></li>
<li>ç£ç›˜è¯»å†™é€Ÿåº¦<figure class="highlight shell"><table><tr><td class="code"><pre><code class="hljs shell">hdparm -Tt /dev/sda<br>//sdaæ¢ä¸ºæµ‹è¯•çš„ç¡¬ç›˜<br></code></pre></td></tr></table></figure></li>
<li>ç£ç›˜æ¸…ç†æŸ¥çœ‹<figure class="highlight shell"><table><tr><td class="code"><pre><code class="hljs shell">apt install ncdu<br>ncdu / --exclude /foldername<br> //å¯æŒ‰ç…§æ–‡ä»¶å ç”¨å¤§å°æ’åºæŸ¥çœ‹<br></code></pre></td></tr></table></figure></li>
</ol>
<h1 id="è™šæ‹Ÿç¯å¢ƒ"><a href="#è™šæ‹Ÿç¯å¢ƒ" class="headerlink" title="è™šæ‹Ÿç¯å¢ƒ"></a>è™šæ‹Ÿç¯å¢ƒ</h1><h3 id="Dockerå®‰è£…"><a href="#Dockerå®‰è£…" class="headerlink" title="Dockerå®‰è£…"></a>Dockerå®‰è£…</h3><figure class="highlight shell"><table><tr><td class="code"><pre><code class="hljs shell">curl -fsSL https://get.docker.com -o get-docker.sh<br>sh get-docker.sh<br></code></pre></td></tr></table></figure>
<h4 id="conda"><a href="#conda" class="headerlink" title="conda"></a>conda</h4><p>æ¯”èµ·virtualenvï¼Œcondaæœ€å¤§ä¼˜ç‚¹æ˜¯å¯ä»¥è‡ªåŠ¨å®‰è£…æŒ‡å®šæ–°ç‰ˆæœ¬pythonï¼Œä¸ç”¨æœ¬åœ°ç¯å¢ƒ</p>
<figure class="highlight shell"><table><tr><td class="code"><pre><code class="hljs shell">wget -4 -c https://mirrors.tuna.tsinghua.edu.cn/anaconda/miniconda/Miniconda3-py39_4.9.2-Linux-x86_64.sh<br><span class="hljs-meta prompt_">#</span><span class="language-bash">ç¬¬äºŒæ­¥å®‰è£…</span><br>sh Miniconda3-py39_4.9.2-Linux-x86_64.sh -b -p /root/miniconda3<br><span class="hljs-meta prompt_"></span><br><span class="hljs-meta prompt_">#</span><span class="language-bash">ç¬¬ä¸‰æ­¥é…ç½®condaé•œåƒ</span><br><br>export PATH=/root/miniconda3/bin:$PATH<br><span class="hljs-meta prompt_"># </span><span class="language-bash"><span class="hljs-built_in">alias</span> ohmyzsh=<span class="hljs-string">&quot;mate ~/.oh-my-zsh&quot;</span></span><br><br>vim ~/.zshrc<br><span class="hljs-meta prompt_">#</span><span class="language-bash"><span class="hljs-comment"># æ·»åŠ ä¸‹é¢çš„å†…å®¹</span></span><br><span class="hljs-meta prompt_"># </span><span class="language-bash">&gt;&gt;&gt; conda initialize &gt;&gt;&gt;</span><br><span class="hljs-meta prompt_"># </span><span class="language-bash">!! Contents within this block are managed by <span class="hljs-string">&#x27;conda init&#x27;</span> !!</span><br>__conda_setup=&quot;$(&#x27;/root/miniconda3/bin/conda&#x27; &#x27;shell.zsh&#x27; &#x27;hook&#x27; 2&gt; /dev/null)&quot;<br>if [ $? -eq 0 ]; then<br>    eval &quot;$__conda_setup&quot;<br>else<br>    if [ -f &quot;/root/miniconda3/etc/profile.d/conda.sh&quot; ]; then<br>        . &quot;/root/miniconda3/etc/profile.d/conda.sh&quot;<br>    else<br>        export PATH=&quot;/root/miniconda3/bin:$PATH&quot;<br>    fi<br>fi<br>unset __conda_setup<br><span class="hljs-meta prompt_"># </span><span class="language-bash">&lt;&lt;&lt; <span class="hljs-string">conda initialize &lt;&lt;&lt;</span></span><br><br>source ~/.zshrc<br><br>conda create -n py39 python=3.9<br>conda activate py39<br></code></pre></td></tr></table></figure>
<h4 id="Jupyter-lab"><a href="#Jupyter-lab" class="headerlink" title="Jupyter lab"></a>Jupyter lab</h4><figure class="highlight shell"><table><tr><td class="code"><pre><code class="hljs shell">conda install jupyterlab<br><span class="hljs-meta prompt_">#</span><span class="language-bash">åˆ›å»ºå¯†ç </span><br>jupyter lab password<br><span class="hljs-meta prompt_">#</span><span class="language-bash">ç”Ÿæˆé…ç½®æ–‡ä»¶</span><br>jupyter lab --generate-config<br><span class="hljs-meta prompt_">#</span><span class="language-bash">ç¼–è¾‘æ–‡ä»¶</span><br>vim /root/.jupyter/jupyter_lab_config.py<br><span class="hljs-meta prompt_">#</span><span class="language-bash"><span class="hljs-comment">#ä¿®æ”¹ä¸‹é¢çš„</span></span><br>c.ServerApp.root_dir = &#x27;&#x27;                  # è®¾ç½®é»˜è®¤å·¥ä½œç›®å½•<br>c.ServerApp.ip = &#x27;*&#x27;                     # å…è®¸è®¿é—®æ­¤æœåŠ¡å™¨çš„ IPï¼Œæ˜Ÿå·è¡¨ç¤ºä»»æ„ IP<br>c.ServerApp.password = &#x27;****************&#x27; # ä¹‹å‰ç”Ÿæˆçš„å¯†ç  hash å­—ä¸²åœ¨/root/.jupyter/jupyter_server_config.json, ç²˜è´´è¿›å»<br>c.ServerApp.open_browser = False         # è¿è¡Œæ—¶ä¸æ‰“å¼€æœ¬æœºæµè§ˆå™¨<br>c.ServerApp.port = 8888                  # ä½¿ç”¨çš„ç«¯å£ï¼Œéšæ„è®¾ç½®ï¼Œä½†æ˜¯è¦è®°å¾—ä½ è®¾å®šçš„è¿™ä¸ªç«¯å£<br>c.ServerApp.enable_mathjax = True        # å¯ç”¨ MathJax<br>c.ServerApp.allow_remote_access = True   # å…è®¸è¿œç¨‹è®¿é—®<br>c.ServerApp.allow_root = True            # å…è®¸rootæƒé™<br></code></pre></td></tr></table></figure>
<h2 id="Jellyfinå®‰è£…é…ç½®"><a href="#Jellyfinå®‰è£…é…ç½®" class="headerlink" title="Jellyfinå®‰è£…é…ç½®"></a>Jellyfinå®‰è£…é…ç½®</h2><figure class="highlight shell"><table><tr><td class="code"><pre><code class="hljs shell">docker pull nyanmisaka/jellyfin<br><br>docker run -d -p 8096:8096 -v /jellyfin/config:/config -v /mnt/AllMedia:/media -v /mnt/Other:/Film3 -v /mnt/Film:/Film2 --restart=always nyanmisaka/jellyfin<br></code></pre></td></tr></table></figure>
<ol>
<li>-p åé¢æ˜¯jellyfinæœåŠ¡çš„ç«¯å£å·ï¼Œå®‰è£…æ—¶å¯ä»¥æŒ‡å®šï¼Œè¿™é‡Œä½¿ç”¨é»˜è®¤çš„8096ï¼›</li>
<li>-v åé¢æ˜¯æŒ‡å®šçš„é…ç½®è·¯å¾„ï¼Œæ¯”å¦‚ &#x2F;mnt&#x2F;film å°±æ˜¯æˆ‘åŸæ¥çš„å½±éŸ³ç‰©ç†è·¯å¾„ï¼Œ&#x2F;mediaå°±æ˜¯jellyfinçš„æ˜ å°„è·¯å¾„</li>
<li>å¯ä»¥é€šè¿‡http:&#x2F;&#x2F;æœ¬åœ°ip:8096 æ¥è®¿é—®jellyfinæœåŠ¡äº†,åæœŸä¹Ÿå¯ä»¥è½¬å‘ç«¯å£åœ¨å¤–ç½‘ç”¨åŸŸåè®¿é—®</li>
</ol>
<h2 id="Sambaå®‰è£…é…ç½®"><a href="#Sambaå®‰è£…é…ç½®" class="headerlink" title="Sambaå®‰è£…é…ç½®"></a>Sambaå®‰è£…é…ç½®</h2><p>Debianç»ˆç«¯</p>
<figure class="highlight shell"><table><tr><td class="code"><pre><code class="hljs shell">apt install samba<br><br>nano /etc/samba/smb.conf<br><br>//æœ€ååŠ ä¸Š<br>[share]<br>comment = Provides Filesystem For Anyone<br>path = /share<br>browsable = yes<br>create mask = 0777<br>directory mask = 0777<br>read only = no<br>writable = yes<br>guest ok = yes<br>public = yes<br>forceuser=root<br>forcegroup=root<br><br>//åˆ›å»ºå…±äº«ç›®å½•å¹¶è®¾ç½®æƒé™<br>mkdir /share<br>chmod -R 0777 /share<br>//å®¢æˆ·ç«¯<br>apt install smbclient<br>//é‡å¯æœåŠ¡<br>systemctl restart smbd.service &amp;&amp; systemctl restart nmbd.service<br></code></pre></td></tr></table></figure>
<p>Windowsç»ˆç«¯</p>
<p>æ‰“å¼€æˆ‘çš„ç”µè„‘ï¼Œåœ°å€æ è¾“å…¥ \192.168.<em><strong>.</strong></em> ï¼ˆNASæ‰€åœ¨å±€åŸŸç½‘IPï¼‰ä¼šçœ‹åˆ°å‡ ä¸ªæ–‡ä»¶å</p>
<ul>
<li>æ³¨æ„ï¼Œwindowä¸Šé¢æ˜ å°„åœ°å€ä¸æ˜¯æŒ‚è½½åœ°å€ï¼Œè€Œå¿…é¡»ä¸ä¸Šé¢æ–‡ä»¶ç´¯çš„pathè·¯å¾„åç§°ï¼ˆ&#x2F;shareï¼‰å®Œå…¨ä¸€è‡´ï¼ŒåŒ…æ‹¬å¤§å°å†™ï¼Œä¸ç„¶ä¼šæç¤ºæ‹¼å†™é”™è¯¯</li>
<li>iPadä¹Ÿå¯ç”¨nPlayerçš„SMBé…ç½®è®¿é—®è¿™ä¸ªåœ°å€</li>
</ul>
<h2 id="NFS"><a href="#NFS" class="headerlink" title="NFS"></a>NFS</h2><p>Sambaé…ç½®å¤ªç¹çäº†ï¼Œç°åœ¨ä¹Ÿä¸ç”¨Windows</p>
<figure class="highlight shell"><table><tr><td class="code"><pre><code class="hljs shell">apt-get install nfs-kernel-server <br>apt-get install nfs-common   #MACå®¢æˆ·ç«¯è‡ªå¸¦ï¼Œå¯ä¸ç”¨å®‰è£…<br><br>vim /etc/exports<br><span class="hljs-meta prompt_">#</span><span class="language-bash">æ·»åŠ  *ä»£è¡¨æ‰€æœ‰ipè®¿é—®</span><br>/mnt *(rw,fsid=0,sync,no_root_squash,no_subtree_check,insecure)<br><br>/mnt/Other *(rw,sync,no_root_squash,no_subtree_check,insecure)<br>/mnt/AllMedia *(rw,sync,no_subtree_check,no_root_squash,insecure)<br>systemctl restart nfs-kernel-service#é‡å¯nfsæœåŠ¡<br><span class="hljs-meta prompt_">#</span><span class="language-bash">MacæŒ‚è½½å‘½ä»¤</span><br>mount -t nfs -o nolocks 192.168.101.111:/mnt /Users/gawaintan/NAS<br><br></code></pre></td></tr></table></figure>
<p>æ³¨æ„ï¼š*ä»£è¡¨æ‰€æœ‰ipéƒ½å…è®¸è®¿é—®ï¼Œ&#x2F;mntä½œä¸ºçˆ¶çº§ç›®å½•fsid&#x3D;0åªèƒ½å‡ºç°ä¸€æ¬¡ï¼Œno_root_squashæˆäºˆrootæƒé™ï¼Œè°¨æ…ä½¿ç”¨ï¼Œinsecureä¸ºäº†æˆ‘é¿å…å®¢æˆ·ç«¯permission denied</p>
<h2 id="ç½‘å£"><a href="#ç½‘å£" class="headerlink" title="ç½‘å£"></a>ç½‘å£</h2><p>æˆ‘ä¹°äº†å—åƒå…†ç½‘å¡ï¼Œä½†æ˜¯è£…æœºæ’å¦ä¸€ä¸ªç½‘å£äº†ï¼Œå¯¼è‡´å¼€æœºé»˜è®¤ä¸å¯åŠ¨<br>æ‰€ä»¥éœ€è¦è®¾ç½®ä¸€ä¸‹</p>
<figure class="highlight shell"><table><tr><td class="code"><pre><code class="hljs shell">vim /etc/network/interfaces<br><br>auto enp2s0   #è®¾ç½®ç½‘å¡è‡ªå¯åŠ¨<br>iface wlan0 inet static    #è®¾ç½®ç½‘å¡ä½¿ç”¨é™æ€IP<br>address 192.168.101.111<br>netmask 255.255.255.0<br>gateway 192.168.101.1<br></code></pre></td></tr></table></figure>

<h2 id="å®‰è£…é…ç½®aria2"><a href="#å®‰è£…é…ç½®aria2" class="headerlink" title="å®‰è£…é…ç½®aria2"></a>å®‰è£…é…ç½®aria2</h2><p>â€¦ä¸æ€ä¹ˆç”¨äº†</p>
<h2 id="mysqlå®‰è£…é…ç½®"><a href="#mysqlå®‰è£…é…ç½®" class="headerlink" title="mysqlå®‰è£…é…ç½®"></a>mysqlå®‰è£…é…ç½®</h2><p>åœ¨Debiançš„é»˜è®¤å­˜å‚¨åº“ä¸­ä¸å¯ç”¨ï¼ŒMariaDBæ˜¯Debian 10ä¸­çš„é»˜è®¤æ•°æ®åº“ç³»ç»Ÿï¼Œæˆ‘å°†ä»‹ç»å¦‚ä½•å®‰è£…mysql8</p>
<figure class="highlight shell"><table><tr><td class="code"><pre><code class="hljs shell">wget http://repo.mysql.com/mysql-apt-config_0.8.13-1_all.deb <br><span class="hljs-meta prompt_">#</span><span class="language-bash">ä¸‹è½½å®Œæˆåï¼Œä»¥å…·æœ‰<span class="hljs-built_in">sudo</span>æƒé™çš„ç”¨æˆ·èº«ä»½å®‰è£…å‘è¡ŒåŒ…ï¼š</span><br>apt install ./mysql-apt-config_0.8.13-1_all.deb<br><span class="hljs-meta prompt_">#</span><span class="language-bash">é€‰æ‹©MySQL Server &amp; Cluster(å½“å‰é€‰æ‹©ï¼šmysql-8.0)ç¡®å®šå®‰è£…</span><br><span class="hljs-meta prompt_"></span><br><span class="hljs-meta prompt_">#</span><span class="language-bash">é€šè¿‡è¿è¡Œä»¥ä¸‹å‘½ä»¤æ›´æ–°åŒ…åˆ—è¡¨å¹¶å®‰è£…MySQLæœåŠ¡å™¨åŒ…ï¼š</span><br>sudo apt update<br>sudo apt install mysql-server<br></code></pre></td></tr></table></figure>
<p>ç­‰å¾…å®‰è£…ï¼Œå®Œæˆåç”¨ systemctl status mysqlæ£€éªŒå®‰è£…æ˜¯å¦æˆåŠŸ<br>è¿è¡Œmysql_secure_installationè®¾ç½®å¯†ç ï¼ŒæŒ‰ç…§å–œå¥½é€‰æ‹©Y<br>mysql -u root -pè¾“å…¥è®¾ç½®ï¼Œå¯†ç ç™»é™†</p>
<h2 id="è½¯è·¯ç”±æµé‡åˆ†å‘"><a href="#è½¯è·¯ç”±æµé‡åˆ†å‘" class="headerlink" title="è½¯è·¯ç”±æµé‡åˆ†å‘"></a>è½¯è·¯ç”±æµé‡åˆ†å‘</h2><h1 id="å…¶ä»–å‘½ä»¤"><a href="#å…¶ä»–å‘½ä»¤" class="headerlink" title="å…¶ä»–å‘½ä»¤"></a>å…¶ä»–å‘½ä»¤</h1><h2 id="å±€åŸŸç½‘ç½‘é€Ÿæµ‹è¯•"><a href="#å±€åŸŸç½‘ç½‘é€Ÿæµ‹è¯•" class="headerlink" title="å±€åŸŸç½‘ç½‘é€Ÿæµ‹è¯•"></a>å±€åŸŸç½‘ç½‘é€Ÿæµ‹è¯•</h2><figure class="highlight shell"><table><tr><td class="code"><pre><code class="hljs shell"><span class="hljs-meta prompt_">#</span><span class="language-bash">Linuxç«¯</span><br>apt-get install iperf3<br>iperf3 -s#å°†linuxä½œä¸ºæœåŠ¡å™¨ç«¯<br><span class="hljs-meta prompt_">#</span><span class="language-bash">windowsç«¯,å®˜ç½‘ä¸‹è½½iperf3ï¼Œcmdå‘½ä»¤åˆ°è¯¥ç›®å½•ä¸‹</span><br>Iperf3 -c 192.168.101.119<br><br></code></pre></td></tr></table></figure>


<h2 id="ç½‘ç»œç«¯å£æŸ¥çœ‹"><a href="#ç½‘ç»œç«¯å£æŸ¥çœ‹" class="headerlink" title="ç½‘ç»œç«¯å£æŸ¥çœ‹"></a>ç½‘ç»œç«¯å£æŸ¥çœ‹</h2><figure class="highlight shell"><table><tr><td class="code"><pre><code class="hljs shell">apt-get install net-tools #æ–°çš„ç³»ç»Ÿå¯èƒ½ä¸å¸¦è¯¥å‘½ä»¤ï¼Œä¹Ÿæ— æ³•é€šè¿‡install ifconfigä¸‹è½½ï¼Œåªèƒ½ç”¨è¯¥å‘½ä»¤<br><br>ethtool enp2s0#æŸ¥çœ‹ç½‘å£ä¿¡æ¯<br><br></code></pre></td></tr></table></figure>

<h2 id="screenå‘½ä»¤çš„ä½¿ç”¨"><a href="#screenå‘½ä»¤çš„ä½¿ç”¨" class="headerlink" title="screenå‘½ä»¤çš„ä½¿ç”¨"></a>screenå‘½ä»¤çš„ä½¿ç”¨</h2><p>æ–¹ä¾¿åˆ‡æ¢è¿›ç¨‹ï¼Œå¯ä»¥åœ¨ä¸€ä¸ªè¿›ç¨‹æœªå®Œæˆçš„æ—¶å€™å°†å…¶æŒ‚èµ·</p>
<figure class="highlight shell"><table><tr><td class="code"><pre><code class="hljs shell">screen<br>screen -ls#å±•ç¤ºæ‰€æœ‰è¿›ç¨‹<br>screen -d id#detachè¯¥è¿›ç¨‹ï¼Œå¯ç”¨åˆ‡æ¢è¿œç¨‹ç»ˆç«¯è®¿é—®<br>screen -r id #è¿›å…¥è¯¥è¿›ç¨‹<br><br></code></pre></td></tr></table></figure>

<h2 id="å®šæ—¶è‡ªåŠ¨å…³æœº"><a href="#å®šæ—¶è‡ªåŠ¨å…³æœº" class="headerlink" title="å®šæ—¶è‡ªåŠ¨å…³æœº"></a>å®šæ—¶è‡ªåŠ¨å…³æœº</h2><p>å› ä¸ºå¯å®¤0:30åœç”µï¼Œç„¶åè®¾ç½®äº†ä¸»åŠæ¥ç”µè‡ªåŠ¨å¼€æœº</p>
<figure class="highlight shell"><table><tr><td class="code"><pre><code class="hljs shell">vim /etc/crontab<br><span class="hljs-meta prompt_">#</span><span class="language-bash">æœ€åæ·»åŠ ä¸€è¡Œä»£è¡¨0:22è‡ªåŠ¨å…³æœº</span><br>22  0    * * *   root    /sbin/halt<br><br></code></pre></td></tr></table></figure>
<h2 id="å¼€æœºå¯åŠ¨ç®¡ç†å·¥å…·"><a href="#å¼€æœºå¯åŠ¨ç®¡ç†å·¥å…·" class="headerlink" title="å¼€æœºå¯åŠ¨ç®¡ç†å·¥å…·"></a>å¼€æœºå¯åŠ¨ç®¡ç†å·¥å…·</h2><figure class="highlight shell"><table><tr><td class="code"><pre><code class="hljs shell">apt-get install sysv-rc-conf<br>sysv-rc-conf --level 345 mysql on #mysqlå¯æ¢å…¶ä»–æœåŠ¡<br><span class="hljs-meta prompt_">sysv-rc-conf#</span><span class="language-bash">å¯æŸ¥çœ‹é€‰æ‹©å¯åŠ¨æƒé™</span><br></code></pre></td></tr></table></figure>
<p><img src="https://ptpimg.me/83u06a.jpg" alt="è¯·æ·»åŠ å›¾ç‰‡æè¿°"></p>
<h2 id="å°å·¥å…·é›†åˆ"><a href="#å°å·¥å…·é›†åˆ" class="headerlink" title="å°å·¥å…·é›†åˆ"></a>å°å·¥å…·é›†åˆ</h2><ol>
<li>htopç”¨äºè§‚å¯Ÿç³»ç»Ÿå ç”¨èµ„æºæƒ…å†µ</li>
<li>ncdu &#x2F;ç›®å½• å¯å°†è¯¥ç›®å½•ä¸‹æ‰€æœ‰æ–‡ä»¶ä»å¤§åˆ°å°æ’åº</li>
</ol>
<h2 id="Alist"><a href="#Alist" class="headerlink" title="Alist"></a>Alist</h2><p><a href="https://alist.nn.ci/zh/guide/install/script.html">https://alist.nn.ci/zh/guide/install/script.html</a></p>
<figure class="highlight shell"><table><tr><td class="code"><pre><code class="hljs shell"><br>curl -fsSL &quot;https://alist.nn.ci/v3.sh&quot; | bash -s install<br></code></pre></td></tr></table></figure>


]]></content>
  </entry>
  <entry>
    <title>æ–¯å¦ç¦æ±½è½¦è¯†åˆ«</title>
    <url>/2022/11/07/StanfordCars/</url>
    <content><![CDATA[<h1 id="æ–¯å¦ç¦æ±½è½¦åˆ†ç±»"><a href="#æ–¯å¦ç¦æ±½è½¦åˆ†ç±»" class="headerlink" title="æ–¯å¦ç¦æ±½è½¦åˆ†ç±»"></a>æ–¯å¦ç¦æ±½è½¦åˆ†ç±»</h1><p>è¿™æ˜¯ä¸€ä¸ªä½¿ç”¨æ–¯å¦ç¦æ±½è½¦æ•°æ®é›†è¿›è¡Œæ±½è½¦åˆ†ç±»çš„æ·±åº¦å­¦ä¹ é¡¹ç›®ã€‚æˆ‘å°†ä½¿ç”¨è¿ç§»å­¦ä¹ åœ¨ImageNetä¸Šé¢„è®­ç»ƒçš„æ·±åº¦ç½‘ç»œï¼Œå¹¶å¯¹æ•°æ®é›†è¿›è¡Œå¾®è°ƒï¼Œä¸ºäº†å‡å°‘è®­ç»ƒæ—¶é—´æˆ‘æŠŠæ•°æ®é›†ã€‚</p>
<p>æ•°æ®æ¥æºï¼š<a href="https://ai.stanford.edu/~jkrause/cars/car_dataset.html">https://ai.stanford.edu/~jkrause/cars/car_dataset.html</a></p>
<h1 id="1-æ•°æ®æè¿°"><a href="#1-æ•°æ®æè¿°" class="headerlink" title="1. æ•°æ®æè¿°"></a>1. æ•°æ®æè¿°</h1><p>æ–¯å¦ç¦æ±½è½¦æ•°æ®é›†åŒ…å« 195 ç±»æ±½è½¦çš„ 16,185 å¼ å›¾åƒã€‚æ•°æ®è¢«åˆ†æˆ 8,144 å¼ è®­ç»ƒå›¾åƒå’Œ 8,041 å¼ æµ‹è¯•å›¾åƒï¼Œæ¯ä¸ªç±»ä¹Ÿè¢«åˆ†æˆå¤§çº¦ 50-50ã€‚ç±»é€šå¸¸å¤„äºå“ç‰Œã€å‹å·å’Œå¹´ä»½çº§åˆ«ï¼Œä¾‹å¦‚ã€‚2012 æ¬¾ç‰¹æ–¯æ‹‰ Model S æˆ– 2012 æ¬¾å®é©¬ M3 è½¿è·‘è½¦ã€‚å¹³å‡è€Œè¨€ï¼Œè®­ç»ƒé›†ä¸­æ¯ä¸ªç±»åˆ«æœ‰ 41.5 å¼ å›¾åƒï¼Œæµ‹è¯•é›†ä¸­æœ‰ 40.5 å¼ å›¾åƒã€‚</p>
<h1 id="2-è®¾ç½®ç¯å¢ƒå¹¶åŠ è½½æ•°æ®"><a href="#2-è®¾ç½®ç¯å¢ƒå¹¶åŠ è½½æ•°æ®" class="headerlink" title="2. è®¾ç½®ç¯å¢ƒå¹¶åŠ è½½æ•°æ®"></a>2. è®¾ç½®ç¯å¢ƒå¹¶åŠ è½½æ•°æ®</h1><h2 id="2-1-ä¸‹è½½è¯»å–æ•°æ®"><a href="#2-1-ä¸‹è½½è¯»å–æ•°æ®" class="headerlink" title="2.1 ä¸‹è½½è¯»å–æ•°æ®"></a>2.1 ä¸‹è½½è¯»å–æ•°æ®</h2><figure class="highlight python"><table><tr><td class="code"><pre><code class="hljs python"><span class="hljs-comment">#æå–ç±»åˆ«åï¼š</span><br><span class="hljs-keyword">import</span> scipy.io<br> <br>data = scipy.io.loadmat(<span class="hljs-string">&#x27;data/cars_annos.mat&#x27;</span>)<br>class_names = data[<span class="hljs-string">&#x27;class_names&#x27;</span>]<br>f_class = <span class="hljs-built_in">open</span>(<span class="hljs-string">&#x27;./label_map.txt&#x27;</span>,<span class="hljs-string">&#x27;w&#x27;</span>)<br> <br>num = <span class="hljs-number">1</span><br><span class="hljs-keyword">for</span> j <span class="hljs-keyword">in</span> <span class="hljs-built_in">range</span>(class_names.shape[<span class="hljs-number">1</span>]):<br>    class_name = <span class="hljs-built_in">str</span>(class_names[<span class="hljs-number">0</span>,j][<span class="hljs-number">0</span>]).replace(<span class="hljs-string">&#x27; &#x27;</span>,<span class="hljs-string">&#x27;_&#x27;</span>)<br>    <span class="hljs-built_in">print</span>(num,class_name)<br>    f_class.write( <span class="hljs-built_in">str</span>(num) + <span class="hljs-string">&#x27; &#x27;</span> + class_name + <span class="hljs-string">&#x27;\n&#x27;</span>)<br>    num = num + <span class="hljs-number">1</span><br>f_class.close()<br><br><br></code></pre></td></tr></table></figure>

<pre><code class="hljs">1 AM_General_Hummer_SUV_2000
2 Acura_RL_Sedan_2012
3 Acura_TL_Sedan_2012
4 Acura_TL_Type-S_2008
5 Acura_TSX_Sedan_2012
6 Acura_Integra_Type_R_2001
7 Acura_ZDX_Hatchback_2012
8 Aston_Martin_V8_Vantage_Convertible_2012
9 Aston_Martin_V8_Vantage_Coupe_2012
10 Aston_Martin_Virage_Convertible_2012
11 Aston_Martin_Virage_Coupe_2012
12 Audi_RS_4_Convertible_2008
13 Audi_A5_Coupe_2012
14 Audi_TTS_Coupe_2012
15 Audi_R8_Coupe_2012
16 Audi_V8_Sedan_1994
17 Audi_100_Sedan_1994
18 Audi_100_Wagon_1994
19 Audi_TT_Hatchback_2011
20 Audi_S6_Sedan_2011
21 Audi_S5_Convertible_2012
22 Audi_S5_Coupe_2012
23 Audi_S4_Sedan_2012
24 Audi_S4_Sedan_2007
25 Audi_TT_RS_Coupe_2012
26 BMW_ActiveHybrid_5_Sedan_2012
27 BMW_1_Series_Convertible_2012
28 BMW_1_Series_Coupe_2012
29 BMW_3_Series_Sedan_2012
30 BMW_3_Series_Wagon_2012
31 BMW_6_Series_Convertible_2007
32 BMW_X5_SUV_2007
33 BMW_X6_SUV_2012
34 BMW_M3_Coupe_2012
35 BMW_M5_Sedan_2010
36 BMW_M6_Convertible_2010
37 BMW_X3_SUV_2012
38 BMW_Z4_Convertible_2012
39 Bentley_Continental_Supersports_Conv._Convertible_2012
40 Bentley_Arnage_Sedan_2009
41 Bentley_Mulsanne_Sedan_2011
42 Bentley_Continental_GT_Coupe_2012
43 Bentley_Continental_GT_Coupe_2007
44 Bentley_Continental_Flying_Spur_Sedan_2007
45 Bugatti_Veyron_16.4_Convertible_2009
46 Bugatti_Veyron_16.4_Coupe_2009
47 Buick_Regal_GS_2012
48 Buick_Rainier_SUV_2007
49 Buick_Verano_Sedan_2012
50 Buick_Enclave_SUV_2012
51 Cadillac_CTS-V_Sedan_2012
52 Cadillac_SRX_SUV_2012
53 Cadillac_Escalade_EXT_Crew_Cab_2007
54 Chevrolet_Silverado_1500_Hybrid_Crew_Cab_2012
55 Chevrolet_Corvette_Convertible_2012
56 Chevrolet_Corvette_ZR1_2012
57 Chevrolet_Corvette_Ron_Fellows_Edition_Z06_2007
58 Chevrolet_Traverse_SUV_2012
59 Chevrolet_Camaro_Convertible_2012
60 Chevrolet_HHR_SS_2010
61 Chevrolet_Impala_Sedan_2007
62 Chevrolet_Tahoe_Hybrid_SUV_2012
63 Chevrolet_Sonic_Sedan_2012
64 Chevrolet_Express_Cargo_Van_2007
65 Chevrolet_Avalanche_Crew_Cab_2012
66 Chevrolet_Cobalt_SS_2010
67 Chevrolet_Malibu_Hybrid_Sedan_2010
68 Chevrolet_TrailBlazer_SS_2009
69 Chevrolet_Silverado_2500HD_Regular_Cab_2012
70 Chevrolet_Silverado_1500_Classic_Extended_Cab_2007
71 Chevrolet_Express_Van_2007
72 Chevrolet_Monte_Carlo_Coupe_2007
73 Chevrolet_Malibu_Sedan_2007
74 Chevrolet_Silverado_1500_Extended_Cab_2012
75 Chevrolet_Silverado_1500_Regular_Cab_2012
76 Chrysler_Aspen_SUV_2009
77 Chrysler_Sebring_Convertible_2010
78 Chrysler_Town_and_Country_Minivan_2012
79 Chrysler_300_SRT-8_2010
80 Chrysler_Crossfire_Convertible_2008
81 Chrysler_PT_Cruiser_Convertible_2008
82 Daewoo_Nubira_Wagon_2002
83 Dodge_Caliber_Wagon_2012
84 Dodge_Caliber_Wagon_2007
85 Dodge_Caravan_Minivan_1997
86 Dodge_Ram_Pickup_3500_Crew_Cab_2010
87 Dodge_Ram_Pickup_3500_Quad_Cab_2009
88 Dodge_Sprinter_Cargo_Van_2009
89 Dodge_Journey_SUV_2012
90 Dodge_Dakota_Crew_Cab_2010
91 Dodge_Dakota_Club_Cab_2007
92 Dodge_Magnum_Wagon_2008
93 Dodge_Challenger_SRT8_2011
94 Dodge_Durango_SUV_2012
95 Dodge_Durango_SUV_2007
96 Dodge_Charger_Sedan_2012
97 Dodge_Charger_SRT-8_2009
98 Eagle_Talon_Hatchback_1998
99 FIAT_500_Abarth_2012
100 FIAT_500_Convertible_2012
101 Ferrari_FF_Coupe_2012
102 Ferrari_California_Convertible_2012
103 Ferrari_458_Italia_Convertible_2012
104 Ferrari_458_Italia_Coupe_2012
105 Fisker_Karma_Sedan_2012
106 Ford_F-450_Super_Duty_Crew_Cab_2012
107 Ford_Mustang_Convertible_2007
108 Ford_Freestar_Minivan_2007
109 Ford_Expedition_EL_SUV_2009
110 Ford_Edge_SUV_2012
111 Ford_Ranger_SuperCab_2011
112 Ford_GT_Coupe_2006
113 Ford_F-150_Regular_Cab_2012
114 Ford_F-150_Regular_Cab_2007
115 Ford_Focus_Sedan_2007
116 Ford_E-Series_Wagon_Van_2012
117 Ford_Fiesta_Sedan_2012
118 GMC_Terrain_SUV_2012
119 GMC_Savana_Van_2012
120 GMC_Yukon_Hybrid_SUV_2012
121 GMC_Acadia_SUV_2012
122 GMC_Canyon_Extended_Cab_2012
123 Geo_Metro_Convertible_1993
124 HUMMER_H3T_Crew_Cab_2010
125 HUMMER_H2_SUT_Crew_Cab_2009
126 Honda_Odyssey_Minivan_2012
127 Honda_Odyssey_Minivan_2007
128 Honda_Accord_Coupe_2012
129 Honda_Accord_Sedan_2012
130 Hyundai_Veloster_Hatchback_2012
131 Hyundai_Santa_Fe_SUV_2012
132 Hyundai_Tucson_SUV_2012
133 Hyundai_Veracruz_SUV_2012
134 Hyundai_Sonata_Hybrid_Sedan_2012
135 Hyundai_Elantra_Sedan_2007
136 Hyundai_Accent_Sedan_2012
137 Hyundai_Genesis_Sedan_2012
138 Hyundai_Sonata_Sedan_2012
139 Hyundai_Elantra_Touring_Hatchback_2012
140 Hyundai_Azera_Sedan_2012
141 Infiniti_G_Coupe_IPL_2012
142 Infiniti_QX56_SUV_2011
143 Isuzu_Ascender_SUV_2008
144 Jaguar_XK_XKR_2012
145 Jeep_Patriot_SUV_2012
146 Jeep_Wrangler_SUV_2012
147 Jeep_Liberty_SUV_2012
148 Jeep_Grand_Cherokee_SUV_2012
149 Jeep_Compass_SUV_2012
150 Lamborghini_Reventon_Coupe_2008
151 Lamborghini_Aventador_Coupe_2012
152 Lamborghini_Gallardo_LP_570-4_Superleggera_2012
153 Lamborghini_Diablo_Coupe_2001
154 Land_Rover_Range_Rover_SUV_2012
155 Land_Rover_LR2_SUV_2012
156 Lincoln_Town_Car_Sedan_2011
157 MINI_Cooper_Roadster_Convertible_2012
158 Maybach_Landaulet_Convertible_2012
159 Mazda_Tribute_SUV_2011
160 McLaren_MP4-12C_Coupe_2012
161 Mercedes-Benz_300-Class_Convertible_1993
162 Mercedes-Benz_C-Class_Sedan_2012
163 Mercedes-Benz_SL-Class_Coupe_2009
164 Mercedes-Benz_E-Class_Sedan_2012
165 Mercedes-Benz_S-Class_Sedan_2012
166 Mercedes-Benz_Sprinter_Van_2012
167 Mitsubishi_Lancer_Sedan_2012
168 Nissan_Leaf_Hatchback_2012
169 Nissan_NV_Passenger_Van_2012
170 Nissan_Juke_Hatchback_2012
171 Nissan_240SX_Coupe_1998
172 Plymouth_Neon_Coupe_1999
173 Porsche_Panamera_Sedan_2012
174 Ram_C/V_Cargo_Van_Minivan_2012
175 Rolls-Royce_Phantom_Drophead_Coupe_Convertible_2012
176 Rolls-Royce_Ghost_Sedan_2012
177 Rolls-Royce_Phantom_Sedan_2012
178 Scion_xD_Hatchback_2012
179 Spyker_C8_Convertible_2009
180 Spyker_C8_Coupe_2009
181 Suzuki_Aerio_Sedan_2007
182 Suzuki_Kizashi_Sedan_2012
183 Suzuki_SX4_Hatchback_2012
184 Suzuki_SX4_Sedan_2012
185 Tesla_Model_S_Sedan_2012
186 Toyota_Sequoia_SUV_2012
187 Toyota_Camry_Sedan_2012
188 Toyota_Corolla_Sedan_2012
189 Toyota_4Runner_SUV_2012
190 Volkswagen_Golf_Hatchback_2012
191 Volkswagen_Golf_Hatchback_1991
192 Volkswagen_Beetle_Hatchback_2012
193 Volvo_C30_Hatchback_2012
194 Volvo_240_Sedan_1993
195 Volvo_XC90_SUV_2007
196 smart_fortwo_Convertible_2012
</code></pre>
<figure class="highlight python"><table><tr><td class="code"><pre><code class="hljs python"><span class="hljs-comment">#æå– åºå·, å›¾ç‰‡å, ç±»åˆ«, å±äºæµ‹è¯•é›†è¿˜æ˜¯è®­ç»ƒé›†(0,1è¡¨ç¤º)</span><br><span class="hljs-keyword">import</span> scipy.io<br> <br>data = scipy.io.loadmat(<span class="hljs-string">&#x27;data/cars_annos.mat&#x27;</span>)<br>annotations = data[<span class="hljs-string">&#x27;annotations&#x27;</span>]<br>f_train = <span class="hljs-built_in">open</span>(<span class="hljs-string">&#x27;data/mat2txt.txt&#x27;</span>,<span class="hljs-string">&#x27;w&#x27;</span>)<br><br>num = <span class="hljs-number">1</span><br><span class="hljs-keyword">for</span> i <span class="hljs-keyword">in</span> <span class="hljs-built_in">range</span>(annotations.shape[<span class="hljs-number">1</span>]):<br>    name = <span class="hljs-built_in">str</span>(annotations[<span class="hljs-number">0</span>,i][<span class="hljs-number">0</span>])[<span class="hljs-number">2</span>:-<span class="hljs-number">2</span>]<br>    test  = <span class="hljs-built_in">int</span>(annotations[<span class="hljs-number">0</span>,i][<span class="hljs-number">6</span>])<br>    clas = <span class="hljs-built_in">int</span>(annotations[<span class="hljs-number">0</span>,i][<span class="hljs-number">5</span>])<br><br>    name = <span class="hljs-built_in">str</span>(name)<br>    clas = <span class="hljs-built_in">str</span>(clas)<br>    test = <span class="hljs-built_in">str</span>(test)<br>    f_train.write(<span class="hljs-built_in">str</span>(num) + <span class="hljs-string">&#x27; &#x27;</span> + name + <span class="hljs-string">&#x27; &#x27;</span> + clas + <span class="hljs-string">&#x27; &#x27;</span> + test+<span class="hljs-string">&#x27;\n&#x27;</span>)<br>    num = num + <span class="hljs-number">1</span><br> <br>f_train.close()<br><br></code></pre></td></tr></table></figure>


<figure class="highlight python"><table><tr><td class="code"><pre><code class="hljs python"><span class="hljs-comment">#æŒ‰åˆ†ç±»é‡å†™æ–‡ä»¶å¤¹</span><br><span class="hljs-comment"># coding=utf-8</span><br><span class="hljs-keyword">import</span> shutil<br><span class="hljs-keyword">import</span> sys<br><span class="hljs-keyword">import</span> scipy.io <span class="hljs-keyword">as</span> scio<br><span class="hljs-keyword">import</span> os<br><span class="hljs-keyword">import</span> numpy <span class="hljs-keyword">as</span> np<br><br><span class="hljs-keyword">def</span> <span class="hljs-title function_">cub2dang</span>():<br>    <span class="hljs-keyword">if</span> sys.getdefaultencoding() != <span class="hljs-string">&#x27;utf-8&#x27;</span>:<br>        reload(sys)<br>        sys.setdefaultencoding(<span class="hljs-string">&#x27;utf-8&#x27;</span>)<br>    data = scio.loadmat(<span class="hljs-string">&#x27;data/cars_annos.mat&#x27;</span>)<br>   <br>    newPath_train = <span class="hljs-string">&quot;data/train&quot;</span><br>    newPath_test = <span class="hljs-string">&quot;data/test&quot;</span><br>    images = data[<span class="hljs-string">&#x27;annotations&#x27;</span>][<span class="hljs-number">0</span>]<br>    classes = data[<span class="hljs-string">&#x27;class_names&#x27;</span>][<span class="hljs-number">0</span>]<br>    num_images = images.size<br>    <span class="hljs-built_in">print</span>(num_images)<br>    <span class="hljs-keyword">for</span> i <span class="hljs-keyword">in</span> <span class="hljs-built_in">range</span>(<span class="hljs-number">0</span>,<span class="hljs-built_in">int</span>(num_images/<span class="hljs-number">2</span>)):<br>        <br>        image_path = os.path.join(<span class="hljs-string">&#x27;data/&#x27;</span>,images[i][<span class="hljs-number">0</span>][<span class="hljs-number">0</span>])<br>        <br>        file_name = images[i][<span class="hljs-number">0</span>][<span class="hljs-number">0</span>]  <span class="hljs-comment"># æ–‡ä»¶å</span><br>        file_name = file_name.split(<span class="hljs-string">&#x27;/&#x27;</span>)[<span class="hljs-number">1</span>].encode(<span class="hljs-string">&#x27;utf-8&#x27;</span>)<br>        classid = images[i][<span class="hljs-number">5</span>][<span class="hljs-number">0</span>][<span class="hljs-number">0</span>]  <span class="hljs-comment"># ç±»åˆ«</span><br>        <span class="hljs-comment"># classid=np.array2string(classid)</span><br>        classid = classid.astype(np.int32)<br>        <span class="hljs-built_in">id</span> = classes[classid-<span class="hljs-number">1</span>][<span class="hljs-number">0</span>]<br>        file_name_new = os.path.join(<span class="hljs-built_in">id</span>, file_name.decode())<br><br>        istest = images[i][<span class="hljs-number">6</span>][<span class="hljs-number">0</span>]  <span class="hljs-comment"># train/test</span><br>        <span class="hljs-keyword">if</span> istest:<br>            <span class="hljs-keyword">if</span> <span class="hljs-keyword">not</span> os.path.exists(os.path.join(newPath_test, <span class="hljs-built_in">id</span>)):<br>                os.makedirs(os.path.join(newPath_test, <span class="hljs-built_in">id</span>))<br>            shutil.copy(image_path, os.path.join(newPath_test, file_name_new))<br>            <span class="hljs-keyword">with</span> <span class="hljs-built_in">open</span>(<span class="hljs-string">&#x27;data/car_test.txt&#x27;</span>, <span class="hljs-string">&#x27;a&#x27;</span>) <span class="hljs-keyword">as</span> f:<br>                f.write(<span class="hljs-string">&#x27;&#123;&#125; &#123;&#125;\n&#x27;</span>.<span class="hljs-built_in">format</span>(file_name_new, classid))<br><br>        <span class="hljs-keyword">if</span> <span class="hljs-keyword">not</span> istest:<br>            <span class="hljs-keyword">if</span> <span class="hljs-keyword">not</span> os.path.exists(os.path.join(newPath_train, <span class="hljs-built_in">id</span>)):<br>                os.makedirs(os.path.join(newPath_train, <span class="hljs-built_in">id</span>))<br>            shutil.copy(image_path, os.path.join(newPath_train, file_name_new))<br>            <span class="hljs-keyword">with</span> <span class="hljs-built_in">open</span>(<span class="hljs-string">&#x27;data/car_train.txt&#x27;</span>, <span class="hljs-string">&#x27;a&#x27;</span>) <span class="hljs-keyword">as</span> f:<br>                f.write(<span class="hljs-string">&#x27;&#123;&#125; &#123;&#125;\n&#x27;</span>.<span class="hljs-built_in">format</span>(file_name_new, classid))<br>    <span class="hljs-built_in">print</span>(i)<br>cub2dang()<br></code></pre></td></tr></table></figure>

<pre><code class="hljs">16185
8091
</code></pre>
<figure class="highlight python"><table><tr><td class="code"><pre><code class="hljs python"><br><span class="hljs-comment">#!python -m pip install --pre torch torchvision torchaudio --extra-index-url https://download.pytorch.org/whl/nightly/cpu                                                                                                   î‚² âœ” î‚² 14:46:26</span><br><span class="hljs-comment">#!pip install torchvision==0.14.0</span><br><br></code></pre></td></tr></table></figure>

<h2 id="2-2-å¯¼å…¥åŒ…"><a href="#2-2-å¯¼å…¥åŒ…" class="headerlink" title="2.2 å¯¼å…¥åŒ…"></a>2.2 å¯¼å…¥åŒ…</h2><figure class="highlight python"><table><tr><td class="code"><pre><code class="hljs python"><span class="hljs-keyword">import</span> matplotlib.pyplot <span class="hljs-keyword">as</span> plt<br><span class="hljs-keyword">import</span> numpy <span class="hljs-keyword">as</span> np<br><br><span class="hljs-keyword">import</span> torch<br><span class="hljs-keyword">import</span> torch.nn <span class="hljs-keyword">as</span> nn<br><span class="hljs-keyword">import</span> torch.optim <span class="hljs-keyword">as</span> optim<br><span class="hljs-keyword">import</span> torchvision<br><span class="hljs-keyword">import</span> torchvision.models <span class="hljs-keyword">as</span> models<br><span class="hljs-keyword">import</span> torchvision.transforms <span class="hljs-keyword">as</span> transforms<br><br><span class="hljs-keyword">import</span> time<br><span class="hljs-keyword">import</span> os<br><span class="hljs-keyword">import</span> tqdm<br><span class="hljs-keyword">import</span> PIL.Image <span class="hljs-keyword">as</span> Image<br><span class="hljs-keyword">from</span> IPython.display <span class="hljs-keyword">import</span> display<br><br><span class="hljs-comment">#print(torch.backends.mps.is_built())</span><br>device = torch.device(<span class="hljs-string">&quot;mps&quot;</span>)<br><span class="hljs-built_in">print</span>(device)<br><br><span class="hljs-comment">#print(torch.cuda.get_device_name(device))</span><br></code></pre></td></tr></table></figure>

<pre><code class="hljs">mps
</code></pre>
<h1 id="3-å»ºæ¨¡"><a href="#3-å»ºæ¨¡" class="headerlink" title="3. å»ºæ¨¡"></a>3. å»ºæ¨¡</h1><h2 id="3-1-åŠ è½½æ•°æ®"><a href="#3-1-åŠ è½½æ•°æ®" class="headerlink" title="3.1 åŠ è½½æ•°æ®"></a>3.1 åŠ è½½æ•°æ®</h2><figure class="highlight python"><table><tr><td class="code"><pre><code class="hljs python">dataset_dir = <span class="hljs-string">&quot;data/&quot;</span><br><br><br>width, height = <span class="hljs-number">224</span>, <span class="hljs-number">224</span><br>train_tfms = transforms.Compose([transforms.Resize((width, height)),<br>                                 torchvision.transforms.AutoAugment(),<br>                                 transforms.RandomHorizontalFlip(),<br>                                 transforms.RandomRotation(<span class="hljs-number">15</span>),<br>                                 transforms.ToTensor(),<br>                                 transforms.Normalize([<span class="hljs-number">0.485</span>, <span class="hljs-number">0.456</span>, <span class="hljs-number">0.406</span>], [<span class="hljs-number">0.229</span>, <span class="hljs-number">0.224</span>, <span class="hljs-number">0.225</span>])])<br>test_tfms = transforms.Compose([transforms.Resize((width, height)),<br>                                transforms.ToTensor(),<br>                                transforms.Normalize([<span class="hljs-number">0.485</span>, <span class="hljs-number">0.456</span>, <span class="hljs-number">0.406</span>], [<span class="hljs-number">0.229</span>, <span class="hljs-number">0.224</span>, <span class="hljs-number">0.225</span>])])<br></code></pre></td></tr></table></figure>


<figure class="highlight python"><table><tr><td class="code"><pre><code class="hljs python"><span class="hljs-comment"># create datasets</span><br>dataset = torchvision.datasets.ImageFolder(root = dataset_dir + <span class="hljs-string">&quot;train&quot;</span>, transform = train_tfms)<br>trainloader = torch.utils.data.DataLoader(dataset, batch_size = <span class="hljs-number">32</span>, shuffle = <span class="hljs-literal">True</span>, num_workers = <span class="hljs-number">2</span>)<br><br>dataset2 = torchvision.datasets.ImageFolder(root = dataset_dir + <span class="hljs-string">&quot;test&quot;</span>, transform = test_tfms)<br>testloader = torch.utils.data.DataLoader(dataset2, batch_size = <span class="hljs-number">32</span>, shuffle = <span class="hljs-literal">False</span>, num_workers = <span class="hljs-number">2</span>)<br></code></pre></td></tr></table></figure>

<h2 id="3-2-å®šä¹‰è®­ç»ƒæ¨¡å‹å‡½æ•°"><a href="#3-2-å®šä¹‰è®­ç»ƒæ¨¡å‹å‡½æ•°" class="headerlink" title="3.2 å®šä¹‰è®­ç»ƒæ¨¡å‹å‡½æ•°"></a>3.2 å®šä¹‰è®­ç»ƒæ¨¡å‹å‡½æ•°</h2><figure class="highlight python"><table><tr><td class="code"><pre><code class="hljs python"><span class="hljs-keyword">def</span> <span class="hljs-title function_">train_model</span>(<span class="hljs-params">model, criterion, optimizer, scheduler, n_epochs=<span class="hljs-number">5</span></span>):<br>    <br>  losses = []<br>  accuracies = []<br>  test_accuracies = []<br><br>  <span class="hljs-comment"># å°†æ¨¡å‹åˆå§‹åŒ–è®¾ä¸ºè®­ç»ƒæ¨¡å¼</span><br>  model.train()<br>  <span class="hljs-keyword">for</span> epoch <span class="hljs-keyword">in</span> tqdm.tqdm(<span class="hljs-built_in">range</span>(n_epochs)):<br>    since = time.time()<br>    running_loss = <span class="hljs-number">0.0</span><br>    running_correct = <span class="hljs-number">0.0</span><br>    <span class="hljs-keyword">for</span> i, data <span class="hljs-keyword">in</span> <span class="hljs-built_in">enumerate</span>(trainloader, <span class="hljs-number">0</span>):<br><br>      <span class="hljs-comment"># è·å–è¾“å…¥å¹¶å°†å…¶åˆ†é…ç»™mps</span><br>      inputs, labels = data<br>      inputs = inputs.to(device)<br>      labels = labels.to(device)<br>      optimizer.zero_grad()<br>            <br>      <span class="hljs-comment"># forward + backward + optimize</span><br>      outputs = model(inputs)<br>      _, predicted = torch.<span class="hljs-built_in">max</span>(outputs.data, <span class="hljs-number">1</span>)<br>      loss = criterion(outputs, labels)<br>      loss.backward()<br>      optimizer.step()<br>            <br>      <span class="hljs-comment"># è®¡ç®—loss/acc </span><br>      running_loss += loss.item()<br>      running_correct += (labels == predicted).<span class="hljs-built_in">sum</span>().item()<br><br>    epoch_duration = time.time() - since<br>    epoch_loss = running_loss / <span class="hljs-built_in">len</span>(trainloader)<br>    epoch_acc = <span class="hljs-number">100</span> / <span class="hljs-number">32</span> * running_correct / <span class="hljs-built_in">len</span>(trainloader)<br>    <span class="hljs-built_in">print</span>(<span class="hljs-string">&quot;Epoch %s, duration: %d s, loss: %.4f, acc: %.4f&quot;</span> % (epoch + <span class="hljs-number">1</span>, epoch_duration, epoch_loss, epoch_acc))<br>        <br>    losses.append(epoch_loss)<br>    accuracies.append(epoch_acc)<br>        <br>    <span class="hljs-comment"># å°†æ¨¡å¼è½¬åŒ–ä¸ºè¯„ä¼°æ¨¡å¼ä½¿ç”¨testæ•°æ®é›†</span><br>    model.<span class="hljs-built_in">eval</span>()<br>    test_acc = eval_model(model)<br>    test_accuracies.append(test_acc)<br>        <br>    <span class="hljs-comment"># åœ¨éªŒè¯åå°†æ¨¡å¼æ”¹å›è®­ç»ƒ</span><br>    model.train()<br>    scheduler.step(test_acc)<br>    <br>    since = time.time()<br>  <span class="hljs-built_in">print</span>(<span class="hljs-string">&#x27;Finished Training&#x27;</span>)<br>  <span class="hljs-keyword">return</span> model, losses, accuracies, test_accuracies<br></code></pre></td></tr></table></figure>

<h2 id="3-3-å®šä¹‰æ¨¡å‹è¯„ä»·å‡½æ•°"><a href="#3-3-å®šä¹‰æ¨¡å‹è¯„ä»·å‡½æ•°" class="headerlink" title="3.3 å®šä¹‰æ¨¡å‹è¯„ä»·å‡½æ•°"></a>3.3 å®šä¹‰æ¨¡å‹è¯„ä»·å‡½æ•°</h2><figure class="highlight python"><table><tr><td class="code"><pre><code class="hljs python"><span class="hljs-keyword">def</span> <span class="hljs-title function_">eval_model</span>(<span class="hljs-params">model</span>):<br>  correct = <span class="hljs-number">0.0</span><br>  total = <span class="hljs-number">0.0</span><br>  <span class="hljs-keyword">with</span> torch.no_grad():<br>    <span class="hljs-keyword">for</span> i, data <span class="hljs-keyword">in</span> <span class="hljs-built_in">enumerate</span>(testloader, <span class="hljs-number">0</span>):<br>      images, labels = data<br>      images = images.to(device)<br>      labels = labels.to(device)<br>      outputs = model_ft(images)<br>      _, predicted = torch.<span class="hljs-built_in">max</span>(outputs.data, <span class="hljs-number">1</span>)<br><br>      total += labels.size(<span class="hljs-number">0</span>)<br>      correct += (predicted == labels).<span class="hljs-built_in">sum</span>().item()<br><br>  test_acc = <span class="hljs-number">100.0</span> * correct / total<br>  <span class="hljs-built_in">print</span>(<span class="hljs-string">&#x27;Accuracy of the network on the test images: %d %%&#x27;</span> % (test_acc))<br>  <span class="hljs-keyword">return</span> test_acc<br></code></pre></td></tr></table></figure>

<h1 id="4-ä½¿ç”¨-ResNet34-å®ç°Â¶"><a href="#4-ä½¿ç”¨-ResNet34-å®ç°Â¶" class="headerlink" title="4. ä½¿ç”¨ ResNet34 å®ç°Â¶"></a>4. ä½¿ç”¨ ResNet34 å®ç°Â¶</h1><h2 id="4-1-å®šä¹‰æ¨¡å‹å‚æ•°"><a href="#4-1-å®šä¹‰æ¨¡å‹å‚æ•°" class="headerlink" title="4.1 å®šä¹‰æ¨¡å‹å‚æ•°"></a>4.1 å®šä¹‰æ¨¡å‹å‚æ•°</h2><figure class="highlight python"><table><tr><td class="code"><pre><code class="hljs python"><span class="hljs-comment">#ResNet34:</span><br>NUM_CAR_CLASSES = <span class="hljs-number">98</span><br><br>model_ft = models.resnet34(weights = <span class="hljs-literal">True</span>)<br><br>num_ftrs = model_ft.fc.in_features<br>model_ft.fc = nn.Linear(num_ftrs, NUM_CAR_CLASSES)<br>model_ft = model_ft.to(device)<br><br>criterion = nn.CrossEntropyLoss()<br><br>optimizer = optim.SGD(model_ft.parameters(), lr = <span class="hljs-number">0.01</span>, momentum = <span class="hljs-number">0.9</span>)<br><br>lrscheduler = optim.lr_scheduler.ReduceLROnPlateau(optimizer, mode = <span class="hljs-string">&#x27;max&#x27;</span>, patience = <span class="hljs-number">3</span>, threshold = <span class="hljs-number">0.9</span>)<br></code></pre></td></tr></table></figure>

<pre><code class="hljs">/Users/gawaintan/miniforge3/envs/FastAi/lib/python3.8/site-packages/torchvision/models/_utils.py:223: UserWarning: Arguments other than a weight enum or `None` for &#39;weights&#39; are deprecated since 0.13 and may be removed in the future. The current behavior is equivalent to passing `weights=ResNet34_Weights.IMAGENET1K_V1`. You can also use `weights=ResNet34_Weights.DEFAULT` to get the most up-to-date weights.
  warnings.warn(msg)
</code></pre>
<h2 id="4-2-è®­ç»ƒ"><a href="#4-2-è®­ç»ƒ" class="headerlink" title="4.2 è®­ç»ƒ"></a>4.2 è®­ç»ƒ</h2><figure class="highlight python"><table><tr><td class="code"><pre><code class="hljs python"><span class="hljs-comment"># ResNet:</span><br>model_ft_res, training_losses_res, training_accs_res, test_accs_res = train_model(model_ft, criterion, optimizer, lrscheduler, n_epochs=<span class="hljs-number">12</span>)<br></code></pre></td></tr></table></figure>

<pre><code class="hljs">  0%|                                                                                                                                                                                                                  | 0/12 [00:00&lt;?, ?it/s]

Epoch 1, duration: 109 s, loss: 4.1009, acc: 9.3994


  8%|â–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–Š                                                                                                                                                                                        | 1/12 [02:34&lt;28:22, 154.73s/it]

Accuracy of the network on the test images: 24 %
Epoch 2, duration: 113 s, loss: 2.3972, acc: 34.3994


 17%|â–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–Œ                                                                                                                                                                       | 2/12 [05:15&lt;26:25, 158.51s/it]

Accuracy of the network on the test images: 34 %
Epoch 3, duration: 117 s, loss: 1.7940, acc: 48.6328


 25%|â–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–                                                                                                                                                      | 3/12 [07:58&lt;24:03, 160.39s/it]

Accuracy of the network on the test images: 35 %
Epoch 4, duration: 114 s, loss: 1.4076, acc: 58.3984


 33%|â–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆ                                                                                                                                      | 4/12 [10:36&lt;21:16, 159.59s/it]

Accuracy of the network on the test images: 48 %
Epoch 5, duration: 119 s, loss: 1.1524, acc: 64.6973


 42%|â–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–Š                                                                                                                     | 5/12 [13:22&lt;18:52, 161.84s/it]

Accuracy of the network on the test images: 48 %
Epoch 6, duration: 119 s, loss: 0.9919, acc: 69.3848


 50%|â–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–Œ                                                                                                    | 6/12 [16:06&lt;16:14, 162.44s/it]

Accuracy of the network on the test images: 61 %
Epoch 7, duration: 122 s, loss: 0.8873, acc: 72.2656


 58%|â–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–                                                                                   | 7/12 [18:54&lt;13:41, 164.33s/it]

Accuracy of the network on the test images: 61 %
Epoch 8, duration: 123 s, loss: 0.7274, acc: 77.3193


 67%|â–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆ                                                                   | 8/12 [21:42&lt;11:01, 165.34s/it]

Accuracy of the network on the test images: 64 %
Epoch 9, duration: 127 s, loss: 0.4055, acc: 87.5000


 75%|â–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–Š                                                  | 9/12 [24:30&lt;08:19, 166.45s/it]

Accuracy of the network on the test images: 80 %
Epoch 10, duration: 127 s, loss: 0.2865, acc: 91.0400


 83%|â–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–‹                                 | 10/12 [27:22&lt;05:35, 167.97s/it]

Accuracy of the network on the test images: 81 %
Epoch 11, duration: 131 s, loss: 0.2480, acc: 92.3828


 92%|â–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–                | 11/12 [30:20&lt;02:51, 171.06s/it]

Accuracy of the network on the test images: 82 %
Epoch 12, duration: 139 s, loss: 0.2195, acc: 93.5547


100%|â–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆ| 12/12 [33:26&lt;00:00, 167.24s/it]

Accuracy of the network on the test images: 82 %
Finished Training
</code></pre>
<p>è¯¥æ¨¡å‹åœ¨12ä¸ªepochè®­ç»ƒåè®­ç»ƒå‡†ç¡®åº¦åˆ°äº†94%ï¼Œæµ‹è¯•å‡†ç¡®åº¦åˆ°äº†82%ã€‚</p>
<figure class="highlight python"><table><tr><td class="code"><pre><code class="hljs python"><span class="hljs-comment"># ç”»ç»Ÿè®¡å›¾</span><br>f, axarr = plt.subplots(<span class="hljs-number">2</span>,<span class="hljs-number">2</span>, figsize = (<span class="hljs-number">12</span>, <span class="hljs-number">8</span>))<br>axarr[<span class="hljs-number">0</span>, <span class="hljs-number">0</span>].plot(training_losses_res)<br>axarr[<span class="hljs-number">0</span>, <span class="hljs-number">0</span>].set_title(<span class="hljs-string">&quot;Training loss&quot;</span>)<br>axarr[<span class="hljs-number">0</span>, <span class="hljs-number">1</span>].plot(training_accs_res)<br>axarr[<span class="hljs-number">0</span>, <span class="hljs-number">1</span>].set_title(<span class="hljs-string">&quot;Training acc&quot;</span>)<br>axarr[<span class="hljs-number">1</span>, <span class="hljs-number">0</span>].plot(test_accs_res)<br>axarr[<span class="hljs-number">1</span>, <span class="hljs-number">0</span>].set_title(<span class="hljs-string">&quot;Test acc&quot;</span>)<br><br></code></pre></td></tr></table></figure>




<pre><code class="hljs">Text(0.5, 1.0, &#39;Test acc&#39;)
</code></pre>
<p><img src="https://ptpimg.me/qqpd2g.png" alt="åœ¨è¿™é‡Œæ’å…¥å›¾ç‰‡æè¿°"><br>)</p>
<h2 id="4-3-åœ¨å•å¼ å›¾ç‰‡ä¸Šè¯„ä¼°æ¨¡å‹"><a href="#4-3-åœ¨å•å¼ å›¾ç‰‡ä¸Šè¯„ä¼°æ¨¡å‹" class="headerlink" title="4.3 åœ¨å•å¼ å›¾ç‰‡ä¸Šè¯„ä¼°æ¨¡å‹"></a>4.3 åœ¨å•å¼ å›¾ç‰‡ä¸Šè¯„ä¼°æ¨¡å‹</h2><p>è¿™ä¸ªæ˜¯æŒ‰å®é™…åœºæ™¯é¢„æµ‹</p>
<figure class="highlight python"><table><tr><td class="code"><pre><code class="hljs python"><span class="hljs-comment"># å…³è”æ–‡ä»¶å’Œå®ƒçš„ç±»å</span><br><br><span class="hljs-keyword">def</span> <span class="hljs-title function_">find_classes</span>(<span class="hljs-params"><span class="hljs-built_in">dir</span></span>):<br>    classes = os.listdir(<span class="hljs-built_in">dir</span>)<br>    classes.sort()<br>    class_to_idx = &#123;classes[i]: i <span class="hljs-keyword">for</span> i <span class="hljs-keyword">in</span> <span class="hljs-built_in">range</span>(<span class="hljs-built_in">len</span>(classes))&#125;<br>    <span class="hljs-keyword">return</span> classes, class_to_idx<br>classes, c_to_idx = find_classes(dataset_dir + <span class="hljs-string">&quot;train&quot;</span>)<br></code></pre></td></tr></table></figure>


<figure class="highlight python"><table><tr><td class="code"><pre><code class="hljs python"><span class="hljs-comment"># å®šä¹‰å‡½æ•°è¯»å–å›¾ç‰‡</span><br><span class="hljs-keyword">def</span> <span class="hljs-title function_">single_img_eval</span>(<span class="hljs-params">model_ft, imgdir</span>):<br><br>  <span class="hljs-comment"># æŠŠæ¨¡å¼åˆ‡æ¢åˆ°è¯„ä¼°</span><br>  model_ft.<span class="hljs-built_in">eval</span>()<br><br>  <span class="hljs-comment"># transformsè¾“å…¥çš„å›¾ç‰‡</span><br>  loader = transforms.Compose([transforms.Resize((<span class="hljs-number">400</span>, <span class="hljs-number">400</span>)),<br>                                  transforms.ToTensor(),<br>                                  transforms.Normalize((<span class="hljs-number">0.5</span>, <span class="hljs-number">0.5</span>, <span class="hljs-number">0.5</span>), (<span class="hljs-number">0.5</span>, <span class="hljs-number">0.5</span>, <span class="hljs-number">0.5</span>))])<br>  image = Image.<span class="hljs-built_in">open</span>(dataset_dir + imgdir)<br>  image = loader(image).<span class="hljs-built_in">float</span>()<br>  <span class="hljs-comment">#è¿™é‡Œä¼šé»˜è®¤cpuï¼Œè‹¥æ˜¯cudaæˆ–è€…mpsä¸€å®šè¦åŠ to(device)</span><br>  image = torch.autograd.Variable(image, requires_grad=<span class="hljs-literal">True</span>).to(device) <br>  <br>  image = image.unsqueeze(<span class="hljs-number">0</span>)<br>  <span class="hljs-comment">#image = image.mps()</span><br>  output = model_ft(image)<br>  conf, predicted = torch.<span class="hljs-built_in">max</span>(output.data, <span class="hljs-number">1</span>)<br><br>  display(Image.<span class="hljs-built_in">open</span>(dataset_dir + imgdir))<br>  <span class="hljs-built_in">print</span>(classes[predicted.item()], <span class="hljs-string">&quot;confidence: &quot;</span>, conf.item())<br></code></pre></td></tr></table></figure>


<figure class="highlight python"><table><tr><td class="code"><pre><code class="hljs python">single_img_eval(model_ft_res, <span class="hljs-string">&quot;test/Chevrolet Traverse SUV 2012/004695.jpg&quot;</span>)<br></code></pre></td></tr></table></figure>


<p><img src="https://ptpimg.me/5672w0.png" alt="åœ¨è¿™é‡Œæ’å…¥å›¾ç‰‡æè¿°"></p>
<pre><code class="hljs">Buick Verano Sedan 2012 confidence:  5.017297267913818
</code></pre>
<figure class="highlight python"><table><tr><td class="code"><pre><code class="hljs python">single_img_eval(model_ft_res, <span class="hljs-string">&quot;test/FIAT 500 Abarth 2012/008089.jpg&quot;</span>)<br></code></pre></td></tr></table></figure>


<p><img src="https://ptpimg.me/qloo1w.png" alt="åœ¨è¿™é‡Œæ’å…¥å›¾ç‰‡æè¿°"></p>
<pre><code class="hljs">FIAT 500 Abarth 2012 confidence:  11.281584739685059
</code></pre>
<figure class="highlight python"><table><tr><td class="code"><pre><code class="hljs python">single_img_eval(model_ft_res, <span class="hljs-string">&quot;test/Aston Martin V8 Vantage Convertible 2012/000623.jpg&quot;</span>)<br></code></pre></td></tr></table></figure>


<p><img src="https://ptpimg.me/2jj563.png" alt="åœ¨è¿™é‡Œæ’å…¥å›¾ç‰‡æè¿°"></p>
<pre><code class="hljs">Aston Martin V8 Vantage Convertible 2012 confidence:  9.173359870910645
</code></pre>
<p>æˆ‘ä»¬ä» ResNet34 é‡‡ç”¨çš„ç½‘ç»œå·²æˆåŠŸå¯¹ä¸‰è¾†æ±½è½¦ä¸­çš„ä¸¤è¾†è¿›è¡Œäº†é«˜ç½®ä¿¡åº¦åˆ†ç±»ã€‚å¯¹äºç¬¬ä¸€è¾†è½¦ï¼Œè¯¥ç½‘ç»œæœªèƒ½åŒºåˆ†Chevroletå’ŒBuickä¸¤ç±»è½¦ã€‚</p>
<h2 id="4-4-ä¿å­˜æ¨¡å‹ä»¥å¤‡å°†æ¥ä½¿ç”¨"><a href="#4-4-ä¿å­˜æ¨¡å‹ä»¥å¤‡å°†æ¥ä½¿ç”¨" class="headerlink" title="4.4 ä¿å­˜æ¨¡å‹ä»¥å¤‡å°†æ¥ä½¿ç”¨"></a>4.4 ä¿å­˜æ¨¡å‹ä»¥å¤‡å°†æ¥ä½¿ç”¨</h2><figure class="highlight python"><table><tr><td class="code"><pre><code class="hljs python">torch.save(model_ft_res.state_dict(), <span class="hljs-string">&#x27;car_model_resnet.pth&#x27;</span>)<br></code></pre></td></tr></table></figure>

<h1 id="5-ä½¿ç”¨-GoogLeNet-å®ç°"><a href="#5-ä½¿ç”¨-GoogLeNet-å®ç°" class="headerlink" title="5. ä½¿ç”¨ GoogLeNet å®ç°"></a>5. ä½¿ç”¨ GoogLeNet å®ç°</h1><h2 id="5-1-å®šä¹‰æ¨¡å‹å‚æ•°"><a href="#5-1-å®šä¹‰æ¨¡å‹å‚æ•°" class="headerlink" title="5.1 å®šä¹‰æ¨¡å‹å‚æ•°"></a>5.1 å®šä¹‰æ¨¡å‹å‚æ•°</h2><figure class="highlight python"><table><tr><td class="code"><pre><code class="hljs python"><span class="hljs-comment"># GoogLeNet:</span><br>NUM_CAR_CLASSES = <span class="hljs-number">98</span><br><br>model_ft = models.googlenet(weights = <span class="hljs-literal">True</span>)<br><br>num_ftrs = model_ft.fc.in_features<br>model_ft.fc = nn.Linear(num_ftrs, NUM_CAR_CLASSES)<br>model_ft = model_ft.to(device)<br><br>optimizer = optim.SGD(model_ft.parameters(), lr = <span class="hljs-number">0.01</span>, momentum = <span class="hljs-number">0.9</span>)<br><br>lrscheduler = optim.lr_scheduler.ReduceLROnPlateau(optimizer, mode = <span class="hljs-string">&#x27;max&#x27;</span>, patience = <span class="hljs-number">3</span>, threshold = <span class="hljs-number">0.9</span>)<br><br></code></pre></td></tr></table></figure>

<h2 id="5-2-è®­ç»ƒ"><a href="#5-2-è®­ç»ƒ" class="headerlink" title="5.2 è®­ç»ƒ"></a>5.2 è®­ç»ƒ</h2><figure class="highlight python"><table><tr><td class="code"><pre><code class="hljs python"><span class="hljs-comment"># GoogLeNet:</span><br>model_ft_google, training_losses_google, training_accs_google, test_accs_google = train_model(model_ft, criterion, optimizer, lrscheduler, n_epochs=<span class="hljs-number">12</span>)<br></code></pre></td></tr></table></figure>

<pre><code class="hljs">  0%|                                                                                                                                                                                                                  | 0/12 [00:00&lt;?, ?it/s]

Epoch 1, duration: 168 s, loss: 3.0864, acc: 23.5596


  8%|â–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–Š                                                                                                                                                                                        | 1/12 [03:22&lt;37:07, 202.47s/it]

Accuracy of the network on the test images: 39 %
Epoch 2, duration: 164 s, loss: 2.0752, acc: 43.7256


 17%|â–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–Œ                                                                                                                                                                       | 2/12 [07:01&lt;35:22, 212.23s/it]

Accuracy of the network on the test images: 51 %
Epoch 3, duration: 164 s, loss: 1.5181, acc: 56.3721


 25%|â–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–                                                                                                                                                      | 3/12 [10:22&lt;31:03, 207.08s/it]

Accuracy of the network on the test images: 62 %
Epoch 4, duration: 182 s, loss: 1.1773, acc: 65.8691


 33%|â–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆ                                                                                                                                      | 4/12 [14:01&lt;28:15, 211.89s/it]

Accuracy of the network on the test images: 66 %
Epoch 5, duration: 130 s, loss: 0.9473, acc: 71.5088


 42%|â–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–Š                                                                                                                     | 5/12 [16:49&lt;22:52, 196.12s/it]

Accuracy of the network on the test images: 69 %
Epoch 6, duration: 106 s, loss: 0.6231, acc: 82.9834


 50%|â–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–Œ                                                                                                    | 6/12 [19:15&lt;17:54, 179.04s/it]

Accuracy of the network on the test images: 79 %
Epoch 7, duration: 135 s, loss: 0.5321, acc: 86.5234


 58%|â–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–                                                                                   | 7/12 [22:10&lt;14:47, 177.47s/it]

Accuracy of the network on the test images: 80 %
Epoch 8, duration: 137 s, loss: 0.4982, acc: 86.7920


 67%|â–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆ                                                                   | 8/12 [25:08&lt;11:50, 177.72s/it]

Accuracy of the network on the test images: 81 %
Epoch 9, duration: 147 s, loss: 0.4649, acc: 88.9404


 75%|â–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–Š                                                  | 9/12 [28:16&lt;09:03, 181.11s/it]

Accuracy of the network on the test images: 81 %
Epoch 10, duration: 154 s, loss: 0.4419, acc: 89.3799


 83%|â–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–‹                                 | 10/12 [31:34&lt;06:12, 186.29s/it]

Accuracy of the network on the test images: 81 %
Epoch 11, duration: 172 s, loss: 0.4061, acc: 89.9170


 92%|â–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–                | 11/12 [35:12&lt;03:15, 195.96s/it]

Accuracy of the network on the test images: 81 %
Epoch 12, duration: 156 s, loss: 0.4121, acc: 89.9170


100%|â–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆ| 12/12 [38:28&lt;00:00, 192.34s/it]

Accuracy of the network on the test images: 81 %
Finished Training
</code></pre>
<p>åŒæ ·ï¼Œæˆ‘ä»¬è§‚å¯Ÿåˆ°ç½‘ç»œåœ¨epoch12 è¾¾åˆ°å…¶å³°å€¼æ€§èƒ½ï¼ˆ90% çš„è®­ç»ƒå‡†ç¡®ç‡å’Œ 81% çš„æµ‹è¯•å‡†ç¡®ç‡ï¼‰ã€‚</p>
<figure class="highlight python"><table><tr><td class="code"><pre><code class="hljs python"><span class="hljs-comment"># plot the stats</span><br><br>f, axarr = plt.subplots(<span class="hljs-number">2</span>,<span class="hljs-number">2</span>, figsize = (<span class="hljs-number">12</span>, <span class="hljs-number">8</span>))<br>axarr[<span class="hljs-number">0</span>, <span class="hljs-number">0</span>].plot(training_losses_google)<br>axarr[<span class="hljs-number">0</span>, <span class="hljs-number">0</span>].set_title(<span class="hljs-string">&quot;Training loss&quot;</span>)<br>axarr[<span class="hljs-number">0</span>, <span class="hljs-number">1</span>].plot(training_accs_google)<br>axarr[<span class="hljs-number">0</span>, <span class="hljs-number">1</span>].set_title(<span class="hljs-string">&quot;Training acc&quot;</span>)<br>axarr[<span class="hljs-number">1</span>, <span class="hljs-number">0</span>].plot(test_accs_google)<br>axarr[<span class="hljs-number">1</span>, <span class="hljs-number">0</span>].set_title(<span class="hljs-string">&quot;Test acc&quot;</span>)<br><br></code></pre></td></tr></table></figure>




<pre><code class="hljs">Text(0.5, 1.0, &#39;Test acc&#39;)
</code></pre>
<p><img src="https://ptpimg.me/qqpd2g.png" alt="åœ¨è¿™é‡Œæ’å…¥å›¾ç‰‡æè¿°"></p>
<h2 id="5-3-åœ¨å•å¹…å›¾åƒä¸Šè¯„ä¼°æ¨¡å‹"><a href="#5-3-åœ¨å•å¹…å›¾åƒä¸Šè¯„ä¼°æ¨¡å‹" class="headerlink" title="5.3 åœ¨å•å¹…å›¾åƒä¸Šè¯„ä¼°æ¨¡å‹"></a>5.3 åœ¨å•å¹…å›¾åƒä¸Šè¯„ä¼°æ¨¡å‹</h2><figure class="highlight python"><table><tr><td class="code"><pre><code class="hljs python">single_img_eval(model_ft_google, <span class="hljs-string">&quot;test/Chevrolet Traverse SUV 2012/004695.jpg&quot;</span>)<br></code></pre></td></tr></table></figure>


<p><img src="https://ptpimg.me/5672w0.png" alt="åœ¨è¿™é‡Œæ’å…¥å›¾ç‰‡æè¿°"></p>
<pre><code class="hljs">Chevrolet Impala Sedan 2007 confidence:  4.615828037261963
</code></pre>
<figure class="highlight python"><table><tr><td class="code"><pre><code class="hljs python">single_img_eval(model_ft_google, <span class="hljs-string">&quot;test/FIAT 500 Abarth 2012/008089.jpg&quot;</span>)<br></code></pre></td></tr></table></figure>



<p><img src="https://ptpimg.me/qloo1w.png" alt="åœ¨è¿™é‡Œæ’å…¥å›¾ç‰‡æè¿°"></p>
<pre><code class="hljs">FIAT 500 Abarth 2012 confidence:  6.266000747680664
</code></pre>
<figure class="highlight python"><table><tr><td class="code"><pre><code class="hljs python">single_img_eval(model_ft_google,  <span class="hljs-string">&quot;test/Aston Martin V8 Vantage Convertible 2012/000623.jpg&quot;</span>)<br></code></pre></td></tr></table></figure>


<p><img src="https://ptpimg.me/2jj563.png" alt="åœ¨è¿™é‡Œæ’å…¥å›¾ç‰‡æè¿°"></p>
<pre><code class="hljs">Aston Martin V8 Vantage Convertible 2012 confidence:  6.059011459350586
</code></pre>
<p>å¯¹æ¯”ResNet34è¯¥ç½‘ç»œè¯†åˆ«å‡ºåä¸¤ä¸ªï¼Œç¬¬ä¸€ä¸ªä¹Ÿæ˜¯è¯†åˆ«é”™äº†ï¼Œä½†æ˜¯æ›´æ¥è¿‘ä¸€äº›ï¼Œåªæ˜¯confidenceä½ä¸€äº›ã€‚</p>
<h2 id="5-4-ä¿å­˜æ¨¡å‹ä»¥å¤‡åç”¨"><a href="#5-4-ä¿å­˜æ¨¡å‹ä»¥å¤‡åç”¨" class="headerlink" title="5.4 ä¿å­˜æ¨¡å‹ä»¥å¤‡åç”¨"></a>5.4 ä¿å­˜æ¨¡å‹ä»¥å¤‡åç”¨</h2><figure class="highlight python"><table><tr><td class="code"><pre><code class="hljs python">torch.save(model_ft_google.state_dict(), <span class="hljs-string">&#x27;car_model_googlenet.pth&#x27;</span>)<br></code></pre></td></tr></table></figure>

<h1 id="6-ç»“è®º"><a href="#6-ç»“è®º" class="headerlink" title="6. ç»“è®º"></a>6. ç»“è®º</h1><p>åœ¨è¿™ä¸ªé¡¹ç›®ä¸­ï¼Œæˆ‘ä»¬åœ¨é¢„è®­ç»ƒçš„æœ€å…ˆè¿›çš„ ResNet34 å’Œ GoogLeNet ç½‘ç»œä¸Šå®æ–½äº†â€œç°æˆçš„â€è¿ç§»å­¦ä¹ æŠ€æœ¯ã€‚æˆ‘ä»¬é€šè¿‡ç”¨æœªç»è®­ç»ƒçš„å±‚æ›¿æ¢å®ƒä»¬çš„æœ€åä¸€ä¸ªå®Œå…¨è¿æ¥å±‚æ¥é‡‡ç”¨è¿™äº›ç½‘ç»œï¼Œç„¶åå†»ç»“æ›´æ·±çš„å±‚å¹¶ä½¿ç”¨æˆ‘ä»¬çš„æ•°æ®è®­ç»ƒæœ€åä¸€å±‚ï¼šæ–¯å¦ç¦æ±½è½¦æ•°æ®ï¼Œä½¿ç”¨éšæœºæ¢¯åº¦ä¸‹é™ã€‚æˆ‘ä»¬ä½¿ç”¨è‡ªé€‚åº”å­¦ä¹ ç‡æ¥ä¼˜åŒ–è®­ç»ƒè¿‡ç¨‹ã€‚æˆ‘ä»¬è¿˜å¯¹è®­ç»ƒæ•°æ®è¿›è¡Œäº†æ‰©å……ä»¥é¿å…è¿‡åº¦æ‹Ÿåˆã€‚</p>
<p>æˆ‘ä»¬çš„ç»“æœä¸é”™ï¼Œé‡‡ç”¨çš„ä¸¤ç§ç½‘ç»œéƒ½å…·æœ‰é«˜æ€§èƒ½ï¼šæ¥è‡ª ResNet34 çš„ç½‘ç»œå…·æœ‰ 93% çš„è®­ç»ƒå‡†ç¡®ç‡å’Œ 85% çš„æµ‹è¯•å‡†ç¡®ç‡ï¼›æ¥è‡ª GoogLeNet çš„ç½‘ç»œå…·æœ‰ 90% çš„è®­ç»ƒå‡†ç¡®ç‡å’Œ 84% çš„æµ‹è¯•å‡†ç¡®ç‡ã€‚</p>
<p>æœ€åï¼Œæˆ‘ä»¬è¿˜ä½¿ç”¨å•ä¸ªå›¾åƒæ¥æ¨¡æ‹ŸçœŸå®ç”Ÿäº§åœºæ™¯æ¥è¯„ä¼°æ¨¡å‹ï¼Œå¹¶ä¸”æ¨¡å‹è¡¨ç°è‰¯å¥½ã€‚</p>
<h1 id="7-æœªæ¥ä¼˜åŒ–"><a href="#7-æœªæ¥ä¼˜åŒ–" class="headerlink" title="7. æœªæ¥ä¼˜åŒ–"></a>7. æœªæ¥ä¼˜åŒ–</h1><p>è¿ç§»å­¦ä¹ çš„ä¸‹ä¸€æ­¥å°†æ˜¯åœ¨é¢„è®­ç»ƒç½‘ç»œä¸­æ›´æ·±å…¥ï¼šå¯èƒ½è®­ç»ƒæ›´å¤šçš„æ–°å±‚ï¼Œæˆ–è€…å¾®è°ƒä¸€äº›æ›´æ·±çš„å±‚ã€‚ä¹Ÿè®¸è¿™å¯ä»¥å°†æ€§èƒ½æå‡åˆ°æ›´é«˜çš„æ°´å¹³å¹¶è§£å†³æ•ç¯·è½¦ä¸è½¿è·‘è½¦çš„é—®é¢˜ã€‚</p>
<p>æ­¤å¤–ï¼Œæˆ‘ä»¬å¸Œæœ›å°†è¿ç§»å­¦ä¹ ç”¨äºå›¾åƒåˆ†ç±»ä»¥å¤–çš„ä»»åŠ¡ï¼Œä¹Ÿè®¸æ˜¯ä¸€äº›è‡ªç„¶è¯­è¨€å¤„ç†ã€‚</p>
]]></content>
  </entry>
  <entry>
    <title>Macä½¿ç”¨æŒ‡å—æŒ‡ä»¤å¤‡å¿˜å½•</title>
    <url>/2021/05/11/m1/</url>
    <content><![CDATA[<p>@[TOC](m1 Macä½¿ç”¨æŒ‡å—æŒ‡ä»¤å¤‡å¿˜å½• )<br>M1ç”¨åˆ°ç°åœ¨ä¹Ÿå°åŠå¹´äº†ï¼Œè¸©äº†äº›å‘ï¼Œä¹Ÿæœ‰ä¸€äº›ä½¿ç”¨å¿ƒå¾—ï¼Œè¿™é‡Œä¸»è¦æä¾›æ€è·¯æ–¹æ³•ï¼Œå…·ä½“æ–¹æ³•å¯ä»¥è‡ªè¡Œæœç´¢äº†è§£</p>
<h1 id="ç¡¬ä»¶å¤–è®¾"><a href="#ç¡¬ä»¶å¤–è®¾" class="headerlink" title="ç¡¬ä»¶å¤–è®¾"></a>ç¡¬ä»¶å¤–è®¾</h1><p>é¦–å…ˆæ˜¯ç”¨çš„Macbook airä¸ç‰ˆ8+256</p>
<ol>
<li>æ˜¾ç¤ºå™¨ï¼ŒHKCçš„C299Qï¼Œçœ‹ä¸­å®ƒé•¿å±æ–¹ä¾¿å‰ªè¾‘å’Œåˆ†å±ï¼Œ90%çš„DCI-Pè‰²åŸŸçœ‹ç”µå½±è¿˜è¡Œï¼Œä¸æ‰“æ¸¸æˆæ‰€ä»¥VAçš„æ›²é¢å±è¿˜æ˜¯æŒºåˆé€‚</li>
<li>é”®ç›˜ï¼Œå°†å°±ç”¨ä¹‹å‰ipadé…çš„é€»è¾‘K380</li>
<li>é¼ æ ‡ï¼Œç½—æŠ€M720</li>
<li>ç¡¬ç›˜ï¼Œåœ¨å®¶ç»„äº†ä¸ªNASï¼Œ4Tç”¨æ¥æ”¾ç”µå½±å’Œå‰ªè¾‘ç´ æä¹‹ç±»çš„å¤§æ–‡ä»¶</li>
<li>æ‹“å±•åï¼Œé£åˆ©æµ¦çš„äº”åˆä¸€Type-c+Hdim1.4+3*USB3.0åŸºæœ¬æ»¡è¶³éœ€æ±‚ã€‚</li>
<li>Ipad air3éšèˆªå½“æ‹“å±•å±å¾ˆå¥½ç”¨</li>
</ol>
<h2 id="å¤–æ¥æ˜¾ç¤ºå™¨HiDpi"><a href="#å¤–æ¥æ˜¾ç¤ºå™¨HiDpi" class="headerlink" title="å¤–æ¥æ˜¾ç¤ºå™¨HiDpi"></a>å¤–æ¥æ˜¾ç¤ºå™¨HiDpi</h2><p>å¼ºåˆ¶å¼€å¯Hidpi<br>æœ‰æ¡ä»¶ä¸Š4kæ˜¾ç¤ºå™¨çš„å½“ç„¶æœ€å¥½ï¼Œæ¥ä¸Šæ˜¾ç¤ºå™¨å°±ä¼šå‡ºç°è°ƒèŠ‚ç•Œé¢ï¼Œä¸»è¦é’ˆå¯¹é4Kå±å¹•<br>hidpiæ˜¯macosä¼˜åŒ–æ˜¾ç¤ºæ•ˆæœçš„ä¸€ç§æŠ€æœ¯ï¼Œéœ€è¦ç¡¬ä»¶è¾¾åˆ°è§†ç½‘è†œå±å¹•æ ‡å‡†ï¼Œå…·ä½“æŠ€æœ¯å¯ä»¥è‡ªè¡Œäº†è§£ï¼Œä¸»è¦é—®é¢˜æ˜¯é4kæ¯”å¦‚æˆ‘ç°åœ¨ç”¨çš„å¸¦é±¼å±1080*2560ä¼šå‡ºç°å­—ä½“å‘è™šçš„æƒ…å†µ<br>å‚è€ƒå›½å¤–ä¸€ä¸ªå¤§ç¥è½¯ä»¶è™šæ‹Ÿæ˜¾ç¤ºå™¨çš„æ–¹æ³•<br><a href="https://github.com/waydabber/BetterDummy">BetterDummy</a><br>ä¸»è¦æ–¹æ³•æ˜¯é€šè¿‡è½¯ä»¶è™šæ‹Ÿä¸€ä¸ªæ”¯æŒhidpiçš„æ˜¾ç¤ºå™¨ï¼Œå†æŠŠè¿™ä¸ªæ˜¾ç¤ºå™¨æŠ•åˆ°è‡ªå·±çš„ä¸Šé¢ã€‚å¸¦é±¼å±çš„è¯æ³¨æ„é€‰21.5:9ï¼Œ21.3:9æ˜¯æ²¡Hidpiçš„ã€‚<br>ç³»ç»Ÿéœ€è¦æ›´æ–°åˆ°Monetery<br><img src="https://ptpimg.me/789b29.png" alt="åœ¨è¿™é‡Œæ’å…¥å›¾ç‰‡æè¿°"></p>
<h1 id="homebrew"><a href="#homebrew" class="headerlink" title="homebrew"></a>homebrew</h1><p>homebrewæ˜¯Macä¸Šä¸€ä¸ªè½¯ä»¶ç®¡ç†å·¥å…·ï¼Œå¯ä»¥ç†è§£ä¸ºå¼€æºAppstoreï¼Œç›´æ¥brew installå³å¯å®‰è£…æŒ‡å®šè½¯ä»¶ï¼Œæœ€å¥½å®‰è£…å‰å…ˆç”¨Brew searchæŸ¥è¯¢æ˜¯å¦å­˜åœ¨å¯¹åº”ç‰ˆæœ¬</p>
<figure class="highlight c"><table><tr><td class="code"><pre><code class="hljs C">export HOMEBREW_BREW_GIT_REMOTE=<span class="hljs-string">&quot;...&quot;</span>  <span class="hljs-meta"># put your Git mirror of Homebrew/brew here</span><br>export HOMEBREW_CORE_GIT_REMOTE=<span class="hljs-string">&quot;...&quot;</span>  <span class="hljs-meta"># put your Git mirror of Homebrew/homebrew-core here</span><br>/bin/bash -c <span class="hljs-string">&quot;$(curl -fsSL https://raw.githubusercontent.com/Homebrew/install/master/install.sh)&quot;</span><br></code></pre></td></tr></table></figure>

<h1 id="å¿…å¤‡ç½‘ç«™"><a href="#å¿…å¤‡ç½‘ç«™" class="headerlink" title="å¿…å¤‡ç½‘ç«™"></a>å¿…å¤‡ç½‘ç«™</h1><ol>
<li><a href="https://isapplesiliconready.com/">Is apple Silicon readyï¼Ÿ</a>å¯¹åº”è½¯ä»¶å®˜æ–¹æ˜¯å¦å·²ç»é€‚é…m1å¹³å°<br><img src="https://ptpimg.me/145r82.png" alt="è½¯ä»¶é€‚é…"></li>
<li><a href="https://www.macwk.com/">MacWk</a>ä¸€ä¸ªå…è´¹çš„ç ´è§£è½¯ä»¶ä¸‹è½½ç½‘ç«™</li>
<li><a href="https://www.applegamingwiki.com/wiki/Home">m1æ¸¸æˆé€‚é…æƒ…å†µ</a>ä»‹ç»æ¸¸æˆåœ¨ä¸åŒç¯å¢ƒä¸‹è¿è¡Œæƒ…å†µï¼Œç‚¹è¿›å»æœ‰è¯¦ç»†æµ‹è¯„<br><img src="https://ptpimg.me/2tyf73.png" alt="m1"></li>
</ol>
<h1 id="è½¯ä»¶æ¨è"><a href="#è½¯ä»¶æ¨è" class="headerlink" title="è½¯ä»¶æ¨è"></a>è½¯ä»¶æ¨è</h1><h2 id="Parallels-Desktop"><a href="#Parallels-Desktop" class="headerlink" title="Parallels Desktop"></a>Parallels Desktop</h2><h2 id="Silicon"><a href="#Silicon" class="headerlink" title="Silicon"></a>Silicon</h2><h2 id="Bob"><a href="#Bob" class="headerlink" title="Bob"></a>Bob</h2><h2 id="IINA"><a href="#IINA" class="headerlink" title="IINA"></a>IINA</h2><h2 id="iterm2è¿œç¨‹"><a href="#iterm2è¿œç¨‹" class="headerlink" title="iterm2è¿œç¨‹"></a>iterm2è¿œç¨‹</h2><p>Iterm2æ¯”Macè‡ªå¸¦terminalæ›´å¥½ç”¨ï¼Œè£…æœºå¿…å¤‡è½¯ä»¶ä¹‹ä¸€<br>cmd+Oè°ƒå‡ºprofile ä¿å­˜å¸å·-&gt;cmd+option+F è°ƒå‡ºpassword manageä¿å­˜å¯†ç </p>
<h1 id="mysqlå’Œrediså¯åŠ¨"><a href="#mysqlå’Œrediså¯åŠ¨" class="headerlink" title="mysqlå’Œrediså¯åŠ¨"></a>mysqlå’Œrediså¯åŠ¨</h1><figure class="highlight shell"><table><tr><td class="code"><pre><code class="hljs shell">brew service start mysql<br><br>redis-server<br></code></pre></td></tr></table></figure>



<h1 id="OhMyZshè®¾ç½®"><a href="#OhMyZshè®¾ç½®" class="headerlink" title="OhMyZshè®¾ç½®"></a>OhMyZshè®¾ç½®</h1><p>å¯ä»¥åœ¨Macå’ŒDebianæœ¬åœ°åˆ†åˆ«è®¾ç½®<br><a href="https://blog.51cto.com/u_15127596/4297531">å‚è€ƒç»†èŠ‚</a><br>æ¨èæ’ä»¶ extractã€ zsh-syntax-highlightingã€autojumpã€zsh-autosuggestions</p>
<h1 id="ç£ç›˜è¯»å†™æŸ¥è¯¢"><a href="#ç£ç›˜è¯»å†™æŸ¥è¯¢" class="headerlink" title="ç£ç›˜è¯»å†™æŸ¥è¯¢"></a>ç£ç›˜è¯»å†™æŸ¥è¯¢</h1><figure class="highlight c"><table><tr><td class="code"><pre><code class="hljs C">smartctl ç›˜æŸ¥çœ‹è¯»å†™æ¬¡æ•°<br><br></code></pre></td></tr></table></figure>
<p>è¿™ä¸ªç£ç›˜è¿‡åº¦è¯»å†™çš„é—®é¢˜æœ€å¥½æ˜¯ä½¿ç”¨åŸç”Ÿè½¯ä»¶<br><img src="https://ptpimg.me/e63381.png" alt="2021-11-22"></p>
<h1 id="tensorfowå®‰è£…é…ç½®"><a href="#tensorfowå®‰è£…é…ç½®" class="headerlink" title="tensorfowå®‰è£…é…ç½®"></a>tensorfowå®‰è£…é…ç½®</h1><h2 id="pythonç¯å¢ƒ"><a href="#pythonç¯å¢ƒ" class="headerlink" title="pythonç¯å¢ƒ"></a>pythonç¯å¢ƒ</h2><p>ç”µè„‘è‡ªå¸¦pythonä½†æ˜¯3.9æœ‰ç‚¹é«˜ï¼Œå¯ä»¥è‡ªå·±é€‰æ‹©å¯¹åº”ç‰ˆæœ¬<br>ç‚¹å‡»ä¸‹è½½<a href="https://github.com/conda-forge/miniforge/#download">miniforge</a><br>å®‰è£…å‘½ä»¤</p>
<figure class="highlight shell"><table><tr><td class="code"><pre><code class="hljs shell">bash Miniforge3-MacOSX-arm64.sh<br><br>nano ~/.bash_profile<br>export PATH=&quot;/Users/Cyberbolt/miniforge3/bin:$PATH&quot; <br><br>source $HOME/.bash_profile<br></code></pre></td></tr></table></figure>
<h2 id="åœ¨è™šæ‹Ÿç¯å¢ƒå®‰è£…-TensorFlow"><a href="#åœ¨è™šæ‹Ÿç¯å¢ƒå®‰è£…-TensorFlow" class="headerlink" title="åœ¨è™šæ‹Ÿç¯å¢ƒå®‰è£… TensorFlow"></a>åœ¨è™šæ‹Ÿç¯å¢ƒå®‰è£… TensorFlow</h2><figure class="highlight shell"><table><tr><td class="code"><pre><code class="hljs shell">conda create -n py39 python=3.9<br>conda activate py39<br><br>conda install -c apple tensorflow-deps<br>python -m pip install tensorflow-macos<br>python -m pip install tensorflow-metal<br></code></pre></td></tr></table></figure>
<h1 id="æœªå®Œå¾…è¡¥å……"><a href="#æœªå®Œå¾…è¡¥å……" class="headerlink" title="æœªå®Œå¾…è¡¥å……"></a>æœªå®Œå¾…è¡¥å……</h1>]]></content>
  </entry>
  <entry>
    <title>æœºå™¨å­¦ä¹ -æ–‡æœ¬å¤„ç†ä¹‹ç”µå½±è¯„è®ºå¤šåˆ†ç±»æƒ…æ„Ÿåˆ†æ</title>
    <url>/2022/09/02/motionanalys/</url>
    <content><![CDATA[<h1 id="ä¸€ã€èƒŒæ™¯"><a href="#ä¸€ã€èƒŒæ™¯" class="headerlink" title="ä¸€ã€èƒŒæ™¯"></a>ä¸€ã€èƒŒæ™¯</h1><p>æ–‡æœ¬å¤„ç†æ˜¯è®¸å¤šMLåº”ç”¨ç¨‹åºä¸­æœ€å¸¸è§çš„ä»»åŠ¡ä¹‹ä¸€ã€‚ä»¥ä¸‹æ˜¯æ­¤ç±»åº”ç”¨çš„ä¸€äº›ç¤ºä¾‹</p>
<ul>
<li>è¯­è¨€ç¿»è¯‘ï¼šå°†å¥å­ä»ä¸€ç§è¯­è¨€ç¿»è¯‘æˆå¦ä¸€ç§è¯­è¨€</li>
<li>æƒ…ç»ªåˆ†æï¼šä»æ–‡æœ¬è¯­æ–™åº“ä¸­ç¡®å®šå¯¹ä»»ä½•ä¸»é¢˜æˆ–äº§å“ç­‰çš„æƒ…ç»ªæ˜¯ç§¯æçš„ã€æ¶ˆæçš„è¿˜æ˜¯ä¸­æ€§çš„</li>
<li>åƒåœ¾é‚®ä»¶è¿‡æ»¤ï¼šæ£€æµ‹æœªç»è¯·æ±‚å’Œä¸éœ€è¦çš„ç”µå­é‚®ä»¶&#x2F;æ¶ˆæ¯ã€‚</li>
</ul>
<p>è¿™äº›åº”ç”¨ç¨‹åºå¤„ç†å¤§é‡æ–‡æœ¬ä»¥æ‰§è¡Œåˆ†ç±»æˆ–ç¿»è¯‘ï¼Œå¹¶ä¸”æ¶‰åŠå¤§é‡åç«¯å·¥ä½œã€‚å°†æ–‡æœ¬è½¬æ¢ä¸ºç®—æ³•å¯ä»¥æ¶ˆåŒ–çš„å†…å®¹æ˜¯ä¸€ä¸ªå¤æ‚çš„è¿‡ç¨‹ã€‚åœ¨æœ¬æ–‡ä¸­ï¼Œæˆ‘ä»¬å°†è®¨è®ºæ–‡æœ¬å¤„ç†ä¸­æ¶‰åŠçš„æ­¥éª¤ã€‚</p>
<h1 id="äºŒã€æ•°æ®é¢„å¤„ç†"><a href="#äºŒã€æ•°æ®é¢„å¤„ç†" class="headerlink" title="äºŒã€æ•°æ®é¢„å¤„ç†"></a>äºŒã€æ•°æ®é¢„å¤„ç†</h1><ul>
<li>åˆ†è¯â€”â€”å°†å¥å­è½¬åŒ–ä¸ºè¯è¯­</li>
<li>å»é™¤å¤šä½™çš„æ ‡ç‚¹ç¬¦å·</li>
<li>å»é™¤åœç”¨è¯â€”â€”é«˜é¢‘å‡ºç°çš„â€œçš„ã€äº†â€ä¹‹ç±»çš„è¯ï¼Œä»–ä»¬å¯¹è¯­ä¹‰åˆ†ææ²¡å¸®åŠ©</li>
<li>è¯å¹²æå–â€”â€”é€šè¿‡åˆ é™¤ä¸å¿…è¦çš„å­—ç¬¦ï¼ˆé€šå¸¸æ˜¯åç¼€ï¼‰ï¼Œå°†å•è¯ç¼©å‡ä¸ºè¯æ ¹ã€‚</li>
<li>è¯å½¢è¿˜åŸâ€”â€”é€šè¿‡ç¡®å®šè¯æ€§å¹¶åˆ©ç”¨è¯­è¨€çš„è¯¦ç»†æ•°æ®åº“æ¥æ¶ˆé™¤å±ˆæŠ˜å˜åŒ–çš„å¦ä¸€ç§æ–¹æ³•ã€‚</li>
</ul>
<p>æˆ‘ä»¬å¯ä»¥ä½¿ç”¨pythonè¿›è¡Œè®¸å¤šæ–‡æœ¬é¢„å¤„ç†æ“ä½œã€‚</p>
<p>NLTKï¼ˆNatural Language Toolkitï¼‰ï¼Œè‡ªç„¶è¯­è¨€å¤„ç†å·¥å…·åŒ…ï¼Œåœ¨NLPï¼ˆè‡ªç„¶è¯­è¨€å¤„ç†ï¼‰é¢†åŸŸä¸­ï¼Œæœ€å¸¸ä½¿ç”¨çš„ä¸€ä¸ªPythonåº“ã€‚è‡ªå¸¦è¯­æ–™åº“ï¼Œè¯æ€§åˆ†ç±»åº“ã€‚è‡ªå¸¦åˆ†ç±»ï¼Œåˆ†è¯åŠŸèƒ½ã€‚ </p>
<p><strong>åˆ†è¯ï¼ˆTokenizeï¼‰</strong>ï¼šword_tokenizeç”Ÿæˆä¸€ä¸ªè¯çš„åˆ—è¡¨</p>
<figure class="highlight python"><table><tr><td class="code"><pre><code class="hljs python"><span class="hljs-keyword">import</span> nltk<br>sentence=<span class="hljs-string">&quot;I Love China !&quot;</span><br>tokens=nltk.word_tokenize(sentence)<br>tokens<br></code></pre></td></tr></table></figure>
<p>[â€˜Iâ€™, â€˜Loveâ€™, â€˜Chinaâ€™, â€˜!â€™]<br><strong>ä¸­æ–‡åˆ†è¯â€“jieba</strong></p>
<figure class="highlight python"><table><tr><td class="code"><pre><code class="hljs python"><span class="hljs-meta">&gt;&gt;&gt; </span><span class="hljs-keyword">import</span> jieba<br><span class="hljs-meta">&gt;&gt;&gt; </span>seg_list=jieba.cut(<span class="hljs-string">&quot;æˆ‘æ­£åœ¨å­¦ä¹ æœºå™¨å­¦ä¹ &quot;</span>,cut_all=<span class="hljs-literal">True</span>)<br><span class="hljs-meta">&gt;&gt;&gt; </span><span class="hljs-built_in">print</span>(<span class="hljs-string">&quot;å…¨æ¨¡å¼ï¼š&quot;</span>,<span class="hljs-string">&quot;/&quot;</span>.join(seg_list))<br>å…¨æ¨¡å¼ï¼š æˆ‘/æ­£åœ¨/å­¦ä¹ /å­¦ä¹ æœº/æœºå™¨/å­¦ä¹ <br><span class="hljs-meta">&gt;&gt;&gt; </span>seg_list=jieba.cut(<span class="hljs-string">&quot;æˆ‘æ­£åœ¨å­¦ä¹ æœºå™¨å­¦ä¹ &quot;</span>,cut_all=<span class="hljs-literal">False</span>)<br><span class="hljs-meta">&gt;&gt;&gt; </span><span class="hljs-built_in">print</span>(<span class="hljs-string">&quot;ç²¾ç¡®æ¨¡å¼ï¼š&quot;</span>,<span class="hljs-string">&quot;/&quot;</span>.join(seg_list))<br>ç²¾ç¡®æ¨¡å¼ï¼š æˆ‘/æ­£åœ¨/å­¦ä¹ /æœºå™¨/å­¦ä¹ <br></code></pre></td></tr></table></figure>

<h1 id="ä¸‰ã€ç‰¹å¾æå–"><a href="#ä¸‰ã€ç‰¹å¾æå–" class="headerlink" title="ä¸‰ã€ç‰¹å¾æå–"></a>ä¸‰ã€ç‰¹å¾æå–</h1><p>åœ¨æ–‡æœ¬å¤„ç†ä¸­ï¼Œæ–‡æœ¬ä¸­çš„å•è¯è¡¨ç¤ºç¦»æ•£çš„ã€åˆ†ç±»çš„ç‰¹å¾ã€‚æˆ‘ä»¬å¦‚ä½•ä»¥ç®—æ³•å¯ä»¥ä½¿ç”¨çš„æ–¹å¼å¯¹è¿™äº›æ•°æ®è¿›è¡Œç¼–ç ï¼Ÿä»æ–‡æœ¬æ•°æ®åˆ°å®å€¼å‘é‡çš„æ˜ å°„ç§°ä¸ºç‰¹å¾æå–ã€‚ç”¨æ•°å­—è¡¨ç¤ºæ–‡æœ¬çš„æœ€ç®€å•çš„æŠ€æœ¯ä¹‹ä¸€æ˜¯<strong>Bag of Words</strong>ã€‚</p>
<h2 id="Bag-of-Words"><a href="#Bag-of-Words" class="headerlink" title="Bag of Words"></a>Bag of Words</h2><p>æˆ‘ä»¬åœ¨æ–‡æœ¬è¯­æ–™åº“ä¸­åˆ—å‡ºä¸€äº›ç‹¬ç‰¹çš„å•è¯ï¼Œç§°ä¸ºè¯æ±‡è¡¨ã€‚ç„¶åæˆ‘ä»¬å¯ä»¥å°†æ¯ä¸ªå¥å­æˆ–æ–‡æ¡£è¡¨ç¤ºä¸ºä¸€ä¸ªå‘é‡ï¼Œæ¯ä¸ªå•è¯è¡¨ç¤ºä¸º1è¡¨ç¤ºç°åœ¨ï¼Œ0è¡¨ç¤ºä¸åœ¨è¯æ±‡è¡¨ä¸­ã€‚å¦ä¸€ç§è¡¨ç¤ºæ³•æ˜¯è®¡ç®—æ¯ä¸ªå•è¯åœ¨æ–‡æ¡£ä¸­å‡ºç°çš„æ¬¡æ•°ã€‚æœ€æµè¡Œçš„æ–¹æ³•æ˜¯ä½¿ç”¨æœ¯è¯­é¢‘ç‡é€†æ–‡æ¡£é¢‘ç‡ï¼ˆ<strong>TF-IDF</strong>ï¼‰æŠ€æœ¯ã€‚</p>
<ul>
<li><strong>Term Frequency (TF)</strong>&#x3D;ï¼ˆæœ¯è¯­tå‡ºç°åœ¨â€¢æ–‡æ¡£ä¸­çš„æ¬¡æ•°ï¼‰&#x2F;ï¼ˆæ–‡æ¡£ä¸­çš„æœ¯è¯­æ•°é‡ï¼‰</li>
<li><strong>Inverse Document Frequency (IDF)</strong>&#x3D;log(N&#x2F;n)ï¼Œå…¶ä¸­ï¼ŒNæ˜¯æ–‡æ¡£æ•°é‡ï¼Œnæ˜¯æœ¯è¯­tå‡ºç°åœ¨æ–‡æ¡£ä¸­çš„æ•°é‡ã€‚ç¨€æœ‰è¯çš„IDFè¾ƒé«˜ï¼Œè€Œé¢‘ç¹è¯çš„IDFå¯èƒ½è¾ƒä½ã€‚å› æ­¤å…·æœ‰çªå‡ºæ˜¾ç¤ºä¸åŒå•è¯çš„æ•ˆæœã€‚</li>
<li>æˆ‘ä»¬è®¡ç®—ä¸€ä¸ªé¡¹çš„<strong>TF-IDF</strong>å€¼ä¸º&#x3D;TF*IDF</li>
</ul>
<p><img src="https://ptpimg.me/4ix0bu.png"></p>
<pre><code class="hljs">TF(&#39;beautiful&#39;,Document1) = 2/10, IDF(&#39;beautiful&#39;)=log(2/2) = 0
TF(â€˜dayâ€™,Document1) = 5/10,  IDF(â€˜dayâ€™)=log(2/1) = 0.30
TF-IDF(â€˜beautifulâ€™, Document1) = (2/10)*0 = 0
TF-IDF(â€˜dayâ€™, Document1) = (5/10)*0.30 = 0.15
</code></pre>
<p>æ­£å¦‚æ‚¨åœ¨Document1ä¸­çœ‹åˆ°çš„ï¼ŒTF-IDFæ–¹æ³•ä¸¥é‡æƒ©ç½šäº†â€œbeautifulâ€ä¸€è¯ï¼Œä½†å¯¹â€œdayâ€èµ‹äºˆäº†æ›´å¤§çš„æƒé‡ã€‚è¿™æ˜¯ç”±äºIDFéƒ¨åˆ†ï¼Œå®ƒä¸ºä¸åŒçš„å•è¯èµ‹äºˆäº†æ›´å¤šçš„æƒé‡ã€‚æ¢å¥è¯è¯´ï¼Œä»æ•´ä¸ªè¯­æ–™åº“çš„ä¸Šä¸‹æ–‡æ¥çœ‹ï¼Œâ€œdayâ€æ˜¯Document1çš„ä¸€ä¸ªé‡è¦è¯ã€‚Python scikitå­¦ä¹ åº“ä¸ºæ–‡æœ¬æ•°æ®æŒ–æ˜æä¾›äº†æœ‰æ•ˆçš„å·¥å…·ï¼Œå¹¶æä¾›äº†è®¡ç®—ç»™å®šæ–‡æœ¬è¯­æ–™åº“çš„æ–‡æœ¬è¯æ±‡è¡¨TF-IDFçš„å‡½æ•°ã€‚</p>
<p>ä½¿ç”¨BOWçš„ä¸€ä¸ªä¸»è¦ç¼ºç‚¹æ˜¯å®ƒæ”¾å¼ƒäº†è¯åºï¼Œä»è€Œå¿½ç•¥äº†ä¸Šä¸‹æ–‡ï¼Œè¿›è€Œå¿½ç•¥äº†æ–‡æ¡£ä¸­å•è¯çš„å«ä¹‰ã€‚å¯¹äºè‡ªç„¶è¯­è¨€å¤„ç†ï¼ˆNLPï¼‰ï¼Œä¿æŒå•è¯çš„ä¸Šä¸‹æ–‡æ˜¯è‡³å…³é‡è¦çš„ã€‚ä¸ºäº†è§£å†³è¿™ä¸ªé—®é¢˜ï¼Œæˆ‘ä»¬ä½¿ç”¨å¦ä¸€ç§ç§°ä¸ºå•è¯åµŒå…¥çš„æ–¹æ³•ã€‚</p>
<h2 id="Word-Embedding"><a href="#Word-Embedding" class="headerlink" title="Word Embedding"></a>Word Embedding</h2><p>å®ƒæ˜¯æ–‡æœ¬çš„ä¸€ç§è¡¨ç¤ºå½¢å¼ï¼Œå…¶ä¸­å…·æœ‰ç›¸åŒå«ä¹‰çš„å•è¯å…·æœ‰ç›¸ä¼¼çš„è¡¨ç¤ºå½¢å¼ã€‚æ¢å¥è¯è¯´ï¼Œå®ƒè¡¨ç¤ºåæ ‡ç³»ä¸­çš„å•è¯ï¼Œåœ¨åæ ‡ç³»ä¸­ï¼ŒåŸºäºå…³ç³»è¯­æ–™åº“çš„ç›¸å…³å•è¯è¢«æ”¾åœ¨æ›´è¿‘çš„ä½ç½®ã€‚</p>
<h4 id="Word2Vec"><a href="#Word2Vec" class="headerlink" title="Word2Vec"></a>Word2Vec</h4><p>Word2vecå°†å¤§é‡æ–‡æœ¬ä½œä¸ºè¾“å…¥ï¼Œå¹¶ç”Ÿæˆä¸€ä¸ªå‘é‡ç©ºé—´ï¼Œæ¯ä¸ªå”¯ä¸€çš„å•è¯åœ¨è¯¥ç©ºé—´ä¸­åˆ†é…ä¸€ä¸ªå¯¹åº”çš„å‘é‡ã€‚è¯å‘é‡å®šä½åœ¨å‘é‡ç©ºé—´ä¸­ï¼Œä½¿å¾—åœ¨è¯­æ–™åº“ä¸­å…±äº«å…¬å…±ä¸Šä¸‹æ–‡çš„è¯åœ¨è¯¥ç©ºé—´ä¸­å½¼æ­¤éå¸¸æ¥è¿‘ã€‚Word2Vecéå¸¸æ“…é•¿æ•æ‰æ„ä¹‰ï¼Œå¹¶åœ¨è¯¸å¦‚è®¡ç®—aåˆ°bçš„ç±»æ¯”é—®é¢˜ä»¥åŠcåˆ°ï¼Ÿçš„ç±»æ¯”é—®é¢˜ç­‰ä»»åŠ¡ä¸­æ¼”ç¤ºå®ƒï¼Ÿã€‚ä¾‹å¦‚ï¼Œç”·äººå¯¹å¥³äººå°±åƒå”å”å¯¹å¥³äººä¸€æ ·ï¼Ÿï¼ˆaï¼‰ä½¿ç”¨åŸºäºä½™å¼¦è·ç¦»çš„ç®€å•çŸ¢é‡åç§»æ–¹æ³•ã€‚ä¾‹å¦‚ï¼Œè¿™é‡Œæœ‰ä¸‰ä¸ªå•è¯å¯¹çš„å‘é‡åç§»é‡æ¥è¯´æ˜æ€§åˆ«å…³ç³»ï¼š<br><img src="https://ptpimg.me/i136y0.png" alt="æ€§åˆ«å…³ç³»çš„å‘é‡åç§»é‡"></p>
<p>è¿™ç§å‘é‡ç»„åˆä¹Ÿè®©æˆ‘ä»¬å›ç­”â€œå›½ç‹-ç”·äºº+å¥³äºº&#x3D;ï¼Ÿâ€æé—®å¹¶å¾—å‡ºç»“æœâ€œå¥³ç‹â€ï¼å½“ä½ è®¤ä¸ºæ‰€æœ‰è¿™äº›çŸ¥è¯†ä»…ä»…æ¥è‡ªäºåœ¨ä¸Šä¸‹æ–‡ä¸­æŸ¥çœ‹å¤§é‡å•è¯ï¼Œè€Œæ²¡æœ‰æä¾›å…³äºå®ƒä»¬çš„è¯­ä¹‰çš„å…¶ä»–ä¿¡æ¯æ—¶ï¼Œæ‰€æœ‰è¿™äº›éƒ½æ˜¯éå¸¸å€¼å¾—æ³¨æ„çš„ã€‚</p>
<h4 id="Glove"><a href="#Glove" class="headerlink" title="Glove"></a>Glove</h4><p>å•è¯è¡¨ç¤ºçš„å…¨å±€å‘é‡ï¼ˆGloVeï¼‰ç®—æ³•æ˜¯word2vecæ–¹æ³•çš„æ‰©å±•ï¼Œç”¨äºæœ‰æ•ˆå­¦ä¹ å•è¯å‘é‡ã€‚gloveä½¿ç”¨æ•´ä¸ªæ–‡æœ¬è¯­æ–™åº“ä¸­çš„ç»Ÿè®¡ä¿¡æ¯æ„å»ºä¸€ä¸ªæ˜¾å¼çš„å•è¯ä¸Šä¸‹æ–‡æˆ–å•è¯å…±ç°çŸ©é˜µã€‚ç»“æœæ˜¯ä¸€ä¸ªå­¦ä¹ æ¨¡å‹ï¼Œå¯èƒ½ä¼šå¯¼è‡´æ›´å¥½çš„å•è¯åµŒå…¥ã€‚</p>
<p><img src="https://ptpimg.me/0nux0t.png" alt="åœ¨è¿™é‡Œæ’å…¥å›¾ç‰‡æè¿°"></p>
<pre><code class="hljs">Target words: ice, steam
Probe words: solid, gas, water, fashion
</code></pre>
<p>è®©P(k | w)æ˜¯å•è¯kå‡ºç°åœ¨å•è¯Wçš„ä¸Šä¸‹æ–‡ä¸­çš„æ¦‚ç‡W.è€ƒè™‘ä¸€ä¸ªä¸iceæœ‰å¯†åˆ‡å…³ç³»çš„è¯ï¼Œè€Œä¸æ˜¯ä¸steamæœ‰å…³çš„è¯ï¼Œä¾‹å¦‚solidã€‚P(solid | ice)ç›¸å¯¹è¾ƒé«˜ï¼ŒP(solid | steam)ç›¸å¯¹è¾ƒä½ã€‚å› æ­¤ï¼ŒP(solid | ice)&#x2F; P(solid | steam)çš„æ¯”ç‡å°†å¾ˆå¤§ã€‚å¦‚æœæˆ‘ä»¬ç”¨ä¸€ä¸ªè¯ï¼Œæ¯”å¦‚æ°”ä½“ï¼Œå®ƒä¸steamæœ‰å…³ï¼Œä½†ä¸iceæ— å…³ï¼Œé‚£ä¹ˆP(gas | ice) &#x2F; P(gas | steam) çš„æ¯”å€¼å°±ä¼šå˜å°ã€‚å¯¹äºä¸€ä¸ªæ—¢ä¸iceæœ‰å…³åˆä¸wateræœ‰å…³çš„è¯ï¼Œä¾‹å¦‚waterï¼Œæˆ‘ä»¬é¢„è®¡å…¶æ¯”ç‡æ¥è¿‘1ã€‚</p>
<p>å•è¯åµŒå…¥å°†æ¯ä¸ªå•è¯ç¼–ç æˆä¸€ä¸ªå‘é‡ï¼Œè¯¥å‘é‡æ•è·æ–‡æœ¬è¯­æ–™åº“ä¸­å•è¯ä¹‹é—´çš„æŸç§å…³ç³»å’Œç›¸ä¼¼æ€§ã€‚è¿™æ„å‘³ç€å³ä½¿æ˜¯å¤§å°å†™ã€æ‹¼å†™ã€æ ‡ç‚¹ç¬¦å·ç­‰å•è¯çš„å˜ä½“ä¹Ÿä¼šè‡ªåŠ¨å­¦ä¹ ã€‚åè¿‡æ¥ï¼Œè¿™æ„å‘³ç€å¯èƒ½ä¸å†éœ€è¦ä¸Šè¿°ä¸€äº›æ–‡æœ¬æ¸…ç†æ­¥éª¤ã€‚</p>
<h1 id="å››ã€ç”µå½±è¯„è®ºæƒ…æ„Ÿåˆ†æå®ä¾‹"><a href="#å››ã€ç”µå½±è¯„è®ºæƒ…æ„Ÿåˆ†æå®ä¾‹" class="headerlink" title="å››ã€ç”µå½±è¯„è®ºæƒ…æ„Ÿåˆ†æå®ä¾‹"></a>å››ã€ç”µå½±è¯„è®ºæƒ…æ„Ÿåˆ†æå®ä¾‹</h1><p>æ ¹æ®é—®é¢˜ç©ºé—´å’Œå¯ç”¨æ•°æ®çš„ä¸åŒï¼Œæœ‰å¤šç§æ–¹æ³•ä¸ºå„ç§åŸºäºæ–‡æœ¬çš„åº”ç”¨ç¨‹åºæ„å»ºMLæ¨¡å‹ã€‚<br>ç”¨äºåƒåœ¾é‚®ä»¶è¿‡æ»¤çš„ç»å…¸MLæ–¹æ³•ï¼Œå¦‚â€œæœ´ç´ è´å¶æ–¯â€æˆ–â€œæ”¯æŒå‘é‡æœºâ€ï¼Œå·²è¢«å¹¿æ³›ä½¿ç”¨ã€‚æ·±åº¦å­¦ä¹ æŠ€æœ¯å¯¹äºè‡ªç„¶è¯­è¨€å¤„ç†é—®é¢˜ï¼ˆå¦‚æƒ…æ„Ÿåˆ†æå’Œè¯­è¨€ç¿»è¯‘ï¼‰æœ‰æ›´å¥½çš„æ•ˆæœã€‚æ·±åº¦å­¦ä¹ æ¨¡å‹çš„è®­ç»ƒé€Ÿåº¦éå¸¸æ…¢ï¼Œå¹¶ä¸”å¯ä»¥çœ‹å‡ºï¼Œå¯¹äºç®€å•çš„æ–‡æœ¬åˆ†ç±»é—®é¢˜ï¼Œç»å…¸çš„MLæ–¹æ³•ä¹Ÿèƒ½ä»¥æ›´å¿«çš„è®­ç»ƒæ—¶é—´ç»™å‡ºç±»ä¼¼çš„ç»“æœã€‚<br>è®©æˆ‘ä»¬ä½¿ç”¨ç›®å‰è®¨è®ºçš„æŠ€æœ¯åœ¨Kaggleæä¾›çš„çƒ‚ç•ªèŒ„ç”µå½±è¯„è®ºæ•°æ®é›†ä¸Šæ„å»ºä¸€ä¸ªæƒ…æ„Ÿåˆ†æå™¨ã€‚</p>
<h2 id="ç”µå½±è¯„è®ºæƒ…æ„Ÿåˆ†æ"><a href="#ç”µå½±è¯„è®ºæƒ…æ„Ÿåˆ†æ" class="headerlink" title="ç”µå½±è¯„è®ºæƒ…æ„Ÿåˆ†æ"></a>ç”µå½±è¯„è®ºæƒ…æ„Ÿåˆ†æ</h2><p><img src="https://ptpimg.me/1blyr8.png"></p>
<p>å¯¹äºç”µå½±è¯„è®ºæƒ…ç»ªåˆ†æï¼Œæˆ‘ä»¬å°†ä½¿ç”¨Kaggleæä¾›çš„çƒ‚ç•ªèŒ„ç”µå½±è¯„è®ºæ•°æ®é›†ã€‚åœ¨è¿™é‡Œï¼Œæˆ‘ä»¬æ ¹æ®ç”µå½±è¯„è®ºçš„æƒ…ç»ªï¼Œä»¥äº”ä¸ªå€¼ä¸ºå°ºåº¦ç»™çŸ­è¯­è´´ä¸Šæ ‡ç­¾ï¼šæ¶ˆæçš„ï¼Œæœ‰äº›æ¶ˆæçš„ï¼Œä¸­æ€§çš„ï¼Œæœ‰äº›ç§¯æçš„ï¼Œç§¯æçš„ã€‚æ•°æ®é›†ç”±é€‰é¡¹å¡åˆ†éš”çš„æ–‡ä»¶ç»„æˆï¼Œå…¶ä¸­åŒ…å«æ¥è‡ªæ•°æ®é›†çš„çŸ­è¯­IDã€‚æ¯ä¸ªçŸ­è¯­éƒ½æœ‰ä¸€ä¸ªçŸ­è¯­ã€‚æ¯ä¸ªå¥å­éƒ½æœ‰ä¸€ä¸ªå¥å­IDã€‚é‡å¤çš„çŸ­è¯­ï¼ˆå¦‚çŸ­&#x2F;å¸¸ç”¨è¯ï¼‰ä»…åœ¨æ•°æ®ä¸­åŒ…å«ä¸€æ¬¡ã€‚æƒ…ç»ªæ ‡ç­¾åŒ…æ‹¬ï¼š</p>
<ul>
<li>0 - <em>negative</em></li>
<li>1 - <em>somewhat negative</em></li>
<li>2 - <em>neutral</em></li>
<li>3 - <em>somewhat positive</em></li>
<li>4 - <em>positive</em></li>
</ul>
<figure class="highlight python"><table><tr><td class="code"><pre><code class="hljs python"><span class="hljs-keyword">import</span> pandas <span class="hljs-keyword">as</span> pd<br><span class="hljs-keyword">import</span> numpy <span class="hljs-keyword">as</span> np<br><span class="hljs-keyword">import</span> matplotlib.pyplot <span class="hljs-keyword">as</span> plt<br><span class="hljs-keyword">import</span> seaborn <span class="hljs-keyword">as</span> sns<br>%matplotlib inline<br><br></code></pre></td></tr></table></figure>

<h2 id="1-åˆå§‹åŒ–æ•°æ®"><a href="#1-åˆå§‹åŒ–æ•°æ®" class="headerlink" title="1. åˆå§‹åŒ–æ•°æ®"></a><a id='1'>1. åˆå§‹åŒ–æ•°æ®</a></h2><figure class="highlight python"><table><tr><td class="code"><pre><code class="hljs python">df_train = pd.read_csv(<span class="hljs-string">&quot;/Users/gawaintan/workSpace/movie-review-sentiment-analysis-kernels-only/train.tsv&quot;</span>, sep=<span class="hljs-string">&#x27;\t&#x27;</span>)<br>df_train.head()<br></code></pre></td></tr></table></figure>




<div>
<style scoped>
    .dataframe tbody tr th:only-of-type {
        vertical-align: middle;
    }

<pre><code class="hljs">.dataframe tbody tr th &#123;
    vertical-align: top;
&#125;

.dataframe thead th &#123;
    text-align: right;
&#125;
</code></pre>
<p></style></p>
<table border="1" class="dataframe">
  <thead>
    <tr style="text-align: right;">
      <th></th>
      <th>PhraseId</th>
      <th>SentenceId</th>
      <th>Phrase</th>
      <th>Sentiment</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <th>0</th>
      <td>1</td>
      <td>1</td>
      <td>A series of escapades demonstrating the adage ...</td>
      <td>1</td>
    </tr>
    <tr>
      <th>1</th>
      <td>2</td>
      <td>1</td>
      <td>A series of escapades demonstrating the adage ...</td>
      <td>2</td>
    </tr>
    <tr>
      <th>2</th>
      <td>3</td>
      <td>1</td>
      <td>A series</td>
      <td>2</td>
    </tr>
    <tr>
      <th>3</th>
      <td>4</td>
      <td>1</td>
      <td>A</td>
      <td>2</td>
    </tr>
    <tr>
      <th>4</th>
      <td>5</td>
      <td>1</td>
      <td>series</td>
      <td>2</td>
    </tr>
  </tbody>
</table>
</div>




<figure class="highlight python"><table><tr><td class="code"><pre><code class="hljs python">df_test = pd.read_csv(<span class="hljs-string">&quot;/Users/gawaintan/workSpace/movie-review-sentiment-analysis-kernels-only/test.tsv&quot;</span>, sep=<span class="hljs-string">&#x27;\t&#x27;</span>)<br>df_test.head()<br></code></pre></td></tr></table></figure>




<div>
<style scoped>
    .dataframe tbody tr th:only-of-type {
        vertical-align: middle;
    }

<pre><code class="hljs">.dataframe tbody tr th &#123;
    vertical-align: top;
&#125;

.dataframe thead th &#123;
    text-align: right;
&#125;
</code></pre>
<p></style></p>
<table border="1" class="dataframe">
  <thead>
    <tr style="text-align: right;">
      <th></th>
      <th>PhraseId</th>
      <th>SentenceId</th>
      <th>Phrase</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <th>0</th>
      <td>156061</td>
      <td>8545</td>
      <td>An intermittently pleasing but mostly routine ...</td>
    </tr>
    <tr>
      <th>1</th>
      <td>156062</td>
      <td>8545</td>
      <td>An intermittently pleasing but mostly routine ...</td>
    </tr>
    <tr>
      <th>2</th>
      <td>156063</td>
      <td>8545</td>
      <td>An</td>
    </tr>
    <tr>
      <th>3</th>
      <td>156064</td>
      <td>8545</td>
      <td>intermittently pleasing but mostly routine effort</td>
    </tr>
    <tr>
      <th>4</th>
      <td>156065</td>
      <td>8545</td>
      <td>intermittently pleasing but mostly routine</td>
    </tr>
  </tbody>
</table>
</div>



<h2 id="1-1-æ¯ä¸ªæƒ…ç»ªç±»åˆ«ä¸­çš„è¯„è®ºåˆ†å¸ƒ"><a href="#1-1-æ¯ä¸ªæƒ…ç»ªç±»åˆ«ä¸­çš„è¯„è®ºåˆ†å¸ƒ" class="headerlink" title="1.1 æ¯ä¸ªæƒ…ç»ªç±»åˆ«ä¸­çš„è¯„è®ºåˆ†å¸ƒ"></a><a id='1.1'>1.1 æ¯ä¸ªæƒ…ç»ªç±»åˆ«ä¸­çš„è¯„è®ºåˆ†å¸ƒ</a></h2><p>åœ¨è¿™é‡Œï¼Œè®­ç»ƒæ•°æ®é›†åŒ…å«äº†ç”µå½±è¯„è®ºä¸­å ä¸»å¯¼åœ°ä½çš„ä¸­æ€§çŸ­è¯­ï¼Œç„¶åæ˜¯æœ‰äº›ç§¯æçš„ï¼Œç„¶åæ˜¯æœ‰äº›æ¶ˆæçš„ã€‚</p>
<figure class="highlight python"><table><tr><td class="code"><pre><code class="hljs python">df_train.Sentiment.value_counts()<br></code></pre></td></tr></table></figure>




<pre><code class="hljs">2    79582
3    32927
1    27273
4     9206
0     7072
Name: Sentiment, dtype: int64
</code></pre>
<figure class="highlight python"><table><tr><td class="code"><pre><code class="hljs python">df_train.info()<br></code></pre></td></tr></table></figure>

<pre><code class="hljs">&lt;class &#39;pandas.core.frame.DataFrame&#39;&gt;
RangeIndex: 156060 entries, 0 to 156059
Data columns (total 4 columns):
 #   Column      Non-Null Count   Dtype 
---  ------      --------------   ----- 
 0   PhraseId    156060 non-null  int64 
 1   SentenceId  156060 non-null  int64 
 2   Phrase      156060 non-null  object
 3   Sentiment   156060 non-null  int64 
dtypes: int64(3), object(1)
memory usage: 4.8+ MB
</code></pre>
<h2 id="1-2-åˆ é™¤ä¸é‡è¦çš„åˆ—"><a href="#1-2-åˆ é™¤ä¸é‡è¦çš„åˆ—" class="headerlink" title="1.2 åˆ é™¤ä¸é‡è¦çš„åˆ—"></a><a id='1.2'>1.2 åˆ é™¤ä¸é‡è¦çš„åˆ—</a></h2><figure class="highlight python"><table><tr><td class="code"><pre><code class="hljs python">df_train_1 = df_train.drop([<span class="hljs-string">&#x27;PhraseId&#x27;</span>,<span class="hljs-string">&#x27;SentenceId&#x27;</span>],axis=<span class="hljs-number">1</span>)<br>df_train_1.head()<br></code></pre></td></tr></table></figure>




<div>
<style scoped>
    .dataframe tbody tr th:only-of-type {
        vertical-align: middle;
    }

<pre><code class="hljs">.dataframe tbody tr th &#123;
    vertical-align: top;
&#125;

.dataframe thead th &#123;
    text-align: right;
&#125;
</code></pre>
<p></style></p>
<table border="1" class="dataframe">
  <thead>
    <tr style="text-align: right;">
      <th></th>
      <th>Phrase</th>
      <th>Sentiment</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <th>0</th>
      <td>A series of escapades demonstrating the adage ...</td>
      <td>1</td>
    </tr>
    <tr>
      <th>1</th>
      <td>A series of escapades demonstrating the adage ...</td>
      <td>2</td>
    </tr>
    <tr>
      <th>2</th>
      <td>A series</td>
      <td>2</td>
    </tr>
    <tr>
      <th>3</th>
      <td>A</td>
      <td>2</td>
    </tr>
    <tr>
      <th>4</th>
      <td>series</td>
      <td>2</td>
    </tr>
  </tbody>
</table>
</div>



<p>Letâ€™s check the phrase length of each of the movie reviews.</p>
<figure class="highlight python"><table><tr><td class="code"><pre><code class="hljs python">df_train_1[<span class="hljs-string">&#x27;phrase_len&#x27;</span>] = [<span class="hljs-built_in">len</span>(t) <span class="hljs-keyword">for</span> t <span class="hljs-keyword">in</span> df_train_1.Phrase]<br>df_train_1.head(<span class="hljs-number">4</span>)<br></code></pre></td></tr></table></figure>




<div>
<style scoped>
    .dataframe tbody tr th:only-of-type {
        vertical-align: middle;
    }

<pre><code class="hljs">.dataframe tbody tr th &#123;
    vertical-align: top;
&#125;

.dataframe thead th &#123;
    text-align: right;
&#125;
</code></pre>
<p></style></p>
<table border="1" class="dataframe">
  <thead>
    <tr style="text-align: right;">
      <th></th>
      <th>Phrase</th>
      <th>Sentiment</th>
      <th>phrase_len</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <th>0</th>
      <td>A series of escapades demonstrating the adage ...</td>
      <td>1</td>
      <td>188</td>
    </tr>
    <tr>
      <th>1</th>
      <td>A series of escapades demonstrating the adage ...</td>
      <td>2</td>
      <td>77</td>
    </tr>
    <tr>
      <th>2</th>
      <td>A series</td>
      <td>2</td>
      <td>8</td>
    </tr>
    <tr>
      <th>3</th>
      <td>A</td>
      <td>2</td>
      <td>1</td>
    </tr>
  </tbody>
</table>
</div>



<h2 id="1-3-å„æƒ…æ„Ÿç±»åˆ«ä¸‹è¯„è®ºæ—¶é•¿çš„æ€»ä½“åˆ†å¸ƒ"><a href="#1-3-å„æƒ…æ„Ÿç±»åˆ«ä¸‹è¯„è®ºæ—¶é•¿çš„æ€»ä½“åˆ†å¸ƒ" class="headerlink" title="1.3 å„æƒ…æ„Ÿç±»åˆ«ä¸‹è¯„è®ºæ—¶é•¿çš„æ€»ä½“åˆ†å¸ƒ"></a><a id='1.3'>1.3 å„æƒ…æ„Ÿç±»åˆ«ä¸‹è¯„è®ºæ—¶é•¿çš„æ€»ä½“åˆ†å¸ƒ</a></h2><figure class="highlight python"><table><tr><td class="code"><pre><code class="hljs python">fig,ax = plt.subplots(figsize=(<span class="hljs-number">5</span>,<span class="hljs-number">5</span>))<br>plt.boxplot(df_train_1.phrase_len)<br>plt.show()<br></code></pre></td></tr></table></figure>


<p><img src="https://i-blog.csdnimg.cn/blog_migrate/72e054ceb9fb8ebddc1a279dcefa8606.png"></p>
<p>ä»ä¸Šé¢çš„ç®±çº¿å›¾ä¸­ï¼Œæœ‰äº›è¯„è®ºçš„é•¿åº¦è¶…è¿‡ 100 ä¸ªå­—ç¬¦ã€‚</p>
<figure class="highlight python"><table><tr><td class="code"><pre><code class="hljs python">df_train_1[df_train_1.phrase_len &gt; <span class="hljs-number">100</span>].head()<br></code></pre></td></tr></table></figure>




<div>
<style scoped>
    .dataframe tbody tr th:only-of-type {
        vertical-align: middle;
    }

<pre><code class="hljs">.dataframe tbody tr th &#123;
    vertical-align: top;
&#125;

.dataframe thead th &#123;
    text-align: right;
&#125;
</code></pre>
<p></style></p>
<table border="1" class="dataframe">
  <thead>
    <tr style="text-align: right;">
      <th></th>
      <th>Phrase</th>
      <th>Sentiment</th>
      <th>phrase_len</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <th>0</th>
      <td>A series of escapades demonstrating the adage ...</td>
      <td>1</td>
      <td>188</td>
    </tr>
    <tr>
      <th>27</th>
      <td>is also good for the gander , some of which oc...</td>
      <td>2</td>
      <td>110</td>
    </tr>
    <tr>
      <th>28</th>
      <td>is also good for the gander , some of which oc...</td>
      <td>2</td>
      <td>108</td>
    </tr>
    <tr>
      <th>116</th>
      <td>A positively thrilling combination of ethnogra...</td>
      <td>3</td>
      <td>152</td>
    </tr>
    <tr>
      <th>117</th>
      <td>A positively thrilling combination of ethnogra...</td>
      <td>4</td>
      <td>150</td>
    </tr>
  </tbody>
</table>
</div>




<figure class="highlight python"><table><tr><td class="code"><pre><code class="hljs python">df_train_1[df_train_1.phrase_len &gt; <span class="hljs-number">100</span>].loc[<span class="hljs-number">0</span>].Phrase<br></code></pre></td></tr></table></figure>




<pre><code class="hljs">&#39;A series of escapades demonstrating the adage that what is good for the goose is also good for the gander , some of which occasionally amuses but none of which amounts to much of a story .&#39;
</code></pre>
<h2 id="1-4-åˆ›å»ºè´Ÿé¢å’Œæ­£é¢ç”µå½±è¯„è®ºçš„è¯äº‘"><a href="#1-4-åˆ›å»ºè´Ÿé¢å’Œæ­£é¢ç”µå½±è¯„è®ºçš„è¯äº‘" class="headerlink" title="1.4 åˆ›å»ºè´Ÿé¢å’Œæ­£é¢ç”µå½±è¯„è®ºçš„è¯äº‘"></a><a id='1.4'>1.4 åˆ›å»ºè´Ÿé¢å’Œæ­£é¢ç”µå½±è¯„è®ºçš„è¯äº‘</a></h2><h3 id="Word-Cloud"><a href="#Word-Cloud" class="headerlink" title="Word Cloud"></a>Word Cloud</h3><p>wordcloud æ˜¯æ–‡æœ¬æ–‡ä»¶é›†åˆä¸­å¸¸ç”¨è¯çš„å›¾å½¢è¡¨ç¤ºã€‚è¿™å¼ å›¾ç‰‡ä¸­æ¯ä¸ªè¯çš„é«˜åº¦æ˜¯è¯¥è¯åœ¨æ•´ä¸ªæ–‡æœ¬ä¸­å‡ºç°é¢‘ç‡çš„æŒ‡æ ‡ã€‚åœ¨è¿›è¡Œæ–‡æœ¬åˆ†ææ—¶ï¼Œæ­¤ç±»å›¾è¡¨éå¸¸æœ‰ç”¨ã€‚</p>
<h2 id="1-4-1-ç­›é€‰å‡ºæ­£é¢å’Œè´Ÿé¢çš„å½±è¯„"><a href="#1-4-1-ç­›é€‰å‡ºæ­£é¢å’Œè´Ÿé¢çš„å½±è¯„" class="headerlink" title="1.4.1 ç­›é€‰å‡ºæ­£é¢å’Œè´Ÿé¢çš„å½±è¯„"></a><a id='1.4.1'>1.4.1 ç­›é€‰å‡ºæ­£é¢å’Œè´Ÿé¢çš„å½±è¯„</a></h2><figure class="highlight python"><table><tr><td class="code"><pre><code class="hljs python">neg_phrases = df_train_1[df_train_1.Sentiment == <span class="hljs-number">0</span>]<br>neg_words = []<br><span class="hljs-keyword">for</span> t <span class="hljs-keyword">in</span> neg_phrases.Phrase:<br>    neg_words.append(t)<br>neg_words[:<span class="hljs-number">4</span>]<br></code></pre></td></tr></table></figure>




<pre><code class="hljs">[&#39;would have a hard time sitting through this one&#39;,
 &#39;have a hard time sitting through this one&#39;,
 &#39;Aggressive self-glorification and a manipulative whitewash&#39;,
 &#39;self-glorification and a manipulative whitewash&#39;]
</code></pre>
<p>**pandas.Series.str.cat ** : ä½¿ç”¨ç»™å®šçš„åˆ†éš”ç¬¦è¿æ¥ç³»åˆ—&#x2F;ç´¢å¼•ä¸­çš„å­—ç¬¦ä¸²ã€‚è¿™é‡Œæˆ‘ä»¬ç»™ä¸€ä¸ªç©ºæ ¼ä½œä¸ºåˆ†éš”ç¬¦ï¼Œå› æ­¤ï¼Œå®ƒå°†è¿æ¥æ¯ä¸ªç´¢å¼•ä¸­ç”±ç©ºæ ¼åˆ†éš”çš„æ‰€æœ‰å­—ç¬¦ä¸²ã€‚</p>
<figure class="highlight python"><table><tr><td class="code"><pre><code class="hljs python">neg_text = pd.Series(neg_words).<span class="hljs-built_in">str</span>.cat(sep=<span class="hljs-string">&#x27; &#x27;</span>)<br>neg_text[:<span class="hljs-number">100</span>]<br></code></pre></td></tr></table></figure>




<pre><code class="hljs">&#39;would have a hard time sitting through this one have a hard time sitting through this one Aggressive&#39;
</code></pre>
<figure class="highlight python"><table><tr><td class="code"><pre><code class="hljs python"><span class="hljs-keyword">for</span> t <span class="hljs-keyword">in</span> neg_phrases.Phrase[:<span class="hljs-number">300</span>]:<br>    <span class="hljs-keyword">if</span> <span class="hljs-string">&#x27;good&#x27;</span> <span class="hljs-keyword">in</span> t:<br>        <span class="hljs-built_in">print</span>(t)<br></code></pre></td></tr></table></figure>

<pre><code class="hljs">&#39;s not a particularly good film
covers huge , heavy topics in a bland , surfacey way that does n&#39;t offer any insight into why , for instance , good things happen to bad people .
huge , heavy topics in a bland , surfacey way that does n&#39;t offer any insight into why , for instance , good things happen to bad people
a bland , surfacey way that does n&#39;t offer any insight into why , for instance , good things happen to bad people
</code></pre>
<p>æ‰€ä»¥ï¼Œæˆ‘ä»¬å¯ä»¥å¾ˆæ¸…æ¥šåœ°çœ‹åˆ°ï¼Œå³ä½¿æ–‡æœ¬åŒ…å«â€œå¥½â€è¿™æ ·çš„è¯ï¼Œä¹Ÿæ˜¯ä¸€ç§è´Ÿé¢æƒ…ç»ªï¼Œå› ä¸ºå®ƒè¡¨æ˜è¿™éƒ¨ç”µå½±ä¸æ˜¯ä¸€éƒ¨å¥½ç”µå½±ã€‚</p>
<figure class="highlight python"><table><tr><td class="code"><pre><code class="hljs python">pos_phrases = df_train_1[df_train_1.Sentiment == <span class="hljs-number">4</span>] <span class="hljs-comment">## 4 is positive sentiment</span><br>pos_string = []<br><span class="hljs-keyword">for</span> t <span class="hljs-keyword">in</span> pos_phrases.Phrase:<br>    pos_string.append(t)<br>pos_text = pd.Series(pos_string).<span class="hljs-built_in">str</span>.cat(sep=<span class="hljs-string">&#x27; &#x27;</span>)<br>pos_text[:<span class="hljs-number">100</span>]<br>    <br></code></pre></td></tr></table></figure>




<pre><code class="hljs">&#39;This quiet , introspective and entertaining independent is worth seeking . quiet , introspective and&#39;
</code></pre>
<h2 id="1-4-2-è´Ÿé¢åˆ†ç±»å½±è¯„çš„è¯äº‘"><a href="#1-4-2-è´Ÿé¢åˆ†ç±»å½±è¯„çš„è¯äº‘" class="headerlink" title="1.4.2 è´Ÿé¢åˆ†ç±»å½±è¯„çš„è¯äº‘"></a><a id='1.4.2'>1.4.2 è´Ÿé¢åˆ†ç±»å½±è¯„çš„è¯äº‘</a></h2><figure class="highlight python"><table><tr><td class="code"><pre><code class="hljs python"><span class="hljs-keyword">from</span> wordcloud <span class="hljs-keyword">import</span> WordCloud<br>wordcloud = WordCloud(width=<span class="hljs-number">1600</span>, height=<span class="hljs-number">800</span>, max_font_size=<span class="hljs-number">200</span>).generate(neg_text)<br>plt.figure(figsize=(<span class="hljs-number">12</span>,<span class="hljs-number">10</span>))<br>plt.imshow(wordcloud, interpolation=<span class="hljs-string">&#x27;bilinear&#x27;</span>)<br>plt.axis(<span class="hljs-string">&quot;off&quot;</span>)<br>plt.show()<br></code></pre></td></tr></table></figure>


<p><img src="https://ptpimg.me/wm153z.png" alt="åœ¨è¿™é‡Œæ’å…¥å›¾ç‰‡æè¿°"></p>
<p>ä¸€äº›å¤§çš„è¯å¯ä»¥è§£é‡Šå¾—ç›¸å½“ä¸­æ€§ï¼Œä¾‹å¦‚â€œfilmâ€ã€â€œmoiveâ€ç­‰ã€‚æˆ‘ä»¬å¯ä»¥çœ‹åˆ°ä¸€äº›è¾ƒå°çš„è¯åœ¨è´Ÿé¢ç”µå½±è¯„è®ºä¸­æ˜¯æœ‰æ„ä¹‰çš„ï¼Œä¾‹å¦‚â€œbad movieâ€ã€â€œdullâ€ ã€â€œboringâ€ç­‰ã€‚</p>
<p>ç„¶è€Œï¼Œåœ¨å¯¹è¿™éƒ¨ç”µå½±çš„è´Ÿé¢åˆ†ç±»æƒ…ç»ªä¸­ï¼Œä¹Ÿæœ‰ä¸€äº›åƒâ€œå¥½â€è¿™æ ·çš„è¯ã€‚è®©æˆ‘ä»¬æ›´æ·±å…¥åœ°äº†è§£è¿™äº›å•è¯&#x2F;æ–‡æœ¬ï¼š</p>
<h2 id="1-4-3-æ­£åˆ†ç±»å½±è¯„çš„è¯äº‘"><a href="#1-4-3-æ­£åˆ†ç±»å½±è¯„çš„è¯äº‘" class="headerlink" title="1.4.3 æ­£åˆ†ç±»å½±è¯„çš„è¯äº‘"></a><a id='1.4.3'>1.4.3 æ­£åˆ†ç±»å½±è¯„çš„è¯äº‘</a></h2><figure class="highlight python"><table><tr><td class="code"><pre><code class="hljs python">wordcloud = WordCloud(width=<span class="hljs-number">1600</span>, height=<span class="hljs-number">800</span>, max_font_size=<span class="hljs-number">200</span>).generate(pos_text)<br>plt.figure(figsize=(<span class="hljs-number">12</span>,<span class="hljs-number">10</span>))<br>plt.imshow(wordcloud, interpolation=<span class="hljs-string">&#x27;bilinear&#x27;</span>)<br>plt.axis(<span class="hljs-string">&#x27;off&#x27;</span>)<br>plt.show()<br></code></pre></td></tr></table></figure>


<p><img src="https://ptpimg.me/mqvx0x.png" alt="åœ¨è¿™é‡Œæ’å…¥å›¾ç‰‡æè¿°"></p>
<p>æˆ‘å†æ¬¡çœ‹åˆ°ä¸€äº›å¤§å°ºå¯¸çš„ä¸­æ€§è¯ï¼Œâ€œmovieâ€ï¼Œâ€œfilmâ€ï¼Œä½†åƒâ€œgoodâ€ï¼Œâ€œnestâ€ï¼Œâ€œfascinatingâ€è¿™æ ·çš„æ­£é¢è¯ä¹Ÿå¾ˆçªå‡ºã€‚</p>
<h2 id="1-5-æ‰€æœ‰5ä¸ªæƒ…æ„Ÿç±»åˆ«çš„æ€»è¯é¢‘"><a href="#1-5-æ‰€æœ‰5ä¸ªæƒ…æ„Ÿç±»åˆ«çš„æ€»è¯é¢‘" class="headerlink" title="1.5 æ‰€æœ‰5ä¸ªæƒ…æ„Ÿç±»åˆ«çš„æ€»è¯é¢‘"></a><a id='1.5'>1.5 æ‰€æœ‰5ä¸ªæƒ…æ„Ÿç±»åˆ«çš„æ€»è¯é¢‘</a></h2><p>æˆ‘ä»¬éœ€è¦ Term Frequency æ•°æ®æ¥æŸ¥çœ‹ç”µå½±è¯„è®ºä¸­ä½¿ç”¨äº†å“ªäº›è¯ä»¥åŠä½¿ç”¨äº†å¤šå°‘æ¬¡ã€‚è®©æˆ‘ä»¬ç»§ç»­ä½¿ç”¨ CountVectorizer æ¥è®¡ç®—è¯é¢‘ï¼š</p>
<figure class="highlight python"><table><tr><td class="code"><pre><code class="hljs python"><span class="hljs-keyword">from</span> sklearn.feature_extraction.text <span class="hljs-keyword">import</span> CountVectorizer<br>cvector = CountVectorizer(min_df = <span class="hljs-number">0.0</span>, max_df = <span class="hljs-number">1.0</span>, ngram_range=(<span class="hljs-number">1</span>,<span class="hljs-number">2</span>))<br>cvector.fit(df_train_1.Phrase)<br></code></pre></td></tr></table></figure>




<pre><code class="hljs">CountVectorizer(min_df=0.0, ngram_range=(1, 2))
</code></pre>
<figure class="highlight python"><table><tr><td class="code"><pre><code class="hljs python"><span class="hljs-built_in">len</span>(cvector.get_feature_names())<br></code></pre></td></tr></table></figure>

<pre><code class="hljs">94644
</code></pre>
<p>çœ‹èµ·æ¥ count vectorizer å·²ç»ä»è¯­æ–™åº“ä¸­æå–äº† 94644 ä¸ªå•è¯ã€‚å¯ä»¥ä½¿ç”¨ä»¥ä¸‹ä»£ç å—è·å–æ¯ä¸ªç±»çš„è¯é¢‘ã€‚</p>
<figure class="highlight python"><table><tr><td class="code"><pre><code class="hljs python">All_matrix=[]<br>All_words=[]<br>All_labels=[<span class="hljs-string">&#x27;negative&#x27;</span>,<span class="hljs-string">&#x27;some-negative&#x27;</span>,<span class="hljs-string">&#x27;neutral&#x27;</span>,<span class="hljs-string">&#x27;some-positive&#x27;</span>,<span class="hljs-string">&#x27;positive&#x27;</span>]<br>neg_matrix = cvector.transform(df_train_1[df_train_1.Sentiment == <span class="hljs-number">0</span>].Phrase)<br>term_freq_df= pd.DataFrame(<span class="hljs-built_in">list</span>(<span class="hljs-built_in">sorted</span>([(word, neg_matrix.<span class="hljs-built_in">sum</span>(axis=<span class="hljs-number">0</span>)[<span class="hljs-number">0</span>, idx]) <span class="hljs-keyword">for</span> word, idx <span class="hljs-keyword">in</span> cvector.vocabulary_.items()], key = <span class="hljs-keyword">lambda</span> x: x[<span class="hljs-number">1</span>], reverse=<span class="hljs-literal">True</span>)),columns=[<span class="hljs-string">&#x27;Terms&#x27;</span>,<span class="hljs-string">&#x27;negative&#x27;</span>])<br>term_freq_df=term_freq_df.set_index(<span class="hljs-string">&#x27;Terms&#x27;</span>)<br><span class="hljs-keyword">for</span> i <span class="hljs-keyword">in</span> <span class="hljs-built_in">range</span>(<span class="hljs-number">1</span>,<span class="hljs-number">5</span>):<br>    All_matrix.append(cvector.transform(df_train_1[df_train_1.Sentiment == i].Phrase))<br>    All_words.append(All_matrix[i-<span class="hljs-number">1</span>].<span class="hljs-built_in">sum</span>(axis=<span class="hljs-number">0</span>))<br>    aa=pd.DataFrame(<span class="hljs-built_in">list</span>(<span class="hljs-built_in">sorted</span>([(word,All_words[i-<span class="hljs-number">1</span>][<span class="hljs-number">0</span>, idx]) <span class="hljs-keyword">for</span> word, idx <span class="hljs-keyword">in</span> cvector.vocabulary_.items()], key = <span class="hljs-keyword">lambda</span> x: x[<span class="hljs-number">1</span>], reverse=<span class="hljs-literal">True</span>)),columns=[<span class="hljs-string">&#x27;Terms&#x27;</span>,All_labels[i]])<br>    <br>    term_freq_df=term_freq_df.join(aa.set_index(<span class="hljs-string">&#x27;Terms&#x27;</span>),how=<span class="hljs-string">&#x27;left&#x27;</span>,lsuffix=<span class="hljs-string">&#x27;_A&#x27;</span>)<br><br>    <br><br>term_freq_df[<span class="hljs-string">&#x27;total&#x27;</span>] = term_freq_df[<span class="hljs-string">&#x27;negative&#x27;</span>] + term_freq_df[<span class="hljs-string">&#x27;some-negative&#x27;</span>] + term_freq_df[<span class="hljs-string">&#x27;neutral&#x27;</span>] + term_freq_df[<span class="hljs-string">&#x27;some-positive&#x27;</span>] +  term_freq_df[<span class="hljs-string">&#x27;positive&#x27;</span>] <br>term_freq_df.sort_values(by=<span class="hljs-string">&#x27;total&#x27;</span>, ascending=<span class="hljs-literal">False</span>).head(<span class="hljs-number">10</span>)<br></code></pre></td></tr></table></figure>




<div>
<style scoped>
    .dataframe tbody tr th:only-of-type {
        vertical-align: middle;
    }

<pre><code class="hljs">.dataframe tbody tr th &#123;
    vertical-align: top;
&#125;

.dataframe thead th &#123;
    text-align: right;
&#125;
</code></pre>
<p></style></p>
<table border="1" class="dataframe">
  <thead>
    <tr style="text-align: right;">
      <th></th>
      <th>negative</th>
      <th>some-negative</th>
      <th>neutral</th>
      <th>some-positive</th>
      <th>positive</th>
      <th>total</th>
    </tr>
    <tr>
      <th>Terms</th>
      <th></th>
      <th></th>
      <th></th>
      <th></th>
      <th></th>
      <th></th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <th>the</th>
      <td>3462</td>
      <td>10885</td>
      <td>20619</td>
      <td>12459</td>
      <td>4208</td>
      <td>51633</td>
    </tr>
    <tr>
      <th>of</th>
      <td>2277</td>
      <td>6660</td>
      <td>12287</td>
      <td>8405</td>
      <td>3073</td>
      <td>32702</td>
    </tr>
    <tr>
      <th>and</th>
      <td>2549</td>
      <td>6204</td>
      <td>10241</td>
      <td>9180</td>
      <td>4003</td>
      <td>32177</td>
    </tr>
    <tr>
      <th>to</th>
      <td>1916</td>
      <td>5571</td>
      <td>8295</td>
      <td>5411</td>
      <td>1568</td>
      <td>22761</td>
    </tr>
    <tr>
      <th>in</th>
      <td>1038</td>
      <td>2965</td>
      <td>5562</td>
      <td>3365</td>
      <td>1067</td>
      <td>13997</td>
    </tr>
    <tr>
      <th>is</th>
      <td>1372</td>
      <td>3362</td>
      <td>3703</td>
      <td>3489</td>
      <td>1550</td>
      <td>13476</td>
    </tr>
    <tr>
      <th>that</th>
      <td>1139</td>
      <td>2982</td>
      <td>3677</td>
      <td>3280</td>
      <td>1260</td>
      <td>12338</td>
    </tr>
    <tr>
      <th>it</th>
      <td>1086</td>
      <td>3067</td>
      <td>3791</td>
      <td>2927</td>
      <td>863</td>
      <td>11734</td>
    </tr>
    <tr>
      <th>as</th>
      <td>757</td>
      <td>2184</td>
      <td>2941</td>
      <td>2037</td>
      <td>732</td>
      <td>8651</td>
    </tr>
    <tr>
      <th>with</th>
      <td>452</td>
      <td>1533</td>
      <td>2471</td>
      <td>2365</td>
      <td>929</td>
      <td>7750</td>
    </tr>
  </tbody>
</table>
</div>



<p>æˆ‘ä»¬å¯ä»¥æ¸…æ¥šåœ°çœ‹åˆ°ï¼Œåƒâ€œtheâ€ã€â€œinâ€ã€â€œitâ€ç­‰è¯çš„é¢‘ç‡è¦é«˜å¾—å¤šï¼Œå®ƒä»¬å¯¹å½±è¯„çš„æƒ…ç»ªæ²¡æœ‰ä»»ä½•æ„ä¹‰ã€‚å¦ä¸€æ–¹é¢ï¼Œè¯¸å¦‚â€œæ‚²è§‚å¯ç¬‘â€ä¹‹ç±»çš„è¯å®ƒä»¬åœ¨æ–‡æ¡£ä¸­çš„å‡ºç°é¢‘ç‡éå¸¸ä½ï¼Œä½†ä¼¼ä¹ä¸ç”µå½±çš„æƒ…ç»ªæœ‰å¾ˆå¤§å…³ç³»ã€‚</p>
<h2 id="1-6-ç”µå½±è¯„è®ºåˆ†è¯å±•ç¤º"><a href="#1-6-ç”µå½±è¯„è®ºåˆ†è¯å±•ç¤º" class="headerlink" title="1.6 ç”µå½±è¯„è®ºåˆ†è¯å±•ç¤º"></a><a id='1.6'>1.6 ç”µå½±è¯„è®ºåˆ†è¯å±•ç¤º</a></h2><p>Next, letâ€™s explore about how different the tokens in two different classes(positive, negative).</p>
<figure class="highlight python"><table><tr><td class="code"><pre><code class="hljs python"><span class="hljs-keyword">from</span> sklearn.feature_extraction.text <span class="hljs-keyword">import</span> CountVectorizer<br>cvec = CountVectorizer(stop_words=<span class="hljs-string">&#x27;english&#x27;</span>,max_features=<span class="hljs-number">10000</span>)<br>cvec.fit(df_train_1.Phrase)<br></code></pre></td></tr></table></figure>




<pre><code class="hljs">CountVectorizer(max_features=10000, stop_words=&#39;english&#39;)
</code></pre>
<figure class="highlight python"><table><tr><td class="code"><pre><code class="hljs python">neg_matrix = cvec.transform(df_train_1[df_train_1.Sentiment == <span class="hljs-number">0</span>].Phrase)<br>som_neg_matrix = cvec.transform(df_train_1[df_train_1.Sentiment == <span class="hljs-number">1</span>].Phrase)<br>neu_matrix = cvec.transform(df_train_1[df_train_1.Sentiment == <span class="hljs-number">2</span>].Phrase)<br>som_pos_matrix = cvec.transform(df_train_1[df_train_1.Sentiment == <span class="hljs-number">3</span>].Phrase)<br>pos_matrix = cvec.transform(df_train_1[df_train_1.Sentiment == <span class="hljs-number">4</span>].Phrase)<br><br>neg_words = neg_matrix.<span class="hljs-built_in">sum</span>(axis=<span class="hljs-number">0</span>)<br>neg_words_freq = [(word, neg_words[<span class="hljs-number">0</span>, idx]) <span class="hljs-keyword">for</span> word, idx <span class="hljs-keyword">in</span> cvec.vocabulary_.items()]<br>neg_tf = pd.DataFrame(<span class="hljs-built_in">list</span>(<span class="hljs-built_in">sorted</span>(neg_words_freq, key = <span class="hljs-keyword">lambda</span> x: x[<span class="hljs-number">1</span>], reverse=<span class="hljs-literal">True</span>)),columns=[<span class="hljs-string">&#x27;Terms&#x27;</span>,<span class="hljs-string">&#x27;negative&#x27;</span>])<br><br>neg_tf_df = neg_tf.set_index(<span class="hljs-string">&#x27;Terms&#x27;</span>)<br><br><br>som_neg_words = som_neg_matrix.<span class="hljs-built_in">sum</span>(axis=<span class="hljs-number">0</span>)<br>som_neg_words_freq = [(word, som_neg_words[<span class="hljs-number">0</span>, idx]) <span class="hljs-keyword">for</span> word, idx <span class="hljs-keyword">in</span> cvec.vocabulary_.items()]<br>som_neg_tf = pd.DataFrame(<span class="hljs-built_in">list</span>(<span class="hljs-built_in">sorted</span>(som_neg_words_freq, key = <span class="hljs-keyword">lambda</span> x: x[<span class="hljs-number">1</span>], reverse=<span class="hljs-literal">True</span>)),columns=[<span class="hljs-string">&#x27;Terms&#x27;</span>,<span class="hljs-string">&#x27;some-negative&#x27;</span>])<br>som_neg_tf_df = som_neg_tf.set_index(<span class="hljs-string">&#x27;Terms&#x27;</span>)<br><br>neu_words = neu_matrix.<span class="hljs-built_in">sum</span>(axis=<span class="hljs-number">0</span>)<br>neu_words_freq = [(word, neu_words[<span class="hljs-number">0</span>, idx]) <span class="hljs-keyword">for</span> word, idx <span class="hljs-keyword">in</span> cvec.vocabulary_.items()]<br>neu_words_tf = pd.DataFrame(<span class="hljs-built_in">list</span>(<span class="hljs-built_in">sorted</span>(neu_words_freq, key = <span class="hljs-keyword">lambda</span> x: x[<span class="hljs-number">1</span>], reverse=<span class="hljs-literal">True</span>)),columns=[<span class="hljs-string">&#x27;Terms&#x27;</span>,<span class="hljs-string">&#x27;neutral&#x27;</span>])<br>neu_words_tf_df = neu_words_tf.set_index(<span class="hljs-string">&#x27;Terms&#x27;</span>)<br><br>som_pos_words = som_pos_matrix.<span class="hljs-built_in">sum</span>(axis=<span class="hljs-number">0</span>)<br>som_pos_words_freq = [(word, som_pos_words[<span class="hljs-number">0</span>, idx]) <span class="hljs-keyword">for</span> word, idx <span class="hljs-keyword">in</span> cvec.vocabulary_.items()]<br>som_pos_words_tf = pd.DataFrame(<span class="hljs-built_in">list</span>(<span class="hljs-built_in">sorted</span>(som_pos_words_freq, key = <span class="hljs-keyword">lambda</span> x: x[<span class="hljs-number">1</span>], reverse=<span class="hljs-literal">True</span>)),columns=[<span class="hljs-string">&#x27;Terms&#x27;</span>,<span class="hljs-string">&#x27;some-positive&#x27;</span>])<br>som_pos_words_tf_df = som_pos_words_tf.set_index(<span class="hljs-string">&#x27;Terms&#x27;</span>)<br><br>pos_words = pos_matrix.<span class="hljs-built_in">sum</span>(axis=<span class="hljs-number">0</span>)<br>pos_words_freq = [(word, pos_words[<span class="hljs-number">0</span>, idx]) <span class="hljs-keyword">for</span> word, idx <span class="hljs-keyword">in</span> cvec.vocabulary_.items()]<br>pos_words_tf = pd.DataFrame(<span class="hljs-built_in">list</span>(<span class="hljs-built_in">sorted</span>(pos_words_freq, key = <span class="hljs-keyword">lambda</span> x: x[<span class="hljs-number">1</span>], reverse=<span class="hljs-literal">True</span>)),columns=[<span class="hljs-string">&#x27;Terms&#x27;</span>,<span class="hljs-string">&#x27;positive&#x27;</span>])<br>pos_words_tf_df = pos_words_tf.set_index(<span class="hljs-string">&#x27;Terms&#x27;</span>)<br><br>term_freq_df = pd.concat([neg_tf_df,som_neg_tf_df,neu_words_tf_df,som_pos_words_tf_df,pos_words_tf_df],axis=<span class="hljs-number">1</span>)<br><br>term_freq_df[<span class="hljs-string">&#x27;total&#x27;</span>] = term_freq_df[<span class="hljs-string">&#x27;negative&#x27;</span>] + term_freq_df[<span class="hljs-string">&#x27;some-negative&#x27;</span>] \<br>                                 + term_freq_df[<span class="hljs-string">&#x27;neutral&#x27;</span>] + term_freq_df[<span class="hljs-string">&#x27;some-positive&#x27;</span>] \<br>                                 +  term_freq_df[<span class="hljs-string">&#x27;positive&#x27;</span>] <br>        <br>term_freq_df.sort_values(by=<span class="hljs-string">&#x27;total&#x27;</span>, ascending=<span class="hljs-literal">False</span>).head(<span class="hljs-number">15</span>)<br></code></pre></td></tr></table></figure>




<div>
<style scoped>
    .dataframe tbody tr th:only-of-type {
        vertical-align: middle;
    }

<pre><code class="hljs">.dataframe tbody tr th &#123;
    vertical-align: top;
&#125;

.dataframe thead th &#123;
    text-align: right;
&#125;
</code></pre>
<p></style></p>
<table border="1" class="dataframe">
  <thead>
    <tr style="text-align: right;">
      <th></th>
      <th>negative</th>
      <th>some-negative</th>
      <th>neutral</th>
      <th>some-positive</th>
      <th>positive</th>
      <th>total</th>
    </tr>
    <tr>
      <th>Terms</th>
      <th></th>
      <th></th>
      <th></th>
      <th></th>
      <th></th>
      <th></th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <th>film</th>
      <td>480</td>
      <td>1281</td>
      <td>2175</td>
      <td>1848</td>
      <td>949</td>
      <td>6733</td>
    </tr>
    <tr>
      <th>movie</th>
      <td>793</td>
      <td>1463</td>
      <td>2054</td>
      <td>1344</td>
      <td>587</td>
      <td>6241</td>
    </tr>
    <tr>
      <th>like</th>
      <td>332</td>
      <td>942</td>
      <td>1167</td>
      <td>599</td>
      <td>150</td>
      <td>3190</td>
    </tr>
    <tr>
      <th>story</th>
      <td>153</td>
      <td>532</td>
      <td>954</td>
      <td>664</td>
      <td>236</td>
      <td>2539</td>
    </tr>
    <tr>
      <th>rrb</th>
      <td>131</td>
      <td>498</td>
      <td>1112</td>
      <td>551</td>
      <td>146</td>
      <td>2438</td>
    </tr>
    <tr>
      <th>good</th>
      <td>100</td>
      <td>334</td>
      <td>519</td>
      <td>974</td>
      <td>334</td>
      <td>2261</td>
    </tr>
    <tr>
      <th>lrb</th>
      <td>119</td>
      <td>452</td>
      <td>878</td>
      <td>512</td>
      <td>137</td>
      <td>2098</td>
    </tr>
    <tr>
      <th>time</th>
      <td>153</td>
      <td>420</td>
      <td>752</td>
      <td>464</td>
      <td>130</td>
      <td>1919</td>
    </tr>
    <tr>
      <th>characters</th>
      <td>167</td>
      <td>455</td>
      <td>614</td>
      <td>497</td>
      <td>149</td>
      <td>1882</td>
    </tr>
    <tr>
      <th>comedy</th>
      <td>174</td>
      <td>341</td>
      <td>578</td>
      <td>475</td>
      <td>245</td>
      <td>1813</td>
    </tr>
    <tr>
      <th>just</th>
      <td>216</td>
      <td>598</td>
      <td>550</td>
      <td>282</td>
      <td>82</td>
      <td>1728</td>
    </tr>
    <tr>
      <th>life</th>
      <td>77</td>
      <td>200</td>
      <td>729</td>
      <td>544</td>
      <td>168</td>
      <td>1718</td>
    </tr>
    <tr>
      <th>does</th>
      <td>135</td>
      <td>566</td>
      <td>519</td>
      <td>375</td>
      <td>79</td>
      <td>1674</td>
    </tr>
    <tr>
      <th>little</th>
      <td>109</td>
      <td>492</td>
      <td>580</td>
      <td>339</td>
      <td>85</td>
      <td>1605</td>
    </tr>
    <tr>
      <th>funny</th>
      <td>73</td>
      <td>257</td>
      <td>267</td>
      <td>639</td>
      <td>347</td>
      <td>1583</td>
    </tr>
  </tbody>
</table>
</div>



<h2 id="1-6-1-è´Ÿé¢å½±è¯„ä¸­æœ€å¸¸ç”¨çš„50ä¸ªè¯"><a href="#1-6-1-è´Ÿé¢å½±è¯„ä¸­æœ€å¸¸ç”¨çš„50ä¸ªè¯" class="headerlink" title="1.6.1 è´Ÿé¢å½±è¯„ä¸­æœ€å¸¸ç”¨çš„50ä¸ªè¯"></a><a id='1.6.1'>1.6.1 è´Ÿé¢å½±è¯„ä¸­æœ€å¸¸ç”¨çš„50ä¸ªè¯</a></h2><figure class="highlight python"><table><tr><td class="code"><pre><code class="hljs python">y_pos = np.arange(<span class="hljs-number">50</span>)<br>plt.figure(figsize=(<span class="hljs-number">12</span>,<span class="hljs-number">10</span>))<br>plt.bar(y_pos, term_freq_df.sort_values(by=<span class="hljs-string">&#x27;negative&#x27;</span>, ascending=<span class="hljs-literal">False</span>)[<span class="hljs-string">&#x27;negative&#x27;</span>][:<span class="hljs-number">50</span>], align=<span class="hljs-string">&#x27;center&#x27;</span>, alpha=<span class="hljs-number">0.5</span>)<br>plt.xticks(y_pos, term_freq_df.sort_values(by=<span class="hljs-string">&#x27;negative&#x27;</span>, ascending=<span class="hljs-literal">False</span>)[<span class="hljs-string">&#x27;negative&#x27;</span>][:<span class="hljs-number">50</span>].index,rotation=<span class="hljs-string">&#x27;vertical&#x27;</span>)<br>plt.ylabel(<span class="hljs-string">&#x27;Frequency&#x27;</span>)<br>plt.xlabel(<span class="hljs-string">&#x27;Top 50 negative tokens&#x27;</span>)<br>plt.title(<span class="hljs-string">&#x27;Top 50 tokens in negative movie reviews&#x27;</span>)<br></code></pre></td></tr></table></figure>




<pre><code class="hljs">Text(0.5, 1.0, &#39;Top 50 tokens in negative movie reviews&#39;)
</code></pre>
<p><img src="https://ptpimg.me/yw0h81.png" alt="åœ¨è¿™é‡Œæ’å…¥å›¾ç‰‡æè¿°"></p>
<p>æˆ‘ä»¬å¯ä»¥çœ‹åˆ°ä¸€äº›è´Ÿé¢è¯ï¼Œå¦‚â€œåâ€ã€â€œæœ€å·®â€ã€â€œæ²‰é—·â€æ˜¯ä¸€äº›é«˜é¢‘è¯ã€‚ä½†æ˜¯ï¼Œå­˜åœ¨æœ‰åƒâ€œç”µå½±â€ã€â€œç”µå½±â€ã€â€œåˆ†é’Ÿâ€è¿™æ ·çš„ä¸­æ€§è¯æ”¯é…é¢‘ç‡å›¾ã€‚</p>
<p>æˆ‘ä»¬å†çœ‹ä¸€ä¸‹æ¡å½¢å›¾ä¸Šçš„å‰ 50 ä¸ªæ­£é¢æ ‡è®°</p>
<h2 id="1-6-2-æ­£é¢å½±è¯„ä¸­æœ€å¸¸ç”¨çš„50ä¸ªè¯"><a href="#1-6-2-æ­£é¢å½±è¯„ä¸­æœ€å¸¸ç”¨çš„50ä¸ªè¯" class="headerlink" title="1.6.2 æ­£é¢å½±è¯„ä¸­æœ€å¸¸ç”¨çš„50ä¸ªè¯"></a><a id='1.6.2'>1.6.2 æ­£é¢å½±è¯„ä¸­æœ€å¸¸ç”¨çš„50ä¸ªè¯</a></h2><figure class="highlight python"><table><tr><td class="code"><pre><code class="hljs python">y_pos = np.arange(<span class="hljs-number">50</span>)<br>plt.figure(figsize=(<span class="hljs-number">12</span>,<span class="hljs-number">10</span>))<br>plt.bar(y_pos, term_freq_df.sort_values(by=<span class="hljs-string">&#x27;positive&#x27;</span>, ascending=<span class="hljs-literal">False</span>)[<span class="hljs-string">&#x27;positive&#x27;</span>][:<span class="hljs-number">50</span>], align=<span class="hljs-string">&#x27;center&#x27;</span>, alpha=<span class="hljs-number">0.5</span>)<br>plt.xticks(y_pos, term_freq_df.sort_values(by=<span class="hljs-string">&#x27;positive&#x27;</span>, ascending=<span class="hljs-literal">False</span>)[<span class="hljs-string">&#x27;positive&#x27;</span>][:<span class="hljs-number">50</span>].index,rotation=<span class="hljs-string">&#x27;vertical&#x27;</span>)<br>plt.ylabel(<span class="hljs-string">&#x27;Frequency&#x27;</span>)<br>plt.xlabel(<span class="hljs-string">&#x27;Top 50 positive tokens&#x27;</span>)<br>plt.title(<span class="hljs-string">&#x27;Top 50 tokens in positive movie reviews&#x27;</span>)<br></code></pre></td></tr></table></figure>




<pre><code class="hljs">Text(0.5, 1.0, &#39;Top 50 tokens in positive movie reviews&#39;)
</code></pre>
<p><img src="https://ptpimg.me/e5x807.png" alt="[å¤–é“¾å›¾ç‰‡è½¬å­˜å¤±è´¥,æºç«™å¯èƒ½æœ‰é˜²ç›—é“¾æœºåˆ¶,å»ºè®®å°†å›¾ç‰‡ä¿å­˜ä¸‹æ¥ç›´æ¥ä¸Šä¼ (img-HLxcm1VK-1640793547488)(sentiment-analysis-countvectorizer-tf-idf_files/sentiment-analysis-countvectorizer-tf-idf_51_1.png)]"></p>
<p>Once again, there are some neutral words like â€œfilmâ€, â€œmovieâ€, are quite high up in the rank.</p>
<h2 id="2-ä¼ ç»Ÿçš„ç›‘ç£æœºå™¨å­¦ä¹ æ¨¡å‹"><a href="#2-ä¼ ç»Ÿçš„ç›‘ç£æœºå™¨å­¦ä¹ æ¨¡å‹" class="headerlink" title="2. ä¼ ç»Ÿçš„ç›‘ç£æœºå™¨å­¦ä¹ æ¨¡å‹"></a><a id='2'>2. ä¼ ç»Ÿçš„ç›‘ç£æœºå™¨å­¦ä¹ æ¨¡å‹</a></h2><h2 id="2-1-ç‰¹å¾å·¥ç¨‹"><a href="#2-1-ç‰¹å¾å·¥ç¨‹" class="headerlink" title="2.1 ç‰¹å¾å·¥ç¨‹"></a><a id='2.1'>2.1 ç‰¹å¾å·¥ç¨‹</a></h2><figure class="highlight python"><table><tr><td class="code"><pre><code class="hljs python">phrase = np.array(df_train_1[<span class="hljs-string">&#x27;Pï¬hrase&#x27;</span>])<br>sentiments = np.array(df_train_1[<span class="hljs-string">&#x27;Sentiment&#x27;</span>])<br><span class="hljs-comment"># build train and test datasets</span><br><br><span class="hljs-keyword">from</span> sklearn.model_selection <span class="hljs-keyword">import</span> train_test_split    <br>phrase_train, phrase_test, sentiments_train, sentiments_test = train_test_split(phrase, sentiments, test_size=<span class="hljs-number">0.2</span>, random_state=<span class="hljs-number">4</span>)<br></code></pre></td></tr></table></figure>

<p>Next, we will try to see how different are the tokens in 4 different classes(positive,some positive,neutral, some negative, negative). </p>
<h2 id="2-2-CountVectorizer-TF-IDF-çš„å®ç°"><a href="#2-2-CountVectorizer-TF-IDF-çš„å®ç°" class="headerlink" title="2.2 CountVectorizer &amp; TF-IDF çš„å®ç°"></a><a id='2.2'>2.2 CountVectorizer &amp; TF-IDF çš„å®ç°</h2><h2 id="2-2-1-CountVectorizer"><a href="#2-2-1-CountVectorizer" class="headerlink" title="2.2.1 CountVectorizer"></a><a id='2.2.1'>2.2.1 CountVectorizer</a></h2><p>ä¼—æ‰€å‘¨çŸ¥ï¼Œæ‰€æœ‰æœºå™¨å­¦ä¹ ç®—æ³•éƒ½æ“…é•¿æ•°å­—ï¼›æˆ‘ä»¬å¿…é¡»åœ¨ä¸ä¸¢å¤±å¤§é‡ä¿¡æ¯çš„æƒ…å†µä¸‹å°†æ–‡æœ¬æ•°æ®æå–æˆ–è½¬æ¢ä¸ºæ•°å­—ã€‚è¿›è¡Œè¿™ç§è½¬æ¢çš„ä¸€ç§æ–¹æ³•æ˜¯è¯è¢‹ (BOW)ï¼Œå®ƒä¸ºæ¯ä¸ªè¯æä¾›ä¸€ä¸ªæ•°å­—ï¼Œä½†æ•ˆç‡éå¸¸ä½ã€‚å› æ­¤ï¼Œä¸€ç§æ–¹æ³•æ˜¯é€šè¿‡CountVectorizerï¼šå®ƒè®¡ç®—æ–‡æ¡£ä¸­çš„å•è¯æ•°ï¼Œå³å°†æ–‡æœ¬æ–‡æ¡£é›†åˆè½¬æ¢ä¸ºæ–‡æ¡£ä¸­æ¯ä¸ªå•è¯å‡ºç°æ¬¡æ•°çš„çŸ©é˜µã€‚ </p>
<p>ä¾‹å¦‚ï¼šå¦‚æœæˆ‘ä»¬æœ‰å¦‚ä¸‹ 3 ä¸ªæ–‡æœ¬æ–‡æ¡£çš„é›†åˆï¼Œé‚£ä¹ˆ CountVectorizer ä¼šå°†å…¶è½¬æ¢ä¸ºæ–‡æ¡£ä¸­æ¯ä¸ªå•è¯å‡ºç°çš„å•ç‹¬è®¡æ•°ï¼Œå¦‚ä¸‹æ‰€ç¤ºï¼š</p>
<figure class="highlight python"><table><tr><td class="code"><pre><code class="hljs python">cv1 = CountVectorizer()<br>x_traincv = cv1.fit_transform([<span class="hljs-string">&quot;Hi How are you How are you doing&quot;</span>,<span class="hljs-string">&quot;Hi what&#x27;s up&quot;</span>,<span class="hljs-string">&quot;Wow that&#x27;s awesome&quot;</span>])<br></code></pre></td></tr></table></figure>


<figure class="highlight python"><table><tr><td class="code"><pre><code class="hljs python">x_traincv_df = pd.DataFrame(x_traincv.toarray(),columns=<span class="hljs-built_in">list</span>(cv1.get_feature_names()))<br>x_traincv_df<br></code></pre></td></tr></table></figure>

<pre><code class="hljs">/Users/gawaintan/miniforge3/lib/python3.9/site-packages/sklearn/utils/deprecation.py:87: FutureWarning: Function get_feature_names is deprecated; get_feature_names is deprecated in 1.0 and will be removed in 1.2. Please use get_feature_names_out instead.
  warnings.warn(msg, category=FutureWarning)
</code></pre>
<div>
<style scoped>
    .dataframe tbody tr th:only-of-type {
        vertical-align: middle;
    }

<pre><code class="hljs">.dataframe tbody tr th &#123;
    vertical-align: top;
&#125;

.dataframe thead th &#123;
    text-align: right;
&#125;
</code></pre>
<p></style></p>
<table border="1" class="dataframe">
  <thead>
    <tr style="text-align: right;">
      <th></th>
      <th>are</th>
      <th>awesome</th>
      <th>doing</th>
      <th>hi</th>
      <th>how</th>
      <th>that</th>
      <th>up</th>
      <th>what</th>
      <th>wow</th>
      <th>you</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <th>0</th>
      <td>2</td>
      <td>0</td>
      <td>1</td>
      <td>1</td>
      <td>2</td>
      <td>0</td>
      <td>0</td>
      <td>0</td>
      <td>0</td>
      <td>2</td>
    </tr>
    <tr>
      <th>1</th>
      <td>0</td>
      <td>0</td>
      <td>0</td>
      <td>1</td>
      <td>0</td>
      <td>0</td>
      <td>1</td>
      <td>1</td>
      <td>0</td>
      <td>0</td>
    </tr>
    <tr>
      <th>2</th>
      <td>0</td>
      <td>1</td>
      <td>0</td>
      <td>0</td>
      <td>0</td>
      <td>1</td>
      <td>0</td>
      <td>0</td>
      <td>1</td>
      <td>0</td>
    </tr>
  </tbody>
</table>
</div>



<p>ç°åœ¨ï¼Œåœ¨ CountVectorizer çš„æƒ…å†µä¸‹ï¼Œæˆ‘ä»¬åªæ˜¯åœ¨è®¡ç®—æ–‡æ¡£ä¸­çš„å•è¯æ•°é‡ï¼Œå¾ˆå¤šæ—¶å€™ï¼Œâ€œareâ€ã€â€œyouâ€ã€â€œhiâ€ç­‰å•è¯çš„æ•°é‡éå¸¸å¤§ï¼Œè¿™å°†æ”¯é…æˆ‘ä»¬çš„æœºå™¨å­¦ä¹ ç®—æ³•çš„ç»“æœã€‚</p>
<h2 id="2-2-2-TF-IDF-ä¸-CountVectorizer-æœ‰ä½•ä¸åŒï¼Ÿ"><a href="#2-2-2-TF-IDF-ä¸-CountVectorizer-æœ‰ä½•ä¸åŒï¼Ÿ" class="headerlink" title="2.2.2 TF-IDF ä¸ CountVectorizer æœ‰ä½•ä¸åŒï¼Ÿ"></a><a id='2.2.2'>2.2.2 TF-IDF ä¸ CountVectorizer æœ‰ä½•ä¸åŒï¼Ÿ</a></h2><p>å› æ­¤ï¼ŒTF-IDFï¼ˆä»£è¡¨Term-Frequency-Inverse-Document Frequencyï¼‰é™ä½äº†å‡ ä¹æ‰€æœ‰æ–‡æ¡£ä¸­å‡ºç°çš„å¸¸è§è¯çš„æƒé‡ï¼Œå¹¶æ›´åŠ é‡è§†å‡ºç°åœ¨æ–‡æ¡£å­é›†ä¸­çš„è¯ã€‚TF-IDF çš„å·¥ä½œåŸç†æ˜¯é€šè¿‡åˆ†é…è¾ƒä½çš„æƒé‡æ¥æƒ©ç½šè¿™äº›å¸¸ç”¨è¯ï¼ŒåŒæ—¶é‡è§†ç‰¹å®šæ–‡æ¡£ä¸­çš„ä¸€äº›ç¨€æœ‰è¯ã€‚</p>
<h2 id="2-2-3-CountVectorizerå‚æ•°è®¾ç½®"><a href="#2-2-3-CountVectorizerå‚æ•°è®¾ç½®" class="headerlink" title="2.2.3 CountVectorizerå‚æ•°è®¾ç½®"></a><a id='2.2.3'>2.2.3 CountVectorizerå‚æ•°è®¾ç½®</a></h2><p>å¯¹äº CountVectorizer è¿™ä¸€æ¬¡ï¼Œåœç”¨è¯ä¸ä¼šæœ‰å¤ªå¤§å¸®åŠ©ï¼Œå› ä¸ºç›¸åŒçš„é«˜é¢‘è¯ï¼Œä¾‹å¦‚â€œtheâ€ã€â€œtoâ€ï¼Œåœ¨ä¸¤ä¸ªç±»ä¸­çš„å‡ºç°é¢‘ç‡ç›¸åŒã€‚å¦‚æœè¿™äº›åœç”¨è¯æ”¯é…ä¸¤ä¸ªç±»ï¼Œæˆ‘å°†æ— æ³•è·å¾—æœ‰æ„ä¹‰çš„ç»“æœã€‚å› æ­¤ï¼Œæˆ‘å†³å®šåˆ é™¤åœç”¨è¯ï¼Œå¹¶ä¸”è¿˜å°†ä½¿ç”¨ countvectorizer å°† max_features é™åˆ¶ä¸º 10,000ã€‚</p>
<figure class="highlight python"><table><tr><td class="code"><pre><code class="hljs python"><span class="hljs-keyword">from</span> sklearn.feature_extraction.text <span class="hljs-keyword">import</span> CountVectorizer, TfidfVectorizer<br><br><span class="hljs-comment">## Build Bag-Of-Words on train phrases</span><br>cv = CountVectorizer(stop_words=<span class="hljs-string">&#x27;english&#x27;</span>,max_features=<span class="hljs-number">10000</span>)<br>cv_train_features = cv.fit_transform(phrase_train)<br></code></pre></td></tr></table></figure>


<figure class="highlight python"><table><tr><td class="code"><pre><code class="hljs python"><br><span class="hljs-comment"># build TFIDF features on train reviews</span><br>tv = TfidfVectorizer(min_df=<span class="hljs-number">0.0</span>, max_df=<span class="hljs-number">1.0</span>, ngram_range=(<span class="hljs-number">1</span>,<span class="hljs-number">2</span>),<br>                     sublinear_tf=<span class="hljs-literal">True</span>)<br>tv_train_features = tv.fit_transform(phrase_train)<br></code></pre></td></tr></table></figure>


<figure class="highlight python"><table><tr><td class="code"><pre><code class="hljs python"><span class="hljs-comment"># transform test reviews into features</span><br>cv_test_features = cv.transform(phrase_test)<br>tv_test_features = tv.transform(phrase_test)<br></code></pre></td></tr></table></figure>


<figure class="highlight python"><table><tr><td class="code"><pre><code class="hljs python"><span class="hljs-built_in">print</span>(<span class="hljs-string">&#x27;BOW model:&gt; Train features shape:&#x27;</span>, cv_train_features.shape, <span class="hljs-string">&#x27; Test features shape:&#x27;</span>, cv_test_features.shape)<br><span class="hljs-built_in">print</span>(<span class="hljs-string">&#x27;TFIDF model:&gt; Train features shape:&#x27;</span>, tv_train_features.shape, <span class="hljs-string">&#x27; Test features shape:&#x27;</span>, tv_test_features.shape)<br></code></pre></td></tr></table></figure>

<pre><code class="hljs">BOW model:&gt; Train features shape: (124848, 10000)  Test features shape: (31212, 10000)
TFIDF model:&gt; Train features shape: (124848, 93697)  Test features shape: (31212, 93697)
</code></pre>
<h2 id="2-3-æ¨¡å‹è®­ç»ƒã€é¢„æµ‹å’Œæ€§èƒ½è¯„ä¼°"><a href="#2-3-æ¨¡å‹è®­ç»ƒã€é¢„æµ‹å’Œæ€§èƒ½è¯„ä¼°" class="headerlink" title="2.3 æ¨¡å‹è®­ç»ƒã€é¢„æµ‹å’Œæ€§èƒ½è¯„ä¼°"></a><a id='2.3'>2.3 æ¨¡å‹è®­ç»ƒã€é¢„æµ‹å’Œæ€§èƒ½è¯„ä¼°</a></h2><figure class="highlight python"><table><tr><td class="code"><pre><code class="hljs python"><span class="hljs-comment">####Evaluation metrics</span><br><br><br><span class="hljs-keyword">from</span> sklearn <span class="hljs-keyword">import</span> metrics<br><span class="hljs-keyword">import</span> numpy <span class="hljs-keyword">as</span> np<br><span class="hljs-keyword">import</span> pandas <span class="hljs-keyword">as</span> pd<br><span class="hljs-keyword">import</span> matplotlib.pyplot <span class="hljs-keyword">as</span> plt<br><span class="hljs-keyword">from</span> sklearn.preprocessing <span class="hljs-keyword">import</span> LabelEncoder<br><span class="hljs-keyword">from</span> sklearn.base <span class="hljs-keyword">import</span> clone<br><span class="hljs-keyword">from</span> sklearn.preprocessing <span class="hljs-keyword">import</span> label_binarize<br><span class="hljs-keyword">from</span> scipy <span class="hljs-keyword">import</span> interp<br><span class="hljs-keyword">from</span> sklearn.metrics <span class="hljs-keyword">import</span> roc_curve, auc <br><br><br><span class="hljs-keyword">def</span> <span class="hljs-title function_">get_metrics</span>(<span class="hljs-params">true_labels, predicted_labels</span>):<br>    <br>    <span class="hljs-built_in">print</span>(<span class="hljs-string">&#x27;Accuracy:&#x27;</span>, np.<span class="hljs-built_in">round</span>(<br>                        metrics.accuracy_score(true_labels, <br>                                               predicted_labels),<br>                        <span class="hljs-number">4</span>))<br>    <span class="hljs-built_in">print</span>(<span class="hljs-string">&#x27;Precision:&#x27;</span>, np.<span class="hljs-built_in">round</span>(<br>                        metrics.precision_score(true_labels, <br>                                               predicted_labels,<br>                                               average=<span class="hljs-string">&#x27;weighted&#x27;</span>),<br>                        <span class="hljs-number">4</span>))<br>    <span class="hljs-built_in">print</span>(<span class="hljs-string">&#x27;Recall:&#x27;</span>, np.<span class="hljs-built_in">round</span>(<br>                        metrics.recall_score(true_labels, <br>                                               predicted_labels,<br>                                               average=<span class="hljs-string">&#x27;weighted&#x27;</span>),<br>                        <span class="hljs-number">4</span>))<br>    <span class="hljs-built_in">print</span>(<span class="hljs-string">&#x27;F1 Score:&#x27;</span>, np.<span class="hljs-built_in">round</span>(<br>                        metrics.f1_score(true_labels, <br>                                               predicted_labels,<br>                                               average=<span class="hljs-string">&#x27;weighted&#x27;</span>),<br>                        <span class="hljs-number">4</span>))<br>                        <br><br><span class="hljs-keyword">def</span> <span class="hljs-title function_">train_predict_model</span>(<span class="hljs-params">classifier, </span><br><span class="hljs-params">                        train_features, train_labels, </span><br><span class="hljs-params">                        test_features, test_labels</span>):<br>    <span class="hljs-comment"># build model    </span><br>    classifier.fit(train_features, train_labels)<br>    <span class="hljs-comment"># predict using model</span><br>    predictions = classifier.predict(test_features) <br>    <span class="hljs-keyword">return</span> predictions    <br><br><br><span class="hljs-keyword">def</span> <span class="hljs-title function_">display_confusion_matrix</span>(<span class="hljs-params">true_labels, predicted_labels, classes=[<span class="hljs-number">1</span>,<span class="hljs-number">0</span>]</span>):<br>    <br>    total_classes = <span class="hljs-built_in">len</span>(classes)<br>    level_labels = [total_classes*[<span class="hljs-number">0</span>], <span class="hljs-built_in">list</span>(<span class="hljs-built_in">range</span>(total_classes))]<br><br>    cm = metrics.confusion_matrix(y_true=true_labels, y_pred=predicted_labels, <br>                                  labels=classes)<br>    cm_frame = pd.DataFrame(data=cm, <br>                            columns=pd.MultiIndex(levels=[[<span class="hljs-string">&#x27;Predicted:&#x27;</span>], classes], <br>                                                  codes=level_labels), <br>                            index=pd.MultiIndex(levels=[[<span class="hljs-string">&#x27;Actual:&#x27;</span>], classes], <br>                                                codes=level_labels)) <br>    <span class="hljs-built_in">print</span>(cm_frame) <br>    <br><span class="hljs-keyword">def</span> <span class="hljs-title function_">display_classification_report</span>(<span class="hljs-params">true_labels, predicted_labels, classes=[<span class="hljs-number">1</span>,<span class="hljs-number">0</span>]</span>):<br><br>    report = metrics.classification_report(y_true=true_labels, <br>                                           y_pred=predicted_labels, <br>                                           labels=classes) <br>    <span class="hljs-built_in">print</span>(report)<br>    <br>    <br>    <br><span class="hljs-keyword">def</span> <span class="hljs-title function_">display_model_performance_metrics</span>(<span class="hljs-params">true_labels, predicted_labels, classes=[<span class="hljs-number">1</span>,<span class="hljs-number">0</span>]</span>):<br>    <span class="hljs-built_in">print</span>(<span class="hljs-string">&#x27;Model Performance metrics:&#x27;</span>)<br>    <span class="hljs-built_in">print</span>(<span class="hljs-string">&#x27;-&#x27;</span>*<span class="hljs-number">30</span>)<br>    get_metrics(true_labels=true_labels, predicted_labels=predicted_labels)<br>    <span class="hljs-built_in">print</span>(<span class="hljs-string">&#x27;\nModel Classification report:&#x27;</span>)<br>    <span class="hljs-built_in">print</span>(<span class="hljs-string">&#x27;-&#x27;</span>*<span class="hljs-number">30</span>)<br>    display_classification_report(true_labels=true_labels, predicted_labels=predicted_labels, <br>                                  classes=classes)<br>    <span class="hljs-built_in">print</span>(<span class="hljs-string">&#x27;\nPrediction Confusion Matrix:&#x27;</span>)<br>    <span class="hljs-built_in">print</span>(<span class="hljs-string">&#x27;-&#x27;</span>*<span class="hljs-number">30</span>)<br>    display_confusion_matrix(true_labels=true_labels, predicted_labels=predicted_labels, <br>                             classes=classes)<br><br><br><span class="hljs-keyword">def</span> <span class="hljs-title function_">plot_model_decision_surface</span>(<span class="hljs-params">clf, train_features, train_labels,</span><br><span class="hljs-params">                                plot_step=<span class="hljs-number">0.02</span>, cmap=plt.cm.RdYlBu,</span><br><span class="hljs-params">                                markers=<span class="hljs-literal">None</span>, alphas=<span class="hljs-literal">None</span>, colors=<span class="hljs-literal">None</span></span>):<br>    <br>    <span class="hljs-keyword">if</span> train_features.shape[<span class="hljs-number">1</span>] != <span class="hljs-number">2</span>:<br>        <span class="hljs-keyword">raise</span> ValueError(<span class="hljs-string">&quot;X_train should have exactly 2 columnns!&quot;</span>)<br>    <br>    x_min, x_max = train_features[:, <span class="hljs-number">0</span>].<span class="hljs-built_in">min</span>() - plot_step, train_features[:, <span class="hljs-number">0</span>].<span class="hljs-built_in">max</span>() + plot_step<br>    y_min, y_max = train_features[:, <span class="hljs-number">1</span>].<span class="hljs-built_in">min</span>() - plot_step, train_features[:, <span class="hljs-number">1</span>].<span class="hljs-built_in">max</span>() + plot_step<br>    xx, yy = np.meshgrid(np.arange(x_min, x_max, plot_step),<br>                         np.arange(y_min, y_max, plot_step))<br><br>    clf_est = clone(clf)<br>    clf_est.fit(train_features,train_labels)<br>    <span class="hljs-keyword">if</span> <span class="hljs-built_in">hasattr</span>(clf_est, <span class="hljs-string">&#x27;predict_proba&#x27;</span>):<br>        Z = clf_est.predict_proba(np.c_[xx.ravel(), yy.ravel()])[:,<span class="hljs-number">1</span>]<br>    <span class="hljs-keyword">else</span>:<br>        Z = clf_est.predict(np.c_[xx.ravel(), yy.ravel()])    <br>    Z = Z.reshape(xx.shape)<br>    cs = plt.contourf(xx, yy, Z, cmap=cmap)<br>    <br>    le = LabelEncoder()<br>    y_enc = le.fit_transform(train_labels)<br>    n_classes = <span class="hljs-built_in">len</span>(le.classes_)<br>    plot_colors = <span class="hljs-string">&#x27;&#x27;</span>.join(colors) <span class="hljs-keyword">if</span> colors <span class="hljs-keyword">else</span> [<span class="hljs-literal">None</span>] * n_classes<br>    label_names = le.classes_<br>    markers = markers <span class="hljs-keyword">if</span> markers <span class="hljs-keyword">else</span> [<span class="hljs-literal">None</span>] * n_classes<br>    alphas = alphas <span class="hljs-keyword">if</span> alphas <span class="hljs-keyword">else</span> [<span class="hljs-literal">None</span>] * n_classes<br>    <span class="hljs-keyword">for</span> i, color <span class="hljs-keyword">in</span> <span class="hljs-built_in">zip</span>(<span class="hljs-built_in">range</span>(n_classes), plot_colors):<br>        idx = np.where(y_enc == i)<br>        plt.scatter(train_features[idx, <span class="hljs-number">0</span>], train_features[idx, <span class="hljs-number">1</span>], c=color,<br>                    label=label_names[i], cmap=cmap, edgecolors=<span class="hljs-string">&#x27;black&#x27;</span>, <br>                    marker=markers[i], alpha=alphas[i])<br>    plt.legend()<br>    plt.show()<br><br><br><span class="hljs-keyword">def</span> <span class="hljs-title function_">plot_model_roc_curve</span>(<span class="hljs-params">clf, features, true_labels, label_encoder=<span class="hljs-literal">None</span>, class_names=<span class="hljs-literal">None</span></span>):<br>    <br>    <span class="hljs-comment">## Compute ROC curve and ROC area for each class</span><br>    fpr = <span class="hljs-built_in">dict</span>()<br>    tpr = <span class="hljs-built_in">dict</span>()<br>    roc_auc = <span class="hljs-built_in">dict</span>()<br>    <span class="hljs-keyword">if</span> <span class="hljs-built_in">hasattr</span>(clf, <span class="hljs-string">&#x27;classes_&#x27;</span>):<br>        class_labels = clf.classes_<br>    <span class="hljs-keyword">elif</span> label_encoder:<br>        class_labels = label_encoder.classes_<br>    <span class="hljs-keyword">elif</span> class_names:<br>        class_labels = class_names<br>    <span class="hljs-keyword">else</span>:<br>        <span class="hljs-keyword">raise</span> ValueError(<span class="hljs-string">&#x27;Unable to derive prediction classes, please specify class_names!&#x27;</span>)<br>    n_classes = <span class="hljs-built_in">len</span>(class_labels)<br>    y_test = label_binarize(true_labels, classes=class_labels)<br>    <span class="hljs-keyword">if</span> n_classes == <span class="hljs-number">2</span>:<br>        <span class="hljs-keyword">if</span> <span class="hljs-built_in">hasattr</span>(clf, <span class="hljs-string">&#x27;predict_proba&#x27;</span>):<br>            prob = clf.predict_proba(features)<br>            y_score = prob[:, prob.shape[<span class="hljs-number">1</span>]-<span class="hljs-number">1</span>] <br>        <span class="hljs-keyword">elif</span> <span class="hljs-built_in">hasattr</span>(clf, <span class="hljs-string">&#x27;decision_function&#x27;</span>):<br>            prob = clf.decision_function(features)<br>            y_score = prob[:, prob.shape[<span class="hljs-number">1</span>]-<span class="hljs-number">1</span>]<br>        <span class="hljs-keyword">else</span>:<br>            <span class="hljs-keyword">raise</span> AttributeError(<span class="hljs-string">&quot;Estimator doesn&#x27;t have a probability or confidence scoring system!&quot;</span>)<br>        <br>        fpr, tpr, _ = roc_curve(y_test, y_score)      <br>        roc_auc = auc(fpr, tpr)<br>        plt.plot(fpr, tpr, label=<span class="hljs-string">&#x27;ROC curve (area = &#123;0:0.2f&#125;)&#x27;</span><br>                                 <span class="hljs-string">&#x27;&#x27;</span>.<span class="hljs-built_in">format</span>(roc_auc),<br>                 linewidth=<span class="hljs-number">2.5</span>)<br>        <br>    <span class="hljs-keyword">elif</span> n_classes &gt; <span class="hljs-number">2</span>:<br>        <span class="hljs-keyword">if</span> <span class="hljs-built_in">hasattr</span>(clf, <span class="hljs-string">&#x27;predict_proba&#x27;</span>):<br>            y_score = clf.predict_proba(features)<br>        <span class="hljs-keyword">elif</span> <span class="hljs-built_in">hasattr</span>(clf, <span class="hljs-string">&#x27;decision_function&#x27;</span>):<br>            y_score = clf.decision_function(features)<br>        <span class="hljs-keyword">else</span>:<br>            <span class="hljs-keyword">raise</span> AttributeError(<span class="hljs-string">&quot;Estimator doesn&#x27;t have a probability or confidence scoring system!&quot;</span>)<br><br>        <span class="hljs-keyword">for</span> i <span class="hljs-keyword">in</span> <span class="hljs-built_in">range</span>(n_classes):<br>            fpr[i], tpr[i], _ = roc_curve(y_test[:, i], y_score[:, i])<br>            roc_auc[i] = auc(fpr[i], tpr[i])<br><br>        <span class="hljs-comment">## Compute micro-average ROC curve and ROC area</span><br>        fpr[<span class="hljs-string">&quot;micro&quot;</span>], tpr[<span class="hljs-string">&quot;micro&quot;</span>], _ = roc_curve(y_test.ravel(), y_score.ravel())<br>        roc_auc[<span class="hljs-string">&quot;micro&quot;</span>] = auc(fpr[<span class="hljs-string">&quot;micro&quot;</span>], tpr[<span class="hljs-string">&quot;micro&quot;</span>])<br><br>        <span class="hljs-comment">## Compute macro-average ROC curve and ROC area</span><br>        <span class="hljs-comment"># First aggregate all false positive rates</span><br>        all_fpr = np.unique(np.concatenate([fpr[i] <span class="hljs-keyword">for</span> i <span class="hljs-keyword">in</span> <span class="hljs-built_in">range</span>(n_classes)]))<br>        <span class="hljs-comment"># Then interpolate all ROC curves at this points</span><br>        mean_tpr = np.zeros_like(all_fpr)<br>        <span class="hljs-keyword">for</span> i <span class="hljs-keyword">in</span> <span class="hljs-built_in">range</span>(n_classes):<br>            mean_tpr += interp(all_fpr, fpr[i], tpr[i])<br>        <span class="hljs-comment"># Finally average it and compute AUC</span><br>        mean_tpr /= n_classes<br>        fpr[<span class="hljs-string">&quot;macro&quot;</span>] = all_fpr<br>        tpr[<span class="hljs-string">&quot;macro&quot;</span>] = mean_tpr<br>        roc_auc[<span class="hljs-string">&quot;macro&quot;</span>] = auc(fpr[<span class="hljs-string">&quot;macro&quot;</span>], tpr[<span class="hljs-string">&quot;macro&quot;</span>])<br><br>        <span class="hljs-comment">## Plot ROC curves</span><br>        plt.figure(figsize=(<span class="hljs-number">6</span>, <span class="hljs-number">4</span>))<br>        plt.plot(fpr[<span class="hljs-string">&quot;micro&quot;</span>], tpr[<span class="hljs-string">&quot;micro&quot;</span>],<br>                 label=<span class="hljs-string">&#x27;micro-average ROC curve (area = &#123;0:0.2f&#125;)&#x27;</span><br>                       <span class="hljs-string">&#x27;&#x27;</span>.<span class="hljs-built_in">format</span>(roc_auc[<span class="hljs-string">&quot;micro&quot;</span>]), linewidth=<span class="hljs-number">3</span>)<br><br>        plt.plot(fpr[<span class="hljs-string">&quot;macro&quot;</span>], tpr[<span class="hljs-string">&quot;macro&quot;</span>],<br>                 label=<span class="hljs-string">&#x27;macro-average ROC curve (area = &#123;0:0.2f&#125;)&#x27;</span><br>                       <span class="hljs-string">&#x27;&#x27;</span>.<span class="hljs-built_in">format</span>(roc_auc[<span class="hljs-string">&quot;macro&quot;</span>]), linewidth=<span class="hljs-number">3</span>)<br><br>        <span class="hljs-keyword">for</span> i, label <span class="hljs-keyword">in</span> <span class="hljs-built_in">enumerate</span>(class_labels):<br>            plt.plot(fpr[i], tpr[i], label=<span class="hljs-string">&#x27;ROC curve of class &#123;0&#125; (area = &#123;1:0.2f&#125;)&#x27;</span><br>                                           <span class="hljs-string">&#x27;&#x27;</span>.<span class="hljs-built_in">format</span>(label, roc_auc[i]), <br>                     linewidth=<span class="hljs-number">2</span>, linestyle=<span class="hljs-string">&#x27;:&#x27;</span>)<br>    <span class="hljs-keyword">else</span>:<br>        <span class="hljs-keyword">raise</span> ValueError(<span class="hljs-string">&#x27;Number of classes should be atleast 2 or more&#x27;</span>)<br>        <br>    plt.plot([<span class="hljs-number">0</span>, <span class="hljs-number">1</span>], [<span class="hljs-number">0</span>, <span class="hljs-number">1</span>], <span class="hljs-string">&#x27;k--&#x27;</span>)<br>    plt.xlim([<span class="hljs-number">0.0</span>, <span class="hljs-number">1.0</span>])<br>    plt.ylim([<span class="hljs-number">0.0</span>, <span class="hljs-number">1.05</span>])<br>    plt.xlabel(<span class="hljs-string">&#x27;False Positive Rate&#x27;</span>)<br>    plt.ylabel(<span class="hljs-string">&#x27;True Positive Rate&#x27;</span>)<br>    plt.title(<span class="hljs-string">&#x27;Receiver Operating Characteristic (ROC) Curve&#x27;</span>)<br>    plt.legend(loc=<span class="hljs-string">&quot;lower right&quot;</span>)<br>    plt.show()<br></code></pre></td></tr></table></figure>


<figure class="highlight python"><table><tr><td class="code"><pre><code class="hljs python"><span class="hljs-keyword">from</span> sklearn.linear_model <span class="hljs-keyword">import</span> SGDClassifier, LogisticRegression<br><br>lr = LogisticRegression(penalty=<span class="hljs-string">&#x27;l2&#x27;</span>, max_iter=<span class="hljs-number">100</span>, C=<span class="hljs-number">1</span>)<br>sgd = SGDClassifier(loss=<span class="hljs-string">&#x27;hinge&#x27;</span>)<br></code></pre></td></tr></table></figure>

<h2 id="2-3-1-CountVectorizer-ä¸Šçš„é€»è¾‘å›å½’æ¨¡å‹"><a href="#2-3-1-CountVectorizer-ä¸Šçš„é€»è¾‘å›å½’æ¨¡å‹" class="headerlink" title="2.3.1 CountVectorizer ä¸Šçš„é€»è¾‘å›å½’æ¨¡å‹"></a><a id='2.3.1'>2.3.1 CountVectorizer ä¸Šçš„é€»è¾‘å›å½’æ¨¡å‹</a></h2><figure class="highlight python"><table><tr><td class="code"><pre><code class="hljs python"><span class="hljs-comment"># Logistic Regression model on BOW features</span><br>lr_bow_predictions = train_predict_model(classifier=lr, <br>                                             train_features=cv_train_features, train_labels=sentiments_train,<br>                                             test_features=cv_test_features, test_labels=sentiments_test)<br>display_model_performance_metrics(true_labels=sentiments_test, predicted_labels=lr_bow_predictions,<br>                                      classes=[<span class="hljs-number">0</span>,<span class="hljs-number">1</span>,<span class="hljs-number">2</span>,<span class="hljs-number">3</span>,<span class="hljs-number">4</span>])<br>                                    <br></code></pre></td></tr></table></figure>

<pre><code class="hljs">Model Performance metrics:
------------------------------
Accuracy: 0.6369
Precision: 0.6177
Recall: 0.6369
F1 Score: 0.6132

Model Classification report:
------------------------------
              precision    recall  f1-score   support

           0       0.55      0.28      0.37      1426
           1       0.53      0.36      0.43      5428
           2       0.68      0.87      0.77     15995
           3       0.57      0.45      0.50      6603
           4       0.56      0.34      0.42      1760

    accuracy                           0.64     31212
   macro avg       0.58      0.46      0.50     31212
weighted avg       0.62      0.64      0.61     31212


Prediction Confusion Matrix:
------------------------------
          Predicted:                        
                   0     1      2     3    4
Actual: 0        393   626    349    53    5
        1        251  1967   2936   255   19
        2         57   862  13982  1031   63
        3         15   236   3023  2941  388
        4          1    23    253   888  595
</code></pre>
<h2 id="2-3-2-åŸºäº-TF-IDF-ç‰¹å¾çš„é€»è¾‘å›å½’æ¨¡å‹"><a href="#2-3-2-åŸºäº-TF-IDF-ç‰¹å¾çš„é€»è¾‘å›å½’æ¨¡å‹" class="headerlink" title="2.3.2 åŸºäº TF-IDF ç‰¹å¾çš„é€»è¾‘å›å½’æ¨¡å‹"></a><a id='2.3.2'>2.3.2 åŸºäº TF-IDF ç‰¹å¾çš„é€»è¾‘å›å½’æ¨¡å‹</a></h2><figure class="highlight python"><table><tr><td class="code"><pre><code class="hljs python"><span class="hljs-comment"># Logistic Regression model on TF-IDF features</span><br>lr_tfidf_predictions = train_predict_model(classifier=lr, <br>                                               train_features=tv_train_features, train_labels=sentiments_train,<br>                                               test_features=tv_test_features, test_labels=sentiments_test)<br>display_model_performance_metrics(true_labels=sentiments_test, predicted_labels=lr_tfidf_predictions,<br>                                      classes=[<span class="hljs-number">0</span>,<span class="hljs-number">1</span>,<span class="hljs-number">2</span>,<span class="hljs-number">3</span>,<span class="hljs-number">4</span>])<br></code></pre></td></tr></table></figure>

<pre><code class="hljs">Model Performance metrics:
------------------------------
Accuracy: 0.6455
Precision: 0.6314
Recall: 0.6455
F1 Score: 0.6189

Model Classification report:
------------------------------
              precision    recall  f1-score   support

           0       0.60      0.22      0.32      1426
           1       0.56      0.38      0.45      5428
           2       0.67      0.89      0.77     15995
           3       0.60      0.47      0.53      6603
           4       0.60      0.29      0.39      1760

    accuracy                           0.65     31212
   macro avg       0.61      0.45      0.49     31212
weighted avg       0.63      0.65      0.62     31212


Prediction Confusion Matrix:
------------------------------
          Predicted:                        
                   0     1      2     3    4
Actual: 0        312   681    408    22    3
        1        177  2051   3066   125    9
        2         29   793  14193   944   36
        3          2   109   3115  3088  289
        4          0     9    281   966  504
</code></pre>
<h2 id="2-3-3-åŸºäºCountvectorizerçš„SGDæ¨¡å‹"><a href="#2-3-3-åŸºäºCountvectorizerçš„SGDæ¨¡å‹" class="headerlink" title="2.3.3 åŸºäºCountvectorizerçš„SGDæ¨¡å‹"></a><a id='2.3.3'>2.3.3 åŸºäºCountvectorizerçš„SGDæ¨¡å‹</a></h2><figure class="highlight python"><table><tr><td class="code"><pre><code class="hljs python"><span class="hljs-comment"># SGD model on Countvectorizer</span><br>sgd_bow_predictions = train_predict_model(classifier=sgd, <br>                                             train_features=cv_train_features, train_labels=sentiments_train,<br>                                             test_features=cv_test_features, test_labels=sentiments_test)<br>display_model_performance_metrics(true_labels=sentiments_test, predicted_labels=sgd_bow_predictions,<br>                                      classes=[<span class="hljs-number">0</span>,<span class="hljs-number">1</span>,<span class="hljs-number">2</span>,<span class="hljs-number">3</span>,<span class="hljs-number">4</span>])<br></code></pre></td></tr></table></figure>

<pre><code class="hljs">Model Performance metrics:
------------------------------
Accuracy: 0.5988
Precision: 0.5776
Recall: 0.5988
F1 Score: 0.5455

Model Classification report:
------------------------------
              precision    recall  f1-score   support

           0       0.52      0.23      0.32      1426
           1       0.54      0.19      0.28      5428
           2       0.62      0.93      0.74     15995
           3       0.54      0.30      0.38      6603
           4       0.52      0.29      0.37      1760

    accuracy                           0.60     31212
   macro avg       0.55      0.39      0.42     31212
weighted avg       0.58      0.60      0.55     31212


Prediction Confusion Matrix:
------------------------------
          Predicted:                        
                   0     1      2     3    4
Actual: 0        332   392    646    49    7
        1        234  1025   3909   230   30
        2         56   371  14874   637   57
        3         18   106   4156  1956  367
        4          4    15    502   735  504
</code></pre>
<h2 id="2-3-4-åŸºäºTF-IDFçš„SGDæ¨¡å‹"><a href="#2-3-4-åŸºäºTF-IDFçš„SGDæ¨¡å‹" class="headerlink" title="2.3.4 åŸºäºTF-IDFçš„SGDæ¨¡å‹"></a><a id='2.3.4'>2.3.4 åŸºäºTF-IDFçš„SGDæ¨¡å‹</a></h2><figure class="highlight python"><table><tr><td class="code"><pre><code class="hljs python"><span class="hljs-comment"># SGD model on TF-IDF</span><br>sgd_tfidf_predictions = train_predict_model(classifier=sgd, <br>                                                train_features=tv_train_features, train_labels=sentiments_train,<br>                                                test_features=tv_test_features, test_labels=sentiments_test)<br>display_model_performance_metrics(true_labels=sentiments_test, predicted_labels=sgd_tfidf_predictions,<br>                                      classes=[<span class="hljs-number">0</span>,<span class="hljs-number">1</span>,<span class="hljs-number">2</span>,<span class="hljs-number">3</span>,<span class="hljs-number">4</span>])<br></code></pre></td></tr></table></figure>

<pre><code class="hljs">Model Performance metrics:
------------------------------
Accuracy: 0.5594
Precision: 0.5543
Recall: 0.5594
F1 Score: 0.4666

Model Classification report:
------------------------------
              precision    recall  f1-score   support

           0       0.60      0.11      0.18      1426
           1       0.52      0.09      0.16      5428
           2       0.56      0.97      0.71     15995
           3       0.55      0.16      0.25      6603
           4       0.59      0.15      0.24      1760

    accuracy                           0.56     31212
   macro avg       0.56      0.30      0.31     31212
weighted avg       0.55      0.56      0.47     31212


Prediction Confusion Matrix:
------------------------------
          Predicted:                       
                   0    1      2     3    4
Actual: 0        152  241   1020    13    0
        1         83  512   4759    67    7
        2         17  193  15447   315   23
        3          2   38   5328  1085  150
        4          0    2    993   502  263
</code></pre>
<h2 id="2-3-5-åŸºäºTF-IDFçš„éšæœºæ£®æ—æ¨¡å‹"><a href="#2-3-5-åŸºäºTF-IDFçš„éšæœºæ£®æ—æ¨¡å‹" class="headerlink" title="2.3.5 åŸºäºTF-IDFçš„éšæœºæ£®æ—æ¨¡å‹"></a><a id='2.3.5'>2.3.5 åŸºäºTF-IDFçš„éšæœºæ£®æ—æ¨¡å‹</a></h2><figure class="highlight python"><table><tr><td class="code"><pre><code class="hljs python"><span class="hljs-keyword">from</span> sklearn.ensemble <span class="hljs-keyword">import</span> RandomForestClassifier<br>rfc = RandomForestClassifier(n_jobs=-<span class="hljs-number">1</span>)<br></code></pre></td></tr></table></figure>


<figure class="highlight python"><table><tr><td class="code"><pre><code class="hljs python"><span class="hljs-comment"># RandomForest model on TF-IDF</span><br>rfc_tfidf_predictions = train_predict_model(classifier=rfc, <br>                                                train_features=tv_train_features, train_labels=sentiments_train,<br>                                                test_features=tv_test_features, test_labels=sentiments_test)<br>display_model_performance_metrics(true_labels=sentiments_test, predicted_labels=rfc_tfidf_predictions,<br>                                      classes=[<span class="hljs-number">0</span>,<span class="hljs-number">1</span>,<span class="hljs-number">2</span>,<span class="hljs-number">3</span>,<span class="hljs-number">4</span>])<br></code></pre></td></tr></table></figure>

<pre><code class="hljs">Model Performance metrics:
------------------------------
Accuracy: 0.6423
Precision: 0.6267
Recall: 0.6423
F1 Score: 0.6274

Model Classification report:
------------------------------
              precision    recall  f1-score   support

           0       0.47      0.36      0.41      1426
           1       0.56      0.42      0.48      5428
           2       0.70      0.84      0.76     15995
           3       0.58      0.46      0.51      6603
           4       0.50      0.40      0.45      1760

    accuracy                           0.64     31212
   macro avg       0.56      0.50      0.52     31212
weighted avg       0.63      0.64      0.63     31212


Prediction Confusion Matrix:
------------------------------
          Predicted:                        
                   0     1      2     3    4
Actual: 0        520   605    283    17    1
        1        465  2281   2539   133   10
        2        101  1094  13479  1258   63
        3          8   115   2793  3057  630
        4          2     6    217   825  710
</code></pre>
<p><strong>åŸºäºTF-IDFçš„é€»è¾‘å›å½’æ¨¡å‹ä¼˜äºå…¶ä»–æœºå™¨å­¦ä¹ ç®—æ³•</strong>. </p>
]]></content>
  </entry>
  <entry>
    <title>é‡è£…ç³»ç»Ÿ</title>
    <url>/2020/03/07/%E9%87%8D%E8%A3%85%E7%B3%BB%E7%BB%9F/</url>
    <content><![CDATA[<h1 id="WIN10è¿ç§»Cç›˜å’Œå´©æºƒè¿˜åŸç³»ç»Ÿæ€»ç»“"><a href="#WIN10è¿ç§»Cç›˜å’Œå´©æºƒè¿˜åŸç³»ç»Ÿæ€»ç»“" class="headerlink" title="WIN10è¿ç§»Cç›˜å’Œå´©æºƒè¿˜åŸç³»ç»Ÿæ€»ç»“"></a>WIN10è¿ç§»Cç›˜å’Œå´©æºƒè¿˜åŸç³»ç»Ÿæ€»ç»“</h1><p>è¿™å‡ å¤©ä¸ºäº†æ¸…ç†Cç›˜ä¸€ç›´åŠ¨ç³»ç»Ÿçš„æ–‡ä»¶ï¼Œå¯¼è‡´ç»å¸¸é‡å¯ï¼Œå…¶ä¸­ä¸»è¦è¿˜æ˜¯è¿ç§»Cç›˜Usersæ•°æ®åˆ°å…¶ä»–éç³»ç»Ÿç›˜æ“ä½œä¸å½“å¯¼è‡´å¼€æœºç³»ç»ŸåŠ è½½ä¸äº†ç”¨æˆ·ä¿¡æ¯ï¼Œä¸‹é¢å…·ä½“è®°å½•è¿™ä¸¤æ–¹é¢ã€‚</p>
<ol>
<li><p>è¿ç§»èµ„æ–™çš„å…³é”®è¿˜æ˜¯åˆ©ç”¨ç¡¬é“¾æ¥å°†ç‰©ç†åœ°å€ä½äºå…¶ä»–ç›˜çš„Usersç”¨æˆ·ä¿¡æ¯æ˜ å°„åˆ°Cç›˜çš„é€»è¾‘åä¸Šã€‚ä¸‹é¢åªç®€å•è®°å½•ä¸€ä¸‹å‘½ä»¤ã€‚</p>
</li>
<li><p><strong>æœ€å…³é”®çš„è¿˜æ˜¯åˆ©ç”¨ç³»ç»Ÿçš„ä¿å‘½æ–‡ä»¶â€”â€”â€”Backup.wimé‡åˆ·ç³»ç»Ÿ</strong><br>ä¸€ä¸ªé€šè¿‡Dism++æ–‡ä»¶åˆ›å»ºçš„é•œåƒæ–‡ä»¶ï¼Œå°½é‡å°†æ­¤æ–‡ä»¶æ”¾äºéç³»ç»Ÿç›˜ï¼Œæœ‰æ­¤æ–‡ä»¶åŸºæœ¬å¯ä»¥ä¸ç”¨å€ŸåŠ©ä»»ä½•å¤–éƒ¨å·¥å…·æ— é™é‡åˆ·å›åŸç³»ç»Ÿã€‚</p>
</li>
</ol>
<p>ä¸Šé¢ä¸¤è€…éƒ½éœ€è¦é€šè¿‡é«˜çº§é‡å¯è¿›å…¥ä¸€ä¸ªçº¯å‘½ä»¤è¡Œçš„Dosç•Œé¢ï¼Œåœ¨æ­¤å¯ä»¥å‡ ä¹ä¸å—æƒé™é™åˆ¶å¯¹æ–‡ä»¶<strong>åˆ é™¤å¤åˆ¶</strong>ç­‰æ“ä½œ<br><strong>è¿›å…¥ <em>ç³»ç»Ÿè®¾ç½® -&gt; å‡çº§&amp;å®‰å…¨ -&gt; æ¢å¤ -&gt; é«˜çº§é‡å¯ -&gt; ç«‹åˆ»é‡å¯</em> æ¥é‡å¯ç”µè„‘åˆ°æ¢å¤æ¨¡å¼ï¼›</strong><br><img src="https://ptpimg.me/edeyq3.png" alt="åœ¨è¿™é‡Œæ’å…¥å›¾ç‰‡æè¿°"><br>åé¢å°±æ˜¯é€‰æ‹© <em><strong>ç–‘éš¾è§£ç­”-&gt;é«˜çº§-&gt;å‘½ä»¤æç¤ºç¬¦</strong></em>ï¼ˆç°åœ¨ä¸ä¾¿å…·ä½“æ¼”ç¤ºï¼Œç½‘ä¸Šæœ‰å¾ˆå¤šç›¸å…³æ•™ç¨‹ï¼‰</p>
<p><strong>æ³¨æ„</strong>ï¼šåœ¨Dosç¯å¢ƒä¸‹ç›˜ç¬¦åç§°å¯èƒ½å’Œå¹³æ—¶ä¸ä¸€æ ·(æˆ‘çš„OSå°±å˜æˆFç›˜äº†)ï¼Œé¦–å…ˆå°±æ˜¯å¹³æ—¶è¢«éšè—çš„Xç›˜ï¼Œå…¶ä»–æœ€å¥½å…ˆé€šè¿‡ <strong>diskpart</strong>å‘½ä»¤è¿›å…¥ç®¡ç†ç£ç›˜å·¥å…·ï¼Œé€šè¿‡<strong>list volume</strong>æŸ¥çœ‹æ‰€æœ‰ç›˜ç¬¦ä¿¡æ¯ï¼Œ<strong>exit</strong>é€€å‡ºã€‚åŒæ—¶åˆ©ç”¨<strong>cd å¯¹åº”ç¡¬ç›˜</strong> è¿›å…¥åå†ç”¨<strong>dir</strong>å‘½ä»¤ç¡®è®¤æ–‡ä»¶æ˜¯å¦æ­£ç¡®ã€‚</p>
<h2 id="Cç›˜Usersè¿ç§»å…¶ä»–ç›˜"><a href="#Cç›˜Usersè¿ç§»å…¶ä»–ç›˜" class="headerlink" title="Cç›˜Usersè¿ç§»å…¶ä»–ç›˜"></a>Cç›˜Usersè¿ç§»å…¶ä»–ç›˜</h2><p>æœ‰å‡ ç§æ–¹æ³•å¯ç”¨ï¼ŒåŸåˆ™å°±æ˜¯è¦å…ˆä¿è¯åœ¨éç°ç”¨æˆ·ä½¿ç”¨ç¯å¢ƒä¸‹è¿›è¡Œï¼Œä¸ºäº†é¿å…å„ç§æƒé™è¦æ±‚ï¼Œæˆ‘æ˜¯ç›´æ¥å¼€æœºè¿›å…¥Doså‘½ä»¤è¡Œï¼š</p>
<ol>
<li>å°†Userså¤åˆ¶ä¸å…¶ä»–ç›˜.<figure class="highlight c"><table><tr><td class="code"><pre><code class="hljs c">å¤åˆ¶C:\Usersä¸‹çš„æ‰€æœ‰æ–‡ä»¶åˆ°D:\Users <br><br><span class="hljs-comment">// å‚æ•°è¯´æ˜ï¼šæ­¤å‘½ä»¤ä¸ºWindowsçš„â€œå¼ºåˆ¶æ–‡ä»¶æ‹·è´â€å‘½ä»¤ã€‚</span><br><span class="hljs-comment">//      /E è¡¨ç¤ºæ‹·è´æ–‡ä»¶æ—¶åŒ…å«å­ç›®å½•ï¼ˆåŒ…æ‹¬ç©ºç›®å½•ï¼‰</span><br><span class="hljs-comment">//      /COPYALL è¡¨ç¤ºæ‹·è´æ‰€æœ‰æ–‡ä»¶ä¿¡æ¯</span><br><span class="hljs-comment">//      /XJ è¡¨ç¤ºä¸åŒ…æ‹¬Junction pointsï¼ˆé»˜è®¤æ˜¯åŒ…æ‹¬çš„ï¼‰</span><br><span class="hljs-comment">//      /XD &quot;F:\Users\Administrator&quot; è¡¨ç¤ºä¸åŒ…æ‹¬æŒ‡å®šçš„ç›®å½•,æ­¤å¤„æŒ‡å®šç›®å½•ä¸ºï¼š&quot;F:\Users\Administrator&quot;</span><br>robocopy <span class="hljs-string">&quot;F:\Users&quot;</span> <span class="hljs-string">&quot;D:\Users&quot;</span> /E /COPYALL /XJ /XD <span class="hljs-string">&quot;F:\Users\Administrator&quot;</span><br></code></pre></td></tr></table></figure></li>
<li>åˆ é™¤ç”¨æˆ·æ–‡ä»¶<figure class="highlight c"><table><tr><td class="code"><pre><code class="hljs c"><span class="hljs-comment">//å‚æ•°è¯´æ˜ï¼šæ­¤å‘½ä»¤åˆ é™¤æŒ‡å®šç›®å½•ã€‚</span><br><span class="hljs-comment">//      /S åˆ é™¤æŒ‡å®šç›®å½•åŠå…¶ä¸­çš„æ‰€æœ‰æ–‡ä»¶,ç”¨äºåˆ é™¤ç›®å½•æ ‘ã€‚</span><br><span class="hljs-comment">//      /Q å®‰é™æ¨¡å¼,åˆ é™¤æ—¶ä¸è¯¢é—®ã€‚ </span><br>rmdir  <span class="hljs-string">&quot;F:\Users&quot;</span> /S /Qã€€ã€€<br></code></pre></td></tr></table></figure></li>
<li>ç¡¬é“¾æ¥å°†Cç›˜æ–°Usersé“¾æ¥åˆ°æ‰€å¤‡ä»½çš„æ–‡ä»¶<figure class="highlight c"><table><tr><td class="code"><pre><code class="hljs c"><span class="hljs-comment">// å‚æ•°è¯´æ˜ï¼šæ­¤å‘½ä»¤åˆ›å»ºç¬¦å·è¿æ¥ã€‚</span><br><span class="hljs-comment">//      /J è¿æ¥ç±»å‹ä¸ºç›®å½•è¿æ¥</span><br>mklink  /J <span class="hljs-string">&quot;F:\Users&quot;</span> <span class="hljs-string">&quot;D:\Users&quot;</span><br></code></pre></td></tr></table></figure>
æœŸé—´å¯èƒ½å¤åˆ¶ä¸€éƒ¨åˆ†æ–‡ä»¶ä¸æˆåŠŸï¼Œæˆ‘çœ‹ä¸å¤ªé‡è¦å°±å¼ºåˆ¶ç»§ç»­ï¼Œåˆ é™¤å¯èƒ½ä¸å¹²å‡€ï¼Œä¹Ÿå¯é‡‡ç”¨ren å‘½ä»¤å°†Usersæ–‡ä»¶å¤¹é‡å‘½åï¼Œä¿è¯å’Œç¡¬é“¾æ¥ä¸å†²çªå³å¯ï¼Œåé¢å†å¤„ç†ï¼Œä¸ç”¨è‡ªå·±åˆ›å»ºæ–°çš„Usersï¼Œmklinkä¼šè‡ªåŠ¨ç”Ÿæˆï¼Œè‡ªå·±è¦åˆ›å»ºå¯ç”¨<strong>md</strong>å‘½ä»¤ã€‚</li>
</ol>
<h2 id="å¤‡ä»½ä»¥åŠè¿˜åŸç³»ç»Ÿ"><a href="#å¤‡ä»½ä»¥åŠè¿˜åŸç³»ç»Ÿ" class="headerlink" title="å¤‡ä»½ä»¥åŠè¿˜åŸç³»ç»Ÿ"></a>å¤‡ä»½ä»¥åŠè¿˜åŸç³»ç»Ÿ</h2><h4 id="å‰æ"><a href="#å‰æ" class="headerlink" title="å‰æ"></a>å‰æ</h4><p>æœ‰å‡ ç§æ–¹å¼ï¼Œæˆ‘ç”¨çš„dism++ å¤‡ä»½ï¼Œä¹Ÿå¯é‡‡ç”¨å‘½ä»¤è¡Œ.</p>
<ol>
<li>å‘½ä»¤è¡Œï¼š<figure class="highlight c"><table><tr><td class="code"><pre><code class="hljs c">  <span class="hljs-comment">//åˆå§‹å¤‡ä»½ï¼ˆä¾‹å¦‚ï¼šæŠŠ C åˆ†åŒºçš„ç³»ç»Ÿå¤‡ä»½åˆ° D åˆ†åŒºçš„ 1æ–‡ä»¶å¤¹ä¸­ï¼Œå¤‡ä»½æ–‡ä»¶åä¸ºBackup.wimï¼‰ï¼š</span><br>    Dism /Capture-Image /ImageFile:D:\<span class="hljs-number">1</span>\Backup.wim /CaptureDir:C:\ /Name:Backup<span class="hljs-number">-1</span> /Description:<span class="hljs-number">0000</span><span class="hljs-number">-00</span><span class="hljs-number">-00</span><br><span class="hljs-comment">// å‘½ä»¤è§£é‡Šï¼š</span><br><span class="hljs-comment">//    /Capture-Image - æŒ‡å®šæ•è·æ˜ åƒã€‚</span><br><span class="hljs-comment">//    /ImageFile: - æŒ‡å®šæ˜ åƒæ–‡ä»¶è·¯å¾„ã€‚                </span><br><span class="hljs-comment">//    /CaptureDir: - æŒ‡å®šæ•è·ç›®å½•ã€‚</span><br><span class="hljs-comment">//    /Name: - æŒ‡å®šåç§°ã€‚æ­¤é¡¹ä¸èƒ½çœç•¥ã€‚</span><br><span class="hljs-comment">//    /Description: - æŒ‡å®šæè¿°ã€‚æè¿°æ˜¯ä¸ºäº†è¯´æ˜è¿™æ¬¡å¤‡ä»½çš„å…·ä½“æƒ…å†µï¼Œæˆ‘ä»¬è¿™é‡Œç”¨äº†æ—¶é—´ã€‚æ­¤é¡¹å¯çœç•¥ã€‚</span><br></code></pre></td></tr></table></figure></li>
<li>åˆ©ç”¨è½¯ä»¶dism++<br><strong>é€‰æ‹©æ¢å¤-&gt;ç³»ç»Ÿå¤‡ä»½</strong><br><img src="https://ptpimg.me/36404v.png" alt="åœ¨è¿™é‡Œæ’å…¥å›¾ç‰‡æè¿°"><br>é€‰æ‹©ä¿å­˜çš„ç¡¬ç›˜å¹¶è¾“å…¥ä¿å­˜çš„åå­—ï¼š<br><img src="https://ptpimg.me/28h841.png" alt="åœ¨è¿™é‡Œæ’å…¥å›¾ç‰‡æè¿°"><br>ç­‰å¾…å®Œæˆå³å¯ã€‚<br><strong>æ³¨</strong>ï¼šæœ€å¥½å¤‡ä»½å‰æ¸…ç†Cç›˜ï¼Œä¿è¯ç”µè„‘æœ€å¥½çŠ¶æ€ï¼Œè¿™ä¹Ÿæ˜¯ä¸ªäººç”¨ç”µè„‘çš„å¥½ä¹ æƒ¯ã€‚</li>
</ol>
<h2 id="ç³»ç»Ÿè¿˜åŸ"><a href="#ç³»ç»Ÿè¿˜åŸ" class="headerlink" title="ç³»ç»Ÿè¿˜åŸ"></a>ç³»ç»Ÿè¿˜åŸ</h2><p>å…·ä½“å‚è€ƒä»¥ä¸‹<br> <a href="https://answers.microsoft.com/zh-hans/windows/forum/windows_10-update/%E7%94%A8-dism/a3ea0d10-036c-41ff-8bb9-350c2bda525b">ç”¨ DISM å‘½ä»¤å¤‡ä»½ä¸è¿˜åŸ Windows ç³»ç»Ÿ</a>.<br>å…³é”®æŒ‡ä»¤ï¼š</p>
<figure class="highlight c"><table><tr><td class="code"><pre><code class="hljs c"><span class="hljs-comment">//ç³»ç»Ÿè¿˜åŸï¼ˆä¾‹å¦‚ï¼šæŠŠ D:\Backup.wim ä¸­å¤‡ä»½è¿˜åŸåˆ° Cåˆ†åŒºï¼‰ï¼š</span><br>    Dism /Apply-Image /ImageFile:D:\Backup.wim/Index:<span class="hljs-number">1</span> /ApplyDir:C:\<br> <span class="hljs-comment">//   å‘½ä»¤è§£é‡Šï¼š</span><br> <span class="hljs-comment">//   /Apply-Image - æŒ‡å®šåº”ç”¨æ˜ åƒã€‚</span><br> <span class="hljs-comment">//   /ApplyDir: - æŒ‡å®šåº”ç”¨ç›®å½•ã€‚</span><br> <span class="hljs-comment">//  /Index: - æŒ‡å®šç´¢å¼•ã€‚æ­¤é¡¹ä¸èƒ½çœç•¥ã€‚ </span><br></code></pre></td></tr></table></figure>
<p><strong>å›  Dism å®‰è£… WIM æ˜ åƒä¸ä¼šåƒ Ghost é‚£æ ·æ ¼å¼åŒ–ç£ç›˜ï¼Œä¸ªäººå°±é‡ä¸Šç¬¬ä¸€æ¬¡æˆåŠŸè¿˜åŸåï¼Œåé¢è¿˜åŸé‡ä¸Šæ— æ³•è®¿é—®çš„ é”™è¯¯5ï¼Œæ‰€ä»¥å…ˆæ ¼å¼åŒ–ç³»ç»Ÿç›˜æ˜¯æœ€ç¨³å¦¥çš„ã€‚</strong><br>æ ¼å¼åŒ–æŒ‡ä»¤ï¼š</p>
<figure class="highlight c"><table><tr><td class="code"><pre><code class="hljs c">format C:/q<br><span class="hljs-comment">//    /Q  æ‰§è¡Œå¿«é€Ÿæ ¼å¼åŒ–ã€‚</span><br></code></pre></td></tr></table></figure>
<p>æ ¼å¼åŒ–éœ€è°¨æ…ï¼Œå°½é‡å¤š<strong>dir</strong>å‘½ä»¤æŸ¥çœ‹ç¡®è®¤åˆ†åŒºæ˜¯å¦æ­£ç¡®ï¼Œæ¯•ç«Ÿç³»ç»Ÿæ ¼å¼åŒ–äº†é©¬ä¸Šå°±è¿˜åŸï¼Œèµ„æ–™æ ¼å¼åŒ–å°±å•¥ä¹Ÿæ²¡äº†ã€‚</p>
<p>æ ¼å¼åŒ–å®Œæˆå†æŒ‰ä¸Šè¿°å‘½ä»¤å®Œæˆè¿˜åŸï¼Œå‡ ä¹ä¸ä¼šæœ‰é—®é¢˜ï¼Œä¸€èˆ¬ç­‰å¾…åå‡ åˆ†é’Ÿï¼Œå®Œæˆåå°±å¯ä»¥å…³é—­å‘½ä»¤çª—å£é‡å¯ç”µè„‘ï¼Œè¿‡ä¼šå°±ä¼šçœ‹è§ç†Ÿæ‚‰è¾“å…¥å¯†ç é¡µé¢äº†ã€‚</p>
<p>åˆ°æ­¤ä¸€ä¸ªå®Œæ•´è¿˜åŸå‘¨æœŸå®Œæˆï¼Œå¹³æ—¶å°½é‡å…»æˆå°†æ•°æ®ç½®äºéç³»ç»Ÿç›˜ä¹‹ä¸‹çš„ä¹ æƒ¯ï¼Œè¿™æ ·é™¤äº†å‡å°Cç›˜å®¹é‡å‹åŠ›ï¼Œä¹Ÿå¯ä½¿é‡è£…ç³»ç»Ÿå¸¦æ¥çš„å½±å“æœ€å°ï¼ŒæŸç§ç¨‹åº¦ä¿è¯è‡ªå·±ç”µè„‘ä½¿ç”¨ç¨³å®šæ€§ã€‚</p>
<p> ç¬¬ä¸€æ¬¡æ–‡æ¡£è®°å½•ï¼Œä¸ºä»¥åç³»ç»Ÿå´©æºƒæä¾›è§£å†³åŠæ³•ï¼Œä¹Ÿæ˜¯å‘å¤§å®¶åˆ†äº«æŠ˜è…¾äº†ä¸¤å¤©çš„é”™è¯¯ç»éªŒï¼Œè™½ç„¶éƒ½æ˜¯å¯ä»¥googleåˆ°çš„æ–¹æ³•ï¼Œä½†æ”¶é›†ä¿¡æ¯æ’é”™éœ€è¦æ—¶é—´ç²¾åŠ›ã€‚<strong>æ ¼å¼åŒ–CåŒº-&gt;dosè¿˜åŸç³»ç»Ÿ</strong>æ˜¯ä¸ªäººä½¿ç”¨æœ€å¿«æ·æ–¹ä¾¿çš„æ¢å¤æ“ä½œï¼Œ<br>è‹¥æœ‰é”™è¯¯æˆ–çº°æ¼å¤šå¤šæŒ‡æ­£ï¼Œè¿˜æœ‰ï¼Œå°ç™½è°¨æ…ä½¿ç”¨ä»¥ä¸Šæ–¹æ³•ï¼Œæˆ‘ä¸èƒ½ä¿è¯é”™è¯¯æ“ä½œå¯¹ç³»ç»Ÿä¸ä¼šé€ æˆæŸå¤±ã€‚</p>
]]></content>
  </entry>
</search>
